/*!
 * UEditor
 * version: ueditor
 * build: Tue Aug 25 2015 15:27:16 GMT+0800 (CST)
 */
(function(){function l(n,t,i){var r;return t=t.toLowerCase(),(r=n.__allListeners||i&&(n.__allListeners={}))&&(r[t]||i&&(r[t]=[]))}function h(n,t,i,r,u,f){var e=r&&n[t],o;for(e||(e=n[i]);!e&&(o=(o||n).parentNode);){if(o.tagName=="BODY"||f&&!f(o))return null;e=o[i]}return e&&u&&!u(e)?h(e,t,i,!1,u):e}var s,r,p,w,b,c,e,t;UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};t=window.baidu||{};window.baidu=t;window.UE=t.editor=window.UE||{};UE.plugins={};UE.commands={};UE.instants={};UE.I18N={};UE._customizeUI={};UE.version="1.4.3";var u=UE.dom={},n=UE.browser=function(){var i=navigator.userAgent.toLowerCase(),e=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(i),opera:!!e&&e.version,webkit:i.indexOf(" applewebkit/")>-1,mac:i.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"},t,r,u,f;return n.gecko=navigator.product=="Gecko"&&!n.webkit&&!n.opera&&!n.ie,t=0,n.ie&&(r=i.match(/(?:msie\s([\w.]+))/),u=i.match(/(?:trident.*rv:([\w.]+))/),t=r&&u&&r[1]&&u[1]?Math.max(r[1]*1,u[1]*1):r&&r[1]?r[1]*1:u&&u[1]?u[1]*1:0,n.ie11Compat=document.documentMode==11,n.ie9Compat=document.documentMode==9,n.ie8=!!document.documentMode,n.ie8Compat=document.documentMode==8,n.ie7Compat=t==7&&!document.documentMode||document.documentMode==7,n.ie6Compat=t<7||n.quirks,n.ie9above=t>8,n.ie9below=t<9,n.ie11above=t>10,n.ie11below=t<11),n.gecko&&(f=i.match(/rv:([\d\.]+)/),f&&(f=f[1].split("."),t=f[0]*1e4+(f[1]||0)*100+(f[2]||0)*1)),/chrome\/(\d+\.\d)/i.test(i)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(t=parseFloat(e.version())),n.webkit&&(t=parseFloat(i.match(/ applewebkit\/(\d+)/)[1])),n.version=t,n.isCompatible=!n.mobile&&(n.ie&&t>=6||n.gecko&&t>=10801||n.opera&&t>=9.5||n.air&&t>=1||n.webkit&&t>=522||!1),n}(),f=n.ie,k=n.webkit,d=n.gecko,v=n.opera,utils=UE.utils={each:function(n,t,i){var r,f,u;if(n!=null)if(n.length===+n.length){for(r=0,f=n.length;r<f;r++)if(t.call(i,n[r],r,n)===!1)return!1}else for(u in n)if(n.hasOwnProperty(u)&&t.call(i,n[u],u,n)===!1)return!1},makeInstance:function(n){var t=new Function;return t.prototype=n,n=new t,t.prototype=null,n},extend:function(n,t,i){if(t)for(var r in t)i&&n.hasOwnProperty(r)||(n[r]=t[r]);return n},extend2:function(n){for(var r,t,u=arguments,i=1;i<u.length;i++){r=u[i];for(t in r)n.hasOwnProperty(t)||(n[t]=r[t])}return n},inherits:function(n,t){var r=n.prototype,i=utils.makeInstance(t.prototype);return utils.extend(i,r,!0),n.prototype=i,i.constructor=n},bind:function(n,t){return function(){return n.apply(t,arguments)}},defer:function(n,t,i){var r;return function(){i&&clearTimeout(r);r=setTimeout(n,t)}},indexOf:function(n,t,i){var r=-1;return i=this.isNumber(i)?i:0,this.each(n,function(n,u){if(u>=i&&n===t)return r=u,!1}),r},removeItem:function(n,t){for(var i=0,r=n.length;i<r;i++)n[i]===t&&(n.splice(i,1),i--)},trim:function(n){return n.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(n){if(!n)return{};n=utils.isArray(n)?n:n.split(",");for(var r=0,t,i={};t=n[r++];)i[t.toUpperCase()]=i[t]=1;return i},unhtml:function(n,t){return n?n.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(n,t){return t?n:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[n]}):""},html:function(n){return n?n.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(n){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[n]}):""},cssStyleToDomStyle:function(){var n=document.createElement("div").style,t={float:n.cssFloat!=undefined?"cssFloat":n.styleFloat!=undefined?"styleFloat":"float"};return function(n){return t[n]||(t[n]=n.toLowerCase().replace(/-./g,function(n){return n.charAt(1).toUpperCase()}))}}(),loadFile:function(){function t(t,i){try{for(var u=0,r;r=n[u++];)if(r.doc===t&&r.url==(i.src||i.href))return r}catch(f){return null}}var n=[];return function(i,r,u){var e=t(i,r),s,f,o;if(e){e.ready?u&&u():e.funs.push(u);return}if(n.push({doc:i,url:r.src||r.href,funs:[u]}),!i.body){s=[];for(o in r)o!="tag"&&s.push(o+'="'+r[o]+'"');i.write("<"+r.tag+" "+s.join(" ")+" ><\/"+r.tag+">");return}if(!r.id||!i.getElementById(r.id)){f=i.createElement(r.tag);delete r.tag;for(o in r)f.setAttribute(o,r[o]);f.onload=f.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(e=t(i,r),e.funs.length>0){e.ready=1;for(var n;n=e.funs.pop();)n()}f.onload=f.onreadystatechange=null}};f.onerror=function(){throw Error("The load "+(r.href||r.src)+" fails,check the url settings of file ueditor.config.js ");};i.getElementsByTagName("head")[0].appendChild(f)}}}(),isEmptyObject:function(n){if(n==null)return!0;if(this.isArray(n)||this.isString(n))return n.length===0;for(var t in n)if(n.hasOwnProperty(t))return!1;return!0},fixColor:function(n,t){var r,u,i;if(/color/i.test(n)&&/rgba?/.test(t)){if(r=t.split(","),r.length>3)return"";for(t="#",u=0;i=r[u++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=i.length==1?"0"+i:i;t=t.toUpperCase()}return t},optCss:function(n){function r(n,t){var o;if(!n)return"";var r=n.top,u=n.bottom,i=n.left,f=n.right,e="";if(r&&i&&u&&f)e+=";"+t+":"+(r==u&&u==i&&i==f?r:r==u&&i==f?r+" "+i:i==f?r+" "+i+" "+u:r+" "+f+" "+u+" "+i)+";";else for(o in n)e+=";"+t+"-"+o+":"+n[o]+";";return e}var t,i;return n=n.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(n,r,u,f){if(f.split(" ").length==1)switch(r){case"padding":return t||(t={}),t[u]=f,"";case"margin":return i||(i={}),i[u]=f,"";case"border":return f=="initial"?"":n}return n}),n+=r(t,"padding")+r(i,"margin"),n.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(n,t){return t?t+";;":";"})},clone:function(n,t){var r,i;t=t||{};for(i in n)n.hasOwnProperty(i)&&(r=n[i],typeof r=="object"?(t[i]=utils.isArray(r)?[]:{},utils.clone(n[i],t[i])):t[i]=r);return t},transUnitToPx:function(n){if(!/(pt|cm)/.test(n))return n;var t;n.replace(/([\d.]+)(\w+)/,function(i,r,u){n=r;t=u});switch(t){case"cm":n=parseFloat(n)*25;break;case"pt":n=Math.round(parseFloat(n)*96/72)}return n+(n?"px":"")},domReady:function(){function t(n){n.isReady=!0;for(var t;t=i.pop();t());}var i=[];return function(r,u){u=u||window;var f=u.document;r&&i.push(r);f.readyState==="complete"?t(f):(f.isReady&&t(f),n.ie&&n.version!=11?(function(){if(!f.isReady){try{f.documentElement.doScroll("left")}catch(n){setTimeout(arguments.callee,0);return}t(f)}}(),u.attachEvent("onload",function(){t(f)})):(f.addEventListener("DOMContentLoaded",function(){f.removeEventListener("DOMContentLoaded",arguments.callee,!1);t(f)},!1),u.addEventListener("load",function(){t(f)},!1)))}}(),cssRule:n.ie&&n.version!=11?function(n,t,i){var u,r;if(t===undefined||t&&t.nodeType&&t.nodeType==9)return(i=t&&t.nodeType&&t.nodeType==9?t:i||document,u=i.indexList||(i.indexList={}),r=u[n],r!==undefined)?i.styleSheets[r].cssText:undefined;if(i=i||document,u=i.indexList||(i.indexList={}),r=u[n],t==="")return r!==undefined?(i.styleSheets[r].cssText="",delete u[n],!0):!1;r!==undefined?sheetStyle=i.styleSheets[r]:(sheetStyle=i.createStyleSheet("",r=i.styleSheets.length),u[n]=r);sheetStyle.cssText=t}:function(n,t,i){var r;if(t===undefined||t&&t.nodeType&&t.nodeType==9)return i=t&&t.nodeType&&t.nodeType==9?t:i||document,r=i.getElementById(n),r?r.innerHTML:undefined;if(i=i||document,r=i.getElementById(n),t==="")return r?(r.parentNode.removeChild(r),!0):!1;r?r.innerHTML=t:(r=i.createElement("style"),r.id=n,r.innerHTML=t,i.getElementsByTagName("head")[0].appendChild(r))},sort:function(n,t){var i,u,r,f,e;for(t=t||function(n,t){return n.localeCompare(t)},i=0,u=n.length;i<u;i++)for(r=i,f=n.length;r<f;r++)t(n[i],n[r])>0&&(e=n[i],n[i]=n[r],n[r]=e);return n},serializeParam:function(n){var r=[],t,i;for(t in n)if(t!="method"&&t!="timeout"&&t!="async")if((typeof n[t]).toLowerCase()=="function"||(typeof n[t]).toLowerCase()=="object"){if(utils.isArray(n[t]))for(i=0;i<n[t].length;i++)r.push(encodeURIComponent(t)+"[]="+encodeURIComponent(n[t][i]))}else r.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return r.join("&")},formatUrl:function(n){var t=n.replace(/&&/g,"&");return t=t.replace(/\?&/g,"?"),t=t.replace(/&$/g,""),t=t.replace(/&#/g,"#"),t.replace(/&+/g,"&")},isCrossDomainUrl:function(t){var i=document.createElement("a");return i.href=t,n.ie&&(i.href=i.href),!(i.protocol==location.protocol&&i.hostname==location.hostname&&(i.port==location.port||i.port=="80"&&location.port==""||i.port==""&&location.port=="80"))},clearEmptyAttrs:function(n){for(var t in n)n[t]===""&&delete n[t];return n},str2json:function(n){return utils.isString(n)?window.JSON?JSON.parse(n):new Function("return "+utils.trim(n||""))():null},json2str:function(){if(window.JSON)return JSON.stringify;var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function i(n){return/["\\\x00-\x1f]/.test(n)&&(n=n.replace(/["\\\x00-\x1f]/g,function(n){var i=t[n];return i?i:(i=n.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))})),'"'+n+'"'}function r(n){for(var t=["["],f=n.length,u,r,i=0;i<f;i++){r=n[i];switch(typeof r){case"undefined":case"function":case"unknown":break;default:u&&t.push(",");t.push(utils.json2str(r));u=1}}return t.push("]"),t.join("")}function n(n){return n<10?"0"+n:n}function u(t){return'"'+t.getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate())+"T"+n(t.getHours())+":"+n(t.getMinutes())+":"+n(t.getSeconds())+'"'}return function(n){var t,e,s,o,f;switch(typeof n){case"undefined":return"undefined";case"number":return isFinite(n)?String(n):"null";case"string":return i(n);case"boolean":return String(n);default:if(n===null)return"null";if(utils.isArray(n))return r(n);if(utils.isDate(n))return u(n);t=["{"];e=utils.json2str;for(f in n)if(Object.prototype.hasOwnProperty.call(n,f)){o=n[f];switch(typeof o){case"undefined":case"unknown":case"function":break;default:s&&t.push(",");s=1;t.push(e(f)+":"+e(o))}}return t.push("}"),t.join("")}}}()};utils.each(["String","Function","Array","Number","RegExp","Object","Date"],function(n){UE.utils["is"+n]=function(t){return Object.prototype.toString.apply(t)=="[object "+n+"]"}});s=UE.EventBase=function(){};s.prototype={addListener:function(n,t){n=utils.trim(n).split(/\s+/);for(var r=0,i;i=n[r++];)l(this,i,!0).push(t)},on:function(n,t){return this.addListener(n,t)},off:function(n,t){return this.removeListener(n,t)},trigger:function(){return this.fireEvent.apply(this,arguments)},removeListener:function(n,t){n=utils.trim(n).split(/\s+/);for(var r=0,i;i=n[r++];)utils.removeItem(l(this,i)||[],t)},fireEvent:function(){for(var r=arguments[0],u,t,f,n,i,r=utils.trim(r).split(" "),e=0;u=r[e++];){if(t=l(this,u),t)for(i=t.length;i--;)if(t[i]){if(n=t[i].apply(this,arguments),n===!0)return n;n!==undefined&&(f=n)}(n=this["on"+u.toLowerCase()])&&(f=n.apply(this,arguments))}return f}};r=u.dtd=function(){function n(n){for(var t in n)n[t.toUpperCase()]=n[t];return n}var i=utils.extend2,s=n({isindex:1,fieldset:1}),l=n({input:1,button:1,select:1,textarea:1,label:1}),a=i(n({a:1}),l),h=i({iframe:1},a),f=n({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),v=n({ins:1,del:1,script:1,style:1}),y=i(n({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),v),p=i(n({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),y),e=i(n({p:1}),p),w=i(n({iframe:1}),p,l),b=n({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),t=i(n({a:0}),w),c=n({tr:1}),u=n({"#":1}),k=i(n({param:1}),b),r=i(n({form:1}),s,h,f,e),o=n({li:1,ol:1,ul:1}),tt=n({style:1,script:1}),d=n({base:1,link:1,meta:1,title:1}),it=i(d,tt),g=n({head:1,body:1}),rt=n({html:1}),nt=n({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),ut=n({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return n({$nonBodyContent:i(rt,g,d),$block:nt,$inline:t,$inlineWithA:i(n({a:1}),t),$body:i(n({script:1,style:1}),nt),$cdata:n({script:1,style:1}),$empty:ut,$nonChild:n({iframe:1,textarea:1}),$listItem:n({dd:1,dt:1,li:1}),$list:n({ul:1,ol:1,dl:1}),$isNotEmpty:n({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:n({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:n({p:1,div:1}),$tableContent:n({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:n({pre:1,script:1,style:1,textarea:1}),html:g,head:it,style:u,script:u,body:r,base:{},link:{},meta:{},title:u,col:{},tr:n({td:1,th:1}),img:{},embed:{},colgroup:n({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:r,td:r,br:{},th:r,center:r,kbd:t,button:i(e,f),basefont:{},h5:t,h4:t,samp:t,h6:t,ol:o,h1:t,h3:t,option:u,h2:t,form:i(s,h,f,e),select:n({optgroup:1,option:1}),font:t,ins:t,menu:o,abbr:t,label:t,table:n({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:t,tfoot:c,cite:t,li:r,input:{},iframe:r,strong:t,textarea:u,noframes:r,big:t,small:t,span:n({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:t,dt:t,sub:t,optgroup:n({option:1}),param:{},bdo:t,"var":t,div:r,object:k,sup:t,dd:r,strike:t,area:{},dir:o,map:i(n({area:1,form:1,p:1}),s,v,f),applet:k,dl:n({dt:1,dd:1}),del:t,isindex:{},fieldset:i(n({legend:1}),b),thead:c,ul:o,acronym:t,b:t,a:i(n({a:1}),w),blockquote:i(n({td:1,tr:1,tbody:1,li:1}),r),caption:t,i:t,u:t,tbody:c,s:t,address:i(h,e),tt:t,legend:t,q:t,pre:i(y,a),p:i(n({a:1}),t),em:t,dfn:t})}();var a=f&&n.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},y=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=u.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:f&&n.version=="6"?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(n,t){var i,r,u,f;if(n===t)return 0;for(r=[n],u=[t],i=n;i=i.parentNode;){if(i===t)return 10;r.push(i)}for(i=t;i=i.parentNode;){if(i===n)return 20;u.push(i)}if(r.reverse(),u.reverse(),r[0]!==u[0])return 1;for(f=-1;f++,r[f]===u[f];);for(n=r[f],t=u[f];n=n.nextSibling;)if(n===t)return 4;return 2},getNodeIndex:function(n,t){for(var i=n,r=0;i=i.previousSibling;){if(t&&i.nodeType==3){i.nodeType!=i.nextSibling.nodeType&&r++;continue}r++}return r},inDoc:function(n,t){return domUtils.getPosition(n,t)==10},findParent:function(n,t,i){if(n&&!domUtils.isBody(n))for(n=i?n:n.parentNode;n;){if(!t||t(n)||domUtils.isBody(n))return t&&!t(n)&&domUtils.isBody(n)?null:n;n=n.parentNode}return null},findParentByTagName:function(n,t,i,r){return t=utils.listToMap(utils.isArray(t)?t:[t]),domUtils.findParent(n,function(n){return t[n.tagName]&&!(r&&r(n))},i)},findParents:function(n,t,i,r){for(var u=t&&(i&&i(n)||!i)?[n]:[];n=domUtils.findParent(n,i);)u.push(n);return r?u:u.reverse()},insertAfter:function(n,t){return n.nextSibling?n.parentNode.insertBefore(t,n.nextSibling):n.parentNode.appendChild(t)},remove:function(n,t){var i=n.parentNode,r;if(i){if(t&&n.hasChildNodes())while(r=n.firstChild)i.insertBefore(r,n);i.removeChild(n)}return n},getNextDomNode:function(n,t,i,r){return h(n,"firstChild","nextSibling",t,i,r)},getPreDomNode:function(n,t,i,r){return h(n,"lastChild","previousSibling",t,i,r)},isBookmarkNode:function(n){return n.nodeType==1&&n.id&&/^_baidu_bookmark_/i.test(n.id)},getWindow:function(n){var t=n.ownerDocument||n;return t.defaultView||t.parentWindow},getCommonAncestor:function(n,t){if(n===t)return n;for(var u=[n],f=[t],i=n,r=-1;i=i.parentNode;){if(i===t)return i;u.push(i)}for(i=t;i=i.parentNode;){if(i===n)return i;f.push(i)}for(u.reverse(),f.reverse();r++,u[r]===f[r];);return r==0?null:u[r-1]},clearEmptySibling:function(n,t,i){function r(n,t){for(var i;n&&!domUtils.isBookmarkNode(n)&&(domUtils.isEmptyInlineElement(n)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(n.nodeValue));)i=n[t],domUtils.remove(n),n=i}t||r(n.nextSibling,"nextSibling");i||r(n.previousSibling,"previousSibling")},split:function(t,i){var f=t.ownerDocument,e,r,u;return n.ie&&i==t.nodeValue.length?(e=f.createTextNode(""),domUtils.insertAfter(t,e)):(r=t.splitText(i),n.ie8&&(u=f.createTextNode(""),domUtils.insertAfter(r,u),domUtils.remove(u)),r)},isWhitespace:function(n){return!new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(n.nodeValue)},getXY:function(n){for(var t=0,i=0;n.offsetParent;)i+=n.offsetTop,t+=n.offsetLeft,n=n.offsetParent;return{x:t,y:i}},on:function(n,t,i){var e=utils.isArray(t)?t:utils.trim(t).split(/\s+/),u=e.length,r,f;if(u)while(u--)t=e[u],n.addEventListener?n.addEventListener(t,i,!1):(i._d||(i._d={els:[]}),r=t+i.toString(),f=utils.indexOf(i._d.els,n),i._d[r]&&f!=-1||(f==-1&&i._d.els.push(n),i._d[r]||(i._d[r]=function(n){return i.call(n.srcElement,n||window.event)}),n.attachEvent("on"+t,i._d[r])));n=null},un:function(n,t,i){var e=utils.isArray(t)?t:utils.trim(t).split(/\s+/),u=e.length,r,f;if(u)while(u--)if(t=e[u],n.removeEventListener)n.removeEventListener(t,i,!1);else{r=t+i.toString();try{n.detachEvent("on"+t,i._d?i._d[r]:i)}catch(o){}i._d&&i._d[r]&&(f=utils.indexOf(i._d.els,n),f!=-1&&i._d.els.splice(f,1),i._d.els.length==0&&delete i._d[r])}},isSameElement:function(n,t){var s,u,i,r,e,h,o;if(n.tagName!=t.tagName||(s=n.attributes,u=t.attributes,!f&&s.length!=u.length))return!1;for(e=0,h=0,o=0;i=s[o++];){if(i.nodeName=="style")if(i.specified&&e++,domUtils.isSameStyle(n,t))continue;else return!1;if(f)if(i.specified)e++,r=u.getNamedItem(i.nodeName);else continue;else r=t.attributes[i.nodeName];if(!r.specified||i.nodeValue!=r.nodeValue)return!1}if(f){for(o=0;r=u[o++];)r.specified&&h++;if(e!=h)return!1}return!0},isSameStyle:function(t,i){var r=t.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),u=i.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),f,e,o;if(n.opera){if(r=t.style,u=i.style,r.length!=u.length)return!1;for(f in r)if(!/^(\d+|csstext)$/i.test(f)&&r[f]!=u[f])return!1;return!0}if(!r||!u)return r==u;if(r=r.split(";"),u=u.split(";"),r.length!=u.length)return!1;for(e=0;o=r[e++];)if(utils.indexOf(u,o)==-1)return!1;return!0},isBlockElm:function(n){return n.nodeType==1&&(r.$block[n.tagName]||y[domUtils.getComputedStyle(n,"display")])&&!r.$nonChild[n.tagName]},isBody:function(n){return n&&n.nodeType==1&&n.tagName.toLowerCase()=="body"},breakParent:function(n,t){var i,u=n,e=n,r,f;do{for(u=u.parentNode,r?(i=u.cloneNode(!1),i.appendChild(r),r=i,i=u.cloneNode(!1),i.appendChild(f),f=i):(r=u.cloneNode(!1),f=r.cloneNode(!1));i=e.previousSibling;)r.insertBefore(i,r.firstChild);while(i=e.nextSibling)f.appendChild(i);e=u}while(t!==u);return i=t.parentNode,i.insertBefore(r,t),i.insertBefore(f,t),i.insertBefore(n,f),domUtils.remove(t),n},isEmptyInlineElement:function(n){if(n.nodeType!=1||!r.$removeEmpty[n.tagName])return 0;for(n=n.firstChild;n;){if(domUtils.isBookmarkNode(n)||n.nodeType==1&&!domUtils.isEmptyInlineElement(n)||n.nodeType==3&&!domUtils.isWhitespace(n))return 0;n=n.nextSibling}return 1},trimWhiteTextNode:function(n){function t(t){for(var i;(i=n[t])&&i.nodeType==3&&domUtils.isWhitespace(i);)n.removeChild(i)}t("firstChild");t("lastChild")},mergeChild:function(n,t,i){for(var u,e,f,o=domUtils.getElementsByTagName(n,n.tagName.toLowerCase()),s=0,r;r=o[s++];)if(r.parentNode&&!domUtils.isBookmarkNode(r)){if(r.tagName.toLowerCase()=="span"){if(n===r.parentNode&&(domUtils.trimWhiteTextNode(n),n.childNodes.length==1)){n.style.cssText=r.style.cssText+";"+n.style.cssText;domUtils.remove(r,!0);continue}if(r.style.cssText=n.style.cssText+";"+r.style.cssText,i&&(u=i.style,u))for(u=u.split(";"),e=0;f=u[e++];)r.style[utils.cssStyleToDomStyle(f.split(":")[0])]=f.split(":")[1];domUtils.isSameStyle(r,n)&&domUtils.remove(r,!0);continue}domUtils.isSameElement(n,r)&&domUtils.remove(r,!0)}},getElementsByTagName:function(n,t,i){var f,r,e,o,s,h,u;for(i&&utils.isString(i)&&(f=i,i=function(n){return domUtils.hasClass(n,f)}),t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" "),r=[],e=0;o=t[e++];)for(s=n.getElementsByTagName(o),h=0;u=s[h++];)(!i||i(u))&&r.push(u);return r},mergeToParent:function(n){for(var t=n.parentNode;t&&r.$removeEmpty[t.tagName];){if(t.tagName==n.tagName||t.tagName=="A"){if(domUtils.trimWhiteTextNode(t),t.tagName=="SPAN"&&!domUtils.isSameStyle(t,n)||t.tagName=="A"&&n.tagName=="SPAN")if(t.childNodes.length>1||t!==n.parentNode){n.style.cssText=t.style.cssText+";"+n.style.cssText;t=t.parentNode;continue}else t.style.cssText+=";"+n.style.cssText,t.tagName=="A"&&(t.style.textDecoration="underline");if(t.tagName!="A"){t===n.parentNode&&domUtils.remove(n,!0);break}}t=t.parentNode}},mergeSibling:function(n,t,i){function r(n,t,i){var r;if((r=i[n])&&!domUtils.isBookmarkNode(r)&&r.nodeType==1&&domUtils.isSameElement(i,r)){while(r.firstChild)t=="firstChild"?i.insertBefore(r.lastChild,i.firstChild):i.appendChild(r.firstChild);domUtils.remove(r)}}t||r("previousSibling","firstChild",n);i||r("nextSibling","lastChild",n)},unSelectable:f&&n.ie9below||n.opera?function(n){n.onselectstart=function(){return!1};n.onclick=n.onkeyup=n.onkeydown=function(){return!1};n.unselectable="on";n.setAttribute("unselectable","on");for(var i=0,t;t=n.all[i++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on";n.setAttribute("unselectable","on")}}:function(n){n.style.MozUserSelect=n.style.webkitUserSelect=n.style.msUserSelect=n.style.KhtmlUserSelect="none"},removeAttributes:function(t,i){var f,r,u;for(i=utils.isArray(i)?i:utils.trim(i).replace(/[ ]{2,}/g," ").split(" "),f=0;r=i[f++];){r=a[r]||r;switch(r){case"className":t[r]="";break;case"style":t.style.cssText="";u=t.getAttributeNode("style");!n.ie&&u&&t.removeAttributeNode(u)}t.removeAttribute(r)}},createElement:function(n,t,i){return domUtils.setAttributes(n.createElement(t),i)},setAttributes:function(n,t){var i,r;for(i in t)if(t.hasOwnProperty(i)){r=t[i];switch(i){case"class":n.className=r;break;case"style":n.style.cssText=n.style.cssText+";"+r;break;case"innerHTML":n[i]=r;break;case"value":n.value=r;break;default:n.setAttribute(a[i]||i,r)}}return n},getComputedStyle:function(t,i){var u,f,e;if("width height top left".indexOf(i)>-1)return t["offset"+i.replace(/^\w/,function(n){return n.toUpperCase()})]+"px";if(t.nodeType==3&&(t=t.parentNode),n.ie&&n.version<9&&i=="font-size"&&!t.style.fontSize&&!r.$empty[t.tagName]&&!r.$nonChild[t.tagName])return u=t.ownerDocument.createElement("span"),u.style.cssText="padding:0;border:0;font-family:simsun;",u.innerHTML=".",t.appendChild(u),f=u.offsetHeight,t.removeChild(u),u=null,f+"px";try{e=domUtils.getStyle(t,i)||(window.getComputedStyle?domUtils.getWindow(t).getComputedStyle(t,"").getPropertyValue(i):(t.currentStyle||t.style)[utils.cssStyleToDomStyle(i)])}catch(o){return""}return utils.transUnitToPx(utils.fixColor(i,e))},removeClasses:function(n,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var u=0,r,i=n.className;r=t[u++];)i=i.replace(new RegExp("\\b"+r+"\\b"),"");i=utils.trim(i).replace(/[ ]{2,}/g," ");i?n.className=i:domUtils.removeAttributes(n,["class"])},addClass:function(n,t){if(n){t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var u=0,i,r=n.className;i=t[u++];)new RegExp("\\b"+i+"\\b").test(r)||(r+=" "+i);n.className=utils.trim(r)}},hasClass:function(n,t){if(utils.isRegExp(t))return t.test(n.className);t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,r,u=n.className;r=t[i++];)if(!new RegExp("\\b"+r+"\\b","i").test(u))return!1;return i-1==t.length},preventDefault:function(n){n.preventDefault?n.preventDefault():n.returnValue=!1},removeStyle:function(t,i){n.ie?(i=="color"&&(i="(^|;)"+i),t.style.cssText=t.style.cssText.replace(new RegExp(i+"[^:]*:[^;]+;?","ig"),"")):t.style.removeProperty?t.style.removeProperty(i):t.style.removeAttribute(utils.cssStyleToDomStyle(i));t.style.cssText||domUtils.removeAttributes(t,["style"])},getStyle:function(n,t){var i=n.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,i)},setStyle:function(n,t,i){n.style[utils.cssStyleToDomStyle(t)]=i;utils.trim(n.style.cssText)||this.removeAttributes(n,"style")},setStyles:function(n,t){for(var i in t)t.hasOwnProperty(i)&&domUtils.setStyle(n,i,t[i])},removeDirtyAttr:function(n){for(var i=0,t,r=n.getElementsByTagName("*");t=r[i++];)t.removeAttribute("_moz_dirty");n.removeAttribute("_moz_dirty")},getChildCount:function(n,t){var r=0,i=n.firstChild;for(t=t||function(){return 1};i;)t(i)&&r++,i=i.nextSibling;return r},isEmptyNode:function(n){return!n.firstChild||domUtils.getChildCount(n,function(n){return!domUtils.isBr(n)&&!domUtils.isBookmarkNode(n)&&!domUtils.isWhitespace(n)})==0},clearSelectedArr:function(n){for(var t;t=n.pop();)domUtils.removeAttributes(t,["class"])},scrollToView:function(n,t,i){var o=function(){var n=t.document,i=n.compatMode=="CSS1Compat";return{width:(i?n.documentElement.clientWidth:n.body.clientWidth)||0,height:(i?n.documentElement.clientHeight:n.body.clientHeight)||0}},s=function(n){if("pageXOffset"in n)return{x:n.pageXOffset||0,y:n.pageYOffset||0};var t=n.document;return{x:t.documentElement.scrollLeft||t.body.scrollLeft||0,y:t.documentElement.scrollTop||t.body.scrollTop||0}},f=o().height,r=f*-1+i,e,u;r+=n.offsetHeight||0;e=domUtils.getXY(n);r+=e.y;u=s(t).y;(r>u||r<u-f)&&t.scrollTo(0,r+(r<0?-20:20))},isBr:function(n){return n.nodeType==1&&n.tagName=="BR"},isFillChar:function(n,t){if(n.nodeType!=3)return!1;var i=n.nodeValue;return t?new RegExp("^"+domUtils.fillChar).test(i):!i.replace(new RegExp(domUtils.fillChar,"g"),"").length},isStartInblock:function(n){var i=n.cloneRange(),e=0,t=i.startContainer,u,r,f;if(t.nodeType==1&&t.childNodes[i.startOffset])for(t=t.childNodes[i.startOffset],r=t.previousSibling;r&&domUtils.isFillChar(r);)t=r,r=r.previousSibling;for(this.isFillChar(t,!0)&&i.startOffset==1&&(i.setStartBefore(t),t=i.startContainer);t&&domUtils.isFillChar(t);)u=t,t=t.previousSibling;for(u&&(i.setStartBefore(u),t=i.startContainer),t.nodeType==1&&domUtils.isEmptyNode(t)&&i.startOffset==1&&i.setStart(t,0).collapse(!0);!i.startOffset;){if(t=i.startContainer,domUtils.isBlockElm(t)||domUtils.isBody(t)){e=1;break}if(r=i.startContainer.previousSibling,r){while(r&&domUtils.isFillChar(r))f=r,r=r.previousSibling;f?i.setStartBefore(f):i.setStartBefore(i.startContainer)}else i.setStartBefore(i.startContainer)}return e&&!domUtils.isBody(i.startContainer)?1:0},isEmptyBlock:function(t,i){if(t.nodeType!=1||(i=i||new RegExp("[  \t\r\n"+domUtils.fillChar+"]","g"),t[n.ie?"innerText":"textContent"].replace(i,"").length>0))return 0;for(var u in r.$isNotEmpty)if(t.getElementsByTagName(u).length)return 0;return 1},setViewportOffset:function(n,t){var f=parseInt(n.style.left)|0,e=parseInt(n.style.top)|0,i=n.getBoundingClientRect(),r=t.left-i.left,u=t.top-i.top;r&&(n.style.left=f+r+"px");u&&(n.style.top=e+u+"px")},fillNode:function(t,i){var r=n.ie?t.createTextNode(domUtils.fillChar):t.createElement("br");i.innerHTML="";i.appendChild(r)},moveChild:function(n,t,i){while(n.firstChild)i&&t.firstChild?t.insertBefore(n.lastChild,t.firstChild):t.appendChild(n.firstChild)},hasNoAttributes:function(t){return n.ie?/^<\w+\s*?>/.test(t.outerHTML):t.attributes.length==0},isCustomeNode:function(n){return n.nodeType==1&&n.getAttribute("_ue_custom_node_")},isTagNode:function(n,t){return n.nodeType==1&&new RegExp("\\b"+n.tagName+"\\b","i").test(t)},filterNodeList:function(n,t,i){var r=[],u;return utils.isFunction(t)||(u=t,t=function(n){return utils.indexOf(utils.isArray(u)?u:u.split(" "),n.tagName.toLowerCase())!=-1}),utils.each(n,function(n){t(n)&&r.push(n)}),r.length==0?null:r.length==1||!i?r[0]:r},isInNodeEndBoundary:function(n,t){var i=n.startContainer;if(i.nodeType==3&&n.startOffset!=i.nodeValue.length||i.nodeType==1&&n.startOffset!=i.childNodes.length)return 0;while(i!==t){if(i.nextSibling)return 0;i=i.parentNode}return 1},isBoundaryNode:function(n,t){for(var i;!domUtils.isBody(n);)if(i=n,n=n.parentNode,i!==n[t])return!1;return!0},fillHtml:n.ie11below?"&nbsp;":"<br/>"},o=new RegExp(domUtils.fillChar,"g");(function(){function v(n){n.collapsed=n.startContainer&&n.endContainer&&n.startContainer===n.endContainer&&n.startOffset==n.endOffset}function h(n){return!n.collapsed&&n.startContainer.nodeType==1&&n.startContainer===n.endContainer&&n.endOffset-n.startOffset==1}function c(n,t,i,u){return t.nodeType==1&&(r.$empty[t.tagName]||r.$nonChild[t.tagName])&&(i=domUtils.getNodeIndex(t)+(n?0:1),t=t.parentNode),n?(u.startContainer=t,u.startOffset=i,u.endContainer||u.collapse(!0)):(u.endContainer=t,u.endOffset=i,u.startContainer||u.collapse(!1)),v(u),u}function e(n,t){var i=n.startContainer,e=n.endContainer,o=n.startOffset,p=n.endOffset,c=n.document,w=c.createDocumentFragment(),b,k,u,v,s,y;if(i.nodeType==1&&(i=i.childNodes[o]||(b=i.appendChild(c.createTextNode("")))),e.nodeType==1&&(e=e.childNodes[p]||(k=e.appendChild(c.createTextNode("")))),i===e&&i.nodeType==3)return w.appendChild(c.createTextNode(i.substringData(o,p-o))),t&&(i.deleteData(o,p-o),n.collapse(!0)),w;var r,l,f=w,h=domUtils.findParents(i,!0),a=domUtils.findParents(e,!0);for(u=0;h[u]==a[u];)u++;for(s=u;v=h[s];s++){for(r=v.nextSibling,v==i?b||(n.startContainer.nodeType==3?(f.appendChild(c.createTextNode(i.nodeValue.slice(o))),t&&i.deleteData(o,i.nodeValue.length-o)):f.appendChild(t?i:i.cloneNode(!0))):(l=v.cloneNode(!1),f.appendChild(l));r;){if(r===e||r===a[s])break;v=r.nextSibling;f.appendChild(t?r:r.cloneNode(!0));r=v}f=l}for(f=w,h[u]||(f.appendChild(h[u-1].cloneNode(!1)),f=f.firstChild),s=u;y=a[s];s++){if(r=y.previousSibling,y==e?k||n.endContainer.nodeType!=3||(f.appendChild(c.createTextNode(e.substringData(0,p))),t&&e.deleteData(0,p)):(l=y.cloneNode(!1),f.appendChild(l)),s!=u||!h[u])while(r){if(r===i)break;y=r.previousSibling;f.insertBefore(t?r:r.cloneNode(!0),f.firstChild);r=y}f=l}return t&&n.setStartBefore(a[u]?h[u]?a[u]:h[u-1]:a[u-1]).collapse(!0),b&&domUtils.remove(b),k&&domUtils.remove(k),w}function a(i,r){try{if(t&&domUtils.inDoc(t,i))if(t.nodeValue.replace(o,"").length)t.nodeValue=t.nodeValue.replace(o,"");else{var u=t.parentNode;for(domUtils.remove(t);u&&domUtils.isEmptyInlineElement(u)&&(n.safari?!(domUtils.getPosition(u,r)&domUtils.POSITION_CONTAINS):!u.contains(r));)t=u.parentNode,domUtils.remove(u),u=t}}catch(f){}}function i(n,t){var i;for(n=n[t];n&&domUtils.isFillChar(n);)i=n[t],domUtils.remove(n),n=i}var s=0,f=domUtils.fillChar,t,l=u.Range=function(n){var t=this;t.startContainer=t.startOffset=t.endContainer=t.endOffset=null;t.document=n;t.collapsed=!0};l.prototype={cloneContents:function(){return this.collapsed?null:e(this,0)},deleteContents:function(){var t;return this.collapsed||e(this,1),n.webkit&&(t=this.startContainer,t.nodeType!=3||t.nodeValue.length||(this.setStartBefore(t).collapse(!0),domUtils.remove(t))),this},extractContents:function(){return this.collapsed?null:e(this,2)},setStart:function(n,t){return c(!0,n,t,this)},setEnd:function(n,t){return c(!1,n,t,this)},setStartAfter:function(n){return this.setStart(n.parentNode,domUtils.getNodeIndex(n)+1)},setStartBefore:function(n){return this.setStart(n.parentNode,domUtils.getNodeIndex(n))},setEndAfter:function(n){return this.setEnd(n.parentNode,domUtils.getNodeIndex(n)+1)},setEndBefore:function(n){return this.setEnd(n.parentNode,domUtils.getNodeIndex(n))},setStartAtFirst:function(n){return this.setStart(n,0)},setStartAtLast:function(n){return this.setStart(n,n.nodeType==3?n.nodeValue.length:n.childNodes.length)},setEndAtFirst:function(n){return this.setEnd(n,0)},setEndAtLast:function(n){return this.setEnd(n,n.nodeType==3?n.nodeValue.length:n.childNodes.length)},selectNode:function(n){return this.setStartBefore(n).setEndAfter(n)},selectNodeContents:function(n){return this.setStart(n,0).setEndAtLast(n)},cloneRange:function(){var n=this;return new l(n.document).setStart(n.startContainer,n.startOffset).setEnd(n.endContainer,n.endOffset)},collapse:function(n){var t=this;return n?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(n){function u(n){return n.nodeType==1&&!domUtils.isBookmarkNode(n)&&!r.$empty[n.tagName]&&!r.$nonChild[n.tagName]}for(var t=this,i,f=t.collapsed;t.startContainer.nodeType==1&&(i=t.startContainer.childNodes[t.startOffset])&&u(i);)t.setStart(i,0);if(f)return t.collapse(!0);if(!n)while(t.endContainer.nodeType==1&&t.endOffset>0&&(i=t.endContainer.childNodes[t.endOffset-1])&&u(i))t.setEnd(i,i.childNodes.length);return t},getCommonAncestor:function(n,t){var r=this,i=r.startContainer,u=r.endContainer;return i===u?n&&h(this)&&(i=i.childNodes[r.startOffset],i.nodeType==1)?i:t&&i.nodeType==3?i.parentNode:i:domUtils.getCommonAncestor(i,u)},trimBoundary:function(n){var u;this.txtToElmBoundary();var r=this.startContainer,t=this.startOffset,f=this.collapsed,i=this.endContainer;return r.nodeType==3&&(t==0?this.setStartBefore(r):t>=r.nodeValue.length?this.setStartAfter(r):(u=domUtils.split(r,t),r===i?this.setEnd(u,this.endOffset-t):r.parentNode===i&&(this.endOffset+=1),this.setStartBefore(u)),f)?this.collapse(!0):(n||(t=this.endOffset,i=this.endContainer,i.nodeType==3&&(t==0?this.setEndBefore(i):(t<i.nodeValue.length&&domUtils.split(i,t),this.setEndAfter(i)))),this)},txtToElmBoundary:function(n){function t(n,t){var i=n[t+"Container"],r=n[t+"Offset"];i.nodeType==3&&(r?r>=i.nodeValue.length&&n["set"+t.replace(/(\w)/,function(n){return n.toUpperCase()})+"After"](i):n["set"+t.replace(/(\w)/,function(n){return n.toUpperCase()})+"Before"](i))}return(n||!this.collapsed)&&(t(this,"start"),t(this,"end")),this},insertNode:function(n){var t=n,r=1;n.nodeType==11&&(t=n.firstChild,r=n.childNodes.length);this.trimBoundary(!0);var i=this.startContainer,f=this.startOffset,u=i.childNodes[f];return u?i.insertBefore(n,u):i.appendChild(n),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+r),this.setStartBefore(t)},setCursor:function(n,t){return this.collapse(!n).select(t)},createBookmark:function(n,t){var i,r=this.document.createElement("span");return r.style.cssText="display:none;line-height:0px;",r.appendChild(this.document.createTextNode("‍")),r.id="_baidu_bookmark_start_"+(t?"":s++),this.collapsed||(i=r.cloneNode(!0),i.id="_baidu_bookmark_end_"+(t?"":s++)),this.insertNode(r),i&&this.collapse().insertNode(i).setEndBefore(i),this.setStartAfter(r),{start:n?r.id:r,end:i?n?i.id:i:null,id:n}},moveToBookmark:function(n){var i=n.id?this.document.getElementById(n.start):n.start,t=n.end&&n.id?this.document.getElementById(n.end):n.end;return this.setStartBefore(i),domUtils.remove(i),t?(this.setEndBefore(t),domUtils.remove(t)):this.collapse(!0),this},enlarge:function(n,t){var f=domUtils.isBody,r,i,u=this.document.createTextNode("");if(n){for(i=this.startContainer,i.nodeType==1?i.childNodes[this.startOffset]?r=i=i.childNodes[this.startOffset]:(i.appendChild(u),r=i=u):r=i;;){if(domUtils.isBlockElm(i)){for(i=r;(r=i.previousSibling)&&!domUtils.isBlockElm(r);)i=r;this.setStartBefore(i);break}r=i;i=i.parentNode}for(i=this.endContainer,i.nodeType==1?((r=i.childNodes[this.endOffset])?i.insertBefore(u,r):i.appendChild(u),r=i=u):r=i;;){if(domUtils.isBlockElm(i)){for(i=r;(r=i.nextSibling)&&!domUtils.isBlockElm(r);)i=r;this.setEndAfter(i);break}r=i;i=i.parentNode}u.parentNode===this.endContainer&&this.endOffset--;domUtils.remove(u)}if(!this.collapsed){while(this.startOffset==0){if(t&&t(this.startContainer))break;if(f(this.startContainer))break;this.setStartBefore(this.startContainer)}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(t&&t(this.endContainer))break;if(f(this.endContainer))break;this.setEndAfter(this.endContainer)}}return this},enlargeToBlockElm:function(n){while(!domUtils.isBlockElm(this.startContainer))this.setStartBefore(this.startContainer);if(!n)while(!domUtils.isBlockElm(this.endContainer))this.setEndAfter(this.endContainer);return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setStartAfter(this.startContainer);while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(n,t,i){var y,u,o,p,w,b,a;if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(n){return n.nodeType==1&&domUtils.isBlockElm(n)}).adjustmentBoundary();for(var h=this.createBookmark(),c=h.end,l=function(n){return n.nodeType==1?n.tagName.toLowerCase()!="br":!domUtils.isWhitespace(n)},e=domUtils.getNextDomNode(h.start,!1,l),f,v,s=this.cloneRange();e&&domUtils.getPosition(e,c)&domUtils.POSITION_PRECEDING;)if(e.nodeType==3||r[n][e.tagName]){for(s.setStartBefore(e),f=e;f&&(f.nodeType==3||r[n][f.tagName])&&f!==c;)v=f,f=domUtils.getNextDomNode(f,f.nodeType==1,null,function(t){return r[n][t.tagName]});if(y=s.setEndAfter(v).extractContents(),i&&i.length>0){for(p=o=i[0].cloneNode(!1),w=1;b=i[w++];)o.appendChild(b.cloneNode(!1)),o=o.firstChild;u=o}else u=s.document.createElement(n);if(t&&domUtils.setAttributes(u,t),u.appendChild(y),s.insertNode(i?p:u),n=="span"&&t.style&&/text\-decoration/.test(t.style)&&(a=domUtils.findParentByTagName(u,"a",!0))?(domUtils.setAttributes(a,t),domUtils.remove(u,!0),u=a):(domUtils.mergeSibling(u),domUtils.clearEmptySibling(u)),domUtils.mergeChild(u,t),e=domUtils.getNextDomNode(u,!1,l),domUtils.mergeToParent(u),f===c)break}else e=domUtils.getNextDomNode(e,!0,l);return this.moveToBookmark(h)},removeInlineStyle:function(n){var t,i,r,e,f,u,o;if(this.collapsed)return this;for(n=utils.isArray(n)?n:[n],this.shrinkBoundary().adjustmentBoundary(),t=this.startContainer,i=this.endContainer;;){if(t.nodeType==1){if(utils.indexOf(n,t.tagName.toLowerCase())>-1)break;if(t.tagName.toLowerCase()=="body"){t=null;break}}t=t.parentNode}for(;;){if(i.nodeType==1){if(utils.indexOf(n,i.tagName.toLowerCase())>-1)break;if(i.tagName.toLowerCase()=="body"){i=null;break}}i=i.parentNode}for(r=this.createBookmark(),t&&(f=this.cloneRange().setEndBefore(r.start).setStartBefore(t),e=f.extractContents(),f.insertNode(e),domUtils.clearEmptySibling(t,!0),t.parentNode.insertBefore(r.start,t)),i&&(f=this.cloneRange().setStartAfter(r.end).setEndAfter(i),e=f.extractContents(),f.insertNode(e),domUtils.clearEmptySibling(i,!1,!0),i.parentNode.insertBefore(r.end,i.nextSibling)),u=domUtils.getNextDomNode(r.start,!1,function(n){return n.nodeType==1});u&&u!==r.end;)o=domUtils.getNextDomNode(u,!0,function(n){return n.nodeType==1}),utils.indexOf(n,u.tagName.toLowerCase())>-1&&domUtils.remove(u,!0),u=o;return this.moveToBookmark(r)},getClosedNode:function(){var i,t,n;return this.collapsed||(t=this.cloneRange().adjustmentBoundary().shrinkBoundary(),h(t)&&(n=t.startContainer.childNodes[t.startOffset],n&&n.nodeType==1&&(r.$empty[n.tagName]||r.$nonChild[n.tagName])&&(i=n))),i},select:n.ie?function(n,r){var u,c,s,e,v,l,h,o;if(this.collapsed||this.shrinkBoundary(),c=this.getClosedNode(),c&&!r){try{u=this.document.body.createControlRange();u.addElement(c);u.select()}catch(y){}return this}s=this.createBookmark();e=s.start;u=this.document.body.createTextRange();u.moveToElementText(e);u.moveStart("character",1);this.collapsed?n||this.startContainer.nodeType==3||(h=this.document.createTextNode(f),o=this.document.createElement("span"),o.appendChild(this.document.createTextNode(f)),e.parentNode.insertBefore(o,e),e.parentNode.insertBefore(h,e),a(this.document,h),t=h,i(o,"previousSibling"),i(e,"nextSibling"),u.moveStart("character",-1),u.collapse(!0)):(l=this.document.body.createTextRange(),v=s.end,l.moveToElementText(v),u.setEndPoint("EndToEnd",l));this.moveToBookmark(s);o&&domUtils.remove(o);try{u.select()}catch(y){}return this}:function(r){function l(n){function t(t,i,r){t.nodeType==3&&t.nodeValue.length<i&&(n[r+"Offset"]=t.nodeValue.length)}t(n.startContainer,n.startOffset,"start");t(n.endContainer,n.endOffset,"end")}var c=domUtils.getWindow(this.document),h=c.getSelection(),e,o,s,u;if(n.gecko?this.document.body.focus():c.focus(),h){if(h.removeAllRanges(),this.collapsed&&!r&&(o=this.startContainer,u=o,o.nodeType==1&&(u=o.childNodes[this.startOffset]),o.nodeType==3&&this.startOffset||(u?u.previousSibling&&u.previousSibling.nodeType==3:o.lastChild&&o.lastChild.nodeType==3)||(e=this.document.createTextNode(f),this.insertNode(e),a(this.document,e),i(e,"previousSibling"),i(e,"nextSibling"),t=e,this.setStart(e,n.webkit?1:0).collapse(!0))),s=this.document.createRange(),this.collapsed&&n.opera&&this.startContainer.nodeType==1)if(u=this.startContainer.childNodes[this.startOffset],u){while(u&&domUtils.isBlockElm(u))if(u.nodeType==1&&u.childNodes[0])u=u.childNodes[0];else break;u&&this.setStartBefore(u).collapse(!0)}else u=this.startContainer.lastChild,u&&domUtils.isBr(u)&&this.setStartBefore(u).collapse(!0);l(this);s.setStart(this.startContainer,this.startOffset);s.setEnd(this.endContainer,this.endOffset);h.addRange(s)}return this},scrollToView:function(n,t){n=n?window:domUtils.getWindow(this.document);var r=this,i=r.document.createElement("span");return i.innerHTML="&nbsp;",r.cloneRange().insertNode(i),domUtils.scrollToView(i,n,t),domUtils.remove(i),r},inFillChar:function(){var n=this.startContainer;return this.collapsed&&n.nodeType==3&&n.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==n.nodeValue.length?!0:!1},createAddress:function(n,t){function u(n){for(var f,e,r,u=n?i.startContainer:i.endContainer,c=domUtils.findParents(u,!0,function(n){return!domUtils.isBody(n)}),s=[],l=0,h;h=c[l++];)s.push(domUtils.getNodeIndex(h,t));if(f=0,t)if(u.nodeType==3){for(e=u.previousSibling;e&&e.nodeType==3;)f+=e.nodeValue.replace(o,"").length,e=e.previousSibling;f+=n?i.startOffset:i.endOffset}else if(u=u.childNodes[n?i.startOffset:i.endOffset],u)f=domUtils.getNodeIndex(u,t);else for(u=n?i.startContainer:i.endContainer,r=u.firstChild;r;){if(domUtils.isFillChar(r)){r=r.nextSibling;continue}if(f++,r.nodeType==3)while(r&&r.nodeType==3)r=r.nextSibling;else r=r.nextSibling}else f=n?domUtils.isFillChar(u)?0:i.startOffset:i.endOffset;return f<0&&(f=0),s.push(f),s}var r={},i=this;return r.startAddress=u(!0),n||(r.endAddress=i.collapsed?[].concat(r.startAddress):u()),r},moveToAddress:function(n,t){function r(n,t){for(var r=i.document.body,u,f,e=0,o,s=n.length;e<s;e++)if(o=n[e],u=r,r=r.childNodes[o],!r){f=o;break}t?r?i.setStartBefore(r):i.setStart(u,f):r?i.setEndBefore(r):i.setEnd(u,f)}var i=this;return r(n.startAddress,!0),!t&&n.endAddress&&r(n.endAddress),i},equals:function(n){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==n[t])return!1;return!0},traversal:function(n,t){var f;if(this.collapsed)return this;for(var r=this.createBookmark(),u=r.end,i=domUtils.getNextDomNode(r.start,!1,t);i&&i!==u&&domUtils.getPosition(i,u)&domUtils.POSITION_PRECEDING;)f=domUtils.getNextDomNode(i,!1,t),n(i),i=f;return this.moveToBookmark(r)}}})(),function(){function f(n,t){var c=domUtils.getNodeIndex,f,e,v,y;if(n=n.duplicate(),n.collapse(t),f=n.parentElement(),!f.hasChildNodes())return{container:f,offset:0};for(var o=f.children,i,s=n.duplicate(),l=0,a=o.length-1,h=-1,u;l<=a;)if(h=Math.floor((l+a)/2),i=o[h],s.moveToElementText(i),e=s.compareEndPoints("StartToStart",n),e>0)a=h-1;else if(e<0)l=h+1;else return{container:f,offset:c(i)};if(h==-1){if(s.moveToElementText(f),s.setEndPoint("StartToStart",n),u=s.text.replace(/(\r\n|\r)/g,"\n").length,o=f.childNodes,!u)return i=o[o.length-1],{container:i,offset:i.nodeValue.length};for(v=o.length;u>0;)u-=o[--v].nodeValue.length;return{container:o[v],offset:-u}}if(s.collapse(e>0),s.setEndPoint(e>0?"StartToStart":"EndToStart",n),u=s.text.replace(/(\r\n|\r)/g,"\n").length,!u)return r.$empty[i.tagName]||r.$nonChild[i.tagName]?{container:f,offset:c(i)+(e>0?0:1)}:{container:i,offset:e>0?0:i.childNodes.length};while(u>0)try{y=i;i=i[e>0?"previousSibling":"nextSibling"];u-=i.nodeValue.length}catch(p){return{container:f,offset:c(y)}}return{container:i,offset:e>0?-u:i.nodeValue.length+u}}function e(n,t){if(n.item)t.selectNode(n.item(0));else{var i=f(n,!0);t.setStart(i.container,i.offset);n.compareEndPoints("StartToEnd",n)!=0&&(i=f(n,!1),t.setEnd(i.container,i.offset))}return t}function i(n){var t,i;try{t=n.getNative().createRange()}catch(r){return null}return(i=t.item?t.item(0):t.parentElement(),(i.ownerDocument||i)===n.document)?t:null}var o=u.Selection=function(t){var r=this,u;if(r.document=t,n.ie9below){u=domUtils.getWindow(t).frameElement;domUtils.on(u,"beforedeactivate",function(){r._bakIERange=r.getIERange()});domUtils.on(u,"activate",function(){try{!i(r)&&r._bakIERange&&r._bakIERange.select()}catch(n){}r._bakIERange=null})}u=t=null};o.prototype={rangeInBody:function(t,i){var r=n.ie9below||i?t.item?t.item():t.parentElement():t.startContainer;return r===this.document.body||domUtils.inDoc(r,this.document)},getNative:function(){var t=this.document;try{return t?n.ie9below?t.selection:domUtils.getWindow(t).getSelection():null}catch(i){return null}},getIERange:function(){var n=i(this);return!n&&this._bakIERange?this._bakIERange:n},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var n=this.getStart();return n?domUtils.findParents(n,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{if(n.ie9below){var t=i(this);return!!(t&&this.rangeInBody(t))}return!!this.getNative().rangeCount}catch(r){return!1}},getRange:function(){function f(n){for(var t=r.document.body.firstChild,i=n.collapsed;t&&t.firstChild;)n.setStart(t,0),t=t.firstChild;n.startContainer||n.setStart(r.document.body,0);i&&n.collapse(!0)}var r=this,i,o,u,s,h;if(r._cachedRange!=null)return this._cachedRange;if(i=new t.editor.dom.Range(r.document),n.ie9below)if(o=r.getIERange(),o)try{e(o,i)}catch(c){f(i)}else f(i);else if(u=r.getNative(),u&&u.rangeCount)s=u.getRangeAt(0),h=u.getRangeAt(u.rangeCount-1),i.setStart(s.startContainer,s.startOffset).setEnd(h.endContainer,h.endOffset),i.collapsed&&domUtils.isBody(i.startContainer)&&!i.startOffset&&f(i);else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document))return this._bakRange;f(i)}return this._bakRange=i},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var i=n.ie9below?this.getIERange():this.getRange(),r,t,u,f;if(n.ie9below){if(!i)return this.document.body.firstChild;if(i.item)return i.item(0);for(r=i.duplicate(),r.text.length>0&&r.moveStart("character",1),r.collapse(1),t=r.parentElement(),f=u=i.parentElement();u=u.parentNode;)if(u==t){t=f;break}}else if(i.shrinkBoundary(),t=i.startContainer,t.nodeType==1&&t.hasChildNodes()&&(t=t.childNodes[Math.min(t.childNodes.length-1,i.startOffset)]),t.nodeType==3)return t.parentNode;return t},getText:function(){var t,i;return this.isFocus()&&(t=this.getNative())?(i=n.ie9below?t.createRange():t.getRangeAt(0),n.ie9below?i.text:i.toString()):""},clearRange:function(){this.getNative()[n.ie9below?"empty":"removeAllRanges"]()}}}(),function(){function t(n,t){var i,u,r,f;if(t.textarea)if(utils.isString(t.textarea)){for(u=0,f=domUtils.getElementsByTagName(n,"textarea");r=f[u++];)if(r.id=="ueditor_textarea_"+t.options.textarea){i=r;break}}else i=t.textarea;i||(n.appendChild(i=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"ueditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=i);i.getAttribute("name")||i.setAttribute("name",t.options.textarea);i.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function c(n){for(var t in n)return t}function o(n){n.langIsReady=!0;n.fireEvent("langReady")}var h=0,e,i=UE.Editor=function(n){var t=this;t.uid=h++;s.call(t);t.commands={};t.options=utils.extend(utils.clone(n||{}),UEDITOR_CONFIG,!0);t.shortcutkeys={};t.inputRules=[];t.outputRules=[];t.setOpt(i.defaultOptions(t));t.loadServerConfig();utils.isEmptyObject(UE.I18N)?utils.loadFile(document,{src:t.options.langPath+t.options.lang+"/"+t.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){UE.plugin.load(t);o(t)}):(t.options.lang=c(UE.I18N),UE.plugin.load(t),o(t));UE.instants["ueditorInstant"+t.uid]=t};i.prototype={registerCommand:function(n,t){this.commands[n]=t},ready:function(n){var t=this;n&&(t.isReady?n.apply(t):t.addListener("ready",n))},setOpt:function(n,t){var i={};utils.isString(n)?i[n]=t:i=n;utils.extend(this.options,i,!0)},getOpt:function(n){return this.options[n]},destroy:function(){var n=this,i,t,u,r;n.fireEvent("destroy");i=n.container.parentNode;t=n.textarea;t?t.style.display="":(t=document.createElement("textarea"),i.parentNode.insertBefore(t,i));t.style.width=n.iframe.offsetWidth+"px";t.style.height=n.iframe.offsetHeight+"px";t.value=n.getContent();t.id=n.key;i.innerHTML="";domUtils.remove(i);u=n.key;for(r in n)n.hasOwnProperty(r)&&delete this[r];UE.delEditor(u)},render:function(t){var u=this,i=u.options,r=function(n){return parseInt(domUtils.getComputedStyle(t,n))},e;utils.isString(t)&&(t=document.getElementById(t));t&&(i.minFrameWidth=i.initialFrameWidth?i.initialFrameWidth:i.initialFrameWidth=t.offsetWidth,i.initialFrameHeight?i.minFrameHeight=i.initialFrameHeight:i.initialFrameHeight=i.minFrameHeight=t.offsetHeight,t.style.width=/%$/.test(i.initialFrameWidth)?"100%":i.initialFrameWidth-r("padding-left")-r("padding-right")+"px",t.style.height=/%$/.test(i.initialFrameHeight)?"100%":i.initialFrameHeight-r("padding-top")-r("padding-bottom")+"px",t.style.zIndex=i.zIndex,e=(f&&n.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml' class='view' ><head><style type='text/css'>.view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\nbody{margin:8px;font-family:sans-serif;font-size:16px;}p{margin:5px 0;}<\/style>"+(i.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(i.iframeCssUrl)+"'/>":"")+(i.initialStyle?"<style>"+i.initialStyle+"<\/style>":"")+"<\/head><body class='view' ><\/body><script type='text/javascript' "+(f?"defer='defer'":"")+" id='_initialScript'>setTimeout(function(){editor = window.parent.UE.instants['ueditorInstant"+u.uid+"'];editor._setup(document);},0);var _tmpScript = document.getElementById('_initialScript');_tmpScript.parentNode.removeChild(_tmpScript);<\/script><\/html>",t.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+u.uid,width:"100%",height:"100%",frameborder:"0",src:"javascript:void(function(){document.open();"+(i.customDomain&&document.domain!=location.hostname?'document.domain="'+document.domain+'";':"")+'document.write("'+e+'");document.close();}())'})),t.style.overflow="hidden",setTimeout(function(){/%$/.test(i.initialFrameWidth)&&(i.minFrameWidth=i.initialFrameWidth=t.offsetWidth);/%$/.test(i.initialFrameHeight)&&(i.minFrameHeight=i.initialFrameHeight=t.offsetHeight,t.style.height=i.initialFrameHeight+"px")}))},_setup:function(i){var r=this,e=r.options,s,o,h;for(f?(i.body.disabled=!0,i.body.contentEditable=!0,i.body.disabled=!1):i.body.contentEditable=!0,i.body.spellcheck=!1,r.document=i,r.window=i.defaultView||i.parentWindow,r.iframe=r.window.frameElement,r.body=i.body,r.selection=new u.Selection(i),n.gecko&&(s=this.selection.getNative())&&s.removeAllRanges(),this._initEvents(),o=this.iframe.parentNode;!domUtils.isBody(o);o=o.parentNode)if(o.tagName=="FORM"){if(r.form=o,r.options.autoSyncData)domUtils.on(r.window,"blur",function(){t(o,r)});else domUtils.on(o,"submit",function(){t(this,r)});break}e.initialContent&&(e.autoClearinitialContent?(h=r.execCommand,r.execCommand=function(){return r.fireEvent("firstBeforeExecCommand"),h.apply(r,arguments)},this._setDefaultContent(e.initialContent)):this.setContent(e.initialContent,!1,!0));domUtils.isEmptyNode(r.body)&&(r.body.innerHTML="<p>"+(n.ie?"":"<br/>")+"<\/p>");e.focus&&setTimeout(function(){r.focus(r.options.focusInEnd);r.options.autoClearinitialContent||r._selectionChange()},0);r.container||(r.container=this.iframe.parentNode);e.fullscreen&&r.ui&&r.ui.setFullScreen(!0);try{r.document.execCommand("2D-position",!1,!1)}catch(c){}try{r.document.execCommand("enableInlineTableEditing",!1,!1)}catch(c){}try{r.document.execCommand("enableObjectResizing",!1,!1)}catch(c){}if(r._bindshortcutKeys(),r.isReady=1,r.fireEvent("ready"),e.onready&&e.onready.call(r),!n.ie9below)domUtils.on(r.window,["blur","focus"],function(n){if(n.type=="blur"){r._bakRange=r.selection.getRange();try{r._bakNativeRange=r.selection.getNative().getRangeAt(0);r.selection.getNative().removeAllRanges()}catch(n){r._bakNativeRange=null}}else try{r._bakRange&&r._bakRange.select()}catch(n){}});n.gecko&&n.version<=10902&&(r.body.contentEditable=!1,setTimeout(function(){r.body.contentEditable=!0},100),setInterval(function(){r.body.style.height=r.iframe.offsetHeight-20+"px"},100));e.isShow||r.setHide();e.readonly&&r.setDisabled()},sync:function(n){var i=this,r=n?document.getElementById(n):domUtils.findParent(i.iframe.parentNode,function(n){return n.tagName=="FORM"},!0);r&&t(r,i)},setHeight:function(n,t){n!==parseInt(this.iframe.parentNode.style.height)&&(this.iframe.parentNode.style.height=n+"px");t||(this.options.minFrameHeight=this.options.initialFrameHeight=n);this.body.style.height=n+"px";t||this.trigger("setHeight")},addshortcutkey:function(n,t){var i={};t?i[n]=t:i=n;utils.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var n=this,t=this.shortcutkeys;n.addListener("keydown",function(i,r){var s=r.keyCode||r.which,f,h,c,u,e,o;for(f in t)for(h=t[f].split(","),c=0;u=h[c++];)u=u.split(":"),e=u[0],o=u[1],(/^(ctrl)(\+shift)?\+(\d+)$/.test(e.toLowerCase())||/^(\d+)$/.test(e))&&((RegExp.$1=="ctrl"?r.ctrlKey||r.metaKey:0)&&(RegExp.$2!=""?r[RegExp.$2.slice(1)+"Key"]:1)&&s==RegExp.$3||s==RegExp.$1)&&(n.queryCommandState(f,o)!=-1&&n.execCommand(f,o),domUtils.preventDefault(r))})},getContent:function(n,t,i,r,u){var f=this,e;return(n&&utils.isFunction(n)&&(t=n,n=""),t?!t():!this.hasContents())?"":(f.fireEvent("beforegetcontent"),e=UE.htmlparser(f.body.innerHTML,r),f.filterOutputRule(e),f.fireEvent("aftergetcontent",n,e),e.toHtml(u))},getAllHtml:function(){var t=this,r=[],i;return t.fireEvent("getAllHtml",r),n.ie&&n.version>8&&(i="",utils.each(t.document.styleSheets,function(n){i+=n.href?'<link rel="stylesheet" type="text/css" href="'+n.href+'" />':"<style>"+n.cssText+"<\/style>"}),utils.each(t.document.getElementsByTagName("script"),function(n){i+=n.outerHTML})),"<html><head>"+(t.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+t.options.charset+'"/>':"")+(i||t.document.getElementsByTagName("head")[0].innerHTML)+r.join("\n")+"<\/head><body "+(f&&n.version<9?'class="view"':"")+">"+t.getContent(null,null,!0)+"<\/body><\/html>"},getPlainTxt:function(){var t=new RegExp(domUtils.fillChar,"g"),n=this.body.innerHTML.replace(/[\n\r]/g,"");return n=n.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(n,t,i){return r.$block[i]?"\n":t?t:""}),n.replace(t,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var t=new RegExp(domUtils.fillChar,"g");return this.body[n.ie?"innerText":"textContent"].replace(t,"").replace(/\u00a0/g," ")},setContent:function(i,u,f){function a(n){return n.tagName=="DIV"&&n.getAttribute("cdata_tag")}var o=this,h,e,c,s,l;if(o.fireEvent("beforesetcontent",i),h=UE.htmlparser(i),o.filterInputRule(h),i=h.toHtml(),o.body.innerHTML=(u?o.body.innerHTML:"")+i,o.options.enterTag=="p")if(e=this.body.firstChild,!e||e.nodeType==1&&(r.$cdata[e.tagName]||a(e)||domUtils.isCustomeNode(e))&&e===this.body.lastChild)this.body.innerHTML="<p>"+(n.ie?"&nbsp;":"<br/>")+"<\/p>"+this.body.innerHTML;else for(s=o.document.createElement("p");e;){while(e&&(e.nodeType==3||e.nodeType==1&&r.p[e.tagName]&&!r.$cdata[e.tagName]))c=e.nextSibling,s.appendChild(e),e=c;if(s.firstChild)if(e)e.parentNode.insertBefore(s,e),s=o.document.createElement("p");else{o.body.appendChild(s);break}e=e.nextSibling}o.fireEvent("aftersetcontent");o.fireEvent("contentchange");f||o._selectionChange();o._bakRange=o._bakIERange=o._bakNativeRange=null;n.gecko&&(l=this.selection.getNative())&&l.removeAllRanges();o.options.autoSyncData&&o.form&&t(o.form,o)},focus:function(n){var u,i,t;try{u=this;i=u.selection.getRange();n?(t=u.body.lastChild,t&&t.nodeType==1&&!r.$empty[t.tagName]&&(domUtils.isEmptyBlock(t)?i.setStartAtFirst(t):i.setStartAtLast(t),i.collapse(!0)),i.setCursor(!0)):(!i.collapsed&&domUtils.isBody(i.startContainer)&&i.startOffset==0&&(t=u.body.firstChild,t&&t.nodeType==1&&!r.$empty[t.tagName]&&i.setStartAtFirst(t).collapse(!0)),i.select(!0));this.fireEvent("focus selectionchange")}catch(f){}},isFocus:function(){return this.selection.isFocus()},blur:function(){var i=this.selection.getNative(),t;i.empty&&n.ie?(t=document.body.createTextRange(),t.moveToElementText(document.body),t.collapse(!0),t.select(),i.empty()):i.removeAllRanges()},_initEvents:function(){var t=this,i=t.document,r=t.window;t._proxyDomEvent=utils.bind(t._proxyDomEvent,t);domUtils.on(i,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],t._proxyDomEvent);domUtils.on(r,["focus","blur"],t._proxyDomEvent);domUtils.on(t.body,"drop",function(i){n.gecko&&i.stopPropagation&&i.stopPropagation();t.fireEvent("contentchange")});domUtils.on(i,["mouseup","keydown"],function(n){n.type=="keydown"&&(n.ctrlKey||n.metaKey||n.shiftKey||n.altKey)||n.button!=2&&t._selectionChange(250,n)})},_proxyDomEvent:function(n){return this.fireEvent("before"+n.type.replace(/^on/,"").toLowerCase())===!1?!1:this.fireEvent(n.type.replace(/^on/,""),n)===!1?!1:this.fireEvent("after"+n.type.replace(/^on/,"").toLowerCase())},_selectionChange:function(t,i){var r=this,u=!1,f,o,s;n.ie&&n.version<9&&i&&i.type=="mouseup"&&(s=this.selection.getRange(),s.collapsed||(u=!0,f=i.clientX,o=i.clientY));clearTimeout(e);e=setTimeout(function(){var n,t;if(r.selection&&r.selection.getNative()){if(u&&r.selection.getNative().type=="None"){n=r.document.body.createTextRange();try{n.moveToPoint(f,o)}catch(e){n=null}}n&&(t=r.selection.getIERange,r.selection.getIERange=function(){return n});r.selection.cache();t&&(r.selection.getIERange=t);r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!i),r.fireEvent("afterselectionchange"),r.selection.clear())}},t||50)},_callCmdFn:function(n,t){var u=t[0].toLowerCase(),i,r;if(i=this.commands[u]||UE.commands[u],r=i&&i[n],i&&r||n!="queryCommandState"){if(r)return r.apply(this,t)}else return 0},execCommand:function(n){n=n.toLowerCase();var t=this,r,i=t.commands[n]||UE.commands[n];return!i||!i.execCommand?null:(i.notNeedUndo||t.__hasEnterExecCommand?(r=this._callCmdFn("execCommand",arguments),t.__hasEnterExecCommand||i.ignoreContentChange||t._ignoreContentChange||t.fireEvent("contentchange")):(t.__hasEnterExecCommand=!0,t.queryCommandState.apply(t,arguments)!=-1&&(t.fireEvent("saveScene"),t.fireEvent.apply(t,["beforeexeccommand",n].concat(arguments)),r=this._callCmdFn("execCommand",arguments),t.fireEvent.apply(t,["afterexeccommand",n].concat(arguments)),t.fireEvent("saveScene")),t.__hasEnterExecCommand=!1),t.__hasEnterExecCommand||i.ignoreContentChange||t._ignoreContentChange||t._selectionChange(),r)},queryCommandState:function(){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(n){var t,i,r,u,f;if(n)for(t=0;i=n[t++];)if(this.document.getElementsByTagName(i).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(n=["div"],t=0;i=n[t++];)for(r=domUtils.getElementsByTagName(this.document,i),u=0;f=r[u++];)if(domUtils.isCustomeNode(f))return!0;return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var n=this,t;if(n.body.contentEditable=="false"){n.body.contentEditable=!0;t=n.selection.getRange();try{t.moveToBookmark(n.lastBk);delete n.lastBk}catch(i){t.setStartAtFirst(n.body).collapse(!0)}t.select(!0);n.bkqueryCommandState&&(n.queryCommandState=n.bkqueryCommandState,delete n.bkqueryCommandState);n.bkqueryCommandValue&&(n.queryCommandValue=n.bkqueryCommandValue,delete n.bkqueryCommandValue);n.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(n){var t=this;n=n?utils.isArray(n)?n:[n]:[];t.body.contentEditable=="true"&&(t.lastBk||(t.lastBk=t.selection.getRange().createBookmark(!0)),t.body.contentEditable=!1,t.bkqueryCommandState=t.queryCommandState,t.bkqueryCommandValue=t.queryCommandValue,t.queryCommandState=function(i){return utils.indexOf(n,i)!=-1?t.bkqueryCommandState.apply(t,arguments):-1},t.queryCommandValue=function(i){return utils.indexOf(n,i)!=-1?t.bkqueryCommandValue.apply(t,arguments):null},t.fireEvent("selectionchange"))},disable:function(n){return this.setDisabled(n)},_setDefaultContent:function(){function n(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(f?"":"<br/>")+"<\/p>",t.removeListener("firstBeforeExecCommand focus",n),setTimeout(function(){t.focus();t._selectionChange()},0))}return function(t){var i=this;i.body.innerHTML='<p id="initContent">'+t+"<\/p>";i.addListener("firstBeforeExecCommand focus",n)}}(),setShow:function(){var n=this,t=n.selection.getRange();if(n.container.style.display=="none"){try{t.moveToBookmark(n.lastBk);delete n.lastBk}catch(i){t.setStartAtFirst(n.body).collapse(!0)}setTimeout(function(){t.select(!0)},100);n.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var n=this;n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0));n.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(n){var t=UE.I18N[this.options.lang],i,r;if(!t)throw Error("not import language file");for(n=(n||"").split("."),i=0;r=n[i++];)if(t=t[r],!t)break;return t},getContentLength:function(n,t){var i=this.getContent(!1,!1,!0).length,r,u;if(n)for(t=(t||[]).concat(["hr","img","iframe"]),i=this.getContentTxt().replace(/[\t\r\n]+/g,"").length,r=0;u=t[r++];)i+=this.document.getElementsByTagName(u).length;return i},addInputRule:function(n){this.inputRules.push(n)},filterInputRule:function(n){for(var i=0,t;t=this.inputRules[i++];)t.call(this,n)},addOutputRule:function(n){this.outputRules.push(n)},filterOutputRule:function(n){for(var i=0,t;t=this.outputRules[i++];)t.call(this,n)},getActionUrl:function(n){var r=this.getOpt(n)||n,i=this.getOpt("imageUrl"),t=this.getOpt("serverUrl");return!t&&i&&(t=i.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2")),t?(t=t+(t.indexOf("?")==-1?"?":"&")+"action="+(r||""),utils.formatUrl(t)):""}};utils.inherits(i,s)}();UE.Editor.defaultOptions=function(n){var t=n.options.UEDITOR_HOME_URL;return{isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,iframeCssUrl:t+"themes/iframe.css",textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,imagePopup:!0,enterTag:"p",customDomain:!1,lang:"zh-cn",langPath:t+"lang/",theme:"default",themePath:t+"themes/",allHtmlEnabled:!1,scaleEnabled:!1,tableNativeEditInFF:!1,autoSyncData:!0,fileNameFormat:"{time}{rand:6}"}},function(){UE.Editor.prototype.loadServerConfig=function(){function showErrorMsg(n){console&&console.error(n)}var me=this;setTimeout(function(){try{me.options.imageUrl&&me.setOpt("serverUrl",me.options.imageUrl.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2"));var n=me.getActionUrl("config"),isJsonp=utils.isCrossDomainUrl(n);me._serverConfigLoaded=!1;n&&UE.ajax.request(n,{method:"GET",dataType:isJsonp?"jsonp":"",onsuccess:function(r){try{var config=isJsonp?r:eval("("+r.responseText+")");utils.extend(me.options,config);me.fireEvent("serverConfigLoaded");me._serverConfigLoaded=!0}catch(e){showErrorMsg(me.getLang("loadconfigFormatError"))}},onerror:function(){showErrorMsg(me.getLang("loadconfigHttpError"))}})}catch(t){showErrorMsg(me.getLang("loadconfigError"))}})};UE.Editor.prototype.isServerConfigLoaded=function(){var n=this;return n._serverConfigLoaded||!1};UE.Editor.prototype.afterConfigReady=function(n){if(n&&utils.isFunction(n)){var t=this,i=function(){n.apply(t,arguments);t.removeListener("serverConfigLoaded",i)};t.isServerConfigLoaded()?n.call(t,"serverConfigLoaded"):t.addListener("serverConfigLoaded",i)}}}();UE.ajax=function(){function n(n){var r=[],t,i;for(t in n)if(t!="method"&&t!="timeout"&&t!="async"&&t!="dataType"&&t!="callback"&&n[t]!=undefined&&n[t]!=null)if((typeof n[t]).toLowerCase()=="function"||(typeof n[t]).toLowerCase()=="object"){if(utils.isArray(n[t]))for(i=0;i<n[t].length;i++)r.push(encodeURIComponent(t)+"[]="+encodeURIComponent(n[t][i]))}else r.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return r.join("&")}function u(t,r){var u=i(),s=!1,h={method:"POST",timeout:5e3,async:!0,data:{},onsuccess:function(){},onerror:function(){}},f,e;if(typeof t=="object"&&(r=t,t=r.url),u&&t){f=r?utils.extend(h,r):h;e=n(f);utils.isEmptyObject(f.data)||(e+=(e?"&":"")+n(f.data));var c=setTimeout(function(){u.readyState!=4&&(s=!0,u.abort(),clearTimeout(c))},f.timeout),o=f.method.toUpperCase(),l=t+(t.indexOf("?")==-1?"?":"&")+(o=="POST"?"":e+"&noCache="+ +new Date);u.open(o,l,f.async);u.onreadystatechange=function(){if(u.readyState==4)if(s||u.status!=200)f.onerror(u);else f.onsuccess(u)};o=="POST"?(u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(e)):u.send(null)}}function r(t,i){function p(n,t,i){n.setAttribute("type","text/javascript");n.setAttribute("defer","defer");i&&n.setAttribute("charset",i);n.setAttribute("src",t);document.getElementsByTagName("head")[0].appendChild(n)}function c(n){return function(){try{if(n)r.onerror&&r.onerror();else try{clearTimeout(a);o.apply(window,arguments)}catch(i){}}catch(t){r.onerror&&r.onerror.call(window,t)}finally{r.oncomplete&&r.oncomplete.apply(window,arguments);f.parentNode&&f.parentNode.removeChild(f);window[u]=null;try{delete window[u]}catch(i){}}}}var o=i.onsuccess||function(){},f=document.createElement("SCRIPT"),r=i||{},y=r.charset,s=r.jsonp||"callback",u,l=r.timeOut||0,a,h=new RegExp("(\\?|&)"+s+"=([^&]*)"),v,e;utils.isFunction(o)?(u="bd__editor__"+Math.floor(Math.random()*2147483648).toString(36),window[u]=c(0)):utils.isString(o)?u=o:(v=h.exec(t))&&(u=v[2]);t=t.replace(h,"$1"+s+"="+u);t.search(h)<0&&(t+=(t.indexOf("?")<0?"?":"&")+s+"="+u);e=n(i);utils.isEmptyObject(i.data)||(e+=(e?"&":"")+n(i.data));e&&(t=t.replace(/\?/,"?"+e+"&"));f.onerror=c(1);l&&(a=setTimeout(c(1),l));p(f,t,y)}var t="XMLHttpRequest()",i;try{new ActiveXObject("Msxml2.XMLHTTP");t="ActiveXObject('Msxml2.XMLHTTP')"}catch(f){try{new ActiveXObject("Microsoft.XMLHTTP");t="ActiveXObject('Microsoft.XMLHTTP')"}catch(f){}}return i=new Function("return new "+t),{request:function(n,t){t&&t.dataType=="jsonp"?r(n,t):u(n,t)},getJSONP:function(n,t,i){var u={data:t,oncomplete:i};r(n,u)}}}();p=UE.filterWord=function(){function i(n){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/ig.test(n)}function t(n){return n.replace(/[\d.]+\w+/g,function(n){return utils.transUnitToPx(n)})}function r(i){return i.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(i){if(n.opera)return"";try{if(/Bitmap/i.test(i))return"";var r=i.match(/width:([ \d.]*p[tx])/i)[1],u=i.match(/height:([ \d.]*p[tx])/i)[1],f=i.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+t(r)+'" height="'+t(u)+'" src="'+f+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1<\/strong><\/p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(n,t,i,r){return t=="class"&&r=="MsoListParagraph"?n:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(n,t,i){return i.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(n,i,r,u){for(var s,f,h,e=[],l=u.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").replace(/[\d.]+(cm|pt)/g,function(n){return utils.transUnitToPx(n)}).split(/;\s*/g),o=0,c;c=l[o];o++)if(h=c.split(":"),h.length==2){if(s=h[0].toLowerCase(),f=h[1].toLowerCase(),/^(background)\w*/.test(s)&&f.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(s)&&/^0\w+$/.test(f))continue;switch(s){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(i)||(e[o]=s.replace(/^mso-|-alt$/g,"")+":"+t(f));continue;case"horiz-align":e[o]="text-align:"+f;continue;case"vert-align":e[o]="vertical-align:"+f;continue;case"font-color":case"mso-foreground":e[o]="color:"+f;continue;case"mso-background":case"mso-highlight":e[o]="background:"+f;continue;case"mso-default-height":e[o]="min-height:"+t(f);continue;case"mso-default-width":e[o]="min-width:"+t(f);continue;case"mso-padding-between-alt":e[o]="border-collapse:separate;border-spacing:"+t(f);continue;case"text-line-through":(f=="single"||f=="double")&&(e[o]="text-decoration:line-through");continue;case"mso-zero-height":f=="yes"&&(e[o]="display:none");continue;case"margin":if(!/[1-9]/.test(f))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(s)||/text\-indent|padding|margin/.test(s)&&/\-[\d.]+/.test(f))continue;e[o]=s+":"+h[1]}return i+(e.length?' style="'+e.join(";").replace(/;{2,}/g,";")+'"':"")})}return function(n){return i(n)?r(n):n}}(),function(){function t(n,t,i){return n.push(l),t+(i?1:-1)}function i(n,t){for(var i=0;i<t;i++)n.push(c)}function u(n,f,e,o){switch(n.type){case"root":for(var h=0,s;s=n.children[h++];)e&&s.type=="element"&&!r.$inlineWithA[s.tagName]&&h>1&&(t(f,o,!0),i(f,o)),u(s,f,e,o);break;case"text":a(n,f);break;case"element":v(n,f,e,o);break;case"comment":y(n,f,e)}return f}function a(n,t){n.parentNode.tagName=="pre"?t.push(n.data):t.push(h[n.parentNode.tagName]?utils.html(n.data):n.data.replace(/[ ]{2}/g," &nbsp;"))}function v(n,f,e,o){var h="",l,c,v,a;if(n.attrs){h=[];l=n.attrs;for(c in l)h.push(c+(l[c]!==undefined?'="'+(s[c]?utils.html(l[c]).replace(/["]/g,function(){return"&quot;"}):utils.unhtml(l[c]))+'"':""));h=h.join(" ")}if(f.push("<"+n.tagName+(h?" "+h:"")+(r.$empty[n.tagName]?"/":"")+">"),e&&!r.$inlineWithA[n.tagName]&&n.tagName!="pre"&&n.children&&n.children.length&&(o=t(f,o,!0),i(f,o)),n.children&&n.children.length)for(v=0;a=n.children[v++];)e&&a.type=="element"&&!r.$inlineWithA[a.tagName]&&v>1&&(t(f,o),i(f,o)),u(a,f,e,o);r.$empty[n.tagName]||(e&&!r.$inlineWithA[n.tagName]&&n.tagName!="pre"&&n.children&&n.children.length&&(o=t(f,o),i(f,o)),f.push("<\/"+n.tagName+">"))}function y(n,t){t.push("<!--"+n.data+"-->")}function f(n,t){var i,r,u;if(n.type=="element"&&n.getAttr("id")==t)return n;if(n.children&&n.children.length)for(r=0;u=n.children[r++];)if(i=f(u,t))return i}function e(n,t,i){if(n.type=="element"&&n.tagName==t&&i.push(n),n.children&&n.children.length)for(var u=0,r;r=n.children[u++];)e(r,t,i)}function o(n,t){if(n.children&&n.children.length)for(var r=0,i;i=n.children[r];)o(i,t),i.parentNode&&(i.children&&i.children.length&&t(i),i.parentNode&&r++);else t(n)}var n=UE.uNode=function(n){this.type=n.type;this.data=n.data;this.tagName=n.tagName;this.parentNode=n.parentNode;this.attrs=n.attrs||{};this.children=n.children},s={href:1,src:1,_src:1,_href:1,cdata_data:1},h={style:1,script:1},c="    ",l="\n";n.createElement=function(t){return/[<>]/.test(t)?UE.htmlparser(t).children[0]:new n({type:"element",children:[],tagName:t})};n.createText=function(n,t){return new UE.uNode({type:"text",data:t?n:utils.unhtml(n||"")})};n.prototype={toHtml:function(n){var t=[];return u(this,t,n,0),t.join("")},innerHTML:function(n){var i,t,u;if(this.type!="element"||r.$empty[this.tagName])return this;if(utils.isString(n)){if(this.children)for(i=0;t=this.children[i++];)t.parentNode=null;for(this.children=[],u=UE.htmlparser(n),i=0;t=u.children[i++];)this.children.push(t),t.parentNode=this;return this}return u=new UE.uNode({type:"root",children:this.children}),u.toHtml()},innerText:function(t,i){if(this.type!="element"||r.$empty[this.tagName])return this;if(t){if(this.children)for(var f=0,u;u=this.children[f++];)u.parentNode=null;return this.children=[],this.appendChild(n.createText(t,i)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return this.type=="element"?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var t=this.parentNode,n=0,i;i=t.children[n];n++)if(i===this)return n==0?null:t.children[n-1]},nextSibling:function(){for(var n=this.parentNode,t=0,i;i=n.children[t++];)if(i===this)return n.children[t]},replaceChild:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i,1,n),t.parentNode=null,n.parentNode=this,n}},appendChild:function(n){if(this.type=="root"||this.type=="element"&&!r.$empty[this.tagName]){this.children||(this.children=[]);n.parentNode&&n.parentNode.removeChild(n);for(var t=0,i;i=this.children[t];t++)if(i===n){this.children.splice(t,1);break}return this.children.push(n),n.parentNode=this,n}},insertBefore:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i,0,n),n.parentNode=this,n}},insertAfter:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i+1,0,n),n.parentNode=this,n}},removeChild:function(n,t){var r,i,u,f;if(this.children)for(r=0;i=this.children[r];r++)if(i===n){if(this.children.splice(r,1),i.parentNode=null,t&&i.children&&i.children.length)for(u=0;f=i.children[u];u++)this.children.splice(r+u,0,f),f.parentNode=this;return i}},getAttr:function(n){return this.attrs&&this.attrs[n.toLowerCase()]},setAttr:function(n,t){if(!n){delete this.attrs;return}if(this.attrs||(this.attrs={}),utils.isObject(n))for(var i in n)n[i]?this.attrs[i.toLowerCase()]=n[i]:delete this.attrs[i];else t?this.attrs[n.toLowerCase()]=t:delete this.attrs[n]},getIndex:function(){for(var i=this.parentNode,n=0,t;t=i.children[n];n++)if(t===this)return n;return-1},getNodeById:function(n){var t,i,r;if(this.children&&this.children.length)for(i=0;r=this.children[i++];)if(t=f(r,n))return t},getNodesByTagName:function(n){n=utils.trim(n).replace(/[ ]{2,}/g," ").split(" ");var i=[],t=this;return utils.each(n,function(n){if(t.children&&t.children.length)for(var u=0,r;r=t.children[u++];)e(r,n,i)}),i},getStyle:function(n){var i=this.getAttr("style"),r,t;return i?(r=new RegExp("(^|;)\\s*"+n+":([^;]+)","i"),t=i.match(r),t&&t[0])?t[2]:"":""},setStyle:function(n,t){function u(n,t){var r=new RegExp("(^|;)\\s*"+n+":([^;]+;?)","gi");i=i.replace(r,"$1");t&&(i=n+":"+utils.unhtml(t)+";"+i)}var i=this.getAttr("style"),r;if(i||(i=""),utils.isObject(n))for(r in n)u(r,n[r]);else u(n,t);this.setAttr("style",utils.trim(i))},traversal:function(n){return this.children&&this.children.length&&o(this,n),this}}}();w=UE.htmlparser=function(n,t){function o(n,t){if(c[n.tagName]){var i=f.createElement(c[n.tagName]);n.appendChild(i);i.appendChild(f.createText(t));n=i}else n.appendChild(f.createText(t))}function l(n,t,i){var e,o,c,s,h,u;if(e=b[t]){for(o=n;o.type!="root";){if(utils.isArray(e)?utils.indexOf(e,o.tagName)!=-1:e==o.tagName){n=o;c=!0;break}o=o.parentNode}c||(n=l(n,utils.isArray(e)?e[0]:e))}if(s=new f({parentNode:n,type:"element",tagName:t.toLowerCase(),children:r.$empty[t]?null:[]}),i){for(h={};u=y.exec(i);)h[u[1].toLowerCase()]=w[u[1].toLowerCase()]?u[2]||u[3]||u[4]:utils.unhtml(u[2]||u[3]||u[4]);s.attrs=h}return n.children.push(s),r.$empty[t]?n:s}function k(n,t){n.children.push(new f({type:"comment",data:t,parentNode:n}))}var h=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,y=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,p={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1},v;n=n.replace(new RegExp(domUtils.fillChar,"g"),"");t||(n=n.replace(new RegExp("[\\r\\t\\n"+(t?"":" ")+"]*<\/?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(n,i){return i&&p[i.toLowerCase()]?n.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):n.replace(new RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));for(var w={href:1,src:1},f=UE.uNode,b={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},c={ol:"li",ul:"li"},u,s=0,e=0,a=new f({type:"root",children:[]}),i=a;u=h.exec(n);){s=u.index;try{if(s>e&&o(i,n.slice(e,s)),u[3])r.$cdata[i.tagName]?o(i,u[0]):i=l(i,u[3].toLowerCase(),u[4]);else if(u[1]){if(i.type!="root")if(r.$cdata[i.tagName]&&!r.$cdata[u[1]])o(i,u[0]);else{for(v=i;i.type=="element"&&i.tagName!=u[1].toLowerCase();)if(i=i.parentNode,i.type=="root"){i=v;throw"break";}i=i.parentNode}}else u[2]&&k(i,u[2])}catch(d){}e=h.lastIndex}return e<n.length&&o(i,n.slice(e)),a};b=UE.filterNode=function(){function n(t,i){var o,s,a,l,e,v,h,c,u,f;switch(t.type){case"element":if(o=i[t.tagName])if(o==="-")t.parentNode.removeChild(t);else if(utils.isFunction(o))if(h=t.parentNode,c=t.getIndex(),o(t),t.parentNode){if(t.children)for(u=0;f=t.children[u];)n(f,i),f.parentNode&&u++}else for(u=c;f=h.children[u];)n(f,i),f.parentNode&&u++;else{if(s=o.$,s&&t.attrs){a={};for(e in s)l=t.getAttr(e),e=="style"&&utils.isArray(s[e])&&(v=[],utils.each(s[e],function(n){var i;(i=t.getStyle(n))&&v.push(n+":"+i)}),l=v.join(";")),l&&(a[e]=l);t.attrs=a}if(t.children)for(u=0;f=t.children[u];)n(f,i),f.parentNode&&u++}else if(r.$cdata[t.tagName])t.parentNode.removeChild(t);else for(h=t.parentNode,c=t.getIndex(),t.parentNode.removeChild(t,!0),u=c;f=h.children[u];)n(f,i),f.parentNode&&u++;break;case"comment":t.parentNode.removeChild(t)}}return function(t,i){var f,r,u;if(utils.isEmptyObject(i))return t;for((f=i["-"])&&utils.each(f.split(" "),function(n){i[n]="-"}),r=0;u=t.children[r];)n(u,i),u.parentNode&&r++;return t}}();UE.plugin=function(){var n={};return{register:function(t,i,r,u){r&&utils.isFunction(r)&&(u=r,r=null);n[t]={optionName:r||t,execFn:i,afterDisabled:u}},load:function(t){utils.each(n,function(n){var i=n.execFn.call(t);t.options[n.optionName]!==!1?i&&utils.each(i,function(n,i){switch(i.toLowerCase()){case"shortcutkey":t.addshortcutkey(n);break;case"bindevents":utils.each(n,function(n,i){t.addListener(i,n)});break;case"bindmultievents":utils.each(utils.isArray(n)?n:[n],function(n){var i=utils.trim(n.type).split(/\s+/);utils.each(i,function(i){t.addListener(i,n.handler)})});break;case"commands":utils.each(n,function(n,i){t.commands[i]=n});break;case"outputrule":t.addOutputRule(n);break;case"inputrule":t.addInputRule(n);break;case"defaultoptions":t.setOpt(n)}}):n.afterDisabled&&n.afterDisabled.call(t)});utils.each(UE.plugins,function(n){n.call(t)})},run:function(t,i){var r=n[t];r&&r.exeFn.call(i)}}}();c=UE.keymap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Del:46,NumLock:144,Cmd:91,"=":187,"-":189,b:66,i:73,z:90,y:89,v:86,x:88,s:83,n:78};e=UE.LocalStorage=function(){function i(){var n=document.createElement("div");return(n.style.display="none",!n.addBehavior)?null:(n.addBehavior("#default#userdata"),{getItem:function(i){var r=null;try{document.body.appendChild(n);n.load(t);r=n.getAttribute(i);document.body.removeChild(n)}catch(u){}return r},setItem:function(i,r){document.body.appendChild(n);n.setAttribute(i,r);n.save(t);document.body.removeChild(n)},removeItem:function(i){document.body.appendChild(n);n.removeAttribute(i);n.save(t);document.body.removeChild(n)}})}var n=window.localStorage||i()||null,t="localStorage";return{saveLocalData:function(t,i){return n&&i?(n.setItem(t,i),!0):!1},getLocalData:function(t){return n?n.getItem(t):null},removeItem:function(t){n&&n.removeItem(t)}}}(),function(){var n="ueditor_preference";UE.Editor.prototype.setPreferences=function(t,i){var u={},r;utils.isString(t)?u[t]=i:u=t;r=e.getLocalData(n);r&&(r=utils.str2json(r))?utils.extend(r,u):r=u;r&&e.saveLocalData(n,utils.json2str(r))};UE.Editor.prototype.getPreferences=function(t){var i=e.getLocalData(n);return i&&(i=utils.str2json(i))?t?i[t]:i:null};UE.Editor.prototype.removePreferences=function(t){var i=e.getLocalData(n);i&&(i=utils.str2json(i))&&(i[t]=undefined,delete i[t]);i&&e.saveLocalData(n,utils.json2str(i))}}();UE.plugins.defaultfilter=function(){var t=this;t.setOpt({allowDivTransToP:!0,disabledTableInTable:!0});t.addInputRule(function(i){function e(n){while(n&&n.type=="element"){if(n.tagName=="td")return!0;n=n.parentNode}return!1}var f=this.options.allowDivTransToP,u;i.traversal(function(i){var s,o,h,c;if(i.type=="element"){if(!r.$cdata[i.tagName]&&t.options.autoClearEmptyNode&&r.$inline[i.tagName]&&!r.$empty[i.tagName]&&(!i.attrs||utils.isEmptyObject(i.attrs))){i.firstChild()?i.tagName=="span"&&(!i.attrs||utils.isEmptyObject(i.attrs))&&i.parentNode.removeChild(i,!0):i.parentNode.removeChild(i);return}switch(i.tagName){case"style":case"script":i.setAttr({cdata_tag:i.tagName,cdata_data:i.innerHTML()||"",_ue_custom_node_:"true"});i.tagName="div";i.innerHTML("");break;case"a":(u=i.getAttr("href"))&&i.setAttr("_href",u);break;case"img":if((u=i.getAttr("src"))&&/^data:/.test(u)){i.parentNode.removeChild(i);break}i.setAttr("_src",i.getAttr("src"));break;case"span":n.webkit&&(u=i.getStyle("white-space"))&&/nowrap|normal/.test(u)&&(i.setStyle("white-space",""),t.options.autoClearEmptyNode&&utils.isEmptyObject(i.attrs)&&i.parentNode.removeChild(i,!0));u=i.getAttr("id");u&&/^_baidu_bookmark_/i.test(u)&&i.parentNode.removeChild(i);break;case"p":(u=i.getAttr("align"))&&(i.setAttr("align"),i.setStyle("text-align",u));utils.each(i.children,function(n){var t,r,u;if(n.type=="element"&&n.tagName=="p"){for(t=n.nextSibling(),i.parentNode.insertAfter(n,i),r=n;t;)u=t.nextSibling(),i.parentNode.insertAfter(t,r),r=t,t=u;return!1}});i.firstChild()||i.innerHTML(n.ie?"&nbsp;":"<br/>");break;case"div":if(i.getAttr("cdata_tag"))break;if(u=i.getAttr("class"),u&&/^line number\d+/.test(u))break;if(!f)break;for(o=UE.uNode.createElement("p");s=i.firstChild();)s.type!="text"&&UE.dom.dtd.$block[s.tagName]?o.firstChild()?(i.parentNode.insertBefore(o,i),o=UE.uNode.createElement("p")):i.parentNode.insertBefore(s,i):o.appendChild(s);o.firstChild()&&i.parentNode.insertBefore(o,i);i.parentNode.removeChild(i);break;case"dl":i.tagName="ul";break;case"dt":case"dd":i.tagName="li";break;case"li":h=i.getAttr("class");h&&/list\-/.test(h)||i.setAttr();c=i.getNodesByTagName("ol ul");UE.utils.each(c,function(n){i.parentNode.insertAfter(n,i)});break;case"td":case"th":case"caption":i.children&&i.children.length||i.appendChild(n.ie11below?UE.uNode.createText(" "):UE.uNode.createElement("br"));break;case"table":t.options.disabledTableInTable&&e(i)&&(i.parentNode.insertBefore(UE.uNode.createText(i.innerText()),i),i.parentNode.removeChild(i))}}})});t.addOutputRule(function(n){var i;n.traversal(function(n){if(n.type=="element"){if(t.options.autoClearEmptyNode&&r.$inline[n.tagName]&&!r.$empty[n.tagName]&&(!n.attrs||utils.isEmptyObject(n.attrs))){n.firstChild()?n.tagName=="span"&&(!n.attrs||utils.isEmptyObject(n.attrs))&&n.parentNode.removeChild(n,!0):n.parentNode.removeChild(n);return}switch(n.tagName){case"div":(i=n.getAttr("cdata_tag"))&&(n.tagName=i,n.appendChild(UE.uNode.createText(n.getAttr("cdata_data"))),n.setAttr({cdata_tag:"",cdata_data:"",_ue_custom_node_:""}));break;case"a":(i=n.getAttr("_href"))&&n.setAttr({href:utils.html(i),_href:""});break;case"span":i=n.getAttr("id");i&&/^_baidu_bookmark_/i.test(i)&&n.parentNode.removeChild(n);break;case"img":(i=n.getAttr("_src"))&&n.setAttr({src:n.getAttr("_src"),_src:""})}}})})};UE.commands.inserthtml={execCommand:function(t,i,u){var h=this,e,p,k,s,f,y,w,d,a,v,b,g,nt,l,c;if(i&&h.fireEvent("beforeinserthtml",i)!==!0){if(e=h.selection.getRange(),p=e.document.createElement("div"),p.style.display="inline",u||(k=UE.htmlparser(i),h.options.filterRules&&UE.filterNode(k,h.options.filterRules),h.filterInputRule(k),i=k.toHtml()),p.innerHTML=utils.trim(i),!e.collapsed&&(s=e.startContainer,domUtils.isFillChar(s)&&e.setStartBefore(s),s=e.endContainer,domUtils.isFillChar(s)&&e.setEndAfter(s),e.txtToElmBoundary(),e.endContainer&&e.endContainer.nodeType==1&&(s=e.endContainer.childNodes[e.endOffset],s&&domUtils.isBr(s)&&e.setEndAfter(s)),e.startOffset==0&&(s=e.startContainer,domUtils.isBoundaryNode(s,"firstChild")&&(s=e.endContainer,e.endOffset==(s.nodeType==3?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild")&&(h.body.innerHTML="<p>"+(n.ie?"":"<br/>")+"<\/p>",e.setStart(h.body.firstChild,0).collapse(!0)))),e.collapsed||e.deleteContents(),e.startContainer.nodeType==1&&(f=e.startContainer.childNodes[e.startOffset],f&&domUtils.isBlockElm(f)&&(l=f.previousSibling)&&domUtils.isBlockElm(l)))){for(e.setEnd(l,l.childNodes.length).collapse();f.firstChild;)l.appendChild(f.firstChild);domUtils.remove(f)}if(d=0,e.inFillChar()&&(f=e.startContainer,domUtils.isFillChar(f)?(e.setStartBefore(f).collapse(!0),domUtils.remove(f)):domUtils.isFillChar(f,!0)&&(f.nodeValue=f.nodeValue.replace(o,""),e.startOffset--,e.collapsed&&e.collapse(!0))),v=domUtils.findParentByTagName(e.startContainer,"li",!0),v){while(f=p.firstChild){while(f&&(f.nodeType==3||!domUtils.isBlockElm(f)||f.tagName=="HR"))c=f.nextSibling,e.insertNode(f).collapse(),b=f,f=c;if(f)if(/^(ol|ul)$/i.test(f.tagName)){while(f.firstChild)b=f.firstChild,domUtils.insertAfter(v,f.firstChild),v=v.nextSibling;domUtils.remove(f)}else c=f.nextSibling,g=h.document.createElement("li"),domUtils.insertAfter(v,g),g.appendChild(f),b=f,f=c,v=g}v=domUtils.findParentByTagName(e.startContainer,"li",!0);domUtils.isEmptyBlock(v)&&domUtils.remove(v);b&&e.setStartAfter(b).collapse(!0).select(!0)}else{while(f=p.firstChild){if(d){for(nt=h.document.createElement("p");f&&(f.nodeType==3||!r.$block[f.tagName]);)a=f.nextSibling,nt.appendChild(f),f=a;nt.firstChild&&(f=nt)}if(e.insertNode(f),a=f.nextSibling,!d&&f.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(f)&&(y=domUtils.findParent(f,function(n){return domUtils.isBlockElm(n)}),y&&y.tagName.toLowerCase()!="body"&&!(r[y.tagName][f.nodeName]&&f.parentNode===y))){if(r[y.tagName][f.nodeName])for(w=f.parentNode;w!==y;)l=w,w=w.parentNode;else l=y;domUtils.breakParent(f,l||w);l=f.previousSibling;domUtils.trimWhiteTextNode(l);l.childNodes.length||domUtils.remove(l);!n.ie&&(c=f.nextSibling)&&domUtils.isBlockElm(c)&&c.lastChild&&!domUtils.isBr(c.lastChild)&&c.appendChild(h.document.createElement("br"));d=1}if(c=f.nextSibling,!p.firstChild&&c&&domUtils.isBlockElm(c)){e.setStart(c,0).collapse(!0);break}e.setEndAfter(f).collapse()}if(f=e.startContainer,a&&domUtils.isBr(a)&&domUtils.remove(a),domUtils.isBlockElm(f)&&domUtils.isEmptyNode(f))if(a=f.nextSibling)domUtils.remove(f),a.nodeType==1&&r.$block[a.tagName]&&e.setStart(a,0).collapse(!0).shrinkBoundary();else try{f.innerHTML=n.ie?domUtils.fillChar:"<br/>"}catch(tt){e.setStartBefore(f);domUtils.remove(f)}try{e.select(!0)}catch(tt){}}setTimeout(function(){e=h.selection.getRange();e.scrollToView(h.autoHeightEnabled,h.autoHeightEnabled?domUtils.getXY(h.iframe).y:0);h.fireEvent("afterinserthtml",i)},200)}}};UE.plugins.autotypeset=function(){function f(n,t){return!n||n.nodeType==3?0:domUtils.isBr(n)?1:n&&n.parentNode&&h[n.tagName.toLowerCase()]?i&&i.contains(n)||n.getAttribute("pagebreak")?0:t?!domUtils.isEmptyBlock(n):domUtils.isEmptyBlock(n,new RegExp("[\\s"+domUtils.fillChar+"]","g")):void 0}function e(n){n.style.cssText||(domUtils.removeAttributes(n,["style"]),n.tagName.toLowerCase()=="span"&&domUtils.hasNoAttributes(n)&&domUtils.remove(n,!0))}function u(t,u){var w=this,p,nt,tt,h,it,k,y,a,b,v,g,rt,d;if(u){if(!n.pasteFilter)return;p=w.document.createElement("div");p.innerHTML=u.html}else p=w.document.body;for(nt=domUtils.getElementsByTagName(p,"*"),tt=0;h=nt[tt++];)if(w.fireEvent("excludeNodeinautotype",h)!==!0){if(n.clearFontSize&&h.style.fontSize&&(domUtils.removeStyle(h,"font-size"),e(h)),n.clearFontFamily&&h.style.fontFamily&&(domUtils.removeStyle(h,"font-family"),e(h)),f(h)){if(n.mergeEmptyline)for(v=h.nextSibling,it=domUtils.isBr(h);f(v);){if(a=v,v=a.nextSibling,it&&(!v||v&&!domUtils.isBr(v)))break;domUtils.remove(a)}if(n.removeEmptyline&&domUtils.inDoc(h,p)&&!s[h.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(h)&&(v=h.nextSibling,v&&!domUtils.isBr(v)))continue;domUtils.remove(h);continue}}if(f(h,!0)&&h.tagName!="SPAN"&&(n.indent&&(h.style.textIndent=n.indentValue),n.textAlign&&(h.style.textAlign=n.textAlign)),n.removeClass&&h.className&&!o[h.className.toLowerCase()]){if(i&&i.contains(h))continue;domUtils.removeAttributes(h,["class"])}if(n.imageBlockLine&&h.tagName.toLowerCase()=="img"&&!h.getAttribute("emotion"))if(u){k=h;switch(n.imageBlockLine){case"left":case"right":case"none":for(y=k.parentNode;r.$inline[y.tagName]||y.tagName=="A";)y=y.parentNode;if(a=y,a.tagName=="P"&&domUtils.getStyle(a,"text-align")=="center"&&!domUtils.isBody(a)&&domUtils.getChildCount(a,function(n){return!domUtils.isBr(n)&&!domUtils.isWhitespace(n)})==1)if(b=a.previousSibling,v=a.nextSibling,b&&v&&b.nodeType==1&&v.nodeType==1&&b.tagName==v.tagName&&domUtils.isBlockElm(b)){for(b.appendChild(a.firstChild);v.firstChild;)b.appendChild(v.firstChild);domUtils.remove(a);domUtils.remove(v)}else domUtils.setStyle(a,"text-align","");domUtils.setStyle(k,"float",n.imageBlockLine);break;case"center":if(w.queryCommandValue("imagefloat")!="center"){for(y=k.parentNode,domUtils.setStyle(k,"float","none"),a=k;y&&domUtils.getChildCount(y,function(n){return!domUtils.isBr(n)&&!domUtils.isWhitespace(n)})==1&&(r.$inline[y.tagName]||y.tagName=="A");)a=y,y=y.parentNode;g=w.document.createElement("p");domUtils.setAttributes(g,{style:"text-align:center"});a.parentNode.insertBefore(g,a);g.appendChild(a);domUtils.setStyle(a,"float","")}}}else rt=w.selection.getRange(),rt.selectNode(h).select(),w.execCommand("imagefloat",n.imageBlockLine);n.removeEmptyNode&&n.removeTagNames[h.tagName.toLowerCase()]&&domUtils.hasNoAttributes(h)&&domUtils.isEmptyBlock(h)&&domUtils.remove(h)}n.tobdc&&(d=UE.htmlparser(p.innerHTML),d.traversal(function(n){n.type=="text"&&(n.data=l(n.data))}),p.innerHTML=d.toHtml());n.bdc2sb&&(d=UE.htmlparser(p.innerHTML),d.traversal(function(n){n.type=="text"&&(n.data=c(n.data))}),p.innerHTML=d.toHtml());u&&(u.html=p.innerHTML)}function c(n){for(var i,r="",t=0;t<n.length;t++)i=n.charCodeAt(t),r+=i>=65281&&i<=65373?String.fromCharCode(n.charCodeAt(t)-65248):i==12288?String.fromCharCode(n.charCodeAt(t)-12256):n.charAt(t);return r}function l(n){var t,r,i;for(n=utils.html(n),t="",r="",i=0;i<n.length;i++)n.charCodeAt(i)==32?t=t+String.fromCharCode(12288):n.charCodeAt(i)<127?t=t+String.fromCharCode(n.charCodeAt(i)+65248):t+=n.charAt(i);return t}function a(){var n=t.getPreferences("autotypeset");utils.extend(t.options.autotypeset,n)}this.setOpt({autotypeset:{mergeEmptyline:!0,removeClass:!0,removeEmptyline:!1,textAlign:"left",imageBlockLine:"center",pasteFilter:!1,clearFontSize:!1,clearFontFamily:!1,removeEmptyNode:!1,removeTagNames:utils.extend({div:1},r.$removeEmpty),indent:!1,indentValue:"2em",bdc2sb:!1,tobdc:!1}});var t=this,n=t.options.autotypeset,o={selectTdClass:1,pagebreak:1,anchorclass:1},s={li:1},h={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1},i;n&&(a(),n.pasteFilter&&t.addListener("beforepaste",u),t.commands.autotypeset={execCommand:function(){t.removeListener("beforepaste",u);n.pasteFilter&&t.addListener("beforepaste",u);u.call(t)}})};UE.plugin.register("autosubmit",function(){return{shortcutkey:{autosubmit:"ctrl+13"},commands:{autosubmit:{execCommand:function(){var n=this,t=domUtils.findParentByTagName(n.iframe,"form",!1);if(t){if(n.fireEvent("beforesubmit")===!1)return;n.sync();t.submit()}}}}}});UE.plugin.register("background",function(){function e(n){var t={},i=n.split(";");return utils.each(i,function(n){var i=n.indexOf(":"),r=utils.trim(n.substr(0,i)).toLowerCase();r&&(t[r]=utils.trim(n.substr(i+1)||""))}),t}function u(n){var r,u;if(n){r=[];for(u in n)n.hasOwnProperty(u)&&r.push(u+":"+n[u]+"; ");utils.cssRule(i,r.length?"body{"+r.join("")+"}":"",t.document)}else utils.cssRule(i,"",t.document)}var t=this,i="editor_background",r,f=new RegExp("body[\\s]*\\{(.+)\\}","i"),o=t.hasContents;return t.hasContents=function(){return t.queryCommandValue("background")?!0:o.apply(t,arguments)},{bindEvents:{getAllHtml:function(i,r){var u=this.body,f=domUtils.getComputedStyle(u,"background-image"),h="",e,o,s;h=f.indexOf(t.options.imagePath)>0?f.substring(f.indexOf(t.options.imagePath),f.length-1).replace(/"|\(|\)/ig,""):f!="none"?f.replace(/url\("?|"?\)/ig,""):"";e='<style type="text/css">body{';o={"background-color":domUtils.getComputedStyle(u,"background-color")||"#ffffff","background-image":h?"url("+h+")":"","background-repeat":domUtils.getComputedStyle(u,"background-repeat")||"","background-position":n.ie?domUtils.getComputedStyle(u,"background-position-x")+" "+domUtils.getComputedStyle(u,"background-position-y"):domUtils.getComputedStyle(u,"background-position"),height:domUtils.getComputedStyle(u,"height")};for(s in o)o.hasOwnProperty(s)&&(e+=s+":"+o[s]+"; ");e+="}<\/style> ";r.push(e)},aftersetcontent:function(){r==!1&&u()}},inputRule:function(n){r=!1;utils.each(n.getNodesByTagName("p"),function(n){var t=n.getAttr("data-background");t&&(r=!0,u(e(t)),n.parentNode.removeChild(n))})},outputRule:function(n){var r=this,t=(utils.cssRule(i,r.document)||"").replace(/[\n\r]+/g,"").match(f);t&&n.appendChild(UE.uNode.createElement('<p style="display:none;" data-background="'+utils.trim(t[1].replace(/"/g,"").replace(/[\s]+/g," "))+'"><br/><\/p>'))},commands:{background:{execCommand:function(n,t){u(t)},queryCommandValue:function(){var t=this,n=(utils.cssRule(i,t.document)||"").replace(/[\n\r]+/g,"").match(f);return n?e(n[1]):null},notNeedUndo:!0}}}});UE.commands.imagefloat={execCommand:function(n,t){var s=this,h=s.selection.getRange(),f,u,i,o,e;if(!h.collapsed&&(f=h.getClosedNode(),f&&f.tagName=="IMG"))switch(t){case"left":case"right":case"none":for(u=f.parentNode;r.$inline[u.tagName]||u.tagName=="A";)u=u.parentNode;if(i=u,i.tagName=="P"&&domUtils.getStyle(i,"text-align")=="center"){if(!domUtils.isBody(i)&&domUtils.getChildCount(i,function(n){return!domUtils.isBr(n)&&!domUtils.isWhitespace(n)})==1)if(o=i.previousSibling,e=i.nextSibling,o&&e&&o.nodeType==1&&e.nodeType==1&&o.tagName==e.tagName&&domUtils.isBlockElm(o)){for(o.appendChild(i.firstChild);e.firstChild;)o.appendChild(e.firstChild);domUtils.remove(i);domUtils.remove(e)}else domUtils.setStyle(i,"text-align","");h.selectNode(f).select()}domUtils.setStyle(f,"float",t=="none"?"":t);t=="none"&&domUtils.removeAttributes(f,"align");break;case"center":if(s.queryCommandValue("imagefloat")!="center"){for(u=f.parentNode,domUtils.setStyle(f,"float",""),domUtils.removeAttributes(f,"align"),i=f;u&&domUtils.getChildCount(u,function(n){return!domUtils.isBr(n)&&!domUtils.isWhitespace(n)})==1&&(r.$inline[u.tagName]||u.tagName=="A");)i=u,u=u.parentNode;h.setStartBefore(i).setCursor(!1);u=s.document.createElement("div");u.appendChild(i);domUtils.setStyle(i,"float","");s.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+u.innerHTML+"<\/p>");i=s.document.getElementById("_img_parent_tmp");i.removeAttribute("id");i=i.firstChild;h.selectNode(i).select();e=i.parentNode.nextSibling;e&&domUtils.isEmptyNode(e)&&domUtils.remove(e)}}},queryCommandValue:function(){var i=this.selection.getRange(),n,t;return i.collapsed?"none":(n=i.getClosedNode(),n&&n.nodeType==1&&n.tagName=="IMG")?(t=domUtils.getComputedStyle(n,"float")||n.getAttribute("align"),t=="none"&&(t=domUtils.getComputedStyle(n.parentNode,"text-align")=="center"?"center":t),{left:1,right:1,center:1}[t]?t:"none"):"none"},queryCommandState:function(){var t=this.selection.getRange(),n;return t.collapsed?-1:(n=t.getClosedNode(),n&&n.nodeType==1&&n.tagName=="IMG")?0:-1}};UE.commands.insertimage={execCommand:function(n,t){var e,h,o,u,i,c;if(t=utils.isArray(t)?t:[t],t.length){var f=this,s=f.selection.getRange(),r=s.getClosedNode();if(f.fireEvent("beforeinsertimage",t)!==!0){if(r&&/img/i.test(r.tagName)&&(r.className!="edui-faked-video"||r.className.indexOf("edui-upload-video")!=-1)&&!r.getAttribute("word_img"))e=t.shift(),h=e.floatStyle,delete e.floatStyle,domUtils.setAttributes(r,e),f.execCommand("imagefloat",h),t.length>0&&(s.setStartAfter(r).setCursor(!1,!0),f.execCommand("insertimage",t));else{if(o=[],u="",i=t[0],t.length==1)u='<img src="'+i.src+'" '+(i._src?' _src="'+i._src+'" ':"")+(i.width?'width="'+i.width+'" ':"")+(i.height?' height="'+i.height+'" ':"")+(i.floatStyle=="left"||i.floatStyle=="right"?' style="float:'+i.floatStyle+';"':"")+(i.title&&i.title!=""?' title="'+i.title+'"':"")+(i.border&&i.border!="0"?' border="'+i.border+'"':"")+(i.alt&&i.alt!=""?' alt="'+i.alt+'"':"")+(i.hspace&&i.hspace!="0"?' hspace = "'+i.hspace+'"':"")+(i.vspace&&i.vspace!="0"?' vspace = "'+i.vspace+'"':"")+"/>",i.floatStyle=="center"&&(u='<p style="text-align: center">'+u+"<\/p>"),o.push(u);else for(c=0;i=t[c++];)u="<p "+(i.floatStyle=="center"?'style="text-align: center" ':"")+'><img src="'+i.src+'" '+(i.width?'width="'+i.width+'" ':"")+(i._src?' _src="'+i._src+'" ':"")+(i.height?' height="'+i.height+'" ':"")+' style="'+(i.floatStyle&&i.floatStyle!="center"?"float:"+i.floatStyle+";":"")+(i.border||"")+'" '+(i.title?' title="'+i.title+'"':"")+" /><\/p>",o.push(u);f.execCommand("insertHtml",o.join(""))}f.fireEvent("afterinsertimage",t)}}}};UE.plugins.justify=function(){var r=this,n=domUtils.isBlockElm,t={left:1,right:1,center:1,justify:1},i=function(t,i){var l=t.createBookmark(),s=function(n){return n.nodeType==1?n.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(n):!domUtils.isWhitespace(n)},f,e,c;t.enlarge(!0);for(var o=t.createBookmark(),r=domUtils.getNextDomNode(o.start,!1,s),u=t.cloneRange(),h;r&&!(domUtils.getPosition(r,o.end)&domUtils.POSITION_FOLLOWING);)if(r.nodeType!=3&&n(r))r=domUtils.getNextDomNode(r,!0,s);else{for(u.setStartBefore(r);r&&r!==o.end&&!n(r);)h=r,r=domUtils.getNextDomNode(r,!1,null,function(t){return!n(t)});u.setEndAfter(h);f=u.getCommonAncestor();!domUtils.isBody(f)&&n(f)?(domUtils.setStyles(f,utils.isString(i)?{"text-align":i}:i),r=f):(e=t.document.createElement("p"),domUtils.setStyles(e,utils.isString(i)?{"text-align":i}:i),c=u.extractContents(),e.appendChild(c),u.insertNode(e),r=e);r=domUtils.getNextDomNode(r,!1,s)}return t.moveToBookmark(o).moveToBookmark(l)};UE.commands.justify={execCommand:function(n,t){var r=this.selection.getRange(),u;return r.collapsed&&(u=this.document.createTextNode("p"),r.insertNode(u)),i(r,t),u&&(r.setStartBefore(u).collapse(!0),domUtils.remove(u)),r.select(),!0},queryCommandValue:function(){var i=this.selection.getStart(),n=domUtils.getComputedStyle(i,"text-align");return t[n]?n:"left"},queryCommandState:function(){var n=this.selection.getStart(),t=n&&domUtils.findParentByTagName(n,["td","th","caption"],!0);return t?-1:0}}};UE.plugins.font=function(){function h(n){for(var t;t=n.parentNode;)if(t.tagName=="SPAN"&&domUtils.getChildCount(t,function(n){return!domUtils.isBookmarkNode(n)&&!domUtils.isBr(n)})==1)t.style.cssText+=n.style.cssText,domUtils.remove(n,!0),n=t;else break}function c(n,t,i){var r,u;s[t]&&(n.adjustmentBoundary(),n.collapsed||n.startContainer.nodeType!=1||(r=n.startContainer.childNodes[n.startOffset],r&&domUtils.isTagNode(r,"span")&&(u=n.createBookmark(),utils.each(domUtils.getElementsByTagName(r,"span"),function(n){n.parentNode&&!domUtils.isBookmarkNode(n)&&(t!="backcolor"||domUtils.getComputedStyle(n,"background-color").toLowerCase()!==i)&&(domUtils.removeStyle(n,s[t]),n.style.cssText.replace(/^\s+$/,"").length==0&&domUtils.remove(n,!0))}),n.moveToBookmark(u))))}function i(t,i,u){var o=t.collapsed,e=t.createBookmark(),f;if(o)for(f=e.start.parentNode;r.$inline[f.tagName];)f=f.parentNode;else f=domUtils.getCommonAncestor(e.start,e.end);utils.each(domUtils.getElementsByTagName(f,"span"),function(t){var r,f;if(t.parentNode&&!domUtils.isBookmarkNode(t)){if(/\s*border\s*:\s*none;?\s*/i.test(t.style.cssText)){/^\s*border\s*:\s*none;?\s*$/.test(t.style.cssText)?domUtils.remove(t,!0):domUtils.removeStyle(t,"border");return}if(/border/i.test(t.style.cssText)&&t.parentNode.tagName=="SPAN"&&/border/i.test(t.parentNode.style.cssText)&&(t.style.cssText=t.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")),!(i=="fontborder"&&u=="none"))for(r=t.nextSibling;r&&r.nodeType==1&&r.tagName=="SPAN";){if(domUtils.isBookmarkNode(r)&&i=="fontborder"){t.appendChild(r);r=t.nextSibling;continue}if(r.style.cssText==t.style.cssText&&(domUtils.moveChild(r,t),domUtils.remove(r)),t.nextSibling===r)break;r=t.nextSibling}h(t);n.ie&&n.version>8&&(f=domUtils.findParent(t,function(n){return n.tagName=="SPAN"&&/background-color/.test(n.style.cssText)}),f&&!/background-color/.test(t.style.cssText)&&(t.style.backgroundColor=f.style.backgroundColor))}});t.moveToBookmark(e);c(t,i,u)}var f=this,e={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},t={underline:1,strikethrough:1,fontborder:1},s={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},u;f.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]});f.addInputRule(function(n){utils.each(n.getNodesByTagName("u s del font strike"),function(n){var i,t,r;if(n.tagName=="font"){i=[];for(t in n.attrs)switch(t){case"size":i.push("font-size:"+({"1":"10","2":"12","3":"16","4":"18","5":"24","6":"32","7":"48"}[n.attrs[t]]||n.attrs[t])+"px");break;case"color":i.push("color:"+n.attrs[t]);break;case"face":i.push("font-family:"+n.attrs[t]);break;case"style":i.push(n.attrs[t])}n.attrs={style:i.join(";")}}else r=n.tagName=="u"?"underline":"line-through",n.attrs={style:(n.getAttr("style")||"")+"text-decoration:"+r+";"};n.tagName="span"})});for(u in e)(function(u,f){UE.commands[u]={execCommand:function(r,e){var l,s,h,c,a;if(e=e||(this.queryCommandState(r)?"none":r=="underline"?"underline":r=="fontborder"?"1px solid #000":"line-through"),l=this,s=this.selection.getRange(),e=="default")s.collapsed&&(h=l.document.createTextNode("font"),s.insertNode(h).select()),l.execCommand("removeFormat","span,a",f),h&&(s.setStartBefore(h).collapse(!0),domUtils.remove(h)),i(s,r,e),s.select();else if(s.collapsed){if(c=domUtils.findParentByTagName(s.startContainer,"span",!0),h=l.document.createTextNode("font"),!c||c.children.length||c[n.ie?"innerText":"textContent"].replace(o,"").length){if(s.insertNode(h),s.selectNode(h).select(),c=s.document.createElement("span"),t[u]){if(domUtils.findParentByTagName(h,"a",!0)){s.setStartBefore(h).setCursor();domUtils.remove(h);return}l.execCommand("removeFormat","span,a",f)}if(c.style.cssText=f+":"+e,h.parentNode.insertBefore(c,h),!n.ie||n.ie&&n.version==9)for(a=c.parentNode;!domUtils.isBlockElm(a);)a.tagName=="SPAN"&&(c.style.cssText=a.style.cssText+";"+c.style.cssText),a=a.parentNode;v?setTimeout(function(){s.setStart(c,0).collapse(!0);i(s,r,e);s.select()}):(s.setStart(c,0).collapse(!0),i(s,r,e),s.select())}else s.insertNode(h),t[u]&&(s.selectNode(h).select(),l.execCommand("removeFormat","span,a",f,null),c=domUtils.findParentByTagName(h,"span",!0),s.setStartBefore(h)),c&&(c.style.cssText+=";"+f+":"+e),s.collapse(!0).select();domUtils.remove(h)}else t[u]&&l.queryCommandValue(u)&&l.execCommand("removeFormat","span,a",f),s=l.selection.getRange(),s.applyInlineStyle("span",{style:f+":"+e}),i(s,r,e),s.select();return!0},queryCommandValue:function(n){var u=this.selection.getStart(),i,o,e,s,t;if(n=="underline"||n=="strikethrough"){for(i=u;i&&!domUtils.isBlockElm(i)&&!domUtils.isBody(i);){if(i.nodeType==1&&(o=domUtils.getComputedStyle(i,f),o!="none"))return o;i=i.parentNode}return"none"}if(n=="fontborder"){for(t=u;t&&r.$inline[t.tagName];){if((e=domUtils.getComputedStyle(t,"border"))&&/1px/.test(e)&&/solid/.test(e))return e;t=t.parentNode}return""}return n=="FontSize"?(s=domUtils.getComputedStyle(u,f),t=/^([\d\.]+)(\w+)$/.exec(s),t)?Math.floor(t[1])+t[2]:s:domUtils.getComputedStyle(u,f)},queryCommandState:function(n){if(!t[n])return 0;var i=this.queryCommandValue(n);return n=="fontborder"?/1px/.test(i)&&/solid/.test(i):n=="underline"?/underline/.test(i):/line\-through/.test(i)}}})(u,e[u])};UE.plugins.link=function(){function t(n){var t=n.startContainer,i=n.endContainer;(t=domUtils.findParentByTagName(t,"a",!0))&&n.setStartBefore(t);(i=domUtils.findParentByTagName(i,"a",!0))&&n.setEndAfter(i)}function i(i,r,u){var e=i.cloneRange(),h=u.queryCommandValue("link"),f,o,s;t(i=i.adjustmentBoundary());f=i.startContainer;f.nodeType==1&&h&&(f=f.childNodes[i.startOffset],f&&f.nodeType==1&&f.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(f[n.ie?"innerText":"textContent"])&&(f[n.ie?"innerText":"textContent"]=utils.html(r.textValue||r.href)));(!e.collapsed||h)&&(i.removeInlineStyle("a"),e=i.cloneRange());e.collapsed?(o=i.document.createElement("a"),s="",r.textValue?(s=utils.html(r.textValue),delete r.textValue):s=utils.html(r.href),domUtils.setAttributes(o,r),f=domUtils.findParentByTagName(e.startContainer,"a",!0),f&&domUtils.isInNodeEndBoundary(e,f)&&i.setStartAfter(f).collapse(!0),o[n.ie?"innerText":"textContent"]=s,i.insertNode(o).selectNode(o)):i.applyInlineStyle("a",r)}UE.commands.unlink={execCommand:function(){var n=this.selection.getRange(),i;(!n.collapsed||domUtils.findParentByTagName(n.startContainer,"a",!0))&&(i=n.createBookmark(),t(n),n.removeInlineStyle("a").moveToBookmark(i).select())},queryCommandState:function(){return!this.highlight&&this.queryCommandValue("link")?0:-1}};UE.commands.link={execCommand:function(n,t){t.class="keylab-self-a";var r;t._href&&(t._href=utils.unhtml(t._href,/[<">]/g));t.href&&(t.href=utils.unhtml(t.href,/[<">]/g));t.textValue&&(t.textValue=utils.unhtml(t.textValue,/[<">]/g));i(r=this.selection.getRange(),t,this);r.collapse().select(!0)},queryCommandValue:function(){var n=this.selection.getRange(),t,e,u,f,o,i;if(n.collapsed){if(t=n.startContainer,t=t.nodeType==1?t:t.parentNode,t&&(t=domUtils.findParentByTagName(t,"a",!0))&&!domUtils.isInNodeEndBoundary(n,t))return t}else{n.shrinkBoundary();var s=n.startContainer.nodeType==3||!n.startContainer.childNodes[n.startOffset]?n.startContainer:n.startContainer.childNodes[n.startOffset],h=n.endContainer.nodeType==3||n.endOffset==0?n.endContainer:n.endContainer.childNodes[n.endOffset-1],r=n.getCommonAncestor();if(t=domUtils.findParentByTagName(r,"a",!0),!t&&r.nodeType==1)for(e=r.getElementsByTagName("a"),o=0;i=e[o++];)if(u=domUtils.getPosition(i,s),f=domUtils.getPosition(i,h),(u&domUtils.POSITION_FOLLOWING||u&domUtils.POSITION_CONTAINS)&&(f&domUtils.POSITION_PRECEDING||f&domUtils.POSITION_CONTAINS)){t=i;break}return t}},queryCommandState:function(){var n=this.selection.getRange().getClosedNode(),t=n&&(n.className=="edui-faked-video"||n.className.indexOf("edui-upload-video")!=-1);return t?-1:0}}};UE.plugins.insertframe=function(){function t(){n._iframe&&delete n._iframe}var n=this;n.addListener("selectionchange",function(){t()})};UE.commands.scrawl={queryCommandState:function(){return n.ie&&n.version<=8?-1:0}};UE.plugins.removeformat=function(){var t=this;t.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"});t.commands.removeformat={execCommand:function(t,i,f,e,o){function v(t){var i,r,u;if(t.nodeType==3||t.tagName.toLowerCase()!="span")return 0;if(n.ie&&(i=t.attributes,i.length)){for(r=0,u=i.length;r<u;r++)if(i[r].specified)return 0;return 1}return!t.attributes.length}function p(n){var b=n.createBookmark(),e,i,p,u,t,l,w;for(n.collapsed&&n.enlarge(!0),o||(e=domUtils.findParentByTagName(n.startContainer,"a",!0),e&&n.setStartBefore(e),e=domUtils.findParentByTagName(n.endContainer,"a",!0),e&&n.setEndAfter(e)),s=n.createBookmark(),t=s.start;(h=t.parentNode)&&!domUtils.isBlockElm(h);)domUtils.breakParent(t,h),domUtils.clearEmptySibling(t);if(s.end){for(t=s.end;(h=t.parentNode)&&!domUtils.isBlockElm(h);)domUtils.breakParent(t,h),domUtils.clearEmptySibling(t);for(i=domUtils.getNextDomNode(s.start,!1,a);i;){if(i==s.end)break;p=domUtils.getNextDomNode(i,!0,a);r.$empty[i.tagName.toLowerCase()]||domUtils.isBookmarkNode(i)||(y.test(i.tagName)?f?(domUtils.removeStyle(i,f),v(i)&&f!="text-decoration"&&domUtils.remove(i,!0)):domUtils.remove(i,!0):r.$tableContent[i.tagName]||r.$list[i.tagName]||(domUtils.removeAttributes(i,c),v(i)&&domUtils.remove(i,!0)));i=p}}for(u=s.start.parentNode,!domUtils.isBlockElm(u)||r.$tableContent[u.tagName]||r.$list[u.tagName]||domUtils.removeAttributes(u,c),u=s.end.parentNode,s.end&&domUtils.isBlockElm(u)&&!r.$tableContent[u.tagName]&&!r.$list[u.tagName]&&domUtils.removeAttributes(u,c),n.moveToBookmark(s).moveToBookmark(b),t=n.startContainer,w=n.collapsed;t.nodeType==1&&domUtils.isEmptyNode(t)&&r.$removeEmpty[t.tagName];)l=t.parentNode,n.setStartBefore(t),n.startContainer===n.endContainer&&n.endOffset--,domUtils.remove(t),t=l;if(!w)for(t=n.endContainer;t.nodeType==1&&domUtils.isEmptyNode(t)&&r.$removeEmpty[t.tagName];)l=t.parentNode,n.setEndBefore(t),domUtils.remove(t),t=l}var y=new RegExp("^(?:"+(i||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),c=f?[]:(e||this.options.removeFormatAttributes).split(","),l=new u.Range(this.document),s,h,a=function(n){return n.nodeType==1};l=this.selection.getRange();p(l);l.select()}}};UE.plugins.blockquote=function(){function n(n){return domUtils.filterNodeList(n.selection.getStartElementPath(),"blockquote")}var t=this;t.commands.blockquote={execCommand:function(t,i){var c=this.selection.getRange(),h=n(this),w=r.blockquote,g=c.createBookmark(),b,l,d,a,p;if(h){var v=c.startContainer,o=domUtils.isBlockElm(v)?v:domUtils.findParent(v,function(n){return domUtils.isBlockElm(n)}),y=c.endContainer,s=domUtils.isBlockElm(y)?y:domUtils.findParent(y,function(n){return domUtils.isBlockElm(n)});for(o=domUtils.findParentByTagName(o,"li",!0)||o,s=domUtils.findParentByTagName(s,"li",!0)||s,o.tagName=="LI"||o.tagName=="TD"||o===h||domUtils.isBody(o)?domUtils.remove(h,!0):domUtils.breakParent(o,h),o!==s&&(h=domUtils.findParentByTagName(s,"blockquote"),h&&(s.tagName=="LI"||s.tagName=="TD"||domUtils.isBody(s)?h.parentNode&&domUtils.remove(h,!0):domUtils.breakParent(s,h))),b=domUtils.getElementsByTagName(this.document,"blockquote"),a=0;l=b[a++];)l.childNodes.length?domUtils.getPosition(l,o)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(l,s)&domUtils.POSITION_PRECEDING&&domUtils.remove(l,!0):domUtils.remove(l)}else{for(var f=c.cloneRange(),u=f.startContainer.nodeType==1?f.startContainer:f.startContainer.parentNode,e=u,k=1;;){if(domUtils.isBody(u)){e!==u?c.collapsed?(f.selectNode(e),k=0):f.setStartBefore(e):f.setStart(u,0);break}if(!w[u.tagName]){c.collapsed?f.selectNode(e):f.setStartBefore(e);break}e=u;u=u.parentNode}if(k)for(e=u=u=f.endContainer.nodeType==1?f.endContainer:f.endContainer.parentNode;;){if(domUtils.isBody(u)){e!==u?f.setEndAfter(e):f.setEnd(u,u.childNodes.length);break}if(!w[u.tagName]){f.setEndAfter(e);break}e=u;u=u.parentNode}for(u=c.document.createElement("blockquote"),domUtils.setAttributes(u,i),u.appendChild(f.extractContents()),f.insertNode(u),d=domUtils.getElementsByTagName(u,"blockquote"),a=0;p=d[a++];)p.parentNode&&domUtils.remove(p,!0)}c.moveToBookmark(g).select()},queryCommandState:function(){return n(this)?1:0}}};UE.commands.touppercase=UE.commands.tolowercase={execCommand:function(n){var e=this,i=e.selection.getRange();if(i.collapsed)return i;for(var r=i.createBookmark(),u=r.end,f=function(n){return!domUtils.isBr(n)&&!domUtils.isWhitespace(n)},t=domUtils.getNextDomNode(r.start,!1,f);t&&domUtils.getPosition(t,u)&domUtils.POSITION_PRECEDING;)if(t.nodeType==3&&(t.nodeValue=t.nodeValue[n=="touppercase"?"toUpperCase":"toLowerCase"]()),t=domUtils.getNextDomNode(t,!0,f),t===u)break;i.moveToBookmark(r).select()}};UE.commands.indent={execCommand:function(){var n=this,t=n.queryCommandState("indent")?"0em":n.options.indentValue||"2em";n.execCommand("Paragraph","p",{style:"text-indent:"+t})},queryCommandState:function(){var n=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return n&&n.style.textIndent&&parseInt(n.style.textIndent)?1:0}};UE.commands.print={execCommand:function(){this.window.print()},notNeedUndo:1};UE.commands.preview={execCommand:function(){var t=window.open("","_blank",""),n=t.document;n.open();n.write('<!DOCTYPE html><html><head><meta charset="utf-8"/><script src="'+this.options.UEDITOR_HOME_URL+"ueditor.parse.js\"><\/script><script>setTimeout(function(){uParse('div',{rootPath: '"+this.options.UEDITOR_HOME_URL+"'})},300)<\/script><\/head><body><div>"+this.getContent(null,null,!0)+"<\/div><\/body><\/html>");n.close()},notNeedUndo:1};UE.plugins.selectall=function(){var t=this;t.commands.selectall={execCommand:function(){var r=this,t=r.body,i=r.selection.getRange();i.selectNodeContents(t);domUtils.isEmptyBlock(t)&&(n.opera&&t.firstChild&&t.firstChild.nodeType==1&&i.setStartAtFirst(t.firstChild),i.collapse(!0));i.select(!0)},notNeedUndo:1};t.addshortcutkey({selectAll:"ctrl+65"})};UE.plugins.paragraph=function(){var i=this,t=domUtils.isBlockElm,r=["TD","LI","PRE"],u=function(n,i,u,f){var v=n.createBookmark(),l=function(n){return n.nodeType==1?n.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(n):!domUtils.isWhitespace(n)},e,o;n.enlarge(!0);for(var h=n.createBookmark(),s=domUtils.getNextDomNode(h.start,!1,l),c=n.cloneRange(),a;s&&!(domUtils.getPosition(s,h.end)&domUtils.POSITION_FOLLOWING);)if(s.nodeType!=3&&t(s))s=domUtils.getNextDomNode(s,!0,l);else{for(c.setStartBefore(s);s&&s!==h.end&&!t(s);)a=s,s=domUtils.getNextDomNode(s,!1,null,function(n){return!t(n)});c.setEndAfter(a);e=n.document.createElement(i);u&&(domUtils.setAttributes(e,u),f&&f=="customstyle"&&u.style&&(e.style.cssText=u.style));e.appendChild(c.extractContents());domUtils.isEmptyNode(e)&&domUtils.fillChar(n.document,e);c.insertNode(e);o=e.parentNode;t(o)&&!domUtils.isBody(e.parentNode)&&utils.indexOf(r,o.tagName)==-1&&(f&&f=="customstyle"||(o.getAttribute("dir")&&e.setAttribute("dir",o.getAttribute("dir")),o.style.cssText&&(e.style.cssText=o.style.cssText+";"+e.style.cssText),o.style.textAlign&&!e.style.textAlign&&(e.style.textAlign=o.style.textAlign),o.style.textIndent&&!e.style.textIndent&&(e.style.textIndent=o.style.textIndent),o.style.padding&&!e.style.padding&&(e.style.padding=o.style.padding)),u&&/h\d/i.test(o.tagName)&&!/h\d/i.test(e.tagName)?(domUtils.setAttributes(o,u),f&&f=="customstyle"&&u.style&&(o.style.cssText=u.style),domUtils.remove(e,!0),e=o):domUtils.remove(e.parentNode,!0));s=utils.indexOf(r,o.tagName)!=-1?o:e;s=domUtils.getNextDomNode(s,!1,l)}return n.moveToBookmark(h).moveToBookmark(v)};i.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});i.commands.paragraph={execCommand:function(t,i,r,f){var e=this.selection.getRange(),o,s,h;return e.collapsed&&(o=this.document.createTextNode("p"),e.insertNode(o),n.ie&&(s=o.previousSibling,s&&domUtils.isWhitespace(s)&&domUtils.remove(s),s=o.nextSibling,s&&domUtils.isWhitespace(s)&&domUtils.remove(s))),e=u(e,i,r,f),o&&(e.setStartBefore(o).collapse(!0),pN=o.parentNode,domUtils.remove(o),domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)&&domUtils.fillNode(this.document,pN)),n.gecko&&e.collapsed&&e.startContainer.nodeType==1&&(h=e.startContainer.childNodes[e.startOffset],h&&h.nodeType==1&&h.tagName.toLowerCase()==i&&e.setStart(h,0).collapse(!0)),e.select(),!0},queryCommandValue:function(){var n=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return n?n.tagName.toLowerCase():""}}},function(){var n=domUtils.isBlockElm,t=function(n){return domUtils.filterNodeList(n.selection.getStartElementPath(),function(n){return n&&n.nodeType==1&&n.getAttribute("dir")})},i=function(i,r,u){var l,c=function(n){return n.nodeType==1?!domUtils.isBookmarkNode(n):!domUtils.isWhitespace(n)},a=t(r),o,s,y;if(a&&i.collapsed)return a.setAttribute("dir",u),i;l=i.createBookmark();i.enlarge(!0);for(var h=i.createBookmark(),f=domUtils.getNextDomNode(h.start,!1,c),e=i.cloneRange(),v;f&&!(domUtils.getPosition(f,h.end)&domUtils.POSITION_FOLLOWING);)if(f.nodeType!=3&&n(f))f=domUtils.getNextDomNode(f,!0,c);else{for(e.setStartBefore(f);f&&f!==h.end&&!n(f);)v=f,f=domUtils.getNextDomNode(f,!1,null,function(t){return!n(t)});e.setEndAfter(v);o=e.getCommonAncestor();!domUtils.isBody(o)&&n(o)?(o.setAttribute("dir",u),f=o):(s=i.document.createElement("p"),s.setAttribute("dir",u),y=e.extractContents(),s.appendChild(y),e.insertNode(s),f=s);f=domUtils.getNextDomNode(f,!1,c)}return i.moveToBookmark(h).moveToBookmark(l)};UE.commands.directionality={execCommand:function(n,t){var r=this.selection.getRange(),u;return r.collapsed&&(u=this.document.createTextNode("d"),r.insertNode(u)),i(r,this,t),u&&(r.setStartBefore(u).collapse(!0),domUtils.remove(u)),r.select(),!0},queryCommandValue:function(){var n=t(this);return n?n.getAttribute("dir"):"ltr"}}}();UE.plugins.horizontal=function(){var n=this;n.commands.horizontal={execCommand:function(n){var r=this,i,u,t;if(r.queryCommandState(n)!==-1)return r.execCommand("insertHtml","<hr>"),i=r.selection.getRange(),u=i.startContainer,u.nodeType!=1||u.childNodes[i.startOffset]||(t=u.childNodes[i.startOffset-1])&&t.nodeType==1&&t.tagName=="HR"&&(r.options.enterTag=="p"?(t=r.document.createElement("p"),i.insertNode(t),i.setStart(t,0).setCursor()):(t=r.document.createElement("br"),i.insertNode(t),i.setStartBefore(t).setCursor())),!0},queryCommandState:function(){return domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}};n.addListener("delkeydown",function(n,t){var i=this.selection.getRange(),u,r;return i.txtToElmBoundary(!0),domUtils.isStartInblock(i)&&(u=i.startContainer,r=u.previousSibling,r&&domUtils.isTagNode(r,"hr"))?(domUtils.remove(r),i.select(),domUtils.preventDefault(t),!0):void 0})};UE.commands.time=UE.commands.date={execCommand:function(n,t){function r(n,t){var i=("0"+n.getHours()).slice(-2),r=("0"+n.getMinutes()).slice(-2),u=("0"+n.getSeconds()).slice(-2);return t=t||"hh:ii:ss",t.replace(/hh/ig,i).replace(/ii/ig,r).replace(/ss/ig,u)}function u(n,t){var i=("000"+n.getFullYear()).slice(-4),r=i.slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),f=("0"+n.getDate()).slice(-2);return t=t||"yyyy-mm-dd",t.replace(/yyyy/ig,i).replace(/yy/ig,r).replace(/mm/ig,u).replace(/dd/ig,f)}var i=new Date;this.execCommand("insertHtml",n=="time"?r(i,t):u(i,t))}};UE.plugins.rowspacing=function(){var n=this;n.setOpt({rowspacingtop:["5","10","15","20","25"],rowspacingbottom:["5","10","15","20","25"]});n.commands.rowspacing={execCommand:function(n,t,i){return this.execCommand("paragraph","p",{style:"margin-"+i+":"+t+"px"}),!0},queryCommandValue:function(n,t){var r=domUtils.filterNodeList(this.selection.getStartElementPath(),function(n){return domUtils.isBlockElm(n)}),i;return r?(i=domUtils.getComputedStyle(r,"margin-"+t).replace(/[^\d]/g,""),i?i:0):0}}};UE.plugins.lineheight=function(){var n=this;n.setOpt({lineheight:["1","1.5","1.75","2","3","4","5"]});n.commands.lineheight={execCommand:function(n,t){return this.execCommand("paragraph","p",{style:"line-height:"+(t=="1"?"normal":t+"em")}),!0},queryCommandValue:function(){var t=domUtils.filterNodeList(this.selection.getStartElementPath(),function(n){return domUtils.isBlockElm(n)}),n;if(t)return n=domUtils.getComputedStyle(t,"line-height"),n=="normal"?1:n.replace(/[^\d.]*/ig,"")}}};UE.plugins.insertcode=function(){var t=this,i;t.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",t.document)});t.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"});t.commands.insertcode={execCommand:function(t,i){var e=this,o=e.selection.getRange(),f=domUtils.findParentByTagName(o.startContainer,"pre",!0),u,c,h,s;f?f.className="brush:"+i+";toolbar:false;":(u="",o.collapsed?u=n.ie&&n.ie11below?n.version<=8?"&nbsp;":"":"<br/>":(c=o.extractContents(),h=e.document.createElement("div"),h.appendChild(c),utils.each(UE.filterNode(UE.htmlparser(h.innerHTML.replace(/[\r\t]/g,"")),e.options.filterTxtRules).children,function(t){if(n.ie&&n.ie11below&&n.version>8)t.type=="element"?t.tagName=="br"?u+="\n":r.$empty[t.tagName]||(utils.each(t.children,function(n){n.type=="element"?n.tagName=="br"?u+="\n":r.$empty[t.tagName]||(u+=n.innerText()):u+=n.data}),/\n$/.test(u)||(u+="\n")):u+=t.data+"\n",!t.nextSibling()&&/\n$/.test(u)&&(u=u.replace(/\n$/,""));else if(n.ie&&n.ie11below)t.type=="element"?t.tagName=="br"?u+="<br>":r.$empty[t.tagName]||(utils.each(t.children,function(n){n.type=="element"?n.tagName=="br"?u+="<br>":r.$empty[t.tagName]||(u+=n.innerText()):u+=n.data}),/br>$/.test(u)||(u+="<br>")):u+=t.data+"<br>",!t.nextSibling()&&/<br>$/.test(u)&&(u=u.replace(/<br>$/,""));else if(u+=t.type=="element"?r.$empty[t.tagName]?"":t.innerText():t.data,!/br\/?\s*>$/.test(u)){if(!t.nextSibling())return;u+="<br>"}})),e.execCommand("inserthtml",'<pre id="coder"class="brush:'+i+';toolbar:false">'+u+"<\/pre>",!0),f=e.document.getElementById("coder"),domUtils.removeAttributes(f,"id"),s=f.previousSibling,s&&(s.nodeType==3&&s.nodeValue.length==1&&n.ie&&n.version==6||domUtils.isEmptyBlock(s))&&domUtils.remove(s),o=e.selection.getRange(),domUtils.isEmptyBlock(f)?o.setStart(f,0).setCursor(!1,!0):o.selectNodeContents(f).select())},queryCommandValue:function(){var t=this.selection.getStartElementPath(),n="";return utils.each(t,function(t){if(t.nodeName=="PRE"){var i=t.className.match(/brush:([^;]+)/);return n=i&&i[1]?i[1]:"",!1}}),n}};t.addInputRule(function(t){utils.each(t.getNodesByTagName("pre"),function(t){var i=t.getNodesByTagName("br"),r;if(i.length){n.ie&&n.ie11below&&n.version>8&&utils.each(i,function(n){var t=UE.uNode.createText("\n");n.parentNode.insertBefore(t,n);n.parentNode.removeChild(n)});return}n.ie&&n.ie11below&&n.version>8||(r=t.innerText().split(/\n/),t.innerHTML(""),utils.each(r,function(n){n.length&&t.appendChild(UE.uNode.createText(n));t.appendChild(UE.uNode.createElement("br"))}))})});t.addOutputRule(function(n){utils.each(n.getNodesByTagName("pre"),function(n){var t="";utils.each(n.children,function(n){t+=n.type=="text"?n.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,""):n.tagName=="br"?"\n":r.$empty[n.tagName]?n.innerText():""});n.innerText(t.replace(/(&nbsp;|\n)+$/,""))})});t.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,selectall:1};i=t.queryCommandState;t.queryCommandState=function(n){var t=this;return!t.notNeedCodeQuery[n.toLowerCase()]&&t.selection&&t.queryCommandValue("insertcode")?-1:UE.Editor.prototype.queryCommandState.apply(this,arguments)};t.addListener("beforeenterkeydown",function(){var r=t.selection.getRange(),i=domUtils.findParentByTagName(r.startContainer,"pre",!0),l,o,h,a,s,f,c,u,e;if(i){if(t.fireEvent("saveScene"),r.collapsed||r.deleteContents(),!n.ie||n.ie9above){for(f=t.document.createElement("br"),r.insertNode(f).setStartAfter(f).collapse(!0),l=f.nextSibling,!l&&(!n.ie||n.version>10)?r.insertNode(f.cloneNode(!1)):r.setStartAfter(f),i=f.previousSibling;i;)if(c=i,i=i.previousSibling,!i||i.nodeName=="BR"){i=c;break}if(i){for(u="";i&&i.nodeName!="BR"&&new RegExp("^[\\s"+domUtils.fillChar+"]*$").test(i.nodeValue);)u+=i.nodeValue,i=i.nextSibling;i.nodeName!="BR"&&(e=i.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)")),e&&e[1]&&(u+=e[1]));u&&(u=t.document.createTextNode(u),r.insertNode(u).setStartAfter(u))}r.collapse(!0).select(!0)}else if(n.version>8)o=t.document.createTextNode("\n"),h=r.startContainer,r.startOffset==0?(a=h.previousSibling,a&&(r.insertNode(o),s=t.document.createTextNode(" "),r.setStartAfter(o).insertNode(s).setStart(s,0).collapse(!0).select(!0))):(r.insertNode(o).setStartAfter(o),s=t.document.createTextNode(" "),h=r.startContainer.childNodes[r.startOffset],h&&!/^\n/.test(h.nodeValue)&&r.setStartBefore(o),r.insertNode(s).setStart(s,0).collapse(!0).select(!0));else{for(f=t.document.createElement("br"),r.insertNode(f),r.insertNode(t.document.createTextNode(domUtils.fillChar)),r.setStartAfter(f),i=f.previousSibling;i;)if(c=i,i=i.previousSibling,!i||i.nodeName=="BR"){i=c;break}if(i){for(u="";i&&i.nodeName!="BR"&&new RegExp("^[ "+domUtils.fillChar+"]*$").test(i.nodeValue);)u+=i.nodeValue,i=i.nextSibling;i.nodeName!="BR"&&(e=i.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)")),e&&e[1]&&(u+=e[1]));u=t.document.createTextNode(u);r.insertNode(u).setStartAfter(u)}r.collapse(!0).select()}return t.fireEvent("saveScene"),!0}});t.addListener("tabkeydown",function(n,i){var e=t.selection.getRange(),u=domUtils.findParentByTagName(e.startContainer,"pre",!0),f,r,o,s;if(u){if(t.fireEvent("saveScene"),!i.shiftKey)if(e.collapsed)s=t.document.createTextNode("    "),e.insertNode(s).setStartAfter(s).collapse(!0).select(!0);else{for(f=e.createBookmark(),r=f.start.previousSibling;r;){if(u.firstChild===r&&!domUtils.isBr(r)){u.insertBefore(t.document.createTextNode("    "),r);break}if(domUtils.isBr(r)){u.insertBefore(t.document.createTextNode("    "),r.nextSibling);break}r=r.previousSibling}for(o=f.end,r=f.start.nextSibling,u.firstChild===f.start&&u.insertBefore(t.document.createTextNode("    "),r.nextSibling);r&&r!==o;){if(domUtils.isBr(r)&&r.nextSibling){if(r.nextSibling===o)break;u.insertBefore(t.document.createTextNode("    "),r.nextSibling)}r=r.nextSibling}e.moveToBookmark(f).select()}return t.fireEvent("saveScene"),!0}});t.addListener("beforeinserthtml",function(t,i){var e=this,o=e.selection.getRange(),h=domUtils.findParentByTagName(o.startContainer,"pre",!0),u,s,f;if(h)return o.collapsed||o.deleteContents(),u="",n.ie&&n.version>8?(utils.each(UE.filterNode(UE.htmlparser(i),e.options.filterTxtRules).children,function(n){n.type=="element"?n.tagName=="br"?u+="\n":r.$empty[n.tagName]||(utils.each(n.children,function(t){t.type=="element"?t.tagName=="br"?u+="\n":r.$empty[n.tagName]||(u+=t.innerText()):u+=t.data}),/\n$/.test(u)||(u+="\n")):u+=n.data+"\n";!n.nextSibling()&&/\n$/.test(u)&&(u=u.replace(/\n$/,""))}),s=e.document.createTextNode(utils.html(u.replace(/&nbsp;/g," "))),o.insertNode(s).selectNode(s).select()):(f=e.document.createDocumentFragment(),utils.each(UE.filterNode(UE.htmlparser(i),e.options.filterTxtRules).children,function(n){n.type=="element"?n.tagName=="br"?f.appendChild(e.document.createElement("br")):r.$empty[n.tagName]||(utils.each(n.children,function(t){t.type=="element"?t.tagName=="br"?f.appendChild(e.document.createElement("br")):r.$empty[n.tagName]||f.appendChild(e.document.createTextNode(utils.html(t.innerText().replace(/&nbsp;/g," ")))):f.appendChild(e.document.createTextNode(utils.html(t.data.replace(/&nbsp;/g," "))))}),f.lastChild.nodeName!="BR"&&f.appendChild(e.document.createElement("br"))):f.appendChild(e.document.createTextNode(utils.html(n.data.replace(/&nbsp;/g," "))));n.nextSibling()||f.lastChild.nodeName!="BR"||f.removeChild(f.lastChild)}),o.insertNode(f).select()),!0});t.addListener("keydown",function(n,t){var f=this,o=t.keyCode||t.which,i,u,e,r;if(o==40&&(i=f.selection.getRange(),e=i.startContainer,i.collapsed&&(u=domUtils.findParentByTagName(i.startContainer,"pre",!0))&&!u.nextSibling)){for(r=u.lastChild;r&&r.nodeName=="BR";)r=r.previousSibling;(r===e||i.startContainer===u&&i.startOffset==u.childNodes.length)&&(f.execCommand("insertparagraph"),domUtils.preventDefault(t))}});t.addListener("delkeydown",function(n,i){var r=this.selection.getRange(),u,f;return r.txtToElmBoundary(!0),u=r.startContainer,domUtils.isTagNode(u,"pre")&&r.collapsed&&domUtils.isStartInblock(r)?(f=t.document.createElement("p"),domUtils.fillNode(t.document,f),u.parentNode.insertBefore(f,u),domUtils.remove(u),r.setStart(f,0).setCursor(!1,!0),domUtils.preventDefault(i),!0):void 0})};UE.commands.cleardoc={execCommand:function(){var n=this,i=n.options.enterTag,t=n.selection.getRange();i=="br"?(n.body.innerHTML="<br/>",t.setStart(n.body,0).setCursor()):(n.body.innerHTML="<p>"+(f?"":"<br/>")+"<\/p>",t.setStart(n.body.firstChild,0).setCursor(!1,!0));setTimeout(function(){n.fireEvent("clearDoc")},0)}};UE.plugin.register("anchor",function(){return{bindEvents:{ready:function(){utils.cssRule("anchor",".anchorclass{background: url('"+this.options.themePath+this.options.theme+"/images/anchor.gif') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}",this.document)}},outputRule:function(n){utils.each(n.getNodesByTagName("img"),function(n){var t;(t=n.getAttr("anchorname"))&&(n.tagName="a",n.setAttr({anchorname:"",name:t,"class":""}))})},inputRule:function(n){utils.each(n.getNodesByTagName("a"),function(n){var t;(t=n.getAttr("name"))&&!n.getAttr("href")&&(n.tagName="img",n.setAttr({anchorname:n.getAttr("name"),"class":"anchorclass"}),n.setAttr("name"))})},commands:{anchor:{execCommand:function(n,t){var r=this.selection.getRange(),i=r.getClosedNode(),u;i&&i.getAttribute("anchorname")?t?i.setAttribute("anchorname",t):(r.setStartBefore(i).setCursor(),domUtils.remove(i)):t&&(u=this.document.createElement("img"),r.collapse(!0),domUtils.setAttributes(u,{anchorname:t,"class":"anchorclass"}),r.insertNode(u).setStartAfter(u).setCursor(!1,!0))}}}}});UE.plugins.wordcount=function(){var n=this,t;n.setOpt("wordCount",!0);n.addListener("contentchange",function(){n.fireEvent("wordcount")});n.addListener("ready",function(){var n=this;domUtils.on(n.body,"keyup",function(i){var r=i.keyCode||i.which;r in{"16":1,"18":1,"20":1,"37":1,"38":1,"39":1,"40":1}||(clearTimeout(t),t=setTimeout(function(){n.fireEvent("wordcount")},200))})})};UE.plugins.pagebreak=function(){function t(t){if(domUtils.isEmptyBlock(t)){for(var i=t.firstChild,r;i&&i.nodeType==1&&domUtils.isEmptyBlock(i);)r=i,i=i.firstChild;r||(r=t);domUtils.fillNode(n.document,r)}}function i(n){return n&&n.nodeType==1&&n.tagName=="HR"&&n.className=="pagebreak"}var n=this,r=["td"];n.setOpt("pageBreakTag","_ueditor_page_break_tag_");n.ready(function(){utils.cssRule("pagebreak",".pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}",n.document)});n.addInputRule(function(t){t.traversal(function(t){if(t.type=="text"&&t.data==n.options.pageBreakTag){var i=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');t.parentNode.insertBefore(i,t);t.parentNode.removeChild(t)}})});n.addOutputRule(function(t){utils.each(t.getNodesByTagName("hr"),function(t){if(t.getAttr("class")=="pagebreak"){var i=UE.uNode.createText(n.options.pageBreakTag);t.parentNode.insertBefore(i,t);t.parentNode.removeChild(t)}})});n.commands.pagebreak={execCommand:function(){var e=n.selection.getRange(),u=n.document.createElement("hr"),c,l,v,s,f,o,h,a;if(domUtils.setAttributes(u,{"class":"pagebreak",noshade:"noshade",size:"5"}),domUtils.unSelectable(u),c=domUtils.findParentByTagName(e.startContainer,r,!0),l=[],c)switch(c.tagName){case"TD":f=c.parentNode;f.previousSibling?(f.parentNode.insertBefore(u,f),l=domUtils.findParents(u)):(v=domUtils.findParentByTagName(f,"table"),v.parentNode.insertBefore(u,v),l=domUtils.findParents(u,!0));f=l[1];u!==f&&domUtils.breakParent(u,f);n.fireEvent("afteradjusttable",n.document)}else{if(!e.collapsed)for(e.deleteContents(),s=e.startContainer;!domUtils.isBody(s)&&domUtils.isBlockElm(s)&&domUtils.isEmptyNode(s);)e.setStartBefore(s).collapse(!0),domUtils.remove(s),s=e.startContainer;for(e.insertNode(u),f=u.parentNode;!domUtils.isBody(f);)domUtils.breakParent(u,f),o=u.nextSibling,o&&domUtils.isEmptyBlock(o)&&domUtils.remove(o),f=u.parentNode;o=u.nextSibling;h=u.previousSibling;i(h)?domUtils.remove(h):h&&t(h);o?(i(o)?domUtils.remove(o):t(o),e.setEndAfter(u).collapse(!1)):(a=n.document.createElement("p"),u.parentNode.appendChild(a),domUtils.fillNode(n.document,a),e.setStart(a,0).collapse(!0));e.select(!0)}}}};UE.plugin.register("wordimage",function(){var n=this,t=[];return{commands:{wordimage:{execCommand:function(){for(var t,u=domUtils.getElementsByTagName(n.body,"img"),i=[],f=0,r;r=u[f++];)t=r.getAttribute("word_img"),t&&i.push(t);return i},queryCommandState:function(){t=domUtils.getElementsByTagName(n.body,"img");for(var r=0,i;i=t[r++];)if(i.getAttribute("word_img"))return 1;return-1},notNeedUndo:!0}},inputRule:function(t){utils.each(t.getNodesByTagName("img"),function(t){var i=t.attrs,u=parseInt(i.width)<128||parseInt(i.height)<43,r=n.options,f=r.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";i.src&&/^(?:(file:\/+))/.test(i.src)&&t.setAttr({width:i.width,height:i.height,alt:i.alt,word_img:i.src,src:f,style:"background:url("+(u?r.themePath+r.theme+"/images/word.gif":r.langPath+r.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd"})})}}});UE.plugins.dragdrop=function(){var n=this;n.ready(function(){domUtils.on(this.body,"dragend",function(){var u=n.selection.getRange(),r=u.getClosedNode()||n.selection.getStart(),i,t;if(r&&r.tagName=="IMG"){for(i=r.previousSibling;t=r.nextSibling;)if(t.nodeType!=1||t.tagName!="SPAN"||t.firstChild)break;else domUtils.remove(t);(!i||i.nodeType!=1||domUtils.isEmptyBlock(i))&&i||t&&(!t||domUtils.isEmptyBlock(t))||(i&&i.tagName=="P"&&!domUtils.isEmptyBlock(i)?(i.appendChild(r),domUtils.moveChild(t,i),domUtils.remove(t)):t&&t.tagName=="P"&&!domUtils.isEmptyBlock(t)&&t.insertBefore(r,t.firstChild),i&&i.tagName=="P"&&domUtils.isEmptyBlock(i)&&domUtils.remove(i),t&&t.tagName=="P"&&domUtils.isEmptyBlock(t)&&domUtils.remove(t),u.selectNode(r).select(),n.fireEvent("saveScene"))}})});n.addListener("keyup",function(t,i){var f=i.keyCode||i.which,u,r;f==13&&(u=n.selection.getRange(),(r=domUtils.findParentByTagName(u.startContainer,"p",!0))&&domUtils.getComputedStyle(r,"text-align")=="center"&&domUtils.removeStyle(r,"text-align"))})};UE.plugins.undo=function(){function s(n,t){if(n.length!=t.length)return 0;for(var i=0,r=n.length;i<r;i++)if(n[i]!=t[i])return 0;return 1}function p(n,t){return n.collapsed!=t.collapsed?0:!s(n.startAddress,t.startAddress)||!s(n.endAddress,t.endAddress)?0:1}function w(){this.list=[];this.index=0;this.hasUndo=!1;this.hasRedo=!1;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content)if(this.index--,this.index==0)return this.restore(0);this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}};this.restore=function(){var t=this.editor,r=this.list[this.index],f=UE.htmlparser(r.content.replace(v,"")),i;t.options.autoClearEmptyNode=!1;t.filterInputRule(f);t.options.autoClearEmptyNode=o;t.document.body.innerHTML=f.toHtml();t.fireEvent("afterscencerestore");n.ie&&utils.each(domUtils.getElementsByTagName(t.document,"td th caption p"),function(n){domUtils.isEmptyNode(n)&&domUtils.fillNode(t.document,n)});try{i=new u.Range(t.document).moveToAddress(r.address);i.select(y[i.startContainer.nodeName.toLowerCase()])}catch(e){}this.update();this.clearKey();t.fireEvent("reset",!0)};this.getScene=function(){var n=this.editor,r=n.selection.getRange(),u=r.createAddress(!1,!0),t,i;return n.fireEvent("beforegetscene"),t=UE.htmlparser(n.body.innerHTML),n.options.autoClearEmptyNode=!1,n.filterOutputRule(t),n.options.autoClearEmptyNode=o,i=t.toHtml(),n.fireEvent("aftergetscene"),{address:u,content:i}};this.save=function(n,i){clearTimeout(f);var u=this.getScene(i),r=this.list[this.index];(r&&r.content!=u.content&&t.trigger("contentchange"),r&&r.content==u.content&&(n?1:p(r.address,u.address)))||(this.list=this.list.slice(0,this.index+1),this.list.push(u),this.list.length>l&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=!1;this.hasRedo=!1;this.clearKey()};this.clearKey=function(){e=0;c=null}}var f,t=this,l=t.options.maxUndoCount||20,a=t.options.maxInputCount||20,v=new RegExp(domUtils.fillChar+"|<\/hr>","gi"),y={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},o=t.options.autoClearEmptyNode,r;t.undoManger=new w;t.undoManger.editor=t;t.addListener("saveScene",function(){var n=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,n)});t.addListener("reset",function(n,t){t||this.undoManger.reset()});t.commands.redo=t.commands.undo={execCommand:function(n){this.undoManger[n]()},queryCommandState:function(n){return this.undoManger["has"+(n.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var h={16:1,17:1,18:1,37:1,38:1,39:1,40:1},e=0,c,i=!1;t.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){i=!0});domUtils.on(this.body,"compositionend",function(){i=!1})});t.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});r=!0;t.addListener("keydown",function(n,t){var u=this,s=t.keyCode||t.which;if(!h[s]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(i)return;if(!u.selection.getRange().collapsed){u.undoManger.save(!1,!0);r=!1;return}u.undoManger.list.length==0&&u.undoManger.save(!0);clearTimeout(f);function o(n){n.undoManger.save(!1,!0);n.fireEvent("selectionchange")}f=setTimeout(function(){if(i){var n=setInterval(function(){i||(o(u),clearInterval(n))},300);return}o(u)},200);c=s;e++;e>=a&&o(u)}});t.addListener("keyup",function(n,t){var u=t.keyCode||t.which;if(!h[u]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(i)return;r||(this.undoManger.save(!1,!0),r=!0)}});t.stopCmdUndo=function(){t.__hasEnterExecCommand=!0};t.startCmdUndo=function(){t.__hasEnterExecCommand=!1}};UE.plugin.register("copy",function(){function i(){ZeroClipboard.config({debug:!1,swfPath:t.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.swf"});var n=t.zeroclipboard=new ZeroClipboard;n.on("copy",function(n){var r=n.client,u=t.selection.getRange(),i=document.createElement("div");i.appendChild(u.cloneContents());r.setText(i.innerText||i.textContent);r.setHtml(i.innerHTML);u.select()});n.on("mouseover mouseout",function(n){var t=n.target;n.type=="mouseover"?domUtils.addClass(t,"edui-state-hover"):n.type=="mouseout"&&domUtils.removeClasses(t,"edui-state-hover")});n.on("wrongflash noflash",function(){ZeroClipboard.destroy()})}var t=this;return{bindEvents:{ready:function(){n.ie||(window.ZeroClipboard?i():utils.loadFile(document,{src:t.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.js",tag:"script",type:"text/javascript",defer:"defer"},function(){i()}))}},commands:{copy:{execCommand:function(){t.document.execCommand("copy")||alert(t.getLang("copymsg"))}}}}});UE.plugins.paste=function(){function f(t){var r=this.document;if(!r.getElementById("baidu_pastebin")){var u=this.selection.getRange(),f=u.createBookmark(),i=r.createElement("div");i.id="baidu_pastebin";n.webkit&&i.appendChild(r.createTextNode(domUtils.fillChar+domUtils.fillChar));r.body.appendChild(i);f.start.style.display="";i.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(f.start).y+"px";u.selectNodeContents(i).select(!0);setTimeout(function(){if(n.webkit)for(var o=0,s=r.querySelectorAll("#baidu_pastebin"),e;e=s[o++];)if(domUtils.isEmptyNode(e))domUtils.remove(e);else{i=e;break}try{i.parentNode.removeChild(i)}catch(h){}u.moveToBookmark(f).select(!0);t(i)},0)}}function e(n){return n.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(n,t,i,r){return(i=i.toLowerCase(),{img:1}[i])?n:(r=r.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(n,t,i){return{src:1,href:1,name:1}[t.toLowerCase()]?t+"="+i+" ":""}),{span:1,div:1}[i]?"":"<"+t+i+" "+utils.trim(r)+">")})}function o(f){var h,b,y,k,a,d,l,w,g,p,nt,tt,o,c,s,v;if(f.firstChild){for(b=domUtils.getElementsByTagName(f,"span"),o=0;y=b[o++];)(y.id=="_baidu_cut_start"||y.id=="_baidu_cut_end")&&domUtils.remove(y);if(n.webkit){for(p=f.querySelectorAll("div br"),o=0;k=p[o++];)a=k.parentNode,a.tagName=="DIV"&&a.childNodes.length==1&&(a.innerHTML="<p><br/><\/p>",domUtils.remove(a));for(d=f.querySelectorAll("#baidu_pastebin"),o=0;l=d[o++];){for(w=t.document.createElement("p"),l.parentNode.insertBefore(w,l);l.firstChild;)w.appendChild(l.firstChild);domUtils.remove(l)}for(g=f.querySelectorAll("meta"),o=0;c=g[o++];)domUtils.remove(c);for(p=f.querySelectorAll("br"),o=0;c=p[o++];)/^apple-/i.test(c.className)&&domUtils.remove(c)}if(n.gecko)for(nt=f.querySelectorAll("[_moz_dirty]"),o=0;c=nt[o++];)c.removeAttribute("_moz_dirty");if(!n.ie)for(tt=f.querySelectorAll("span.Apple-style-span"),o=0;c=tt[o++];)domUtils.remove(c,!0);if(h=f.innerHTML,h=UE.filterWord(h),s=UE.htmlparser(h),t.options.filterRules&&UE.filterNode(s,t.options.filterRules),t.filterInputRule(s),n.webkit&&(v=s.lastChild(),v&&v.type=="element"&&v.tagName=="br"&&s.removeChild(v),utils.each(t.body.querySelectorAll("div"),function(n){domUtils.isEmptyBlock(n)&&domUtils.remove(n,!0)})),h={html:s.toHtml()},t.fireEvent("beforepaste",h,s),!h.html)return;s=UE.htmlparser(h.html,!0);t.queryCommandState("pasteplain")===1?t.execCommand("insertHtml",UE.filterNode(s,t.options.filterTxtRules).toHtml(),!0):(UE.filterNode(s,t.options.filterTxtRules),r=s.toHtml(),i=h.html,u=t.selection.getRange().createAddress(!0),t.execCommand("insertHtml",t.getOpt("retainOnlyLabelPasted")===!0?e(i):i,!0));t.fireEvent("afterpaste",h)}}var t=this,r,i,u;t.setOpt({retainOnlyLabelPasted:!1});t.addListener("pasteTransfer",function(n,f){var o,h,l,c,a,v,s,y;if(u&&r&&i&&r!=i){if(o=t.selection.getRange(),o.moveToAddress(u,!0),!o.collapsed){while(!domUtils.isBody(o.startContainer)){if(h=o.startContainer,h.nodeType==1){if(h=h.childNodes[o.startOffset],!h){o.setStartBefore(o.startContainer);continue}l=h.previousSibling;l&&l.nodeType==3&&new RegExp("^[\n\r\t "+domUtils.fillChar+"]*$").test(l.nodeValue)&&o.setStartBefore(l)}if(o.startOffset==0)o.setStartBefore(o.startContainer);else break}while(!domUtils.isBody(o.endContainer)){if(c=o.endContainer,c.nodeType==1){if(c=c.childNodes[o.endOffset],!c){o.setEndAfter(o.endContainer);continue}a=c.nextSibling;a&&a.nodeType==3&&new RegExp("^[\n\r\t"+domUtils.fillChar+"]*$").test(a.nodeValue)&&o.setEndAfter(a)}if(o.endOffset==o.endContainer[o.endContainer.nodeType==3?"nodeValue":"childNodes"].length)o.setEndAfter(o.endContainer);else break}}for(o.deleteContents(),o.select(!0),t.__hasEnterExecCommand=!0,v=i,f===2?v=e(v):f&&(v=r),t.execCommand("inserthtml",v,!0),t.__hasEnterExecCommand=!1,s=t.selection.getRange();!domUtils.isBody(s.startContainer)&&!s.startOffset&&s.startContainer[s.startContainer.nodeType==3?"nodeValue":"childNodes"].length;)s.setStartBefore(s.startContainer);y=s.createAddress(!0);u.endAddress=y.startAddress}});t.addListener("ready",function(){domUtils.on(t.body,"cut",function(){var n=t.selection.getRange();!n.collapsed&&t.undoManger&&t.undoManger.save()});domUtils.on(t.body,n.ie||n.opera?"keydown":"paste",function(i){(n.ie||n.opera)&&(!i.ctrlKey&&!i.metaKey||i.keyCode!="86")||f.call(t,function(n){o(n)})})});t.commands.paste={execCommand:function(){n.ie?(f.call(t,function(n){o(n)}),t.document.execCommand("paste")):alert(t.getLang("pastemsg"))}}};UE.plugins.pasteplain=function(){var t=this,n;t.setOpt({pasteplain:!1,filterTxtRules:function(){function n(n){n.tagName="p";n.setStyle()}function t(n){n.parentNode.removeChild(n,!0)}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:function(n){for(var i,t=UE.uNode.createElement("p");i=n.firstChild();)i.type!="text"&&UE.dom.dtd.$block[i.tagName]?t.firstChild()?(n.parentNode.insertBefore(t,n),t=UE.uNode.createElement("p")):n.parentNode.insertBefore(i,n):t.appendChild(i);t.firstChild()&&n.parentNode.insertBefore(t,n);n.parentNode.removeChild(n)},ol:t,ul:t,dl:t,dt:t,dd:t,li:t,caption:n,th:n,tr:n,h1:n,h2:n,h3:n,h4:n,h5:n,h6:n,td:function(n){var t=!!n.innerText();t&&n.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),n);n.parentNode.removeChild(n,n.innerText())}}}()});n=t.options.pasteplain;t.commands.pasteplain={queryCommandState:function(){return n?1:0},execCommand:function(){n=!n|0},notNeedUndo:1}};UE.plugins.list=function(){function a(n){var t=[];for(var i in n)t.push(i);return t}function u(n){var t=n.className;return domUtils.hasClass(n,/custom_/)?t.match(/custom_(\w+)/)[1]:domUtils.getStyle(n,"list-style-type")}function v(n,t){utils.each(domUtils.getElementsByTagName(n,"ol ul"),function(r){var h,a,y,c,s,l,v;domUtils.inDoc(r,n)&&(h=r.parentNode,h.tagName==r.tagName&&(a=u(r)||(r.tagName=="OL"?"decimal":"disc"),y=u(h)||(h.tagName=="OL"?"decimal":"disc"),a==y&&(c=utils.indexOf(i[r.tagName],a),c=c+1==i[r.tagName].length?0:c+1,o(r,i[r.tagName][c]))),s=0,l=2,domUtils.hasClass(r,/custom_/)?/[ou]l/i.test(h.tagName)&&domUtils.hasClass(h,/custom_/)||(l=1):/[ou]l/i.test(h.tagName)&&domUtils.hasClass(h,/custom_/)&&(l=3),v=domUtils.getStyle(r,"list-style-type"),v&&(r.style.cssText="list-style-type:"+v),r.className=utils.trim(r.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+l,utils.each(domUtils.getElementsByTagName(r,"li"),function(n){var i,t,e;if(n.style.cssText&&(n.style.cssText=""),!n.firstChild){domUtils.remove(n);return}if(n.parentNode===r){if(s++,domUtils.hasClass(r,/custom_/))if(i=1,t=u(r),r.tagName=="OL"){if(t)switch(t){case"cn":case"cn1":case"cn2":s>10&&(s%10==0||s>10&&s<20)?i=2:s>20&&(i=3);break;case"num2":s>9&&(i=2)}n.className="list-"+f[t]+s+" list-"+t+"-paddingleft-"+i}else n.className="list-"+f[t]+" list-"+t+"-paddingleft";else n.className=n.className.replace(/list-[\w\-]+/gi,"");e=n.getAttribute("class");e===null||e.replace(/\s/g,"")||domUtils.removeAttributes(n,"class")}}),t||e(r,r.tagName.toLowerCase(),u(r)||domUtils.getStyle(r,"list-style-type"),!0))})}function e(n,t,i,r){var f=n.nextSibling,e;f&&f.nodeType==1&&f.tagName.toLowerCase()==t&&(u(f)||domUtils.getStyle(f,"list-style-type")||(t=="ol"?"decimal":"disc"))==i&&(domUtils.moveChild(f,n),f.childNodes.length==0&&domUtils.remove(f));f&&domUtils.isFillChar(f)&&domUtils.remove(f);e=n.previousSibling;e&&e.nodeType==1&&e.tagName.toLowerCase()==t&&(u(e)||domUtils.getStyle(e,"list-style-type")||(t=="ol"?"decimal":"disc"))==i&&domUtils.moveChild(n,e);e&&domUtils.isFillChar(e)&&domUtils.remove(e);!r&&domUtils.isEmptyBlock(n)&&domUtils.remove(n);u(n)&&v(n.ownerDocument,!0)}function o(n,t){f[t]&&(n.className="custom_"+t);try{domUtils.setStyle(n,"list-style-type",t)}catch(i){}}function c(n){var t=n.previousSibling;t&&domUtils.isEmptyBlock(t)&&domUtils.remove(t);t=n.nextSibling;t&&domUtils.isEmptyBlock(t)&&domUtils.remove(t)}function y(n){while(n&&!domUtils.isBody(n)){if(n.nodeName=="TABLE")return null;if(n.nodeName=="LI")return n;n=n.parentNode}}var t=this,l={TD:1,PRE:1,BLOCKQUOTE:1},f={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"},i,h,s;t.setOpt({autoTransWordToList:!1,insertorderedlist:{num:"",num1:"",num2:"",cn:"",cn1:"",cn2:"",decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:"",dash:"",dot:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1,disablePInList:!1});i={OL:a(t.options.insertorderedlist),UL:a(t.options.insertunorderedlist)};h=t.options.listiconpath;for(s in f)t.options.insertorderedlist.hasOwnProperty(s)||t.options.insertunorderedlist.hasOwnProperty(s)||delete f[s];t.ready(function(){var r=[],i,u;for(i in f){if(i=="dash"||i=="dot")r.push("li.list-"+f[i]+"{background-image:url("+h+f[i]+".gif)}"),r.push("ul.custom_"+i+"{list-style:none;}ul.custom_"+i+" li{background-position:0 3px;background-repeat:no-repeat}");else{for(u=0;u<99;u++)r.push("li.list-"+f[i]+u+"{background-image:url("+h+"list-"+f[i]+u+".gif)}");r.push("ol.custom_"+i+"{list-style:none;}ol.custom_"+i+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(i){case"cn":r.push("li.list-"+i+"-paddingleft-1{padding-left:25px}");r.push("li.list-"+i+"-paddingleft-2{padding-left:40px}");r.push("li.list-"+i+"-paddingleft-3{padding-left:55px}");break;case"cn1":r.push("li.list-"+i+"-paddingleft-1{padding-left:30px}");r.push("li.list-"+i+"-paddingleft-2{padding-left:40px}");r.push("li.list-"+i+"-paddingleft-3{padding-left:55px}");break;case"cn2":r.push("li.list-"+i+"-paddingleft-1{padding-left:40px}");r.push("li.list-"+i+"-paddingleft-2{padding-left:55px}");r.push("li.list-"+i+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":r.push("li.list-"+i+"-paddingleft-1{padding-left:25px}");break;case"num2":r.push("li.list-"+i+"-paddingleft-1{padding-left:35px}");r.push("li.list-"+i+"-paddingleft-2{padding-left:40px}");break;case"dash":r.push("li.list-"+i+"-paddingleft{padding-left:35px}");break;case"dot":r.push("li.list-"+i+"-paddingleft{padding-left:20px}")}}r.push(".list-paddingleft-1{padding-left:0}");r.push(".list-paddingleft-2{padding-left:"+t.options.listDefaultPaddingLeft+"px}");r.push(".list-paddingleft-3{padding-left:"+t.options.listDefaultPaddingLeft*2+"px}");utils.cssRule("list","ol,ul{margin:0;pading:0;"+(n.ie?"":"width:95%")+"}li{clear:both;}"+r.join("\n"),t.document)});t.ready(function(){domUtils.on(t.body,"cut",function(){setTimeout(function(){var n=t.selection.getRange(),r,i,u,f;n.collapsed||(r=domUtils.findParentByTagName(n.startContainer,"li",!0))&&!r.nextSibling&&domUtils.isEmptyBlock(r)&&(i=r.parentNode,(u=i.previousSibling)?(domUtils.remove(i),n.setStartAtLast(u).collapse(!0),n.select(!0)):(u=i.nextSibling)?(domUtils.remove(i),n.setStartAtFirst(u).collapse(!0),n.select(!0)):(f=t.document.createElement("p"),domUtils.fillNode(t.document,f),i.parentNode.insertBefore(f,i),domUtils.remove(i),n.setStart(f,0).collapse(!0),n.select(!0)))})})});t.addListener("beforepaste",function(n,t){var h=this,c=h.selection.getRange(),o,e=UE.htmlparser(t.html,!0),r,s;(o=domUtils.findParentByTagName(c.startContainer,"li",!0))&&(r=o.parentNode,s=r.tagName=="OL"?"ul":"ol",utils.each(e.getNodesByTagName(s),function(t){var s,o,h;t.tagName=r.tagName;t.setAttr();t.parentNode===e?n=u(r)||(r.tagName=="OL"?"decimal":"disc"):(s=t.parentNode.getAttr("class"),n=s&&/custom_/.test(s)?s.match(/custom_(\w+)/)[1]:t.parentNode.getStyle("list-style-type"),n||(n=r.tagName=="OL"?"decimal":"disc"));o=utils.indexOf(i[r.tagName],n);t.parentNode!==e&&(o=o+1==i[r.tagName].length?0:o+1);h=i[r.tagName][o];f[h]?t.setAttr("class","custom_"+h):t.setStyle("list-style-type",h)}));t.html=e.toHtml()});t.getOpt("disablePInList")===!0&&t.addOutputRule(function(n){utils.each(n.getNodesByTagName("li"),function(n){var t=[],i=0;utils.each(n.children,function(r){var u,f;if(r.tagName=="p"){while(u=r.children.pop())t.splice(i,0,u),u.parentNode=n,lastNode=u;u=t[t.length-1];u&&u.type=="element"&&u.tagName=="br"||(f=UE.uNode.createElement("br"),f.parentNode=n,t.push(f));i=t.length}});t.length&&(n.children=t)})});t.addInputRule(function(i){if(utils.each(i.getNodesByTagName("li"),function(t){for(var o,f,i=UE.uNode.createElement("p"),e=0,u;u=t.children[e];)u.type=="text"||r.p[u.tagName]?i.appendChild(u):i.firstChild()?(t.insertBefore(i,u),i=UE.uNode.createElement("p"),e=e+2):e++;(!i.firstChild()||i.parentNode)&&t.firstChild()||t.appendChild(i);i.firstChild()||i.innerHTML(n.ie?"&nbsp;":"<br/>");o=t.firstChild();f=o.lastChild();f&&f.type=="text"&&/^\s*$/.test(f.data)&&o.removeChild(f)}),t.options.autoTransWordToList){var u={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},e={square:"n"};function o(n,t){var r=t.firstChild(),i;if(r&&r.type=="element"&&r.tagName=="span"&&/Wingdings|Symbol/.test(r.getStyle("font-family"))){for(i in e)if(e[i]==r.data)return i;return"disc"}for(i in u)if(u[i].test(n))return i}utils.each(i.getNodesByTagName("p"),function(i){function l(t,i,r){var f,e;t.tagName=="ol"?n.ie?(f=i.firstChild(),f.type=="element"&&f.tagName=="span"&&u[r].test(f.innerText())&&i.removeChild(f)):i.innerHTML(i.innerHTML().replace(u[r],"")):i.removeChild(i.firstChild());e=UE.uNode.createElement("li");e.appendChild(i);t.appendChild(e)}var h,s,c,r,e;if(i.getAttr("class")=="MsoListParagraph"){if(i.setStyle("margin",""),i.setStyle("margin-left",""),i.setAttr("class",""),h=i,c=i,i.parentNode.tagName!="li"&&(s=o(i.innerText(),i))){for(r=UE.uNode.createElement(t.options.insertorderedlist.hasOwnProperty(s)?"ol":"ul"),f[s]?r.setAttr("class","custom_"+s):r.setStyle("list-style-type",s);i&&i.parentNode.tagName!="li"&&o(i.innerText(),i);)h=i.nextSibling(),h||i.parentNode.insertBefore(r,i),l(r,i,s),i=h;!r.parentNode&&i&&i.parentNode&&i.parentNode.insertBefore(r,i)}e=c.firstChild();e&&e.type=="element"&&e.tagName=="span"&&/^\s*(&nbsp;)+\s*$/.test(e.innerText())&&e.parentNode.removeChild(e)}})}});t.addListener("contentchange",function(){v(t.document)});t.addListener("keydown",function(n,i){function k(){i.preventDefault?i.preventDefault():i.returnValue=!1;t.fireEvent("contentchange");t.undoManger&&t.undoManger.save()}function tt(n,t){while(n&&!domUtils.isBody(n)){if(t(n))return null;if(n.nodeType==1&&/[ou]l/i.test(n.tagName))return n;n=n.parentNode}return null}var d=i.keyCode||i.which,nt,v,u,h,a,b,o,s,e,y;if(d==13&&!i.shiftKey){var g=t.selection.getRange(),p=domUtils.findParent(g.startContainer,function(n){return domUtils.isBlockElm(n)},!0),u=domUtils.findParentByTagName(g.startContainer,"li",!0);p&&p.tagName!="PRE"&&!u&&(nt=p.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),""),/^\s*1\s*\.[^\d]/.test(nt)&&(p.innerHTML=nt.replace(/^\s*1\s*\./,""),g.setStartAtLast(p).collapse(!0).select(),t.__hasEnterExecCommand=!0,t.execCommand("insertorderedlist"),t.__hasEnterExecCommand=!1));var f=t.selection.getRange(),l=tt(f.startContainer,function(n){return n.tagName=="TABLE"}),w=f.collapsed?l:tt(f.endContainer,function(n){return n.tagName=="TABLE"});if(l&&w&&l===w){if(!f.collapsed)if(l=domUtils.findParentByTagName(f.startContainer,"li",!0),w=domUtils.findParentByTagName(f.endContainer,"li",!0),l&&w&&l===w){if(f.deleteContents(),u=domUtils.findParentByTagName(f.startContainer,"li",!0),u&&domUtils.isEmptyBlock(u)){o=u.previousSibling;next=u.nextSibling;s=t.document.createElement("p");domUtils.fillNode(t.document,s);e=u.parentNode;o&&next?(f.setStart(next,0).collapse(!0).select(!0),domUtils.remove(u)):((o||next)&&o?u.parentNode.parentNode.insertBefore(s,e.nextSibling):e.parentNode.insertBefore(s,e),domUtils.remove(u),e.firstChild||domUtils.remove(e),f.setStart(s,0).setCursor());k();return}}else{v=f.cloneRange();y=v.collapse(!1).createBookmark();f.deleteContents();v.moveToBookmark(y);u=domUtils.findParentByTagName(v.startContainer,"li",!0);c(u);v.select();k();return}if(u=domUtils.findParentByTagName(f.startContainer,"li",!0),u){if(domUtils.isEmptyBlock(u)){if(y=f.createBookmark(),e=u.parentNode,u!==e.lastChild?(domUtils.breakParent(u,e),c(u)):(e.parentNode.insertBefore(u,e.nextSibling),domUtils.isEmptyNode(e)&&domUtils.remove(e)),!r.$list[u.parentNode.tagName])if(domUtils.isBlockElm(u.firstChild))domUtils.remove(u,!0);else{for(s=t.document.createElement("p"),u.parentNode.insertBefore(s,u);u.firstChild;)s.appendChild(u.firstChild);domUtils.remove(u)}f.moveToBookmark(y).select()}else{if(h=u.firstChild,!h||!domUtils.isBlockElm(h)){for(s=t.document.createElement("p"),u.firstChild||domUtils.fillNode(t.document,s);u.firstChild;)s.appendChild(u.firstChild);u.appendChild(s);h=s}a=t.document.createElement("span");f.insertNode(a);domUtils.breakParent(a,u);b=a.nextSibling;h=b.firstChild;h||(s=t.document.createElement("p"),domUtils.fillNode(t.document,s),b.appendChild(s),h=s);domUtils.isEmptyNode(h)&&(h.innerHTML="",domUtils.fillNode(t.document,h));f.setStart(h,0).collapse(!0).shrinkBoundary().select();domUtils.remove(a);o=b.previousSibling;o&&domUtils.isEmptyBlock(o)&&(o.innerHTML="<p><\/p>",domUtils.fillNode(t.document,o.firstChild))}k()}}}if(d==8&&(f=t.selection.getRange(),f.collapsed&&domUtils.isStartInblock(f)&&(v=f.cloneRange().trimBoundary(),u=domUtils.findParentByTagName(f.startContainer,"li",!0),u&&domUtils.isStartInblock(v)))){if(l=domUtils.findParentByTagName(f.startContainer,"p",!0),l&&l!==u.firstChild){e=domUtils.findParentByTagName(l,["ol","ul"]);domUtils.breakParent(l,e);c(l);t.fireEvent("contentchange");f.setStart(l,0).setCursor(!1,!0);t.fireEvent("saveScene");domUtils.preventDefault(i);return}if(u&&(o=u.previousSibling)){if(d==46&&u.childNodes.length)return;if(r.$list[o.tagName]&&(o=o.lastChild),t.undoManger&&t.undoManger.save(),h=u.firstChild,domUtils.isBlockElm(h))if(domUtils.isEmptyNode(h))for(o.appendChild(h),f.setStart(h,0).setCursor(!1,!0);u.firstChild;)o.appendChild(u.firstChild);else a=t.document.createElement("span"),f.insertNode(a),domUtils.isEmptyBlock(o)&&(o.innerHTML=""),domUtils.moveChild(u,o),f.setStartBefore(a).collapse(!0).select(!0),domUtils.remove(a);else if(domUtils.isEmptyNode(u))s=t.document.createElement("p"),o.appendChild(s),f.setStart(s,0).setCursor();else for(f.setEnd(o,o.childNodes.length).collapse().select(!0);u.firstChild;)o.appendChild(u.firstChild);domUtils.remove(u);t.fireEvent("contentchange");t.fireEvent("saveScene");domUtils.preventDefault(i);return}if(u&&!u.previousSibling){if(e=u.parentNode,y=f.createBookmark(),domUtils.isTagNode(e.parentNode,"ol ul"))e.parentNode.insertBefore(u,e),domUtils.isEmptyNode(e)&&domUtils.remove(e);else{while(u.firstChild)e.parentNode.insertBefore(u.firstChild,e);domUtils.remove(u);domUtils.isEmptyNode(e)&&domUtils.remove(e)}f.moveToBookmark(y).setCursor(!1,!0);t.fireEvent("contentchange");t.fireEvent("saveScene");domUtils.preventDefault(i);return}}});t.addListener("keyup",function(n,i){var o=i.keyCode||i.which,f,r;o==8&&(f=t.selection.getRange(),(r=domUtils.findParentByTagName(f.startContainer,["ol","ul"],!0))&&e(r,r.tagName.toLowerCase(),u(r)||domUtils.getComputedStyle(r,"list-style-type"),!0))});t.addListener("tabkeydown",function(){function p(n){if(t.options.maxListLevel!=-1){for(var i=n.parentNode,r=0;/[ou]l/i.test(i.tagName);)r++,i=i.parentNode;if(r>=t.options.maxListLevel)return!0}}var h=t.selection.getRange(),n=domUtils.findParentByTagName(h.startContainer,"li",!0),c,a,w,v,b,y,f;if(n)if(h.collapsed){if(p(n))return!0;var s=n.parentNode,r=t.document.createElement(s.tagName),l=utils.indexOf(i[r.tagName],u(s)||domUtils.getComputedStyle(s,"list-style-type"));if(l=l+1==i[r.tagName].length?0:l+1,a=i[r.tagName][l],o(r,a),domUtils.isStartInblock(h))return t.fireEvent("saveScene"),c=h.createBookmark(),s.insertBefore(r,n),r.appendChild(n),e(r,r.tagName.toLowerCase(),a),t.fireEvent("contentchange"),h.moveToBookmark(c).select(!0),!0}else{for(t.fireEvent("saveScene"),c=h.createBookmark(),w=0,b=domUtils.findParents(n);y=b[w++];)if(domUtils.isTagNode(y,"ol ul")){v=y;break}if(f=n,c.end)while(f&&!(domUtils.getPosition(f,c.end)&domUtils.POSITION_FOLLOWING)){if(p(f)){f=domUtils.getNextDomNode(f,!1,null,function(n){return n!==v});continue}var s=f.parentNode,r=t.document.createElement(s.tagName),l=utils.indexOf(i[r.tagName],u(s)||domUtils.getComputedStyle(s,"list-style-type")),k=l+1==i[r.tagName].length?0:l+1,a=i[r.tagName][k];for(o(r,a),s.insertBefore(r,f);f&&!(domUtils.getPosition(f,c.end)&domUtils.POSITION_FOLLOWING);){if(n=f.nextSibling,r.appendChild(f),!n||domUtils.isTagNode(n,"ol ul")){if(n){while(n=n.firstChild)if(n.tagName=="LI")break}else n=domUtils.getNextDomNode(f,!1,null,function(n){return n!==v});break}f=n}e(r,r.tagName.toLowerCase(),a);f=n}return t.fireEvent("contentchange"),h.moveToBookmark(c).select(),!0}});t.commands.insertorderedlist=t.commands.insertunorderedlist={execCommand:function(n,t){var rt,yt,st,nt,ut,ft,ct,tt,b,ht,d,wt;t||(t=n.toLowerCase()=="insertorderedlist"?"decimal":"disc");var h=this,a=this.selection.getRange(),it=function(n){return n.nodeType==1?n.tagName.toLowerCase()!="br":!domUtils.isWhitespace(n)},et=n.toLowerCase()=="insertorderedlist"?"ol":"ul",c=h.document.createDocumentFragment();a.adjustmentBoundary().shrinkBoundary();var g=a.createBookmark(!0),i=y(h.document.getElementById(g.start)),at=0,v=y(h.document.getElementById(g.end)),vt=0,p,k,w,f;if(i||v){if(i&&(p=i.parentNode),g.end||(v=i),v&&(k=v.parentNode),p===k){while(i!==v){if(f=i,i=i.nextSibling,!domUtils.isBlockElm(f.firstChild)){for(rt=h.document.createElement("p");f.firstChild;)rt.appendChild(f.firstChild);f.appendChild(rt)}c.appendChild(f)}if(f=h.document.createElement("span"),p.insertBefore(f,v),!domUtils.isBlockElm(v.firstChild)){for(rt=h.document.createElement("p");v.firstChild;)rt.appendChild(v.firstChild);v.appendChild(rt)}if(c.appendChild(v),domUtils.breakParent(f,p),domUtils.isEmptyNode(f.previousSibling)&&domUtils.remove(f.previousSibling),domUtils.isEmptyNode(f.nextSibling)&&domUtils.remove(f.nextSibling),yt=u(p)||domUtils.getComputedStyle(p,"list-style-type")||(n.toLowerCase()=="insertorderedlist"?"decimal":"disc"),p.tagName.toLowerCase()==et&&yt==t){for(ht=0,st=h.document.createDocumentFragment();d=c.firstChild;)if(domUtils.isTagNode(d,"ol ul"))st.appendChild(d);else while(d.firstChild)st.appendChild(d.firstChild),domUtils.remove(d);f.parentNode.insertBefore(st,f)}else w=h.document.createElement(et),o(w,t),w.appendChild(c),f.parentNode.insertBefore(w,f);domUtils.remove(f);w&&e(w,et,t);a.moveToBookmark(g).select();return}if(i){while(i){if(f=i.nextSibling,domUtils.isTagNode(i,"ol ul"))c.appendChild(i);else{for(nt=h.document.createDocumentFragment(),ut=0;i.firstChild;)domUtils.isBlockElm(i.firstChild)&&(ut=1),nt.appendChild(i.firstChild);ut?c.appendChild(nt):(ft=h.document.createElement("p"),ft.appendChild(nt),c.appendChild(ft));domUtils.remove(i)}i=f}p.parentNode.insertBefore(c,p.nextSibling);domUtils.isEmptyNode(p)?(a.setStartBefore(p),domUtils.remove(p)):a.setStartAfter(p);at=1}if(v&&domUtils.inDoc(k,h.document)){for(i=k.firstChild;i&&i!==v;){if(f=i.nextSibling,domUtils.isTagNode(i,"ol ul"))c.appendChild(i);else{for(nt=h.document.createDocumentFragment(),ut=0;i.firstChild;)domUtils.isBlockElm(i.firstChild)&&(ut=1),nt.appendChild(i.firstChild);ut?c.appendChild(nt):(ft=h.document.createElement("p"),ft.appendChild(nt),c.appendChild(ft));domUtils.remove(i)}i=f}ct=domUtils.createElement(h.document,"div",{tmpDiv:1});domUtils.moveChild(v,ct);c.appendChild(ct);domUtils.remove(v);k.parentNode.insertBefore(c,k);a.setEndBefore(k);domUtils.isEmptyNode(k)&&domUtils.remove(k);vt=1}}at||a.setStartBefore(h.document.getElementById(g.start));g.end&&!vt&&a.setEndAfter(h.document.getElementById(g.end));a.enlarge(!0,function(n){return l[n.tagName]});c=h.document.createDocumentFragment();for(var ot=a.createBookmark(),s=domUtils.getNextDomNode(ot.start,!1,it),lt=a.cloneRange(),b,pt=domUtils.isBlockElm;s&&s!==ot.end&&domUtils.getPosition(s,ot.end)&domUtils.POSITION_PRECEDING;)if(s.nodeType==3||r.li[s.tagName]){if(s.nodeType==1&&r.$list[s.tagName]){while(s.firstChild)c.appendChild(s.firstChild);b=domUtils.getNextDomNode(s,!1,it);domUtils.remove(s);s=b;continue}for(b=s,lt.setStartBefore(s);s&&s!==ot.end&&(!pt(s)||domUtils.isBookmarkNode(s));)b=s,s=domUtils.getNextDomNode(s,!1,null,function(n){return!l[n.tagName]});if(s&&pt(s)&&(f=domUtils.getNextDomNode(b,!1,it),f&&domUtils.isBookmarkNode(f)&&(s=domUtils.getNextDomNode(f,!1,it),b=f)),lt.setEndAfter(b),s=domUtils.getNextDomNode(b,!1,it),tt=a.document.createElement("li"),tt.appendChild(lt.extractContents()),domUtils.isEmptyNode(tt)){for(b=a.document.createElement("p");tt.firstChild;)b.appendChild(tt.firstChild);tt.appendChild(b)}c.appendChild(tt)}else s=domUtils.getNextDomNode(s,!0,it);for(a.moveToBookmark(ot).collapse(!0),w=h.document.createElement(et),o(w,t),w.appendChild(c),a.insertNode(w),e(w,et,t),ht=0,wt=domUtils.getElementsByTagName(w,"div");d=wt[ht++];)d.getAttribute("tmpDiv")&&domUtils.remove(d,!0);a.moveToBookmark(g).select()},queryCommandState:function(n){for(var i=n.toLowerCase()=="insertorderedlist"?"ol":"ul",r=this.selection.getStartElementPath(),u=0,t;t=r[u++];){if(t.nodeName=="TABLE")return 0;if(i==t.nodeName.toLowerCase())return 1}return 0},queryCommandValue:function(n){for(var r=n.toLowerCase()=="insertorderedlist"?"ol":"ul",f=this.selection.getStartElementPath(),t,e=0,i;i=f[e++];){if(i.nodeName=="TABLE"){t=null;break}if(r==i.nodeName.toLowerCase()){t=i;break}}return t?u(t)||domUtils.getComputedStyle(t,"list-style-type"):null}}},function(){var t={textarea:function(t,i){var r=i.ownerDocument.createElement("textarea");return r.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;",n.ie&&n.version<8&&(r.style.width=i.offsetWidth+"px",r.style.height=i.offsetHeight+"px",i.onresize=function(){r.style.width=i.offsetWidth+"px";r.style.height=i.offsetHeight+"px"}),i.appendChild(r),{setContent:function(n){r.value=n},getContent:function(){return r.value},select:function(){var t;n.ie?(t=r.createTextRange(),t.collapse(!0),t.select()):(r.setSelectionRange(0,0),r.focus())},dispose:function(){i.removeChild(r);i.onresize=null;r=null;i=null}}},codemirror:function(n,t){var i=window.CodeMirror(t,{mode:"text/html",tabMode:"indent",lineNumbers:!0,lineWrapping:!0}),r=i.getWrapperElement();return r.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;',i.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;",i.refresh(),{getCodeMirror:function(){return i},setContent:function(n){i.setValue(n)},getContent:function(){return i.getValue()},select:function(){i.focus()},dispose:function(){t.removeChild(r);r=null;i=null}}}};UE.plugins.source=function(){function a(n){return t[u.sourceEditor=="codemirror"&&window.CodeMirror?"codemirror":"textarea"](i,n)}var i=this,u=this.options,e=!1,f,s,h,c,o,l;u.sourceEditor=n.ie?"textarea":u.sourceEditor||"codemirror";i.setOpt({sourceEditorFirst:!1});i.commands.source={execCommand:function(){var u,y,l,v,t;if(e=!e,e)o=i.selection.getRange().createAddress(!1,!0),i.undoManger&&i.undoManger.save(!0),n.gecko&&(i.body.contentEditable=!1),h=i.iframe.style.cssText,i.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;",i.fireEvent("beforegetcontent"),u=UE.htmlparser(i.body.innerHTML),i.filterOutputRule(u),u.traversal(function(n){if(n.type=="element")switch(n.tagName){case"td":case"th":case"caption":n.children&&n.children.length==1&&n.firstChild().tagName=="br"&&n.removeChild(n.firstChild());break;case"pre":n.innerText(n.innerText().replace(/&nbsp;/g," "))}}),i.fireEvent("aftergetcontent"),y=u.toHtml(!0),f=a(i.iframe.parentNode),f.setContent(y),s=i.setContent,i.setContent=function(n){var t=UE.htmlparser(n);i.filterInputRule(t);n=t.toHtml();f.setContent(n)},setTimeout(function(){f.select();i.addListener("fullscreenchanged",function(){try{f.getCodeMirror().refresh()}catch(n){}})}),c=i.getContent,i.getContent=function(){return f.getContent()||"<p>"+(n.ie?"":"<br/>")+"<\/p>"};else if(i.iframe.style.cssText=h,l=f.getContent()||"<p>"+(n.ie?"":"<br/>")+"<\/p>",l=l.replace(new RegExp("[\\r\\t\\n ]*<\/?(\\w+)\\s*(?:[^>]*)>","g"),function(n,t){return t&&!r.$inlineWithA[t.toLowerCase()]?n.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):n.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),i.setContent=s,i.setContent(l),f.dispose(),f=null,i.getContent=c,v=i.body.firstChild,v||(i.body.innerHTML="<p>"+(n.ie?"":"<br/>")+"<\/p>",v=i.body.firstChild),i.undoManger&&i.undoManger.save(!0),n.gecko)t=document.createElement("input"),t.style.cssText="position:absolute;left:0;top:-32768px",document.body.appendChild(t),i.body.contentEditable=!1,setTimeout(function(){domUtils.setViewportOffset(t,{left:-32768,top:0});t.focus();setTimeout(function(){i.body.contentEditable=!0;i.selection.getRange().moveToAddress(o).select(!0);domUtils.remove(t)})});else try{i.selection.getRange().moveToAddress(o).select(!0)}catch(p){}this.fireEvent("sourcemodechanged",e)},queryCommandState:function(){return e|0},notNeedUndo:1};l=i.queryCommandState;i.queryCommandState=function(n){return(n=n.toLowerCase(),e)?n in{source:1,fullscreen:1}?1:-1:l.apply(this,arguments)};u.sourceEditor=="codemirror"&&i.addListener("ready",function(){utils.loadFile(document,{src:u.codeMirrorJsUrl||u.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){u.sourceEditorFirst&&setTimeout(function(){i.execCommand("source")},0)});utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:u.codeMirrorCssUrl||u.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}();UE.plugins.enterkey=function(){var i,t=this,u=t.options.enterTag;t.addListener("keyup",function(r,u){var a=u.keyCode||u.which,e,s,h,l,o,f,c;if(a==13)if(e=t.selection.getRange(),s=e.startContainer,n.ie)t.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(i)){if(n.gecko)l=domUtils.findParentByTagName(s,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0),l||(t.document.execCommand("formatBlock",!1,"<p>"),h=1);else if(s.nodeType==1){if(o=t.document.createTextNode(""),e.insertNode(o),f=domUtils.findParentByTagName(o,"div",!0),f){for(c=t.document.createElement("p");f.firstChild;)c.appendChild(f.firstChild);f.parentNode.insertBefore(c,f);domUtils.remove(f);e.setStartBefore(o).setCursor();h=1}domUtils.remove(o)}t.undoManger&&h&&t.undoManger.save()}n.opera&&e.select()}});t.addListener("keydown",function(f,e){var v=e.keyCode||e.which,o,h,a;if(v==13){if(t.fireEvent("beforeenterkeydown")){domUtils.preventDefault(e);return}if(t.fireEvent("saveScene",!0,!0),i="",o=t.selection.getRange(),!o.collapsed){var s=o.startContainer,y=o.endContainer,c=domUtils.findParentByTagName(s,"td",!0),l=domUtils.findParentByTagName(y,"td",!0);if(c&&l&&c!==l||!c&&l||c&&!l){e.preventDefault?e.preventDefault():e.returnValue=!1;return}}if(u=="p")n.ie||(s=domUtils.findParentByTagName(o.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),s||n.opera?(i=s.tagName,s.tagName.toLowerCase()=="p"&&n.gecko&&domUtils.removeDirtyAttr(s)):(t.document.execCommand("formatBlock",!1,"<p>"),n.gecko&&(o=t.selection.getRange(),s=domUtils.findParentByTagName(o.startContainer,"p",!0),s&&domUtils.removeDirtyAttr(s))));else if(e.preventDefault?e.preventDefault():e.returnValue=!1,o.collapsed)h=o.document.createElement("br"),o.insertNode(h),a=h.parentNode,a.lastChild===h?(h.parentNode.insertBefore(h.cloneNode(!0),h),o.setStartBefore(h)):o.setStartAfter(h),o.setCursor();else if(o.deleteContents(),s=o.startContainer,s.nodeType==1&&(s=s.childNodes[o.startOffset])){while(s.nodeType==1){if(r.$empty[s.tagName])return o.setStartBefore(s).setCursor(),t.undoManger&&t.undoManger.save(),!1;if(!s.firstChild)return h=o.document.createElement("br"),s.appendChild(h),o.setStart(s,0).setCursor(),t.undoManger&&t.undoManger.save(),!1;s=s.firstChild}s===o.startContainer.childNodes[o.startOffset]?(h=o.document.createElement("br"),o.insertNode(h).setCursor()):o.setStart(s,0).setCursor()}else h=o.document.createElement("br"),o.insertNode(h).setStartAfter(h).setCursor()}})};UE.plugins.keystrokes=function(){var t=this,i=!0;t.addListener("keydown",function(r,u){var h=u.keyCode||u.which,f=t.selection.getRange(),o,e,l,b,s,y,p,g,w,a,v;if(!f.collapsed&&!(u.ctrlKey||u.shiftKey||u.altKey||u.metaKey)&&(h>=65&&h<=90||h>=48&&h<=57||h>=96&&h<=111||{13:1,8:1,46:1}[h])&&(o=f.startContainer,domUtils.isFillChar(o)&&f.setStartBefore(o),o=f.endContainer,domUtils.isFillChar(o)&&f.setEndAfter(o),f.txtToElmBoundary(),f.endContainer&&f.endContainer.nodeType==1&&(o=f.endContainer.childNodes[f.endOffset],o&&domUtils.isBr(o)&&f.setEndAfter(o)),f.startOffset==0&&(o=f.startContainer,domUtils.isBoundaryNode(o,"firstChild")&&(o=f.endContainer,f.endOffset==(o.nodeType==3?o.nodeValue.length:o.childNodes.length)&&domUtils.isBoundaryNode(o,"lastChild"))))){t.fireEvent("saveScene");t.body.innerHTML="<p>"+(n.ie?"":"<br/>")+"<\/p>";f.setStart(t.body.firstChild,0).setCursor(!1,!0);t._selectionChange();return}if(h==c.Backspace){if(f=t.selection.getRange(),i=f.collapsed,t.fireEvent("delkeydown",u))return;if(f.collapsed&&f.inFillChar()&&(e=f.startContainer,domUtils.isFillChar(e)?(f.setStartBefore(e).shrinkBoundary(!0).collapse(!0),domUtils.remove(e)):(e.nodeValue=e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),f.startOffset--,f.collapse(!0).select(!0))),e=f.getClosedNode()){t.fireEvent("saveScene");f.setStartBefore(e);domUtils.remove(e);f.setCursor();t.fireEvent("saveScene");domUtils.preventDefault(u);return}if(!n.ie&&(e=domUtils.findParentByTagName(f.startContainer,"table",!0),l=domUtils.findParentByTagName(f.endContainer,"table",!0),e&&!l||!e&&l||e!==l)){u.preventDefault();return}}if(h==c.Tab){if(b={ol:1,ul:1,table:1},t.fireEvent("tabkeydown",u)){domUtils.preventDefault(u);return}s=t.selection.getRange();t.fireEvent("saveScene");for(var k=0,d="",nt=t.options.tabSize||4,tt=t.options.tabNode||"&nbsp;";k<nt;k++)d+=tt;if(y=t.document.createElement("span"),y.innerHTML=d+domUtils.fillChar,s.collapsed)s.insertNode(y.cloneNode(!0).firstChild).setCursor(!0);else if(p=function(n){return domUtils.isBlockElm(n)&&!b[n.tagName.toLowerCase()]},e=domUtils.findParent(s.startContainer,p,!0),l=domUtils.findParent(s.endContainer,p,!0),e&&l&&e===l)s.deleteContents(),s.insertNode(y.cloneNode(!0).firstChild).setCursor(!0);else{for(g=s.createBookmark(),s.enlarge(!0),w=s.createBookmark(),a=domUtils.getNextDomNode(w.start,!1,p);a&&!(domUtils.getPosition(a,w.end)&domUtils.POSITION_FOLLOWING);)a.insertBefore(y.cloneNode(!0).firstChild,a.firstChild),a=domUtils.getNextDomNode(a,!1,p);s.moveToBookmark(w).moveToBookmark(g).select()}domUtils.preventDefault(u)}if(n.gecko&&h==46&&(s=t.selection.getRange(),s.collapsed&&(e=s.startContainer,domUtils.isEmptyBlock(e)))){for(v=e.parentNode;domUtils.getChildCount(v)==1&&!domUtils.isBody(v);)e=v,v=v.parentNode;e===v.lastChild&&u.preventDefault();return}});t.addListener("keyup",function(t,r){var a=r.keyCode||r.which,u,h=this,l,e,o,f,s;if(a==c.Backspace){if(h.fireEvent("delkeyup"))return;if(u=h.selection.getRange(),u.collapsed){if(l=["h1","h2","h3","h4","h5","h6"],(f=domUtils.findParentByTagName(u.startContainer,l,!0))&&domUtils.isEmptyBlock(f)){if(e=f.previousSibling,e&&e.nodeName!="TABLE"){domUtils.remove(f);u.setStartAtLast(e).setCursor(!1,!0);return}if(o=f.nextSibling,o&&o.nodeName!="TABLE"){domUtils.remove(f);u.setStartAtFirst(o).setCursor(!1,!0);return}}domUtils.isBody(u.startContainer)&&(f=domUtils.createElement(h.document,"p",{innerHTML:n.ie?domUtils.fillChar:"<br/>"}),u.insertNode(f).setStart(f,0).setCursor(!1,!0))}!i&&(u.startContainer.nodeType==3||u.startContainer.nodeType==1&&domUtils.isEmptyBlock(u.startContainer))&&(n.ie?(s=u.document.createElement("span"),u.insertNode(s).setStartBefore(s).collapse(!0),u.select(),domUtils.remove(s)):u.select())}})};UE.plugins.fiximgclick=function(){function r(){this.editor=null;this.resizer=null;this.cover=null;this.doc=document;this.prePos={x:0,y:0};this.startPos={x:0,y:0}}var t=!1;return function(){var n=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];r.prototype={init:function(n){var t=this;t.editor=n;t.startPos=this.prePos={x:0,y:0};t.dragId=-1;var f=[],u=t.cover=document.createElement("div"),r=t.resizer=document.createElement("div");u.id=t.editor.ui.id+"_imagescale_cover";u.style.cssText="position:absolute;display:none;z-index:"+t.editor.options.zIndex+";filter:alpha(opacity=0); opacity:0;background:#CCC;";domUtils.on(u,"mousedown click",function(){t.hide()});for(i=0;i<8;i++)f.push('<span class="edui-editor-imagescale-hand'+i+'"><\/span>');r.id=t.editor.ui.id+"_imagescale";r.className="edui-editor-imagescale";r.innerHTML=f.join("");r.style.cssText+=";display:none;border:1px solid #3b77ff;z-index:"+t.editor.options.zIndex+";";t.editor.ui.getDom().appendChild(u);t.editor.ui.getDom().appendChild(r);t.initStyle();t.initEvents()},initStyle:function(){utils.cssRule("imagescale",".edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}.edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},initEvents:function(){var n=this;n.startPos.x=n.startPos.y=0;n.isDraging=!1},_eventHandler:function(n){var i=this,r;switch(n.type){case"mousedown":if(r=n.target||n.srcElement,r.className.indexOf("edui-editor-imagescale-hand")!=-1&&i.dragId==-1){i.dragId=r.className.slice(-1);i.startPos.x=i.prePos.x=n.clientX;i.startPos.y=i.prePos.y=n.clientY;domUtils.on(i.doc,"mousemove",i.proxy(i._eventHandler,i))}break;case"mousemove":i.dragId!=-1&&(i.updateContainerStyle(i.dragId,{x:n.clientX-i.prePos.x,y:n.clientY-i.prePos.y}),i.prePos.x=n.clientX,i.prePos.y=n.clientY,t=!0,i.updateTargetElement());break;case"mouseup":i.dragId!=-1&&(i.updateContainerStyle(i.dragId,{x:n.clientX-i.prePos.x,y:n.clientY-i.prePos.y}),i.updateTargetElement(),i.target.parentNode&&i.attachTo(i.target),i.dragId=-1);domUtils.un(i.doc,"mousemove",i.proxy(i._eventHandler,i));t&&(t=!1,i.editor.fireEvent("contentchange"))}},updateTargetElement:function(){var n=this;domUtils.setStyles(n.target,{width:n.resizer.style.width,height:n.resizer.style.height});n.target.width=parseInt(n.resizer.style.width);n.target.height=parseInt(n.resizer.style.height);n.attachTo(n.target)},updateContainerStyle:function(t,i){var f=this,r=f.resizer,u;n[t][0]!=0&&(u=parseInt(r.style.left)+i.x,r.style.left=f._validScaledProp("left",u)+"px");n[t][1]!=0&&(u=parseInt(r.style.top)+i.y,r.style.top=f._validScaledProp("top",u)+"px");n[t][2]!=0&&(u=r.clientWidth+n[t][2]*i.x,r.style.width=f._validScaledProp("width",u)+"px");n[t][3]!=0&&(u=r.clientHeight+n[t][3]*i.y,r.style.height=f._validScaledProp("height",u)+"px")},_validScaledProp:function(n,t){var i=this.resizer,r=document;t=isNaN(t)?0:t;switch(n){case"left":return t<0?0:t+i.clientWidth>r.clientWidth?r.clientWidth-i.clientWidth:t;case"top":return t<0?0:t+i.clientHeight>r.clientHeight?r.clientHeight-i.clientHeight:t;case"width":return t<=0?1:t+i.offsetLeft>r.clientWidth?r.clientWidth-i.offsetLeft:t;case"height":return t<=0?1:t+i.offsetTop>r.clientHeight?r.clientHeight-i.offsetTop:t}},hideCover:function(){this.cover.style.display="none"},showCover:function(){var n=this,t=domUtils.getXY(n.editor.ui.getDom()),i=domUtils.getXY(n.editor.iframe);domUtils.setStyles(n.cover,{width:n.editor.iframe.offsetWidth+"px",height:n.editor.iframe.offsetHeight+"px",top:i.y-t.y+"px",left:i.x-t.x+"px",position:"absolute",display:""})},show:function(n){var t=this;t.resizer.style.display="block";n&&t.attachTo(n);domUtils.on(this.resizer,"mousedown",t.proxy(t._eventHandler,t));domUtils.on(t.doc,"mouseup",t.proxy(t._eventHandler,t));t.showCover();t.editor.fireEvent("afterscaleshow",t);t.editor.fireEvent("saveScene")},hide:function(){var n=this;n.hideCover();n.resizer.style.display="none";domUtils.un(n.resizer,"mousedown",n.proxy(n._eventHandler,n));domUtils.un(n.doc,"mouseup",n.proxy(n._eventHandler,n));n.editor.fireEvent("afterscalehide",n)},proxy:function(n,t){return function(){return n.apply(t||this,arguments)}},attachTo:function(n){var t=this,r=t.target=n,i=this.resizer,u=domUtils.getXY(r),f=domUtils.getXY(t.editor.iframe),e=domUtils.getXY(i.parentNode);domUtils.setStyles(i,{width:r.width+"px",height:r.height+"px",left:f.x+u.x-t.editor.document.body.scrollLeft-e.x-parseInt(i.style.borderLeftWidth)+"px",top:f.y+u.y-t.editor.document.body.scrollTop-e.y-parseInt(i.style.borderTopWidth)+"px"})}}}(),function(){var t=this,i;t.setOpt("imageScaleEnabled",!0);!n.ie&&t.options.imageScaleEnabled&&t.addListener("click",function(){var o=t.selection.getRange(),n=o.getClosedNode(),u,f,e;if(n&&n.tagName=="IMG"&&t.body.contentEditable!="false"){if(n.className.indexOf("edui-faked-music")!=-1||n.getAttribute("anchorname")||domUtils.hasClass(n,"loadingclass")||domUtils.hasClass(n,"loaderrorclass"))return;if(!i){i=new r;i.init(t);t.ui.getDom().appendChild(i.resizer);u=function(){i.hide();i.target&&t.selection.getRange().selectNode(i.target).select()};f=function(n){var t=n.target||n.srcElement;t&&(t.className===undefined||t.className.indexOf("edui-editor-imagescale")==-1)&&u(n)};t.addListener("afterscaleshow",function(){t.addListener("beforekeydown",u);t.addListener("beforemousedown",f);domUtils.on(document,"keydown",u);domUtils.on(document,"mousedown",f);t.selection.getNative().removeAllRanges()});t.addListener("afterscalehide",function(){t.removeListener("beforekeydown",u);t.removeListener("beforemousedown",f);domUtils.un(document,"keydown",u);domUtils.un(document,"mousedown",f);var n=i.target;n.parentNode&&t.selection.getRange().selectNode(n).select()});domUtils.on(i.resizer,"mousedown",function(n){t.selection.getNative().removeAllRanges();var r=n.target||n.srcElement;r&&r.className.indexOf("edui-editor-imagescale-hand")==-1&&(e=setTimeout(function(){i.hide();i.target&&t.selection.getRange().selectNode(r).select()},200))});domUtils.on(i.resizer,"mouseup",function(n){var t=n.target||n.srcElement;t&&t.className.indexOf("edui-editor-imagescale-hand")==-1&&clearTimeout(e)})}i.show(n)}else i&&i.resizer.style.display!="none"&&i.hide()});n.webkit&&t.addListener("click",function(n,i){if(i.target.tagName=="IMG"&&t.body.contentEditable!="false"){var r=new u.Range(t.document);r.selectNode(i.target).select()}})}}();UE.plugin.register("autolink",function(){var t=0;return n.ie?{}:{bindEvents:{reset:function(){t=0},keydown:function(n,t){var f=this,l=t.keyCode||t.which,r,u,c,e;if(l==32||l==13){for(var o=f.selection.getNative(),i=o.getRangeAt(0).cloneRange(),s,h,r=i.startContainer;r.nodeType==1&&i.startOffset>0;){if(r=i.startContainer.childNodes[i.startOffset-1],!r)break;i.setStart(r,r.nodeType==1?r.childNodes.length:r.nodeValue.length);i.collapse(!0);r=i.startContainer}do{if(i.startOffset==0){for(r=i.startContainer.previousSibling;r&&r.nodeType==1;)r=r.lastChild;if(!r||domUtils.isFillChar(r))break;s=r.nodeValue.length}else r=i.startContainer,s=i.startOffset;i.setStart(r,s-1);h=i.toString().charCodeAt(0)}while(h!=160&&h!=32);if(i.toString().replace(new RegExp(domUtils.fillChar,"g"),"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){while(i.toString().length){if(/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(i.toString()))break;try{i.setStart(i.startContainer,i.startOffset+1)}catch(a){for(r=i.startContainer;!(next=r.nextSibling);){if(domUtils.isBody(r))return;r=r.parentNode}i.setStart(next,0)}}if(domUtils.findParentByTagName(i.startContainer,"a",!0))return;u=f.document.createElement("a");c=f.document.createTextNode(" ");f.undoManger&&f.undoManger.save();u.appendChild(i.extractContents());u.href=u.innerHTML=u.innerHTML.replace(/<[^>]+>/g,"");e=u.getAttribute("href").replace(new RegExp(domUtils.fillChar,"g"),"");e=/^(?:https?:\/\/)/ig.test(e)?e:"http://"+e;u.setAttribute("_src",utils.html(e));u.href=utils.html(e);i.insertNode(u);u.parentNode.insertBefore(c,u.nextSibling);i.setStart(c,0);i.collapse(!0);o.removeAllRanges();o.addRange(i);f.undoManger&&f.undoManger.save()}}}}}},function(){function i(n){if(n.nodeType==3)return null;if(n.nodeName=="A")return n;for(var t=n.lastChild;t;){if(t.nodeName=="A")return t;if(t.nodeType==3){if(domUtils.isWhitespace(t)){t=t.previousSibling;continue}return null}t=t.lastChild}}var t={37:1,38:1,39:1,40:1,13:1,32:1};n.ie&&this.addListener("keyup",function(n,r){var h=this,o=r.keyCode,e,u,f,s;if(t[o])if(e=h.selection.getRange(),u=e.startContainer,o==13){while(u&&!domUtils.isBody(u)&&!domUtils.isBlockElm(u))u=u.parentNode;u&&!domUtils.isBody(u)&&u.nodeName=="P"&&(f=u.previousSibling,f&&f.nodeType==1&&(f=i(f),f&&!f.getAttribute("_href")&&domUtils.remove(f,!0)))}else o==32?u.nodeType==3&&/^\s$/.test(u.nodeValue)&&(u=u.previousSibling,u&&u.nodeName=="A"&&!u.getAttribute("_href")&&domUtils.remove(u,!0)):(u=domUtils.findParentByTagName(u,"a",!0),u&&!u.getAttribute("_href")&&(s=e.createBookmark(),domUtils.remove(u,!0),e.moveToBookmark(s).select(!0)))})});UE.plugins.autoheight=function(){function i(){var n=this;(clearTimeout(o),s)||(!n.queryCommandState||n.queryCommandState&&n.queryCommandState("source")!=1)&&(o=setTimeout(function(){for(var t=n.body.lastChild;t&&t.nodeType!=1;)t=t.previousSibling;t&&t.nodeType==1&&(t.style.clear="both",r=Math.max(domUtils.getXY(t).y+t.offsetHeight+25,Math.max(f.minFrameHeight,f.initialFrameHeight)),r!=u&&(r!==parseInt(n.iframe.parentNode.style.height)&&(n.iframe.parentNode.style.height=r+"px"),n.body.style.height=r+"px",u=r),domUtils.removeStyle(t,"clear"))},50))}var t=this,e,u,f,r,o,s;if(t.autoHeightEnabled=t.options.autoHeightEnabled!==!1,t.autoHeightEnabled){u=0;f=t.options;t.addListener("fullscreenchanged",function(n,t){s=t});t.addListener("destroy",function(){t.removeListener("contentchange afterinserthtml keyup mouseup",i)});t.enableAutoHeight=function(){var t=this,r;t.autoHeightEnabled&&(r=t.document,t.autoHeightEnabled=!0,e=r.body.style.overflowY,r.body.style.overflowY="hidden",t.addListener("contentchange afterinserthtml keyup mouseup",i),setTimeout(function(){i.call(t)},n.gecko?100:0),t.fireEvent("autoheightchanged",t.autoHeightEnabled))};t.disableAutoHeight=function(){t.body.style.overflowY=e||"";t.removeListener("contentchange",i);t.removeListener("keyup",i);t.removeListener("mouseup",i);t.autoHeightEnabled=!1;t.fireEvent("autoheightchanged",t.autoHeightEnabled)};t.on("setHeight",function(){t.disableAutoHeight()});t.addListener("ready",function(){var u,r;t.enableAutoHeight();domUtils.on(n.ie?t.body:t.document,n.webkit?"dragover":"drop",function(){clearTimeout(u);u=setTimeout(function(){i.call(t)},100)});window.onscroll=function(){r===null?r=this.scrollY:this.scrollY==0&&r!=0&&(t.window.scrollTo(0,0),r=null)}})}};UE.plugins.autofloat=function(){function b(){return UE.ui?1:(alert(y.autofloatMsg),0)}function k(){var n=document.body.style;n.backgroundImage='url("about:blank")';n.backgroundAttachment="fixed"}function d(){var o=domUtils.getXY(t),u=domUtils.getComputedStyle(t,"position"),s=domUtils.getComputedStyle(t,"left");t.style.width=t.offsetWidth+"px";t.style.zIndex=i.options.zIndex*1+1;t.parentNode.insertBefore(r,t);c||w&&n.ie?(t.style.position!="absolute"&&(t.style.position="absolute"),t.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-a+e+"px"):(n.ie7Compat&&f&&(f=!1,t.style.left=domUtils.getXY(t).x-document.documentElement.getBoundingClientRect().left+2+"px"),t.style.position!="fixed"&&(t.style.position="fixed",t.style.top=e+"px",(u=="absolute"||u=="relative")&&parseFloat(s)&&(t.style.left=o.x+"px")))}function v(){f=!0;r.parentNode&&r.parentNode.removeChild(r);t.style.cssText=l}function u(){var n=o(i.container),r=i.options.toolbarTopOffset||0;n.top<0&&n.bottom-t.offsetHeight>r?d():v()}var i=this,y=i.getLang(),h,e,l,r,t,a,o,f,s;if(i.setOpt({topOffset:0}),h=i.options.autoFloatEnabled!==!1,e=i.options.topOffset,h){var p=UE.ui.uiUtils,c=n.ie&&n.version<=6,w=n.quirks;r=document.createElement("div");f=!0;s=utils.defer(function(){u()},n.ie?200:100,!0);i.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],u);i.removeListener("keydown",s)});i.addListener("ready",function(){if(b(i)){if(!i.ui)return;o=p.getClientRect;t=i.ui.getDom("toolbarbox");a=o(t).top;l=t.style.cssText;r.style.height=t.offsetHeight+"px";c&&k();domUtils.on(window,["scroll","resize"],u);i.addListener("keydown",s);i.addListener("beforefullscreenchange",function(n,t){t&&v()});i.addListener("fullscreenchanged",function(n,t){t||u()});i.addListener("sourcemodechanged",function(){setTimeout(function(){u()},0)});i.addListener("clearDoc",function(){setTimeout(function(){u()},0)})}})}};UE.plugins.video=function(){function t(t,i,r,u,f,e,o){var s,h;switch(o){case"image":s="<img "+(u?'id="'+u+'"':"")+' width="'+i+'" height="'+r+'" _url="'+t+'" class="'+e.replace(/\bvideo-js\b/,"")+'" src="'+n.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+n.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(f?"float:"+f+";":"")+'" />';break;case"embed":s='<embed type="application/x-shockwave-flash" class="'+e+'" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+utils.html(t)+'" width="'+i+'" height="'+r+'"'+(f?' style="float:'+f+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';break;case"video":h=t.substr(t.lastIndexOf(".")+1);h=="ogv"&&(h="ogg");s="<video"+(u?' id="'+u+'"':"")+' class="'+e+' video-js" '+(f?' style="float:'+f+'"':"")+' controls preload="none" width="'+i+'" height="'+r+'" src="'+t+'" data-setup="{}"><source src="'+t+'" type="video/'+h+'" /><\/video>'}return s}function i(n,i){utils.each(n.getNodesByTagName(i?"img":"embed video"),function(n){var r=n.getAttr("class"),u;r&&r.indexOf("edui-faked-video")!=-1&&(u=t(i?n.getAttr("_url"):n.getAttr("src"),n.getAttr("width"),n.getAttr("height"),null,n.getStyle("float")||"",r,i?"embed":"image"),n.parentNode.replaceChild(UE.uNode.createElement(u),n));r&&r.indexOf("edui-upload-video")!=-1&&(u=t(i?n.getAttr("_url"):n.getAttr("src"),n.getAttr("width"),n.getAttr("height"),null,n.getStyle("float")||"",r,i?"video":"image"),n.parentNode.replaceChild(UE.uNode.createElement(u),n))})}var n=this;n.addOutputRule(function(n){i(n,!0)});n.addInputRule(function(n){i(n)});n.commands.insertvideo={execCommand:function(i,r,u){var s,c,l,e,a,f,o,h;for(r=utils.isArray(r)?r:[r],s=[],c="tmpVedio",f=0,o=r.length;f<o;f++)e=r[f],l=u=="upload"?"edui-upload-video video-js vjs-default-skin":"edui-faked-video",s.push(t(e.url,e.width||420,e.height||280,c+f,null,l,"image"));for(n.execCommand("inserthtml",s.join(""),!0),a=this.selection.getRange(),f=0,o=r.length;f<o;f++)h=this.document.getElementById("tmpVedio"+f),domUtils.removeAttributes(h,"id"),a.selectNode(h).select(),n.execCommand("imagefloat",r[f].align)},queryCommandState:function(){var t=n.selection.getRange().getClosedNode(),i=t&&(t.className=="edui-faked-video"||t.className.indexOf("edui-upload-video")!=-1);return i?1:0}}},function(){function i(){}var t=UE.UETable=function(n){this.table=n;this.indexTable=[];this.selectedTds=[];this.cellsRange={};this.update(n)};t.removeSelectedClass=function(n){utils.each(n,function(n){domUtils.removeClasses(n,"selectTdClass")})};t.addSelectedClass=function(n){utils.each(n,function(n){domUtils.addClass(n,"selectTdClass")})};t.isEmptyBlock=function(t){var u=new RegExp(domUtils.fillChar,"g"),i;if(t[n.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(u,"").length>0)return 0;for(i in r.$isNotEmpty)if(r.$isNotEmpty.hasOwnProperty(i)&&t.getElementsByTagName(i).length)return 0;return 1};t.getWidth=function(n){return n?parseInt(domUtils.getComputedStyle(n,"width"),10):0};t.getTableCellAlignState=function(n){utils.isArray(n)||(n=[n]);var t={},u=["align","valign"],i=null,r=!0;return utils.each(n,function(n){return utils.each(u,function(u){if(i=n.getAttribute(u),!t[u]&&i)t[u]=i;else if(!t[u]||i!==t[u])return r=!1,!1}),r}),r?t:null};t.getTableItemsByRange=function(n){var t=n.selection.getStart();t&&t.id&&t.id.indexOf("_baidu_bookmark_start_")===0&&t.nextSibling&&(t=t.nextSibling);var i=t&&domUtils.findParentByTagName(t,["td","th"],!0),r=i&&i.parentNode,u=t&&domUtils.findParentByTagName(t,"caption",!0),f=u?u.parentNode:r&&r.parentNode.parentNode;return{cell:i,tr:r,table:f,caption:u}};t.getUETableBySelected=function(n){var i=t.getTableItemsByRange(n).table;return i&&i.ueTable&&i.ueTable.selectedTds.length?i.ueTable:null};t.getDefaultValue=function(n,t){var r={thin:"0px",medium:"1px",thick:"2px"},f,e,o,i,u;return t?(u=t.getElementsByTagName("td")[0],i=domUtils.getComputedStyle(t,"border-left-width"),f=parseInt(r[i]||i,10),i=domUtils.getComputedStyle(u,"padding-left"),e=parseInt(r[i]||i,10),i=domUtils.getComputedStyle(u,"border-left-width"),o=parseInt(r[i]||i,10),{tableBorder:f,tdPadding:e,tdBorder:o}):(t=n.document.createElement("table"),t.insertRow(0).insertCell(0).innerHTML="xxx",n.body.appendChild(t),u=t.getElementsByTagName("td")[0],i=domUtils.getComputedStyle(t,"border-left-width"),f=parseInt(r[i]||i,10),i=domUtils.getComputedStyle(u,"padding-left"),e=parseInt(r[i]||i,10),i=domUtils.getComputedStyle(u,"border-left-width"),o=parseInt(r[i]||i,10),domUtils.remove(t),{tableBorder:f,tdPadding:e,tdBorder:o})};t.getUETable=function(n){var i=n.tagName.toLowerCase();return n=i=="td"||i=="th"||i=="caption"?domUtils.findParentByTagName(n,"table",!0):n,n.ueTable||(n.ueTable=new t(n)),n.ueTable};t.cloneCell=function(n,t,i){var u,r;return!n||utils.isString(n)?this.table.ownerDocument.createElement(n||"td"):(u=domUtils.hasClass(n,"selectTdClass"),u&&domUtils.removeClasses(n,"selectTdClass"),r=n.cloneNode(!0),t&&(r.rowSpan=r.colSpan=1),i||domUtils.removeAttributes(r,"width height"),i||domUtils.removeAttributes(r,"style"),r.style.borderLeftStyle="",r.style.borderTopStyle="",r.style.borderLeftColor=n.style.borderRightColor,r.style.borderLeftWidth=n.style.borderRightWidth,r.style.borderTopColor=n.style.borderBottomColor,r.style.borderTopWidth=n.style.borderBottomWidth,u&&domUtils.addClass(n,"selectTdClass"),r)};t.prototype={getMaxRows:function(){for(var n,u,f,e=this.table.rows,t=1,i=0,r;r=e[i];i++){for(n=1,u=0;f=r.cells[u++];)n=Math.max(f.rowSpan||1,n);t=Math.max(n+i,t)}return t},getMaxCols:function(){for(var u,o,t,i,s=this.table.rows,f=0,r={},n=0,e;e=s[n];n++){for(u=0,o=0;t=e.cells[o++];)if(u+=t.colSpan||1,t.rowSpan&&t.rowSpan>1)for(i=1;i<t.rowSpan;i++)r["row_"+(n+i)]?r["row_"+(n+i)]++:r["row_"+(n+i)]=t.colSpan||1;u+=r["row_"+n]||0;f=Math.max(u,f)}return f},getCellColIndex:function(){},getHSideCell:function(n,t){try{var r=this.getCellInfo(n),e,o,u=this.selectedTds.length,f=this.cellsRange;return!t&&(u?!f.beginColIndex:!r.colIndex)||t&&(u?f.endColIndex==this.colsNum-1:r.colIndex==this.colsNum-1)?null:(e=u?f.beginRowIndex:r.rowIndex,o=t?u?f.endColIndex+1:r.colIndex+1:u?f.beginColIndex-1:r.colIndex<1?0:r.colIndex-1,this.getCell(this.indexTable[e][o].rowIndex,this.indexTable[e][o].cellIndex))}catch(s){i(s)}},getTabNextCell:function(n,t){var u=this.getCellInfo(n),i=t||u.rowIndex,r=u.colIndex+1+(u.colSpan-1),f;try{f=this.getCell(this.indexTable[i][r].rowIndex,this.indexTable[i][r].cellIndex)}catch(e){try{i=i*1+1;r=0;f=this.getCell(this.indexTable[i][r].rowIndex,this.indexTable[i][r].cellIndex)}catch(e){}}return f},getVSideCell:function(n,t,r){try{var u=this.getCellInfo(n),o,s,f=this.selectedTds.length&&!r,e=this.cellsRange;return!t&&u.rowIndex==0||t&&(f?e.endRowIndex==this.rowsNum-1:u.rowIndex+u.rowSpan>this.rowsNum-1)?null:(o=t?f?e.endRowIndex+1:u.rowIndex+u.rowSpan:f?e.beginRowIndex-1:u.rowIndex-1,s=f?e.beginColIndex:u.colIndex,this.getCell(this.indexTable[o][s].rowIndex,this.indexTable[o][s].cellIndex))}catch(h){i(h)}},getSameEndPosCells:function(n,t){var f,c,u,e;try{var r=t.toLowerCase()==="x",o=domUtils.getXY(n)[r?"x":"y"]+n["offset"+(r?"Width":"Height")],l=this.table.rows,s=null,h=[];for(f=0;f<this.rowsNum;f++)for(s=l[f].cells,c=0;u=s[c++];){if(e=domUtils.getXY(u)[r?"x":"y"]+u["offset"+(r?"Width":"Height")],e>o&&r)break;if((n==u||o==e)&&(u[r?"colSpan":"rowSpan"]==1&&h.push(u),r))break}return h}catch(a){i(a)}},setCellContent:function(t,i){t.innerHTML=i||(n.ie?domUtils.fillChar:"<br />")},cloneCell:t.cloneCell,getSameStartPosXCells:function(n){var t,s,r,u;try{var f=domUtils.getXY(n).x+n.offsetWidth,h=this.table.rows,e,o=[];for(t=0;t<this.rowsNum;t++)for(e=h[t].cells,s=0;r=e[s++];){if(u=domUtils.getXY(r).x,u>f)break;if(u==f&&r.colSpan==1){o.push(r);break}}return o}catch(c){i(c)}},update:function(n){var y,e,o,c,t,p,i,r,k,f,u;this.table=n||this.table;this.selectedTds=[];this.cellsRange={};this.indexTable=[];for(var s=this.table.rows,h=this.getMaxRows(),g=h-s.length,v=this.getMaxCols();g--;)this.table.insertRow(s.length);for(this.rowsNum=h,this.colsNum=v,u=0,y=s.length;u<y;u++)this.indexTable[u]=new Array(v);for(e=0;o=s[e];e++)for(c=0,p=o.cells;t=p[c];c++){t.rowSpan>h&&(t.rowSpan=h);for(var l=c,w=t.rowSpan||1,b=t.colSpan||1;this.indexTable[e][l];)l++;for(i=0;i<w;i++)for(r=0;r<b;r++)this.indexTable[e+i][l+r]={rowIndex:e,cellIndex:c,colIndex:l,rowSpan:w,colSpan:b}}for(i=0;i<h;i++)for(r=0;r<v;r++)this.indexTable[i][r]===undefined&&(o=s[i],t=o.cells[o.cells.length-1],t=t?t.cloneNode(!0):this.table.ownerDocument.createElement("td"),this.setCellContent(t),t.colSpan!==1&&(t.colSpan=1),t.rowSpan!==1&&(t.rowSpan=1),o.appendChild(t),this.indexTable[i][r]={rowIndex:i,cellIndex:t.cellIndex,colIndex:r,rowSpan:1,colSpan:1});if(k=domUtils.getElementsByTagName(this.table,"td"),f=[],utils.each(k,function(n){domUtils.hasClass(n,"selectTdClass")&&f.push(n)}),f.length){var nt=f[0],tt=f[f.length-1],d=this.getCellInfo(nt),a=this.getCellInfo(tt);this.selectedTds=f;this.cellsRange={beginRowIndex:d.rowIndex,beginColIndex:d.colIndex,endRowIndex:a.rowIndex+a.rowSpan-1,endColIndex:a.colIndex+a.colSpan-1}}if(!domUtils.hasClass(this.table.rows[0],"firstRow"))for(domUtils.addClass(this.table.rows[0],"firstRow"),u=1;u<this.table.rows.length;u++)domUtils.removeClasses(this.table.rows[u],"firstRow")},getCellInfo:function(n){var t,i;if(n){var r=n.cellIndex,u=n.parentNode.rowIndex,f=this.indexTable[u],e=this.colsNum;for(t=r;t<e;t++)if(i=f[t],i.rowIndex===u&&i.cellIndex===r)return i}},getCell:function(n,t){return n<this.rowsNum&&this.table.rows[n].cells[t]||null},deleteCell:function(n,t){t=typeof t=="number"?t:n.parentNode.rowIndex;var i=this.table.rows[t];i.deleteCell(n.cellIndex)},getCellsRange:function(n,t){function f(n,t,i,u){var h=n,c=t,l=i,a=u,s,o,e;if(n>0)for(o=t;o<u;o++)s=r.indexTable[n][o],e=s.rowIndex,e<n&&(h=Math.min(e,h));if(u<r.colsNum)for(e=n;e<i;e++)s=r.indexTable[e][u],o=s.colIndex+s.colSpan-1,o>u&&(a=Math.max(o,a));if(i<r.rowsNum)for(o=t;o<u;o++)s=r.indexTable[i][o],e=s.rowIndex+s.rowSpan-1,e>i&&(l=Math.max(e,l));if(t>0)for(e=n;e<i;e++)s=r.indexTable[e][t],o=s.colIndex,o<t&&(c=Math.min(s.colIndex,c));return h!=n||c!=t||l!=i||a!=u?f(h,c,l,a):{beginRowIndex:n,beginColIndex:t,endRowIndex:i,endColIndex:u}}var r,i;try{if(r=this,i=r.getCellInfo(n),n===t)return{beginRowIndex:i.rowIndex,beginColIndex:i.colIndex,endRowIndex:i.rowIndex+i.rowSpan-1,endColIndex:i.colIndex+i.colSpan-1};var u=r.getCellInfo(t),e=Math.min(i.rowIndex,u.rowIndex),o=Math.min(i.colIndex,u.colIndex),s=Math.max(i.rowIndex+i.rowSpan-1,u.rowIndex+u.rowSpan-1),h=Math.max(i.colIndex+i.colSpan-1,u.colIndex+u.colSpan-1);return f(e,o,s,h)}catch(c){}},getCells:function(n){var r,u,e;this.clearSelected();var l=n.beginRowIndex,a=n.beginColIndex,o=n.endRowIndex,s=n.endColIndex,t,i,f,h={},c=[];for(r=l;r<=o;r++)for(u=a;u<=s;u++)if(t=this.indexTable[r][u],i=t.rowIndex,f=t.colIndex,e=i+"|"+f,!h[e]){if(h[e]=1,i<r||f<u||i+t.rowSpan-1>o||f+t.colSpan-1>s)return null;c.push(this.getCell(i,t.cellIndex))}return c},clearSelected:function(){t.removeSelectedClass(this.selectedTds);this.selectedTds=[];this.cellsRange={}},setSelected:function(n){var i=this.getCells(n);t.addSelectedClass(i);this.selectedTds=i;this.cellsRange=n},isFullRow:function(){var n=this.cellsRange;return n.endColIndex-n.beginColIndex+1==this.colsNum},isFullCol:function(){var t=this.cellsRange,i=this.table,r=i.getElementsByTagName("th"),n=t.endRowIndex-t.beginRowIndex+1;return r.length?n==this.rowsNum||n==this.rowsNum-1:n==this.rowsNum},getNextCell:function(n,t,r){try{var u=this.getCellInfo(n),o,s,f=this.selectedTds.length&&!r,e=this.cellsRange;return!t&&u.rowIndex==0||t&&(f?e.endRowIndex==this.rowsNum-1:u.rowIndex+u.rowSpan>this.rowsNum-1)?null:(o=t?f?e.endRowIndex+1:u.rowIndex+u.rowSpan:f?e.beginRowIndex-1:u.rowIndex-1,s=f?e.beginColIndex:u.colIndex,this.getCell(this.indexTable[o][s].rowIndex,this.indexTable[o][s].cellIndex))}catch(h){i(h)}},getPreviewCell:function(n,t){try{var r=this.getCellInfo(n),e,o,u=this.selectedTds.length,f=this.cellsRange;return!t&&(u?!f.beginColIndex:!r.colIndex)||t&&(u?f.endColIndex==this.colsNum-1:r.rowIndex>this.colsNum-1)?null:(e=t?u?f.beginRowIndex:r.rowIndex<1?0:r.rowIndex-1:u?f.beginRowIndex:r.rowIndex,o=t?u?f.endColIndex+1:r.colIndex:u?f.beginColIndex-1:r.colIndex<1?0:r.colIndex-1,this.getCell(this.indexTable[e][o].rowIndex,this.indexTable[e][o].cellIndex))}catch(s){i(s)}},moveContent:function(n,i){if(!t.isEmptyBlock(i)){if(t.isEmptyBlock(n)){n.innerHTML=i.innerHTML;return}var u=n.lastChild;for(u.nodeType!=3&&r.$block[u.tagName]||n.appendChild(n.ownerDocument.createElement("br"));u=i.firstChild;)n.appendChild(u)}},mergeRight:function(n){var t=this.getCellInfo(n),u=t.colIndex+t.colSpan,i=this.indexTable[t.rowIndex][u],r=this.getCell(i.rowIndex,i.cellIndex);n.colSpan=t.colSpan+i.colSpan;n.removeAttribute("width");this.moveContent(n,r);this.deleteCell(r,i.rowIndex);this.update()},mergeDown:function(n){var t=this.getCellInfo(n),u=t.rowIndex+t.rowSpan,i=this.indexTable[u][t.colIndex],r=this.getCell(i.rowIndex,i.cellIndex);n.rowSpan=t.rowSpan+i.rowSpan;n.removeAttribute("height");this.moveContent(n,r);this.deleteCell(r,i.rowIndex);this.update()},mergeRange:function(){var t=this.cellsRange,n=this.getCell(t.beginRowIndex,this.indexTable[t.beginRowIndex][t.beginColIndex].cellIndex),r,u,h,f,e,i,o,s;for(n.tagName=="TH"&&t.endRowIndex!==t.beginRowIndex&&(r=this.indexTable,u=this.getCellInfo(n),n=this.getCell(1,r[1][u.colIndex].cellIndex),t=this.getCellsRange(n,this.getCell(r[this.rowsNum-1][u.colIndex].rowIndex,r[this.rowsNum-1][u.colIndex].cellIndex))),h=this.getCells(t),i=0;f=h[i++];)f!==n&&(this.moveContent(n,f),this.deleteCell(f));if(n.rowSpan=t.endRowIndex-t.beginRowIndex+1,n.rowSpan>1&&n.removeAttribute("height"),n.colSpan=t.endColIndex-t.beginColIndex+1,n.colSpan>1&&n.removeAttribute("width"),n.rowSpan==this.rowsNum&&n.colSpan!=1&&(n.colSpan=1),n.colSpan==this.colsNum&&n.rowSpan!=1){if(e=n.parentNode.rowIndex,this.table.deleteRow)for(var i=e+1,c=e+1,o=n.rowSpan;i<o;i++)this.table.deleteRow(c);else for(i=0,o=n.rowSpan-1;i<o;i++)s=this.table.rows[e+1],s.parentNode.removeChild(s);n.rowSpan=1}this.update()},insertRow:function(n,t){function s(n,t,i){var f,r,u;n==0?(f=i.nextSibling||i.previousSibling,r=f.cells[n],r.tagName=="TH"&&(r=t.ownerDocument.createElement("th"),r.appendChild(t.firstChild),i.insertBefore(r,t),domUtils.remove(t))):t.tagName=="TH"&&(u=t.ownerDocument.createElement("td"),u.appendChild(t.firstChild),i.insertBefore(u,t),domUtils.remove(t))}var e=this.colsNum,c=this.table,u=c.insertRow(n),i,o=typeof t=="string"&&t.toUpperCase()=="TH",r,h,l,f;if(n==0||n==this.rowsNum)for(r=0;r<e;r++)i=this.cloneCell(t,!0),this.setCellContent(i),i.getAttribute("vAlign")&&i.setAttribute("vAlign",i.getAttribute("vAlign")),u.appendChild(i),o||s(r,i,u);else for(h=this.indexTable[n],l=0,r=0;r<e;r++)f=h[r],f.rowIndex<n?(i=this.getCell(f.rowIndex,f.cellIndex),i.rowSpan=f.rowSpan+1):(i=this.cloneCell(t,!0),this.setCellContent(i),u.appendChild(i)),o||s(r,i,u);return this.update(),u},deleteRow:function(n){for(var u,i,r,o,s,h,c=this.table.rows[n],e=this.indexTable[n],l=this.colsNum,a=0,t=0;t<l;){if(u=e[t],i=this.getCell(u.rowIndex,u.cellIndex),i.rowSpan>1&&u.rowIndex==n){r=i.cloneNode(!0);r.rowSpan=i.rowSpan-1;r.innerHTML="";i.rowSpan=1;var v=n+1,f=this.table.rows[v],y,p=this.getPreviewMergedCellsNum(v,t)-a;p<t?(y=t-p-1,domUtils.insertAfter(f.cells[y],r)):f.cells.length&&f.insertBefore(r,f.cells[0]);a+=1}t+=i.colSpan||1}for(o=[],s={},t=0;t<l;t++){var w=e[t].rowIndex,b=e[t].cellIndex,k=w+"_"+b;s[k]||(s[k]=1,i=this.getCell(w,b),o.push(i))}h=[];utils.each(o,function(n){n.rowSpan==1?n.parentNode.removeChild(n):h.push(n)});utils.each(h,function(n){n.rowSpan--});c.parentNode.removeChild(c);this.update()},insertCol:function(n,t,i){function c(n,t,i){var r,u;n==0?(r=t.nextSibling||t.previousSibling,r.tagName=="TH"&&(r=t.ownerDocument.createElement("th"),r.appendChild(t.firstChild),i.insertBefore(r,t),domUtils.remove(t))):t.tagName=="TH"&&(u=t.ownerDocument.createElement("td"),u.appendChild(t.firstChild),i.insertBefore(u,t),domUtils.remove(t))}var s=this.rowsNum,f=0,u,r,l=parseInt((this.table.offsetWidth-(this.colsNum+1)*20-(this.colsNum+1))/(this.colsNum+1),10),h=typeof t=="string"&&t.toUpperCase()=="TH",e,o;if(n==0||n==this.colsNum)for(;f<s;f++)u=this.table.rows[f],e=u.cells[n==0?n:u.cells.length],r=this.cloneCell(t,!0),this.setCellContent(r),r.setAttribute("vAlign",r.getAttribute("vAlign")),e&&r.setAttribute("width",e.getAttribute("width")),n?domUtils.insertAfter(u.cells[u.cells.length-1],r):u.insertBefore(r,u.cells[0]),h||c(f,r,u);else for(;f<s;f++)o=this.indexTable[f][n],o.colIndex<n?(r=this.getCell(o.rowIndex,o.cellIndex),r.colSpan=o.colSpan+1):(u=this.table.rows[f],e=u.cells[o.cellIndex],r=this.cloneCell(t,!0),this.setCellContent(r),r.setAttribute("vAlign",r.getAttribute("vAlign")),e&&r.setAttribute("width",e.getAttribute("width")),e?u.insertBefore(r,e):u.appendChild(r)),h||c(f,r,u);this.update();this.updateWidth(l,i||{tdPadding:10,tdBorder:1})},updateWidth:function(n,i){var r=this.table,u=t.getWidth(r)-i.tdPadding*2-i.tdBorder+n,f;if(u<r.ownerDocument.body.offsetWidth){r.setAttribute("width",u);return}f=domUtils.getElementsByTagName(this.table,"td th");utils.each(f,function(t){t.setAttribute("width",n)})},deleteCol:function(n){for(var i,o=this.indexTable,s=this.table.rows,h=this.table.getAttribute("width"),u=0,c=this.rowsNum,f={},r=0;r<c;){var l=o[r],t=l[n],e=t.rowIndex+"_"+t.colIndex;f[e]||(f[e]=1,i=this.getCell(t.rowIndex,t.cellIndex),u||(u=i&&parseInt(i.offsetWidth/i.colSpan,10).toFixed(0)),i.colSpan>1?i.colSpan--:s[r].deleteCell(t.cellIndex),r+=t.rowSpan||1)}this.table.setAttribute("width",h-u);this.update()},splitToCells:function(n){var t=this,i=this.splitToRows(n);utils.each(i,function(n){t.splitToCols(n)})},splitToRows:function(n){var r=this.getCellInfo(n),u=r.rowIndex,e=r.colIndex,f=[],i,o,s,t;for(n.rowSpan=1,f.push(n),i=u,o=u+r.rowSpan;i<o;i++)i!=u&&(s=this.table.rows[i],t=s.insertCell(e-this.getPreviewMergedCellsNum(i,e)),t.colSpan=r.colSpan,this.setCellContent(t),t.setAttribute("vAlign",n.getAttribute("vAlign")),t.setAttribute("align",n.getAttribute("align")),n.style.cssText&&(t.style.cssText=n.style.cssText),f.push(t));return this.update(),f},getPreviewMergedCellsNum:function(n,t){for(var r,e,u=this.indexTable[n],f=0,i=0;i<t;)r=u[i].colSpan,e=u[i].rowIndex,f+=r-(e==n?1:0),i+=r;return f},splitToCols:function(n){var s=(n.offsetWidth/n.colSpan-22).toFixed(0),u=this.getCellInfo(n),h=u.rowIndex,f=u.colIndex,e=[],i,c,o,t,r;for(n.colSpan=1,n.setAttribute("width",s),e.push(n),i=f,c=f+u.colSpan;i<c;i++)i!=f&&(o=this.table.rows[h],t=o.insertCell(this.indexTable[h][i].cellIndex+1),t.rowSpan=u.rowSpan,this.setCellContent(t),t.setAttribute("vAlign",n.getAttribute("vAlign")),t.setAttribute("align",n.getAttribute("align")),t.setAttribute("width",s),n.style.cssText&&(t.style.cssText=n.style.cssText),n.tagName=="TH"&&(r=n.ownerDocument.createElement("th"),r.appendChild(t.firstChild),r.setAttribute("vAlign",n.getAttribute("vAlign")),r.rowSpan=t.rowSpan,o.insertBefore(r,t),domUtils.remove(t)),e.push(t));return this.update(),e},isLastCell:function(n,t,i){t=t||this.rowsNum;i=i||this.colsNum;var r=this.getCellInfo(n);return r.rowIndex+r.rowSpan==t&&r.colIndex+r.colSpan==i},getLastCell:function(n){n=n||this.table.getElementsByTagName("td");var o=this.getCellInfo(n[0]),f=this,t=n[0],e=t.parentNode,r=0,i=0,u;return utils.each(n,function(n){n.parentNode==e&&(i+=n.colSpan||1);r+=n.rowSpan*n.colSpan||1}),u=r/i,utils.each(n,function(n){if(f.isLastCell(n,u,i))return t=n,!1}),t},selectRow:function(n){var t=this.indexTable[n],i=this.getCell(t[0].rowIndex,t[0].cellIndex),r=this.getCell(t[this.colsNum-1].rowIndex,t[this.colsNum-1].cellIndex),u=this.getCellsRange(i,r);this.setSelected(u)},selectTable:function(){var n=this.table.getElementsByTagName("td"),t=this.getCellsRange(n[0],n[n.length-1]);this.setSelected(t)},setBackground:function(n,t){var u,r,f;if(typeof t=="string")utils.each(n,function(n){n.style.backgroundColor=t});else if(typeof t=="object"){t=utils.extend({repeat:!0,colorList:["#ddd","#fff"]},t);var e=this.getCellInfo(n[0]).rowIndex,i=0,o=t.colorList,s=function(n,t,i){return n[t]?n[t]:i?n[t%n.length]:""};for(u=0;r=n[u++];)f=this.getCellInfo(r),r.style.backgroundColor=s(o,e+i==f.rowIndex?i:++i,t.repeat)}},removeBackground:function(n){utils.each(n,function(n){n.style.backgroundColor=""})}}}(),function(){function o(n,t){var i=domUtils.getElementsByTagName(n,"td th"),r;utils.each(i,function(n){n.removeAttribute("width")});n.setAttribute("width",s(t,!0,e(t,n)));r=[];setTimeout(function(){utils.each(i,function(n){n.colSpan==1&&r.push(n.offsetWidth)});utils.each(i,function(n,t){n.colSpan==1&&n.setAttribute("width",r[t]+"")})},0)}function s(n,t,i){var r=n.body;return r.offsetWidth-(t?parseInt(domUtils.getComputedStyle(r,"margin-left"),10)*2:0)-i.tableBorder*2-(n.options.offsetWidth||0)}function r(n){var r=t(n).cell,u;return r?(u=i(r),u.selectedTds.length?u.selectedTds:[r]):[]}var f=UE.UETable,t=function(n){return f.getTableItemsByRange(n)},u=function(n){return f.getUETableBySelected(n)},e=function(n,t){return f.getDefaultValue(n,t)},i=function(n){return f.getUETable(n)};UE.commands.inserttable={queryCommandState:function(){return t(this).table?-1:0},execCommand:function(t,i){function f(t,i){for(var f,r=[],e=t.numRows,o=t.numCols,u=0;u<e;u++){for(r.push("<tr"+(u==0?' class="firstRow"':"")+">"),f=0;f<o;f++)r.push('<td width="'+i+'"  vAlign="'+t.tdvalign+'" >'+(n.ie&&n.version<11?domUtils.fillChar:"<br/>")+"<\/td>");r.push("<\/tr>")}return"<table><tbody>"+r.join("")+"<\/tbody><\/table>"}i||(i=utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign}));var r=this,o=this.selection.getRange(),s=o.startContainer,h=domUtils.findParent(s,function(n){return domUtils.isBlockElm(n)},!0)||r.body,u=e(r),c=h.offsetWidth,l=Math.floor(c/i.numCols-u.tdPadding*2-u.tdBorder);i.tdvalign||(i.tdvalign=r.options.tdvalign);r.execCommand("inserthtml",f(i,l))}};UE.commands.insertparagraphbeforetable={queryCommandState:function(){return t(this).cell?0:-1},execCommand:function(){var r=t(this).table,i;r&&(i=this.document.createElement("p"),i.innerHTML=n.ie?"&nbsp;":"<br />",r.parentNode.insertBefore(i,r),this.selection.getRange().setStart(i,0).setCursor())}};UE.commands.deletetable={queryCommandState:function(){var n=this.selection.getRange();return domUtils.findParentByTagName(n.startContainer,"table",!0)?0:-1},execCommand:function(t,i){var u=this.selection.getRange(),r;i=i||domUtils.findParentByTagName(u.startContainer,"table",!0);i&&(r=i.nextSibling,r||(r=domUtils.createElement(this.document,"p",{innerHTML:n.ie?domUtils.fillChar:"<br/>"}),i.parentNode.insertBefore(r,i)),domUtils.remove(i),u=this.selection.getRange(),r.nodeType==3?u.setStartBefore(r):u.setStart(r,0),u.setCursor(!1,!0),this.fireEvent("tablehasdeleted"))}};UE.commands.cellalign={queryCommandState:function(){return r(this).length?0:-1},execCommand:function(n,t){var i=r(this),u,f;if(i.length)for(u=0;f=i[u++];)f.setAttribute("align",t)}};UE.commands.cellvalign={queryCommandState:function(){return r(this).length?0:-1},execCommand:function(n,t){var i=r(this),u,f;if(i.length)for(u=0;f=i[u++];)f.setAttribute("vAlign",t)}};UE.commands.insertcaption={queryCommandState:function(){var n=t(this).table;return n?n.getElementsByTagName("caption").length==0?1:-1:-1},execCommand:function(){var r=t(this).table,i,u;r&&(i=this.document.createElement("caption"),i.innerHTML=n.ie?domUtils.fillChar:"<br/>",r.insertBefore(i,r.firstChild),u=this.selection.getRange(),u.setStart(i,0).setCursor())}};UE.commands.deletecaption={queryCommandState:function(){var t=this.selection.getRange(),n=domUtils.findParentByTagName(t.startContainer,"table");return n?n.getElementsByTagName("caption").length==0?-1:1:-1},execCommand:function(){var i=this.selection.getRange(),n=domUtils.findParentByTagName(i.startContainer,"table"),t;n&&(domUtils.remove(n.getElementsByTagName("caption")[0]),t=this.selection.getRange(),t.setStart(n.rows[0].cells[0],0).setCursor())}};UE.commands.inserttitle={queryCommandState:function(){var i=t(this).table,n;return i?(n=i.rows[0],n.cells[n.cells.length-1].tagName.toLowerCase()!="th"?0:-1):-1},execCommand:function(){var n=t(this).table,r;n&&i(n).insertRow(0,"th");r=n.getElementsByTagName("th")[0];this.selection.getRange().setStart(r,0).setCursor(!1,!0)}};UE.commands.deletetitle={queryCommandState:function(){var i=t(this).table,n;return i?(n=i.rows[0],n.cells[n.cells.length-1].tagName.toLowerCase()=="th"?0:-1):-1},execCommand:function(){var n=t(this).table,i;n&&domUtils.remove(n.rows[0]);i=n.getElementsByTagName("td")[0];this.selection.getRange().setStart(i,0).setCursor(!1,!0)}};UE.commands.inserttitlecol={queryCommandState:function(){var n=t(this).table,i;return n?(i=n.rows[n.rows.length-1],i.getElementsByTagName("th").length?-1:0):-1},execCommand:function(){var n=t(this).table,r;n&&i(n).insertCol(0,"th");o(n,this);r=n.getElementsByTagName("th")[0];this.selection.getRange().setStart(r,0).setCursor(!1,!0)}};UE.commands.deletetitlecol={queryCommandState:function(){var n=t(this).table,i;return n?(i=n.rows[n.rows.length-1],i.getElementsByTagName("th").length?0:-1):-1},execCommand:function(){var n=t(this).table,i,r;if(n)for(i=0;i<n.rows.length;i++)domUtils.remove(n.rows[i].children[0]);o(n,this);r=n.getElementsByTagName("td")[0];this.selection.getRange().setStart(r,0).setCursor(!1,!0)}};UE.commands.mergeright={queryCommandState:function(){var h=t(this),f=h.table,e=h.cell,r,n,o,u,s;return!f||!e?-1:(r=i(f),r.selectedTds.length)?-1:(n=r.getCellInfo(e),o=n.colIndex+n.colSpan,o>=r.colsNum)?-1:(u=r.indexTable[n.rowIndex][o],s=f.rows[u.rowIndex].cells[u.cellIndex],!s||e.tagName!=s.tagName)?-1:u.rowIndex==n.rowIndex&&u.rowSpan==n.rowSpan?0:-1},execCommand:function(){var n=this.selection.getRange(),u=n.createBookmark(!0),r=t(this).cell,f=i(r);f.mergeRight(r);n.moveToBookmark(u).select()}};UE.commands.mergedown={queryCommandState:function(){var h=t(this),f=h.table,e=h.cell,r,n,o,u,s;return!f||!e?-1:(r=i(f),r.selectedTds.length)?-1:(n=r.getCellInfo(e),o=n.rowIndex+n.rowSpan,o>=r.rowsNum)?-1:(u=r.indexTable[o][n.colIndex],s=f.rows[u.rowIndex].cells[u.cellIndex],!s||e.tagName!=s.tagName)?-1:u.colIndex==n.colIndex&&u.colSpan==n.colSpan?0:-1},execCommand:function(){var n=this.selection.getRange(),u=n.createBookmark(!0),r=t(this).cell,f=i(r);f.mergeDown(r);n.moveToBookmark(u).select()}};UE.commands.mergecells={queryCommandState:function(){return u(this)?0:-1},execCommand:function(){var n=u(this),t,i;n&&n.selectedTds.length&&(t=n.selectedTds[0],n.mergeRange(),i=this.selection.getRange(),domUtils.isEmptyBlock(t)?i.setStart(t,0).collapse(!0):i.selectNodeContents(t),i.select())}};UE.commands.insertrow={queryCommandState:function(){var n=t(this),r=n.cell;return r&&(r.tagName=="TD"||r.tagName=="TH"&&n.tr!==n.table.rows[0])&&i(n.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var o=this.selection.getRange(),c=o.createBookmark(!0),s=t(this),u=s.cell,f=s.table,n=i(f),l=n.getCellInfo(u),r,e,h;if(n.selectedTds.length)for(r=n.cellsRange,e=0,h=r.endRowIndex-r.beginRowIndex+1;e<h;e++)n.insertRow(r.beginRowIndex,u);else n.insertRow(l.rowIndex,u);o.moveToBookmark(c).select();f.getAttribute("interlaced")==="enabled"&&this.fireEvent("interlacetable",f)}};UE.commands.insertrownext={queryCommandState:function(){var n=t(this),r=n.cell;return r&&r.tagName=="TD"&&i(n.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var o=this.selection.getRange(),l=o.createBookmark(!0),s=t(this),u=s.cell,f=s.table,n=i(f),h=n.getCellInfo(u),r,e,c;if(n.selectedTds.length)for(r=n.cellsRange,e=0,c=r.endRowIndex-r.beginRowIndex+1;e<c;e++)n.insertRow(r.endRowIndex+1,u);else n.insertRow(h.rowIndex+h.rowSpan,u);o.moveToBookmark(l).select();f.getAttribute("interlaced")==="enabled"&&this.fireEvent("interlacetable",f)}};UE.commands.deleterow={queryCommandState:function(){var n=t(this);return n.cell?0:-1},execCommand:function(){var e=t(this).cell,n=i(e),r=n.cellsRange,u=n.getCellInfo(e),l=n.getVSideCell(e),a=n.getVSideCell(e,!0),o=this.selection.getRange(),s,f,h,c;if(utils.isEmptyObject(r))n.deleteRow(u.rowIndex);else for(s=r.beginRowIndex;s<r.endRowIndex+1;s++)n.deleteRow(r.beginRowIndex);f=n.table;f.getElementsByTagName("td").length?u.rowSpan==1||u.rowSpan==r.endRowIndex-r.beginRowIndex+1?(a||l)&&o.selectNodeContents(a||l).setCursor(!1,!0):(c=n.getCell(u.rowIndex,n.indexTable[u.rowIndex][u.colIndex].cellIndex),c&&o.selectNodeContents(c).setCursor(!1,!0)):(h=f.nextSibling,domUtils.remove(f),h&&o.setStart(h,0).setCursor(!1,!0));f.getAttribute("interlaced")==="enabled"&&this.fireEvent("interlacetable",f)}};UE.commands.insertcol={queryCommandState:function(){var r=t(this),n=r.cell;return n&&(n.tagName=="TD"||n.tagName=="TH"&&n!==r.tr.cells[0])&&i(r.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(n){var o=this.selection.getRange(),h=o.createBookmark(!0),f,e,s;if(this.queryCommandState(n)!=-1){var u=t(this).cell,r=i(u),c=r.getCellInfo(u);if(r.selectedTds.length)for(f=r.cellsRange,e=0,s=f.endColIndex-f.beginColIndex+1;e<s;e++)r.insertCol(f.beginColIndex,u);else r.insertCol(c.colIndex,u);o.moveToBookmark(h).select(!0)}}};UE.commands.insertcolnext={queryCommandState:function(){var n=t(this),r=n.cell;return r&&i(n.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(){var e=this.selection.getRange(),h=e.createBookmark(!0),r=t(this).cell,n=i(r),o=n.getCellInfo(r),u,f,s;if(n.selectedTds.length)for(u=n.cellsRange,f=0,s=u.endColIndex-u.beginColIndex+1;f<s;f++)n.insertCol(u.endColIndex+1,r);else n.insertCol(o.colIndex+o.colSpan,r);e.moveToBookmark(h).select()}};UE.commands.deletecol={queryCommandState:function(){var n=t(this);return n.cell?0:-1},execCommand:function(){var r=t(this).cell,n=i(r),f=n.cellsRange,l=n.getCellInfo(r),o=n.getHSideCell(r),s=n.getHSideCell(r,!0),h,e,u,c;if(utils.isEmptyObject(f))n.deleteCol(l.colIndex);else for(h=f.beginColIndex;h<f.endColIndex+1;h++)n.deleteCol(f.beginColIndex);e=n.table;u=this.selection.getRange();e.getElementsByTagName("td").length?domUtils.inDoc(r,this.document)?u.setStart(r,0).setCursor(!1,!0):s&&domUtils.inDoc(s,this.document)?u.selectNodeContents(s).setCursor(!1,!0):o&&domUtils.inDoc(o,this.document)&&u.selectNodeContents(o).setCursor(!0,!0):(c=e.nextSibling,domUtils.remove(e),c&&u.setStart(c,0).setCursor(!1,!0))}};UE.commands.splittocells={queryCommandState:function(){var r=t(this),n=r.cell,u;return n?(u=i(r.table),u.selectedTds.length>0)?-1:n&&(n.colSpan>1||n.rowSpan>1)?0:-1:-1},execCommand:function(){var n=this.selection.getRange(),u=n.createBookmark(!0),r=t(this).cell,f=i(r);f.splitToCells(r);n.moveToBookmark(u).select()}};UE.commands.splittorows={queryCommandState:function(){var r=t(this),n=r.cell,u;return n?(u=i(r.table),u.selectedTds.length>0)?-1:n&&n.rowSpan>1?0:-1:-1},execCommand:function(){var n=this.selection.getRange(),u=n.createBookmark(!0),r=t(this).cell,f=i(r);f.splitToRows(r);n.moveToBookmark(u).select()}};UE.commands.splittocols={queryCommandState:function(){var r=t(this),n=r.cell,u;return n?(u=i(r.table),u.selectedTds.length>0)?-1:n&&n.colSpan>1?0:-1:-1},execCommand:function(){var n=this.selection.getRange(),u=n.createBookmark(!0),r=t(this).cell,f=i(r);f.splitToCols(r);n.moveToBookmark(u).select()}};UE.commands.adaptbytext=UE.commands.adaptbywindow={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(n){var u=t(this),i=u.table,r;i&&(n=="adaptbywindow"?o(i,this):(r=domUtils.getElementsByTagName(i,"td th"),utils.each(r,function(n){n.removeAttribute("width")}),i.removeAttribute("width")))}};UE.commands.averagedistributecol={queryCommandState:function(){var n=u(this);return n?n.isFullRow()||n.isFullCol()?0:-1:-1},execCommand:function(){function i(){var o=n.table,r=0,u=0,s=e(t,o),h,c,f,i;if(n.isFullRow())r=o.offsetWidth,u=n.colsNum;else for(h=n.cellsRange.beginColIndex,c=n.cellsRange.endColIndex,i=h;i<=c;)f=n.selectedTds[i],r+=f.offsetWidth,i+=f.colSpan,u+=1;return Math.ceil(r/u)-s.tdBorder*2-s.tdPadding*2}function r(t){utils.each(domUtils.getElementsByTagName(n.table,"th"),function(n){n.setAttribute("width","")});var i=n.isFullRow()?domUtils.getElementsByTagName(n.table,"td"):n.selectedTds;utils.each(i,function(n){n.colSpan==1&&n.setAttribute("width",t)})}var t=this,n=u(t);n&&n.selectedTds.length&&r(i())}};UE.commands.averagedistributerow={queryCommandState:function(){var n=u(this);return n?n.selectedTds&&/th/ig.test(n.selectedTds[0].tagName)?-1:n.isFullRow()||n.isFullCol()?0:-1:-1},execCommand:function(){function r(){var u,f=0,r=t.table,v=e(i,r),y=parseInt(domUtils.getComputedStyle(r.getElementsByTagName("td")[0],"padding-top")),h,o,c,l,s;if(t.isFullCol())h=domUtils.getElementsByTagName(r,"caption"),o=domUtils.getElementsByTagName(r,"th"),h.length>0&&(c=h[0].offsetHeight),o.length>0&&(l=o[0].offsetHeight),f=r.offsetHeight-(c||0)-(l||0),u=o.length==0?t.rowsNum:t.rowsNum-1;else{var p=t.cellsRange.beginRowIndex,w=t.cellsRange.endRowIndex,a=0,b=domUtils.getElementsByTagName(r,"tr");for(s=p;s<=w;s++)f+=b[s].offsetHeight,a+=1;u=a}return n.ie&&n.version<9?Math.ceil(f/u):Math.ceil(f/u)-v.tdBorder*2-y*2}function f(n){var i=t.isFullCol()?domUtils.getElementsByTagName(t.table,"td"):t.selectedTds;utils.each(i,function(t){t.rowSpan==1&&t.setAttribute("height",n)})}var i=this,t=u(i);t&&t.selectedTds.length&&f(r())}};UE.commands.cellalignment={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(n,t){var r=this,e=u(r),f,i;e?utils.each(e.selectedTds,function(n){domUtils.setAttributes(n,t)}):(f=r.selection.getStart(),i=f&&domUtils.findParentByTagName(f,["td","th","caption"],!0),/caption/ig.test(i.tagName)?(i.style.textAlign=t.align,i.style.verticalAlign=t.vAlign):domUtils.setAttributes(i,t),r.selection.getRange().setCursor(!0))},queryCommandValue:function(){var n=t(this).cell,i;return n||(n=r(this)[0]),n?(i=UE.UETable.getUETable(n).selectedTds,i.length||(i=n),UE.UETable.getTableCellAlignState(i)):null}};UE.commands.tablealignment={queryCommandState:function(){return n.ie&&n.version<8?-1:t(this).table?0:-1},execCommand:function(n,t){var u=this,i=u.selection.getStart(),r=i&&domUtils.findParentByTagName(i,["table"],!0);r&&r.setAttribute("align",t)}};UE.commands.edittable={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(n,t){var u=this.selection.getRange(),i=domUtils.findParentByTagName(u.startContainer,"table"),r;i&&(r=domUtils.getElementsByTagName(i,"td").concat(domUtils.getElementsByTagName(i,"th"),domUtils.getElementsByTagName(i,"caption")),utils.each(r,function(n){n.style.borderColor=t}))}};UE.commands.edittd={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(n,t){var f=this,e=u(f),i,r;e?utils.each(e.selectedTds,function(n){n.style.backgroundColor=t}):(i=f.selection.getStart(),r=i&&domUtils.findParentByTagName(i,["td","th","caption"],!0),r&&(r.style.backgroundColor=t))}};UE.commands.settablebackground={queryCommandState:function(){return r(this).length>1?0:-1},execCommand:function(n,t){var u,f;u=r(this);f=i(u[0]);f.setBackground(u,t)}};UE.commands.cleartablebackground={queryCommandState:function(){var n=r(this),t,i;if(!n.length)return-1;for(t=0;i=n[t++];)if(i.style.backgroundColor!=="")return 0;return-1},execCommand:function(){var n=r(this),t=i(n[0]);t.removeBackground(n)}};UE.commands.interlacetable=UE.commands.uninterlacetable={queryCommandState:function(n){var r=t(this).table,i;return r?(i=r.getAttribute("interlaced"),n=="interlacetable"?i==="enabled"?-1:0:!i||i==="disabled"?-1:0):-1},execCommand:function(n,i){var r=t(this).table;n=="interlacetable"?(r.setAttribute("interlaced","enabled"),this.fireEvent("interlacetable",r,i)):(r.setAttribute("interlaced","disabled"),this.fireEvent("uninterlacetable",r))}};UE.commands.setbordervisible={queryCommandState:function(){var n=t(this).table;return n?0:-1},execCommand:function(){var n=t(this).table;utils.each(domUtils.getElementsByTagName(n,"td"),function(n){n.style.borderWidth="1px";n.style.borderStyle="solid"})}}}();UE.plugins.table=function(){function at(){}function ti(n){ii(n,"width",!0);ii(n,"height",!0)}function ii(n,t,i){n.style[t]&&(i&&n.setAttribute(t,parseInt(n.style[t],10)),n.style[t]="")}function pt(n){if(n.tagName=="TD"||n.tagName=="TH")return n;var t;return(t=domUtils.findParentByTagName(n,"td",!0)||domUtils.findParentByTagName(n,"th",!0))?t:null}function et(t){var u=new RegExp(domUtils.fillChar,"g"),i;if(t[n.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(u,"").length>0)return 0;for(i in r.$isNotEmpty)if(t.getElementsByTagName(i).length)return 0;return 1}function y(n){return n.pageX||n.pageY?{x:n.pageX,y:n.pageY}:{x:n.clientX+t.document.body.scrollLeft-t.document.body.clientLeft,y:n.clientY+t.document.body.scrollTop-t.document.body.clientTop}}function ai(i){var r,e,u,f,h;if(!ot())try{if(r=pt(i.target||i.srcElement),d&&(t.body.style.webkitUserSelect="none",(Math.abs(it.x-i.clientX)>dt||Math.abs(it.y-i.clientY)>dt)&&(wt(),d=!1,s=0,ui(i))),v&&l){s=0;t.body.style.webkitUserSelect="none";t.selection.getNative()[n.ie9below?"empty":"removeAllRanges"]();e=y(i);p(t,!0,v,e,r);v=="h"?c.style.left=pi(l,i)+"px":v=="v"&&(c.style.top=wi(l,i)+"px");return}if(r){if(t.fireEvent("excludetable",r)===!0)return;if(e=y(i),u=nt(r,e),f=domUtils.findParentByTagName(r,"table",!0),g(f,r,i,!0)){if(t.fireEvent("excludetable",f)===!0)return;t.body.style.cursor="url("+t.options.cursorpath+"h.png),pointer"}else if(g(f,r,i)){if(t.fireEvent("excludetable",f)===!0)return;t.body.style.cursor="url("+t.options.cursorpath+"v.png),pointer"}else t.body.style.cursor="text",h=r,/\d/.test(u)&&(u=u.replace(/\d/,""),r=o(r).getPreviewCell(r,u=="v")),p(t,r?!!u:!1,r?u:"",e,r)}else ri(!1,f,t)}catch(a){at(a)}}function ri(n,t,i){if(n)yi(t,i);else{if(ft)return;vi=setTimeout(function(){!ft&&f&&f.parentNode&&f.parentNode.removeChild(f)},2e3)}}function yi(n,t){function e(r,u){clearTimeout(i);i=setTimeout(function(){t.fireEvent("tableClicked",n,u)},300)}function s(){clearTimeout(i);var r=o(n),u=n.rows[0].cells[0],f=r.getLastCell(),e=r.getCellsRange(u,f);t.selection.getRange().setStart(u,0).setCursor(!1,!0);r.setSelected(e)}var r=domUtils.getXY(n),u=n.ownerDocument,i;if(f&&f.parentNode)return f;f=u.createElement("div");f.contentEditable=!1;f.innerHTML="";f.style.cssText="width:15px;height:15px;background-image:url("+t.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(r.y-15)+"px;left:"+r.x+"px;";domUtils.unSelectable(f);f.onmouseover=function(){ft=!0};f.onmouseout=function(){ft=!1};domUtils.on(f,"click",function(n,t){e(t,this)});domUtils.on(f,"dblclick",function(n,t){s(t)});domUtils.on(f,"dragstart",function(n,t){domUtils.preventDefault(t)});u.body.appendChild(f)}function g(n,t,i,r){var u=y(i),e=nt(t,u),f,o;return r?(f=n.getElementsByTagName("caption")[0],o=f?f.offsetHeight:0,e=="v1"&&u.y-domUtils.getXY(n).y-o<8):e=="h1"&&u.x-domUtils.getXY(n).x<8}function pi(n,i){var r=o(n);if(r){var h=r.getSameEndPosCells(n,"x")[0],u=r.getSameStartPosXCells(n)[0],f=y(i).x,e=(h?domUtils.getXY(h).x:domUtils.getXY(r.table).x)+20,s=u?domUtils.getXY(u).x+u.offsetWidth-20:t.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(t.body,"width"),10);return e+=ct,s-=ct,f<e?e:f>s?s:f}}function wi(n,t){try{var i=domUtils.getXY(n).y,r=y(t).y;return r<i?i:r}catch(u){at(u)}}function p(t,i,r,u,f){try{t.body.style.cursor=r=="h"?"col-resize":r=="v"?"row-resize":"text";n.ie&&(!r||b||h(t)?k(t):(si(t,t.document),hi(r,f)));vt=i}catch(e){at(e)}}function nt(n,t){var i=domUtils.getXY(n);return i?i.x+n.offsetWidth-t.x<w?"h":t.x-i.x<w?"h1":i.y+n.offsetHeight-t.y<w?"v":t.y-i.y<w?"v1":"":""}function di(n,i){var r,f,u;ot()||(it={x:i.clientX,y:i.clientY},i.button==2?(r=h(t),f=!1,r&&(u=ci(t,i),utils.each(r.selectedTds,function(n){n===u&&(f=!0)}),f?(u=r.selectedTds[0],setTimeout(function(){t.selection.getRange().setStart(u,0).setCursor(!1,!0)},0)):(rt(domUtils.getElementsByTagName(t.body,"th td")),r.clearSelected()))):nr(i))}function gi(n){var i,u,c,f,h;if(s=0,n=n||t.window.event,i=pt(n.target||n.srcElement),i&&(u=nt(i,y(n)))&&(k(t),u=="h1"&&(u="h",g(domUtils.findParentByTagName(i,"table"),i,n)?t.execCommand("adaptbywindow"):(i=o(i).getPreviewCell(i),i&&(c=t.selection.getRange(),c.selectNodeContents(i).setCursor(!0,!0)))),u=="h")){var e=o(i),l=e.table,r=oi(i,l,!0);r=ir(r,"left");e.width=e.offsetWidth;f=[];h=[];utils.each(r,function(n){f.push(n.offsetWidth)});utils.each(r,function(n){n.removeAttribute("width")});window.setTimeout(function(){var n=!0,t;utils.each(r,function(t,i){var r=t.offsetWidth;if(r>f[i])return n=!1,!1;h.push(r)});t=n?h:f;utils.each(r,function(n,i){n.width=t[i]-st()})},0)}}function nr(n){if(rt(domUtils.getElementsByTagName(t.body,"td th")),utils.each(t.document.getElementsByTagName("table"),function(n){n.ueTable=null}),i=ci(t,n),i){var r=domUtils.findParentByTagName(i,"table",!0);ut=o(r);ut&&ut.clearSelected();vt?tr(n):(t.document.body.style.webkitUserSelect="",b=!0,t.addListener("mouseover",ei))}}function tr(t){n.ie&&(t=rr(t));wt();d=!0;tt=setTimeout(function(){ui(t)},gt)}function ir(n,t){for(var u=[],i=null,r=0,f=n.length;r<f;r++)i=n[r][t],i&&u.push(i);return u}function wt(){tt&&clearTimeout(tt);tt=null}function rr(n){var f=["pageX","pageY","clientX","clientY","srcElement","target"],u={},t,i,r;if(n)for(t=0;i=f[t];t++)r=n[i],r&&(u[i]=r);return u}function ui(n){if(d=!1,i=n.target||n.srcElement,i){var r=nt(i,y(n));/\d/.test(r)&&(r=r.replace(/\d/,""),i=o(i).getPreviewCell(i,r=="v"));k(t);si(t,t.document);t.fireEvent("saveScene");hi(r,i);b=!0;v=r;l=i}}function fi(t,r){var w,g,y,nt,p,h,a;if(!ot()){if(wt(),d=!1,vt&&(s=++s%3,it={x:r.clientX,y:r.clientY},li=setTimeout(function(){s>0&&s--},gt),s===2)){s=0;gi(r);return}if(r.button!=2){var f=this,e=f.selection.getRange(),h=domUtils.findParentByTagName(e.startContainer,"table",!0),a=domUtils.findParentByTagName(e.endContainer,"table",!0);if((h||a)&&(h===a?(h=domUtils.findParentByTagName(e.startContainer,["td","th","caption"],!0),a=domUtils.findParentByTagName(e.endContainer,["td","th","caption"],!0),h!==a&&f.selection.clearRange()):f.selection.clearRange()),b=!1,f.document.body.style.webkitUserSelect="",v&&l&&(f.selection.getNative()[n.ie9below?"empty":"removeAllRanges"](),s=0,c=f.document.getElementById("ue_tableDragLine"),c)){w=domUtils.getXY(l);g=domUtils.getXY(c);switch(v){case"h":fr(l,g.x-w.x);break;case"v":er(l,g.y-w.y-l.offsetHeight)}v="";l=null;k(f);f.fireEvent("saveScene");return}if(i)nt=o(i),p=nt?nt.selectedTds[0]:null,p?(e=new u.Range(f.document),domUtils.isEmptyBlock(p)?e.setStart(p,0).setCursor(!1,!0):e.selectNodeContents(p).shrinkBoundary().setCursor(!1,!0)):(e=f.selection.getRange().shrinkBoundary(),e.collapsed||(h=domUtils.findParentByTagName(e.startContainer,["td","th"],!0),a=domUtils.findParentByTagName(e.endContainer,["td","th"],!0),(h&&!a||!h&&a||h&&a&&h!==a)&&e.setCursor(!1,!0))),i=null,f.removeListener("mouseover",ei);else if(y=domUtils.findParentByTagName(r.target||r.srcElement,"td",!0),y||(y=domUtils.findParentByTagName(r.target||r.srcElement,"th",!0)),y&&(y.tagName=="TD"||y.tagName=="TH")){if(f.fireEvent("excludetable",y)===!0)return;e=new u.Range(f.document);e.setStart(y,0).setCursor(!1,!0)}f._selectionChange(250,r)}}}function ei(t,r){var u,e,f,s;ot()||(u=this,e=r.target||r.srcElement,a=domUtils.findParentByTagName(e,"td",!0)||domUtils.findParentByTagName(e,"th",!0),i&&a&&(i.tagName=="TD"&&a.tagName=="TD"||i.tagName=="TH"&&a.tagName=="TH")&&domUtils.findParentByTagName(i,"table")==domUtils.findParentByTagName(a,"table")&&(f=o(a),i!=a?(u.document.body.style.webkitUserSelect="none",u.selection.getNative()[n.ie9below?"empty":"removeAllRanges"](),s=f.getCellsRange(i,a),f.setSelected(s)):(u.document.body.style.webkitUserSelect="",f.clearSelected())),r.preventDefault?r.preventDefault():r.returnValue=!1)}function ur(n,t,i){var r=parseInt(domUtils.getComputedStyle(n,"line-height"),10),u=i+t;t=u<r?r:u;n.style.height&&(n.style.height="");n.rowSpan==1?n.setAttribute("height",t):n.removeAttribute&&n.removeAttribute("height")}function fr(n,t){var u=o(n),i,r,f;u&&(i=u.table,r=oi(n,i),i.style.width="",i.removeAttribute("width"),t=or(t,n,r),n.nextSibling?(f=0,utils.each(r,function(n){n.left.width=+n.left.width+t;n.right&&(n.right.width=+n.right.width-t)})):utils.each(r,function(n){n.left.width-=-t}))}function ot(){return t.body.contentEditable==="false"}function er(n,t){var r,i,u,f,e;if(!(Math.abs(t)<10)&&(r=o(n),r))for(i=r.getSameEndPosCells(n,"y"),u=i[0]?i[0].offsetHeight:0,f=0;e=i[f++];)ur(e,t,u)}function oi(n,t,i){var u;if(t||(t=domUtils.findParentByTagName(n,"table")),!t)return null;for(var o=domUtils.getNodeIndex(n),r=n,e=t.rows,f=0;r;)r.nodeType===1&&(f+=r.colSpan||1),r=r.previousSibling;return r=null,u=[],utils.each(e,function(n){var r=n.cells,t=0;utils.each(r,function(n){return(t+=n.colSpan||1,t===f)?(u.push({left:n,right:n.nextSibling||null}),!1):t>f?(i&&u.push({left:n}),!1):void 0})}),u}function or(n,t,i){if(n-=st(),n<0)return 0;n-=bt(t);var r=n<0?"left":"right";return n=Math.abs(n),utils.each(i,function(t){var i=t[r];i&&(n=Math.min(n,bt(i)-ct))}),n=n<0?0:n,r==="left"?-n:n}function bt(n){var t=0,t=n.offsetWidth-st();n.nextSibling||(t-=sr(n));t=t<0?0:t;try{n.width=t}catch(i){}return t}function sr(n){if(tab=domUtils.findParentByTagName(n,"table",!1),tab.offsetVal===undefined){var t=n.previousSibling;tab.offsetVal=t?n.offsetWidth-t.offsetWidth===e.borderWidth?e.borderWidth:0:0}return tab.offsetVal}function st(){var o;if(e.tabcellSpace===undefined){var n=t.document.createElement("table"),u=t.document.createElement("tbody"),r=t.document.createElement("tr"),i=t.document.createElement("td"),f=null;i.style.cssText="border: 0;";i.width=1;r.appendChild(i);r.appendChild(f=i.cloneNode(!1));u.appendChild(r);n.appendChild(u);n.style.cssText="visibility: hidden;";t.body.appendChild(n);e.paddingSpace=i.offsetWidth-1;o=n.offsetWidth;i.style.cssText="";f.style.cssText="";e.borderWidth=(n.offsetWidth-o)/3;e.tabcellSpace=e.paddingSpace+e.borderWidth;t.body.removeChild(n)}return st=function(){return e.tabcellSpace},e.tabcellSpace}function si(n){b||(c=n.document.createElement("div"),domUtils.setAttributes(c,{id:"ue_tableDragLine",unselectable:"on",contenteditable:!1,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"}),n.body.appendChild(c))}function k(n){if(!b)for(var t;t=n.document.getElementById("ue_tableDragLine");)domUtils.remove(t)}function hi(n,t){if(t){var i=domUtils.findParentByTagName(t,"table"),r=i.getElementsByTagName("caption"),o=i.offsetWidth,s=i.offsetHeight-(r.length>0?r[0].offsetHeight:0),f=domUtils.getXY(i),e=domUtils.getXY(t),u;switch(n){case"h":u="height:"+s+"px;top:"+(f.y+(r.length>0?r[0].offsetHeight:0))+"px;left:"+(e.x+t.offsetWidth);c.style.cssText=u+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":u="width:"+o+"px;left:"+f.x+"px;top:"+(e.y+t.offsetHeight);c.style.cssText=u+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)"}}}function kt(n,t){for(var r,f=domUtils.getElementsByTagName(n.body,"table"),u,e=0,i;i=f[e++];)r=domUtils.getElementsByTagName(i,"td"),r[0]&&(t?(u=r[0].style.borderColor.replace(/\s/g,""),/(#ffffff)|(rgb\(255,255,255\))/ig.test(u)&&domUtils.addClass(i,"noBorderTable")):domUtils.removeClasses(i,"noBorderTable"))}function hr(n,t,i){var r=n.body;return r.offsetWidth-(t?parseInt(domUtils.getComputedStyle(r,"margin-left"),10)*2:0)-i.tableBorder*2-(n.options.offsetWidth||0)}function ci(n,t){var i=domUtils.findParentByTagName(t.target||t.srcElement,["td","th"],!0),u=null,f,r,e;return i?(u=nt(i,y(t)),!i)?null:(u==="h1"&&i.previousSibling?(r=domUtils.getXY(i),f=i.offsetWidth,Math.abs(r.x+f-t.clientX)>f/3&&(i=i.previousSibling)):u==="v1"&&i.parentNode.previousSibling&&(r=domUtils.getXY(i),e=i.offsetHeight,Math.abs(r.y+e-t.clientY)>e/3&&(i=i.parentNode.previousSibling.firstChild)),i&&!(n.fireEvent("excludetable",i)===!0)?i:null):null}var t=this,ht=null,tt=null,li=null,ct=5,d=!1,w=5,dt=10,s=0,it=null,gt=360,e=UE.UETable,o=function(n){return e.getUETable(n)},h=function(n){return e.getUETableBySelected(n)},lt=function(n,t){return e.getDefaultValue(n,t)},rt=function(n){return e.removeSelectedClass(n)},ni,vi;t.ready(function(){var t=this,i=t.selection.getText;t.selection.getText=function(){var u=h(t),r;return u?(r="",utils.each(u.selectedTds,function(t){r+=t[n.ie?"innerText":"textContent"]}),r):i.call(t.selection)}});var i=null,a=null,v="",vt=!1,f=null,ft=!1,c=null,l=null,b=!1,yt=!0;t.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:t.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:!1,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]});t.getUETable=o;ni={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};t.ready(function(){var i,s,c,a,r,l;utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}table{margin-bottom:10px;border-collapse:collapse;display:table;}td,th{padding: 5px 10px;border: 1px solid #DDD;}caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}th{border-top:1px solid #BBB;background-color:#F7F7F7;}table tr.firstRow th{border-top-width:2px;}.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }td p{margin:0;padding:0;}",t.document);t.addListener("keydown",function(n,t){var r=this,p=t.keyCode||t.which,w,o,f,e,v,u,y,l,a;if(p==8&&(u=h(r),u&&u.selectedTds.length&&(u.isFullCol()?r.execCommand("deletecol"):u.isFullRow()?r.execCommand("deleterow"):r.fireEvent("delcells"),domUtils.preventDefault(t)),f=domUtils.findParentByTagName(r.selection.getStart(),"caption",!0),w=r.selection.getRange(),w.collapsed&&f&&et(f)&&(r.fireEvent("saveScene"),e=f.parentNode,domUtils.remove(f),e&&w.setStart(e.rows[0].cells[0],0).setCursor(!1,!0),r.fireEvent("saveScene"))),p==46&&(u=h(r),u)){for(r.fireEvent("saveScene"),l=0;a=u.selectedTds[l++];)domUtils.fillNode(r.document,a);r.fireEvent("saveScene");domUtils.preventDefault(t)}if(p==13){if(o=r.selection.getRange(),f=domUtils.findParentByTagName(o.startContainer,"caption",!0),f){e=domUtils.findParentByTagName(f,"table");o.collapsed?f&&o.setStart(e.rows[0].cells[0],0).setCursor(!1,!0):(o.deleteContents(),r.fireEvent("saveScene"));domUtils.preventDefault(t);return}if(o.collapsed&&(e=domUtils.findParentByTagName(o.startContainer,"table"),e)){var d=e.rows[0].cells[0],k=domUtils.findParentByTagName(r.selection.getStart(),["td","th"],!0),b=e.previousSibling;d===k&&(!b||b.nodeType==1&&b.tagName=="TABLE")&&domUtils.isStartInblock(o)&&(v=domUtils.findParent(r.selection.getStart(),function(n){return domUtils.isBlockElm(n)},!0),v&&(/t(h|d)/i.test(v.tagName)||v===k.firstChild)&&(r.execCommand("insertparagraphbeforetable"),domUtils.preventDefault(t)))}}if((t.ctrlKey||t.metaKey)&&t.keyCode=="67"&&(i=null,u=h(r),u))for(y=u.selectedTds,s=u.isFullCol(),c=u.isFullRow(),i=[[u.cloneCell(y[0],null,!0)]],l=1;a=y[l];l++)a.parentNode!==y[l-1].parentNode?i.push([u.cloneCell(a,null,!0)]):i[i.length-1].push(u.cloneCell(a,null,!0))});t.addListener("tablehasdeleted",function(){p(this,!1,"",null);f&&domUtils.remove(f)});t.addListener("beforepaste",function(t,r){var a=this,it=a.selection.getRange(),g,l,nt,ot,y,rt,b,ut,k,tt,p,v,d,f,u,st,ht,w,ft;if(domUtils.findParentByTagName(it.startContainer,"caption",!0)){w=a.document.createElement("div");w.innerHTML=r.html;r.html=w[n.ie9below?"innerText":"textContent"];return}if(g=h(a),i){if(a.fireEvent("saveScene"),it=a.selection.getRange(),l=domUtils.findParentByTagName(it.startContainer,["td","th"],!0),l){if(y=o(l),c)for(rt=y.getCellInfo(l).rowIndex,l.tagName=="TH"&&rt++,p=0;v=i[p++];){for(d=y.insertRow(rt++,"td"),f=0;u=v[f];f++)b=d.cells[f],b||(b=d.insertCell(f)),b.innerHTML=u.innerHTML,u.getAttribute("width")&&b.setAttribute("width",u.getAttribute("width")),u.getAttribute("vAlign")&&b.setAttribute("vAlign",u.getAttribute("vAlign")),u.getAttribute("align")&&b.setAttribute("align",u.getAttribute("align")),u.style.cssText&&(b.style.cssText=u.style.cssText);for(f=0;u=d.cells[f];f++){if(!v[f])break;u.innerHTML=v[f].innerHTML;v[f].getAttribute("width")&&u.setAttribute("width",v[f].getAttribute("width"));v[f].getAttribute("vAlign")&&u.setAttribute("vAlign",v[f].getAttribute("vAlign"));v[f].getAttribute("align")&&u.setAttribute("align",v[f].getAttribute("align"));v[f].style.cssText&&(u.style.cssText=v[f].style.cssText)}}else{if(s){for(tt=y.getCellInfo(l),ut=0,f=0,v=i[0];u=v[f++];)ut+=u.colSpan||1;for(a.__hasEnterExecCommand=!0,p=0;p<ut;p++)a.execCommand("insertcol");a.__hasEnterExecCommand=!1;l=y.table.rows[0].cells[tt.cellIndex];l.tagName=="TH"&&(l=y.table.rows[1].cells[tt.cellIndex])}for(p=0;v=i[p++];){for(nt=l,f=0;u=v[f++];)l?(l.innerHTML=u.innerHTML,u.getAttribute("width")&&l.setAttribute("width",u.getAttribute("width")),u.getAttribute("vAlign")&&l.setAttribute("vAlign",u.getAttribute("vAlign")),u.getAttribute("align")&&l.setAttribute("align",u.getAttribute("align")),u.style.cssText&&(l.style.cssText=u.style.cssText),ot=l,l=l.nextSibling):(k=u.cloneNode(!0),domUtils.removeAttributes(k,["class","rowSpan","colSpan"]),ot.parentNode.appendChild(k));if(l=y.getNextCell(nt,!0,!0),!i[p])break;l||(tt=y.getCellInfo(nt),y.table.insertRow(y.table.rows.length),y.update(),l=y.getVSideCell(nt,!0))}}y.update()}else{for(g=a.document.createElement("table"),p=0;v=i[p++];){for(d=g.insertRow(g.rows.length),f=0;u=v[f++];)k=e.cloneCell(u,null,!0),domUtils.removeAttributes(k,["class"]),d.appendChild(k);f==2&&k.rowSpan>1&&(k.rowSpan=1)}st=lt(a);ht=a.body.offsetWidth-(yt?parseInt(domUtils.getComputedStyle(a.body,"margin-left"),10)*2:0)-st.tableBorder*2-(a.options.offsetWidth||0);a.execCommand("insertHTML","<table  "+(s&&c?'width="'+ht+'"':"")+">"+g.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"<\/table>")}return a.fireEvent("contentchange"),a.fireEvent("saveScene"),r.html="",!0}w=a.document.createElement("div");w.innerHTML=r.html;ft=w.getElementsByTagName("table");domUtils.findParentByTagName(a.selection.getStart(),"table")?(utils.each(ft,function(n){domUtils.remove(n)}),domUtils.findParentByTagName(a.selection.getStart(),"caption",!0)&&(w.innerHTML=w[n.ie?"innerText":"textContent"])):utils.each(ft,function(n){ti(n,!0);domUtils.removeAttributes(n,["style","border"]);utils.each(domUtils.getElementsByTagName(n,"td"),function(n){et(n)&&domUtils.fillNode(a.document,n);ti(n,!0)})});r.html=w.innerHTML});t.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(t.body,"table"),function(n){if(n.offsetWidth>t.body.offsetWidth){var i=lt(t,n);n.style.width=t.body.offsetWidth-(yt?parseInt(domUtils.getComputedStyle(t.body,"margin-left"),10)*2:0)-i.tableBorder*2-(t.options.offsetWidth||0)+"px"}})});t.addListener("blur",function(){i=null});t.addListener("keydown",function(){clearTimeout(a);a=setTimeout(function(){var r=t.selection.getRange(),n=domUtils.findParentByTagName(r.startContainer,["th","td"],!0),i;n&&(i=n.parentNode.parentNode.parentNode,i.offsetWidth>i.getAttribute("width")&&(n.style.wordBreak="break-all"))},100)});t.addListener("selectionchange",function(){p(t,!1,"",null)});t.addListener("contentchange",function(){var n=this,i,t;(k(n),h(n))||(i=n.selection.getRange(),t=i.startContainer,t=domUtils.findParentByTagName(t,["td","th"],!0),utils.each(domUtils.getElementsByTagName(n.document,"table"),function(t){n.fireEvent("excludetable",t)!==!0&&(t.ueTable=new e(t),t.onmouseover=function(){n.fireEvent("tablemouseover",t)},t.onmousemove=function(){n.fireEvent("tablemousemove",t);n.options.tableDragable&&ri(!0,this,n);utils.defer(function(){n.fireEvent("contentchange",50)},!0)},t.onmouseout=function(){n.fireEvent("tablemouseout",t);p(n,!1,"",null);k(n)},t.onclick=function(t){var r,e,s;if(t=n.window.event||t,r=pt(t.target||t.srcElement),r){var i=o(r),c=i.table,h=i.getCellInfo(r),u,f=n.selection.getRange();if(g(c,r,t,!0)){e=i.getCell(i.indexTable[i.rowsNum-1][h.colIndex].rowIndex,i.indexTable[i.rowsNum-1][h.colIndex].cellIndex);t.shiftKey&&i.selectedTds.length?i.selectedTds[0]!==e?(u=i.getCellsRange(i.selectedTds[0],e),i.setSelected(u)):f&&f.selectNodeContents(e).select():r!==e?(u=i.getCellsRange(r,e),i.setSelected(u)):f&&f.selectNodeContents(e).select();return}g(c,r,t)&&(s=i.getCell(i.indexTable[h.rowIndex][i.colsNum-1].rowIndex,i.indexTable[h.rowIndex][i.colsNum-1].cellIndex),t.shiftKey&&i.selectedTds.length?i.selectedTds[0]!==s?(u=i.getCellsRange(i.selectedTds[0],s),i.setSelected(u)):f&&f.selectNodeContents(s).select():r!==s?(u=i.getCellsRange(r,s),i.setSelected(u)):f&&f.selectNodeContents(s).select())}})}),kt(n,!0))});domUtils.on(t.document,"mousemove",ai);domUtils.on(t.document,"mouseout",function(n){var i=n.target||n.srcElement;i.tagName=="TABLE"&&p(t,!1,"",null)});t.addListener("interlacetable",function(n,t,i){var r;if(t){var f=this,u=t.rows,e=u.length,o=function(n,t,i){return n[t]?n[t]:i?n[t%n.length]:""};for(r=0;r<e;r++)u[r].className=o(i||f.options.classList,r,!0)}});t.addListener("uninterlacetable",function(n,t){var i;if(t){var u=this,r=t.rows,f=u.options.classList,e=r.length;for(i=0;i<e;i++)domUtils.removeClasses(r[i],f)}});t.addListener("mousedown",di);t.addListener("mouseup",fi);domUtils.on(t.body,"dragstart",function(n){fi.call(t,"dragstart",n)});t.addOutputRule(function(n){utils.each(n.getNodesByTagName("div"),function(n){n.getAttr("id")=="ue_tableDragLine"&&n.parentNode.removeChild(n)})});r=0;t.addListener("mousedown",function(){r=0});t.addListener("tabkeydown",function(){var i=this.selection.getRange(),e=i.getCommonAncestor(!0,!0),f=domUtils.findParentByTagName(e,"table"),n,s,u;if(f)return domUtils.findParentByTagName(e,"caption",!0)?(n=domUtils.getElementsByTagName(f,"th td"),n&&n.length&&i.setStart(n[0],0).setCursor(!1,!0)):(n=domUtils.findParentByTagName(e,["td","th"],!0),s=o(n),r=n.rowSpan>1?r:s.getCellInfo(n).rowIndex,u=s.getTabNextCell(n,r),u?et(u)?i.setStart(u,0).setCursor(!1,!0):i.selectNodeContents(u).select():(t.fireEvent("saveScene"),t.__hasEnterExecCommand=!0,this.execCommand("insertrownext"),t.__hasEnterExecCommand=!1,i=this.selection.getRange(),i.setStart(f.rows[f.rows.length-1].cells[0],0).setCursor(),t.fireEvent("saveScene"))),!0});n.ie&&t.addListener("selectionchange",function(){p(this,!1,"",null)});t.addListener("keydown",function(n,t){var u=this,f=t.keyCode||t.which,i,r;f!=8&&f!=46&&(i=!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey,i&&rt(domUtils.getElementsByTagName(u.body,"td")),r=h(u),r)&&i&&r.clearSelected()});t.addListener("beforegetcontent",function(){kt(this,!1);n.ie&&utils.each(this.document.getElementsByTagName("caption"),function(n){domUtils.isEmptyNode(n)&&(n.innerHTML="&nbsp;")})});t.addListener("aftergetcontent",function(){kt(this,!0)});t.addListener("getAllHtml",function(){rt(t.document.getElementsByTagName("td"))});t.addListener("fullscreenchanged",function(n,i){if(!i){var r=this.body.offsetWidth/document.body.offsetWidth,u=domUtils.getElementsByTagName(this.body,"table");utils.each(u,function(n){var u,f,i,e;if(n.offsetWidth<t.body.offsetWidth)return!1;for(u=domUtils.getElementsByTagName(n,"td"),f=[],utils.each(u,function(n){f.push(n.offsetWidth)}),i=0;e=u[i];i++)e.setAttribute("width",Math.floor(f[i]*r));n.setAttribute("width",Math.floor(hr(t,yt,lt(t))))})}});l=t.execCommand;t.execCommand=function(n){var t=this,w=arguments,o,s,p,c,a,i;n=n.toLowerCase();var v=h(t),r,f=new u.Range(t.document),y=t.commands[n]||UE.commands[n],e;if(y){if(!v||ni[n]||y.notNeedUndo||t.__hasEnterExecCommand)e=l.apply(t,arguments);else{for(t.__hasEnterExecCommand=!0,t.fireEvent("beforeexeccommand",n),r=v.selectedTds,o=-2,s=-2,a=0;i=r[a];a++)et(i)?f.setStart(i,0).setCursor(!1,!0):f.selectNode(i).select(!0),c=t.queryCommandState(n),p=t.queryCommandValue(n),c!=-1&&((o!==c||s!==p)&&(t._ignoreContentChange=!0,e=l.apply(t,arguments),t._ignoreContentChange=!1),o=t.queryCommandState(n),s=t.queryCommandValue(n),domUtils.isEmptyBlock(i)&&domUtils.fillNode(t.document,i));f.setStart(r[0],0).shrinkBoundary(!0).setCursor(!1,!0);t.fireEvent("contentchange");t.fireEvent("afterexeccommand",n);t.__hasEnterExecCommand=!1;t._selectionChange()}return e}}})};UE.UETable.prototype.sortTable=function(t,i){var h=this.table,o=h.rows,u=[],y=o[0].cells[0].tagName==="TH",a=0,f,r,s,c,l,e,v;if(this.selectedTds.length){for(f=this.cellsRange,e=f.endRowIndex+1,r=f.beginRowIndex;r<e;r++)u[r]=o[r];u.splice(0,f.beginRowIndex);a=f.endRowIndex+1===this.rowsNum?0:f.endRowIndex+1}else for(r=0,e=o.length;r<e;r++)u[r]=o[r];for(s={reversecurrent:function(){return 1},orderbyasc:function(n,t){var i=n.innerText||n.textContent,r=t.innerText||t.textContent;return i.localeCompare(r)},reversebyasc:function(n,t){var i=n.innerHTML,r=t.innerHTML;return r.localeCompare(i)},orderbynum:function(t,i){var r=t[n.ie?"innerText":"textContent"].match(/\d+/),u=i[n.ie?"innerText":"textContent"].match(/\d+/);return r&&(r=+r[0]),u&&(u=+u[0]),(r||0)-(u||0)},reversebynum:function(t,i){var r=t[n.ie?"innerText":"textContent"].match(/\d+/),u=i[n.ie?"innerText":"textContent"].match(/\d+/);return r&&(r=+r[0]),u&&(u=+u[0]),(u||0)-(r||0)}},h.setAttribute("data-sort-type",i&&typeof i=="string"&&s[i]?i:""),y&&u.splice(0,1),u=utils.sort(u,function(n,r){return i&&typeof i=="function"?i.call(this,n.cells[t],r.cells[t]):i&&typeof i=="number"?1:i&&typeof i=="string"&&s[i]?s[i].call(this,n.cells[t],r.cells[t]):s.orderbyasc.call(this,n.cells[t],r.cells[t])}),c=h.ownerDocument.createDocumentFragment(),l=0,e=u.length;l<e;l++)c.appendChild(u[l]);v=h.getElementsByTagName("tbody")[0];a?v.insertBefore(c,o[a-f.endRowIndex+f.beginRowIndex-1]):v.appendChild(c)};UE.plugins.tablesort=function(){var n=this,i=UE.UETable,r=function(n){return i.getUETable(n)},t=function(n){return i.getTableItemsByRange(n)};n.ready(function(){utils.cssRule("tablesort","table.sortEnabled tr.firstRow th,table.sortEnabled tr.firstRow td{padding-right:20px;background-repeat: no-repeat;background-position: center right;   background-image:url("+n.options.themePath+n.options.theme+"/images/sortable.png);}",n.document);n.addListener("afterexeccommand",function(n,t){(t=="mergeright"||t=="mergedown"||t=="mergecells")&&this.execCommand("disablesort")})});UE.commands.sorttable={queryCommandState:function(){var e=this,i=t(e),r,u,f,n;if(!i.cell)return-1;for(r=i.table,u=r.getElementsByTagName("td"),f=0;n=u[f++];)if(n.rowSpan!=1||n.colSpan!=1)return-1;return 0},execCommand:function(n,i){var f=this,u=f.selection.getRange(),s=u.createBookmark(!0),e=t(f),h=e.cell,o=r(e.table),c=o.getCellInfo(h);o.sortTable(c.cellIndex,i);u.moveToBookmark(s);try{u.select()}catch(l){}}};UE.commands.enablesort=UE.commands.disablesort={queryCommandState:function(n){var r=t(this).table,u,i;if(r&&n=="enablesort")for(u=domUtils.getElementsByTagName(r,"th td"),i=0;i<u.length;i++)if(u[i].getAttribute("colspan")>1||u[i].getAttribute("rowspan")>1)return-1;return r?n=="enablesort"^r.getAttribute("data-sort")!="sortEnabled"?-1:0:-1},execCommand:function(n){var i=t(this).table;i.setAttribute("data-sort",n=="enablesort"?"sortEnabled":"sortDisabled");n=="enablesort"?domUtils.addClass(i,"sortEnabled"):domUtils.removeClasses(i,"sortEnabled")}}};UE.plugins.contextmenu=function(){var i=this,t,r,f,e;(i.setOpt("enableContextMenu",!0),i.getOpt("enableContextMenu")!==!1)&&(t=i.getLang("contextMenu"),f=i.options.contextMenu||[{label:t.selectall,cmdName:"selectall"},{label:t.cleardoc,cmdName:"cleardoc",exec:function(){confirm(t.confirmclear)&&this.execCommand("cleardoc")}},"-",{label:t.unlink,cmdName:"unlink"},"-",{group:t.paragraph,icon:"justifyjustify",subMenu:[{label:t.justifyleft,cmdName:"justify",value:"left"},{label:t.justifyright,cmdName:"justify",value:"right"},{label:t.justifycenter,cmdName:"justify",value:"center"},{label:t.justifyjustify,cmdName:"justify",value:"justify"}]},"-",{group:t.table,icon:"table",subMenu:[{label:t.inserttable,cmdName:"inserttable"},{label:t.deletetable,cmdName:"deletetable"},"-",{label:t.deleterow,cmdName:"deleterow"},{label:t.deletecol,cmdName:"deletecol"},{label:t.insertcol,cmdName:"insertcol"},{label:t.insertcolnext,cmdName:"insertcolnext"},{label:t.insertrow,cmdName:"insertrow"},{label:t.insertrownext,cmdName:"insertrownext"},"-",{label:t.insertcaption,cmdName:"insertcaption"},{label:t.deletecaption,cmdName:"deletecaption"},{label:t.inserttitle,cmdName:"inserttitle"},{label:t.deletetitle,cmdName:"deletetitle"},{label:t.inserttitlecol,cmdName:"inserttitlecol"},{label:t.deletetitlecol,cmdName:"deletetitlecol"},"-",{label:t.mergecells,cmdName:"mergecells"},{label:t.mergeright,cmdName:"mergeright"},{label:t.mergedown,cmdName:"mergedown"},"-",{label:t.splittorows,cmdName:"splittorows"},{label:t.splittocols,cmdName:"splittocols"},{label:t.splittocells,cmdName:"splittocells"},"-",{label:t.averageDiseRow,cmdName:"averagedistributerow"},{label:t.averageDisCol,cmdName:"averagedistributecol"},"-",{label:t.edittd,cmdName:"edittd",exec:function(){UE.ui.edittd&&new UE.ui.edittd(this);this.getDialog("edittd").open()}},{label:t.edittable,cmdName:"edittable",exec:function(){UE.ui.edittable&&new UE.ui.edittable(this);this.getDialog("edittable").open()}},{label:t.setbordervisible,cmdName:"setbordervisible"}]},{group:t.tablesort,icon:"tablesort",subMenu:[{label:t.enablesort,cmdName:"enablesort"},{label:t.disablesort,cmdName:"disablesort"},"-",{label:t.reversecurrent,cmdName:"sorttable",value:"reversecurrent"},{label:t.orderbyasc,cmdName:"sorttable",value:"orderbyasc"},{label:t.reversebyasc,cmdName:"sorttable",value:"reversebyasc"},{label:t.orderbynum,cmdName:"sorttable",value:"orderbynum"},{label:t.reversebynum,cmdName:"sorttable",value:"reversebynum"}]},{group:t.borderbk,icon:"borderBack",subMenu:[{label:t.setcolor,cmdName:"interlacetable",exec:function(){this.execCommand("interlacetable")}},{label:t.unsetcolor,cmdName:"uninterlacetable",exec:function(){this.execCommand("uninterlacetable")}},{label:t.setbackground,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["#bbb","#ccc"]})}},{label:t.unsetbackground,cmdName:"cleartablebackground",exec:function(){this.execCommand("cleartablebackground")}},{label:t.redandblue,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["red","blue"]})}},{label:t.threecolorgradient,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["#aaa","#bbb","#ccc"]})}}]},{group:t.aligntd,icon:"aligntd",subMenu:[{cmdName:"cellalignment",value:{align:"left",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"bottom"}}]},{group:t.aligntable,icon:"aligntable",subMenu:[{cmdName:"tablealignment",className:"left",label:t.tableleft,value:"left"},{cmdName:"tablealignment",className:"center",label:t.tablecenter,value:"center"},{cmdName:"tablealignment",className:"right",label:t.tableright,value:"right"}]},"-",{label:t.insertparagraphbefore,cmdName:"insertparagraph",value:!0},{label:t.insertparagraphafter,cmdName:"insertparagraph"},{label:t.copy,cmdName:"copy"},{label:t.paste,cmdName:"paste"}],f.length)&&(e=UE.ui.uiUtils,i.addListener("contextmenu",function(o,s){var p=e.getViewportOffsetByEvent(s),l,v,h,c,a,y;for(i.fireEvent("beforeselectionchange"),r&&r.destroy(),l=0,h=[];v=f[l];l++)(function(n){if(n=="-")(c=h[h.length-1])&&c!=="-"&&h.push("-");else if(n.hasOwnProperty("group")){for(var u=0,f,r=[];f=n.subMenu[u];u++)(function(n){n=="-"?(c=r[r.length-1])&&c!=="-"?r.push("-"):r.splice(r.length-1):(i.commands[n.cmdName]||UE.commands[n.cmdName]||n.query)&&(n.query?n.query():i.queryCommandState(n.cmdName))>-1&&r.push({label:n.label||i.getLang("contextMenu."+n.cmdName+(n.value||""))||"",className:"edui-for-"+n.cmdName+(n.className?" edui-for-"+n.cmdName+"-"+n.className:""),onclick:n.exec?function(){n.exec.call(i)}:function(){i.execCommand(n.cmdName,n.value)}})})(f);if(r.length){function e(){switch(n.icon){case"table":return i.getLang("contextMenu.table");case"justifyjustify":return i.getLang("contextMenu.paragraph");case"aligntd":return i.getLang("contextMenu.aligntd");case"aligntable":return i.getLang("contextMenu.aligntable");case"tablesort":return t.tablesort;case"borderBack":return t.borderbk;default:return""}}h.push({label:e(),className:"edui-for-"+n.icon,subMenu:{items:r,editor:i}})}}else(i.commands[n.cmdName]||UE.commands[n.cmdName]||n.query)&&(n.query?n.query.call(i):i.queryCommandState(n.cmdName))>-1&&h.push({label:n.label||i.getLang("contextMenu."+n.cmdName),className:"edui-for-"+(n.icon?n.icon:n.cmdName+(n.value||"")),onclick:n.exec?function(){n.exec.call(i)}:function(){i.execCommand(n.cmdName,n.value)}})})(v);if(h[h.length-1]=="-"&&h.pop(),r=new UE.ui.Menu({items:h,className:"edui-contextmenu",editor:i}),r.render(),r.showAt(p),i.fireEvent("aftershowcontextmenu",r),domUtils.preventDefault(s),n.ie){try{a=i.selection.getNative().createRange()}catch(w){return}a.item&&(y=new u.Range(i.document),y.selectNode(a.item(0)).select(!0,!0))}}),i.addListener("aftershowcontextmenu",function(n,t){var r,u;if(i.zeroclipboard){r=t.items;for(u in r)r[u].className=="edui-for-copy"&&i.zeroclipboard.clip(r[u].getDom())}}))};UE.plugins.shortcutmenu=function(){var r=this,i,f=r.options.shortcutMenu||[];f.length&&(r.addListener("contextmenu mouseup",function(r,e){var o=this,c={type:r,target:e.target||e.srcElement,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY},s,h;if(setTimeout(function(){var n=o.selection.getRange();(n.collapsed===!1||r=="contextmenu")&&(i||(i=new t.editor.ui.ShortCutMenu({editor:o,items:f,theme:o.options.theme,className:"edui-shortcutmenu"}),i.render(),o.fireEvent("afterrendershortcutmenu",i)),i.show(c,!!UE.plugins.contextmenu))}),r=="contextmenu"&&(domUtils.preventDefault(e),n.ie9below)){try{s=o.selection.getNative().createRange()}catch(e){return}s.item&&(h=new u.Range(o.document),h.selectNode(s.item(0)).select(!0,!0))}}),r.addListener("keydown",function(n){n=="keydown"&&i&&!i.isHidden&&i.hide()}))};UE.plugins.basestyle=function(){var i={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},r=function(n,t){return domUtils.filterNodeList(n.selection.getStartElementPath(),t)},n=this,t;n.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"});n.addInputRule(function(n){utils.each(n.getNodesByTagName("b i"),function(n){switch(n.tagName){case"b":n.tagName="strong";break;case"i":n.tagName="em"}})});for(t in i)(function(t,i){n.commands[t]={execCommand:function(t){var u=n.selection.getRange(),e=r(this,i),f,o;u.collapsed?(e?(f=n.document.createTextNode(""),u.insertNode(f).removeInlineStyle(i),u.setStartBefore(f),domUtils.remove(f)):(o=u.document.createElement(i[0]),(t=="superscript"||t=="subscript")&&(f=n.document.createTextNode(""),u.insertNode(f).removeInlineStyle(["sub","sup"]).setStartBefore(f).collapse(!0)),u.insertNode(o).setStart(o,0)),u.collapse(!0)):((t=="superscript"||t=="subscript")&&(e&&e.tagName.toLowerCase()==t||u.removeInlineStyle(["sub","sup"])),e?u.removeInlineStyle(i):u.applyInlineStyle(i[0]));u.select()},queryCommandState:function(){return r(this,i)?1:0}}})(t,i[t])};UE.plugins.elementpath=function(){var t,i,n=this;(n.setOpt("elementPathEnabled",!0),n.options.elementPathEnabled)&&(n.commands.elementpath={execCommand:function(r,u){var f=i[u],e=n.selection.getRange();t=u*1;e.selectNode(f).select()},queryCommandValue:function(){var f=[].concat(this.selection.getStartElementPath()).reverse(),e=[],n,r,u;for(i=f,n=0;r=f[n];n++)if(r.nodeType!=3&&(u=r.tagName.toLowerCase(),u=="img"&&r.getAttribute("anchorname")&&(u="anchor"),e[n]=u,t==n)){t=-1;break}return e}})};UE.plugins.formatmatch=function(){function f(e,o){function y(n){return h&&n.selectNode(h),n.applyInlineStyle(i[i.length-1].tagName,null,i)}var l,s,c,a,h,v;n.webkit&&(l=o.target.tagName=="IMG"?o.target:null);t.undoManger&&t.undoManger.save();s=t.selection.getRange();c=l||s.getClosedNode();r&&c&&c.tagName=="IMG"?(c.style.cssText+=";float:"+(r.style.cssFloat||r.style.styleFloat||"none")+";display:"+(r.style.display||"inline"),r=null):r||(a=s.collapsed,a&&(h=t.document.createTextNode("match"),s.insertNode(h).select()),t.__hasEnterExecCommand=!0,v=t.options.removeFormatAttributes,t.options.removeFormatAttributes="",t.execCommand("removeformat"),t.options.removeFormatAttributes=v,t.__hasEnterExecCommand=!1,s=t.selection.getRange(),i.length&&y(s),h&&s.setStartBefore(h).collapse(!0),s.select(),h&&domUtils.remove(h));t.undoManger&&t.undoManger.save();t.removeListener("mouseup",f);u=0}var t=this,i=[],r,u=0;t.addListener("reset",function(){i=[];u=0});t.commands.formatmatch={execCommand:function(){var n,o,e,s;if(u){u=0;i=[];t.removeListener("mouseup",f);return}if(n=t.selection.getRange(),r=n.getClosedNode(),!r||r.tagName!="IMG")for(n.collapse(!0).shrinkBoundary(),o=n.startContainer,i=domUtils.findParents(o,!0,function(n){return!domUtils.isBlockElm(n)&&n.nodeType==1}),e=0;s=i[e];e++)if(s.tagName=="A"){i.splice(e,1);break}t.addListener("mouseup",f);u=1},queryCommandState:function(){return u},notNeedUndo:1}};UE.plugin.register("searchreplace",function(){function o(n,t,i){var u=t.searchStr,f,r;for(t.dir==-1&&(n=n.split("").reverse().join(""),u=u.split("").reverse().join(""),i=n.length-i),f=new RegExp(u,"g"+(t.casesensitive?"":"i"));r=f.exec(n);)if(r.index>=i)return t.dir==-1?n.length-r.index-t.searchStr.length:r.index;return-1}function s(t,i,r){var f,u,s=r.all||r.dir==1?"getNextDomNode":"getPreDomNode",h;for(domUtils.isBody(t)&&(t=t.firstChild),h=1;t;){if(f=t.nodeType==3?t.nodeValue:t[n.ie?"innerText":"textContent"],u=o(f,r,i),h=0,u!=-1)return{node:t,index:u};for(t=domUtils[s](t);t&&e[t.nodeName.toLowerCase()];)t=domUtils[s](t,!0);t&&(i=r.dir==-1?(t.nodeType==3?t.nodeValue:t[n.ie?"innerText":"textContent"]).length:0)}}function i(t,u,f){for(var o=0,e=t.firstChild,s=0,h;e;){if(e.nodeType==3){if(s=e.nodeValue.replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,o+=s,o>=u)return{node:e,index:s-(o-u)}}else if(!r.$empty[e.tagName]&&(s=e[n.ie?"innerText":"textContent"].replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,o+=s,o>=u&&(h=i(e,s-(o-u),f),h)))return h;e=domUtils.getNextDomNode(e)}}function u(t,r){var u=t.selection.getRange(),h,c=r.searchStr,o=t.document.createElement("span"),v,y,e,l,a;if(o.innerHTML="$$ueditor_searchreplace_key$$",u.shrinkBoundary(!0),!u.collapsed&&(u.select(),v=t.selection.getText(),new RegExp("^"+r.searchStr+"$",r.casesensitive?"":"i").test(v))){if(r.replaceStr!=undefined)return f(u,r.replaceStr),u.select(),!0;u.collapse(r.dir==-1)}if(u.insertNode(o),u.enlargeToBlockElm(!0),h=u.startContainer,y=h[n.ie?"innerText":"textContent"].indexOf("$$ueditor_searchreplace_key$$"),u.setStartBefore(o),domUtils.remove(o),e=s(h,y,r),e)return l=i(e.node,e.index,c),a=i(e.node,e.index+c.length,c),u.setStart(l.node,l.index).setEnd(a.node,a.index),r.replaceStr!==undefined&&f(u,r.replaceStr),u.select(),!0;u.setCursor()}function f(n,i){i=t.document.createTextNode(i);n.deleteContents().insertNode(i)}var t=this,e={table:1,tbody:1,tr:1,ol:1,ul:1};return{commands:{searchreplace:{execCommand:function(n,i){var r,e,f;if(utils.extend(i,{all:!1,casesensitive:!1,dir:1},!0),r=0,i.all){for(e=t.selection.getRange(),f=t.body.firstChild,f&&f.nodeType==1?(e.setStart(f,0),e.shrinkBoundary(!0)):f.nodeType==3&&e.setStartBefore(f),e.collapse(!0).select(!0),i.replaceStr!==undefined&&t.fireEvent("saveScene");u(this,i);)r++;r&&t.fireEvent("saveScene")}else i.replaceStr!==undefined&&t.fireEvent("saveScene"),u(this,i)&&r++,r&&t.fireEvent("saveScene");return r},notNeedUndo:1}}}});UE.plugins.customstyle=function(){var n=this;n.setOpt({customstyle:[{tag:"h1",name:"tc",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;"},{tag:"h1",name:"tl",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;"},{tag:"span",name:"im",style:"font-size:16px;font-style:italic;font-weight:bold;line-height:18px;"},{tag:"span",name:"hi",style:"font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;"}]});n.commands.customstyle={execCommand:function(n,t){var f=this,s=t.tag,i=domUtils.findParent(f.selection.getStart(),function(n){return n.getAttribute("label")},!0),u,e,c={},a,l,y,b,o,p,w,h,v;for(a in t)t[a]!==undefined&&(c[a]=t[a]);if(delete c.tag,i&&i.getAttribute("label")==t.label){if(u=this.selection.getRange(),e=u.createBookmark(),u.collapsed)r.$block[i.tagName]?(h=f.document.createElement("p"),domUtils.moveChild(i,h),i.parentNode.insertBefore(h,i),domUtils.remove(i)):domUtils.remove(i,!0);else{for(l=domUtils.getCommonAncestor(e.start,e.end),y=domUtils.getElementsByTagName(l,s),new RegExp(s,"i").test(l.tagName)&&y.push(l),b=0;o=y[b++];)o.getAttribute("label")==t.label&&(p=domUtils.getPosition(o,e.start),w=domUtils.getPosition(o,e.end),(p&domUtils.POSITION_FOLLOWING||p&domUtils.POSITION_CONTAINS)&&(w&domUtils.POSITION_PRECEDING||w&domUtils.POSITION_CONTAINS)&&r.$block[s]&&(h=f.document.createElement("p"),domUtils.moveChild(o,h),o.parentNode.insertBefore(h,o)),domUtils.remove(o,!0));i=domUtils.findParent(l,function(n){return n.getAttribute("label")==t.label},!0);i&&domUtils.remove(i,!0)}u.moveToBookmark(e).select()}else if(r.$block[s])this.execCommand("paragraph",s,c,"customstyle"),u=f.selection.getRange(),u.collapsed||(u.collapse(),i=domUtils.findParent(f.selection.getStart(),function(n){return n.getAttribute("label")==t.label},!0),v=f.document.createElement("p"),domUtils.insertAfter(i,v),domUtils.fillNode(f.document,v),u.setStart(v,0).setCursor());else{if(u=f.selection.getRange(),u.collapsed){i=f.document.createElement(s);domUtils.setAttributes(i,c);u.insertNode(i).setStart(i,0).setCursor();return}e=u.createBookmark();u.applyInlineStyle(s,c).moveToBookmark(e).select()}},queryCommandValue:function(){var n=domUtils.filterNodeList(this.selection.getStartElementPath(),function(n){return n.getAttribute("label")});return n?n.getAttribute("label"):""}};n.addListener("keyup",function(t,i){var o=i.keyCode||i.which,e,u,f;(o==32||o==13)&&(e=n.selection.getRange(),e.collapsed&&(u=domUtils.findParent(n.selection.getStart(),function(n){return n.getAttribute("label")},!0),u&&r.$block[u.tagName]&&domUtils.isEmptyNode(u)&&(f=n.document.createElement("p"),domUtils.insertAfter(u,f),domUtils.fillNode(n.document,f),domUtils.remove(u),e.setStart(f,0).setCursor())))})};UE.plugins.catchremoteimage=function(){var me=this,n=UE.ajax;me.options.catchRemoteImageEnable!==!1&&(me.setOpt({catchRemoteImageEnable:!1}),me.addListener("afterpaste",function(){me.fireEvent("catchRemoteImage")}),me.addListener("catchRemoteImage",function(){function h(t,i){var o=utils.serializeParam(me.queryCommandValue("serverparam"))||"",r=utils.formatUrl(u+(u.indexOf("?")==-1?"?":"&")+o),s=utils.isCrossDomainUrl(r),f={method:"POST",dataType:s?"jsonp":"",timeout:6e4,onsuccess:i.success,onerror:i.error};f[e]=t;n.request(r,f)}for(var i,f=me.getOpt("catcherLocalDomain"),u=me.getActionUrl(me.getOpt("catcherActionName")),catcherUrlPrefix=me.getOpt("catcherUrlPrefix"),e=me.getOpt("catcherFieldName"),r=[],imgs=domUtils.getElementsByTagName(me.document,"img"),o=function(n,t){if(n.indexOf(location.host)!=-1||/(^\.)|(^\/)/.test(n))return!0;if(t)for(var r=0,i;i=t[r++];)if(n.indexOf(i)!==-1)return!0;return!1},s=0,t;t=imgs[s++];)t.getAttribute("word_img")||(i=t.getAttribute("_src")||t.src||"",/^(https?|ftp):/i.test(i)&&!o(i,f)&&r.push(i));r.length&&h(r,{success:function(r){var info,i,j,ci,cj,oldSrc,newSrc,list;try{info=r.state!==undefined?r:eval("("+r.responseText+")")}catch(e){return}for(list=info.list,i=0;ci=imgs[i++];)for(oldSrc=ci.getAttribute("_src")||ci.src||"",j=0;cj=list[j++];)if(oldSrc==cj.source&&cj.state=="SUCCESS"){newSrc=catcherUrlPrefix+cj.url;domUtils.setAttributes(ci,{src:newSrc,_src:newSrc});break}me.fireEvent("catchremotesuccess")},error:function(){me.fireEvent("catchremoteerror")}})}))};UE.plugin.register("snapscreen",function(){function i(t){var r,i=document.createElement("a"),u=utils.serializeParam(me.queryCommandValue("serverparam"))||"";return i.href=t,n.ie&&(i.href=i.href),r=i.search,u&&(r=r+(r.indexOf("?")==-1?"?":"&")+u,r=r.replace(/[&]+/ig,"&")),{port:i.port,hostname:i.hostname,path:i.pathname+r||+i.hash}}var me=this,t;return{commands:{snapscreen:{execCommand:function(){function o(rs){try{if(rs=eval("("+rs+")"),rs.state=="SUCCESS"){var opt=me.options;me.execCommand("insertimage",{src:opt.snapscreenUrlPrefix+rs.url,_src:opt.snapscreenUrlPrefix+rs.url,alt:rs.title||"",floatStyle:opt.snapscreenImgAlign})}else alert(rs.state)}catch(e){alert(lang.callBackErrorMsg)}}var r,n,u,lang=me.getLang("snapScreen_plugin"),f,e;if(!t){f=me.container;e=me.container.ownerDocument||me.container.document;t=e.createElement("object");try{t.type="application/x-pluginbaidusnap"}catch(s){return}t.style.cssText="position:absolute;left:-9999px;width:0;height:0;";t.setAttribute("width","0");t.setAttribute("height","0");f.appendChild(t)}r=me.getActionUrl(me.getOpt("snapscreenActionName"));n=i(r);setTimeout(function(){try{u=t.saveSnapshot(n.hostname,n.path,n.port)}catch(i){me.ui._dialogs.snapscreenDialog.open();return}o(u)},50)},queryCommandState:function(){return navigator.userAgent.indexOf("Windows",0)!=-1?0:-1}}}}});UE.commands.insertparagraph={execCommand:function(n,t){for(var f=this,e=f.selection.getRange(),r=e.startContainer,i,u;r;){if(domUtils.isBody(r))break;i=r;r=r.parentNode}i&&(u=f.document.createElement("p"),t?i.parentNode.insertBefore(u,i):i.parentNode.insertBefore(u,i.nextSibling),domUtils.fillNode(f.document,u),e.setStart(u,0).setCursor(!1,!0))}};UE.plugin.register("webapp",function(){function n(n,i){return i?'<iframe class="edui-faked-webapp" title="'+n.title+'" '+(n.align&&!n.cssfloat?'align="'+n.align+'"':"")+(n.cssfloat?'style="float:'+n.cssfloat+'"':"")+'width="'+n.width+'" height="'+n.height+'"  scrolling="no" frameborder="0" src="'+n.url+'" logo_url = "'+n.logo+'"><\/iframe>':'<img title="'+n.title+'" width="'+n.width+'" height="'+n.height+'" src="'+t.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" _logo_url="'+n.logo+'" style="background:url('+n.logo+') no-repeat center center; border:1px solid gray;" class="edui-faked-webapp" _url="'+n.url+'" '+(n.align&&!n.cssfloat?'align="'+n.align+'"':"")+(n.cssfloat?'style="float:'+n.cssfloat+'"':"")+"/>"}var t=this;return{outputRule:function(t){utils.each(t.getNodesByTagName("img"),function(t){var i,r;t.getAttr("class")=="edui-faked-webapp"&&(i=n({title:t.getAttr("title"),width:t.getAttr("width"),height:t.getAttr("height"),align:t.getAttr("align"),cssfloat:t.getStyle("float"),url:t.getAttr("_url"),logo:t.getAttr("_logo_url")},!0),r=UE.uNode.createElement(i),t.parentNode.replaceChild(r,t))})},inputRule:function(t){utils.each(t.getNodesByTagName("iframe"),function(t){if(t.getAttr("class")=="edui-faked-webapp"){var i=UE.uNode.createElement(n({title:t.getAttr("title"),width:t.getAttr("width"),height:t.getAttr("height"),align:t.getAttr("align"),cssfloat:t.getStyle("float"),url:t.getAttr("src"),logo:t.getAttr("logo_url")}));t.parentNode.replaceChild(i,t)}})},commands:{webapp:{execCommand:function(t,i){var r=this,u=n(utils.extend(i,{align:"none"}),!1);r.execCommand("inserthtml",u)},queryCommandState:function(){var t=this,n=t.selection.getRange().getClosedNode(),i=n&&n.className=="edui-faked-webapp";return i?1:0}}}}});UE.plugins.template=function(){UE.commands.template={execCommand:function(n,t){t.html&&this.execCommand("inserthtml",t.html)}};this.addListener("click",function(n,t){var r=t.target||t.srcElement,u=this.selection.getRange(),i=domUtils.findParent(r,function(n){if(n.className&&domUtils.hasClass(n,"ue_t"))return n},!0);i&&u.selectNode(i).shrinkBoundary().select()});this.addListener("keydown",function(n,t){var r=this.selection.getRange(),i;r.collapsed||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||(i=domUtils.findParent(r.startContainer,function(n){if(n.className&&domUtils.hasClass(n,"ue_t"))return n},!0),i&&domUtils.removeClasses(i,["ue_t"]))})};UE.plugin.register("music",function(){function n(n,i,r,u,f,e){return e?'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+n+'" width="'+i+'" height="'+r+'" '+(u&&!f?'align="'+u+'"':"")+(f?'style="float:'+f+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(u&&!f?'align="'+u+'"':"")+(f?'style="float:'+f+'"':"")+' width="'+i+'" height="'+r+'" _url="'+n+'" class="edui-faked-music" src="'+t.options.langPath+t.options.lang+'/images/music.png" />'}var t=this;return{outputRule:function(t){utils.each(t.getNodesByTagName("img"),function(t){var i,r,u,f;t.getAttr("class")=="edui-faked-music"&&(r=t.getStyle("float"),u=t.getAttr("align"),i=n(t.getAttr("_url"),t.getAttr("width"),t.getAttr("height"),u,r,!0),f=UE.uNode.createElement(i),t.parentNode.replaceChild(f,t))})},inputRule:function(t){utils.each(t.getNodesByTagName("embed"),function(t){var i,r,u;t.getAttr("class")=="edui-faked-music"&&(i=t.getStyle("float"),r=t.getAttr("align"),html=n(t.getAttr("src"),t.getAttr("width"),t.getAttr("height"),r,i,!1),u=UE.uNode.createElement(html),t.parentNode.replaceChild(u,t))})},commands:{music:{execCommand:function(t,i){var r=this,u=n(i.url,i.width||400,i.height||95,"none",!1);r.execCommand("inserthtml",u)},queryCommandState:function(){var t=this,n=t.selection.getRange().getClosedNode(),i=n&&n.className=="edui-faked-music";return i?1:0}}}}});UE.plugin.register("autoupload",function(){function n(n,t){var i=t,y,o,p,s,h,c,u,l,r=/image\/\w+/i.test(n.type)?"image":"file",f="loading_"+(+new Date).toString(36),a;if(y=i.getOpt(r+"FieldName"),o=i.getOpt(r+"UrlPrefix"),p=i.getOpt(r+"MaxSize"),s=i.getOpt(r+"AllowFiles"),h=i.getActionUrl(i.getOpt(r+"ActionName")),u=function(n){var t=i.document.getElementById(f);t&&domUtils.remove(t);i.fireEvent("showmessage",{id:f,content:n,type:"error",timeout:4e3})},r=="image"?(c='<img class="loadingclass" id="'+f+'" src="'+i.options.themePath+i.options.theme+'/images/spacer.gif" title="'+(i.getLang("autoupload.loading")||"")+'" >',l=function(n){var r=o+n.url,t=i.document.getElementById(f);t&&(t.setAttribute("src",r),t.setAttribute("_src",r),t.setAttribute("title",n.title||""),t.setAttribute("alt",n.original||""),t.removeAttribute("id"),domUtils.removeClasses(t,"loadingclass"))}):(c='<p><img class="loadingclass" id="'+f+'" src="'+i.options.themePath+i.options.theme+'/images/spacer.gif" title="'+(i.getLang("autoupload.loading")||"")+'" ><\/p>',l=function(n){var r=o+n.url,u=i.document.getElementById(f),t=i.selection.getRange(),e=t.createBookmark();t.selectNode(u).select();i.execCommand("insertfile",{url:r});t.moveToBookmark(e).select()}),i.execCommand("inserthtml",c),!i.getOpt(r+"ActionName")){u(i.getLang("autoupload.errorLoadConfig"));return}if(n.size>p){u(i.getLang("autoupload.exceedSizeError"));return}if(a=n.name?n.name.substr(n.name.lastIndexOf(".")):"",a&&r!="image"||s&&(s.join("")+".").indexOf(a.toLowerCase()+".")==-1){u(i.getLang("autoupload.exceedTypeError"));return}var e=new XMLHttpRequest,v=new FormData,w=utils.serializeParam(i.queryCommandValue("serverparam"))||"",b=utils.formatUrl(h+(h.indexOf("?")==-1?"?":"&")+w);v.append(y,n,n.name||"blob."+n.type.substr(6));v.append("type","ajax");e.open("post",b,!0);e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.addEventListener("load",function(n){try{var t=new Function("return "+utils.trim(n.target.response))();t.state=="SUCCESS"&&t.url?l(t):u(t.state)}catch(r){u(i.getLang("autoupload.loadError"))}});e.send(v)}function t(n){return n.clipboardData&&n.clipboardData.items&&n.clipboardData.items.length==1&&/^image\//.test(n.clipboardData.items[0].type)?n.clipboardData.items:null}function i(n){return n.dataTransfer&&n.dataTransfer.files?n.dataTransfer.files:null}return{outputRule:function(n){utils.each(n.getNodesByTagName("img"),function(n){/\b(loaderrorclass)|(bloaderrorclass)\b/.test(n.getAttr("class"))&&n.parentNode.removeChild(n)});utils.each(n.getNodesByTagName("p"),function(n){/\bloadpara\b/.test(n.getAttr("class"))&&n.parentNode.removeChild(n)})},bindEvents:{ready:function(){var r=this;if(window.FormData&&window.FileReader){domUtils.on(r.body,"paste drop",function(u){var s=!1,e,o,f;if(e=u.type=="paste"?t(u):i(u),e){for(o=e.length;o--;)f=e[o],f.getAsFile&&(f=f.getAsFile()),f&&f.size>0&&(n(f,r),s=!0);s&&u.preventDefault()}});domUtils.on(r.body,"dragover",function(n){n.dataTransfer.types[0]=="Files"&&n.preventDefault()});utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document)}}}}});UE.plugin.register("autosave",function(){function r(r){var f;if(!(new Date-i<u)){if(!r.hasContents()){t&&n.removePreferences(t);return}(i=new Date,r._saveFlag=null,f=n.body.innerHTML,r.fireEvent("beforeautosave",{content:f})!==!1)&&(n.setPreferences(t,f),r.fireEvent("afterautosave",{content:f}))}}var n=this,i=new Date,u=20,t=null;return{defaultOptions:{saveInterval:500},bindEvents:{ready:function(){var i="-drafts-data",r=null;r=n.key?n.key+i:(n.container.parentNode.id||"ue-common")+i;t=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+r},contentchange:function(){t&&(n._saveFlag&&window.clearTimeout(n._saveFlag),n.options.saveInterval>0?n._saveFlag=window.setTimeout(function(){r(n)},n.options.saveInterval):r(n))}},commands:{clearlocaldata:{execCommand:function(){t&&n.getPreferences(t)&&n.removePreferences(t)},notNeedUndo:!0,ignoreContentChange:!0},getlocaldata:{execCommand:function(){return t?n.getPreferences(t)||"":""},notNeedUndo:!0,ignoreContentChange:!0},drafts:{execCommand:function(){t&&(n.body.innerHTML=n.getPreferences(t)||"<p>"+domUtils.fillHtml+"<\/p>",n.focus(!0))},queryCommandState:function(){return t?n.getPreferences(t)===null?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}}}});UE.plugin.register("charts",function(){function n(n){var f=null,o=0,t,r,e,i,u;if(n.rows.length<2||n.rows[0].cells.length<2)return!1;for(f=n.rows[0].cells,o=f.length,t=0;i=f[t];t++)if(i.tagName.toLowerCase()!=="th")return!1;for(t=1;r=n.rows[t];t++){if(r.cells.length!=o||r.cells[0].tagName.toLowerCase()!=="th")return!1;for(e=1;i=r.cells[e];e++)if(u=utils.trim(i.innerText||i.textContent||""),u=u.replace(new RegExp(UE.dom.domUtils.fillChar,"g"),"").replace(/^\s+|\s+$/g,""),!/^\d*\.?\d+$/.test(u))return!1}return!0}var t=this;return{bindEvents:{chartserror:function(){}},commands:{charts:{execCommand:function(i,r){var f=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",!0),o=[],u={},e;if(!f)return!1;if(!n(f))return t.fireEvent("chartserror"),!1;u.title=r.title||"";u.subTitle=r.subTitle||"";u.xTitle=r.xTitle||"";u.yTitle=r.yTitle||"";u.suffix=r.suffix||"";u.tip=r.tip||"";u.dataFormat=r.tableDataFormat||"";u.chartType=r.chartType||0;for(e in u)u.hasOwnProperty(e)&&o.push(e+":"+u[e]);f.setAttribute("data-chart",o.join(";"));domUtils.addClass(f,"edui-charts-table")},queryCommandState:function(){var t=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",!0);return t&&n(t)?0:-1}}},inputRule:function(n){utils.each(n.getNodesByTagName("table"),function(n){n.getAttr("data-chart")!==undefined&&n.setAttr("style")})},outputRule:function(n){utils.each(n.getNodesByTagName("table"),function(n){n.getAttr("data-chart")!==undefined&&n.setAttr("style","display: none;")})}}});UE.plugin.register("section",function(){function r(){this.tag="";this.level=-1;this.dom=null;this.nextSection=null;this.previousSection=null;this.parentSection=null;this.startAddress=[];this.endAddress=[];this.children=[]}function i(n){var t=new r;return utils.extend(t,n)}function t(n,t){for(var i=t,r=0;r<n.length;r++){if(!i.childNodes)return null;i=i.childNodes[n[r]]}return i}var n=this;return{bindMultiEvents:{type:"aftersetcontent afterscencerestore",handler:function(){n.fireEvent("updateSections")}},bindEvents:{ready:function(){n.fireEvent("updateSections");domUtils.on(n.body,"drop paste",function(){n.fireEvent("updateSections")})},afterexeccommand:function(t,i){i=="paragraph"&&n.fireEvent("updateSections")},keyup:function(n,t){var r=this,u=r.selection.getRange(),i;u.collapsed!=!0?r.fireEvent("updateSections"):(i=t.keyCode||t.which,(i==13||i==8||i==46)&&r.fireEvent("updateSections"))}},commands:{getsections:{execCommand:function(n,t){function h(n){for(var t=0;t<r.length;t++)if(r[t](n))return t;return-1}function s(n,t){for(var v,e,c,l=null,u,r,y=n.childNodes,a=0,p=y.length;a<p;a++)if(r=y[a],c=h(r),c>=0){for(v=o.selection.getRange().selectNode(r).createAddress(!0).startAddress,e=i({tag:r.tagName,title:r.innerText||r.textContent||"",level:c,dom:r,startAddress:utils.clone(v,[]),endAddress:utils.clone(v,[]),children:[]}),f.nextSection=e,e.previousSection=f,u=f;c<=u.level;)u=u.parentSection;e.parentSection=u;u.children.push(e);l=f=e}else r.nodeType===1&&s(r,t),l&&l.endAddress[l.endAddress.length-1]++}for(var r=t||["h1","h2","h3","h4","h5","h6"],u=0;u<r.length;u++)typeof r[u]=="string"?r[u]=function(n){return function(t){return t.tagName==n.toUpperCase()}}(r[u]):typeof r[u]!="function"&&(r[u]=function(){return null});var o=this,e=i({level:-1,title:"root"}),f=e;return s(o.body,e),e},notNeedUndo:!0},movesection:{execCommand:function(n,i,r,u){function a(n,t,i){for(var u=!1,f=!1,r=0;r<n.length;r++){if(r>=i.length)break;if(i[r]>n[r]){u=!0;break}else if(i[r]<n[r])break}for(r=0;r<t.length;r++){if(r>=i.length)break;if(i[r]<n[r]){f=!0;break}else if(i[r]>n[r])break}return u&&f}var o=this,s,e,h,c,f,l;if(i&&r&&r.level!=-1&&(s=u?r.endAddress:r.startAddress,e=t(s,o.body),s&&e&&!a(i.startAddress,i.endAddress,s))){if(h=t(i.startAddress,o.body),c=t(i.endAddress,o.body),u)for(f=c;f&&!(domUtils.getPosition(h,f)&domUtils.POSITION_FOLLOWING);){if(l=f.previousSibling,domUtils.insertAfter(e,f),f==h)break;f=l}else for(f=h;f&&!(domUtils.getPosition(f,c)&domUtils.POSITION_FOLLOWING);){if(l=f.nextSibling,e.parentNode.insertBefore(f,e),f==c)break;f=l}o.fireEvent("updateSections")}}},deletesection:{execCommand:function(n,t,i){function f(n){for(var t=u.body,i=0;i<n.length;i++){if(!t.childNodes)return null;t=t.childNodes[n[i]]}return t}var u=this;if(t){var s=f(t.startAddress),e=f(t.endAddress),r=s,o;if(i)domUtils.remove(r);else while(r&&domUtils.inDoc(e,u.document)&&!(domUtils.getPosition(r,e)&domUtils.POSITION_FOLLOWING))o=r.nextSibling,domUtils.remove(r),r=o;u.fireEvent("updateSections")}}},selectsection:{execCommand:function(n,t){if(!t&&!t.dom)return!1;var r=this,u=r.selection.getRange(),i={startAddress:utils.clone(t.startAddress,[]),endAddress:utils.clone(t.endAddress,[])};return i.endAddress[i.endAddress.length-1]++,u.moveToAddress(i).select().scrollToView(),!0},notNeedUndo:!0},scrolltosection:{execCommand:function(n,t){if(!t&&!t.dom)return!1;var r=this,u=r.selection.getRange(),i={startAddress:t.startAddress,endAddress:t.endAddress};return i.endAddress[i.endAddress.length-1]++,u.moveToAddress(i).scrollToView(),!0},notNeedUndo:!0}}}});UE.plugin.register("simpleupload",function(){function r(){var u=t.offsetWidth||20,e=t.offsetHeight||20,r=document.createElement("iframe"),f="display:block;width:"+u+"px;height:"+e+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";domUtils.on(r,"load",function(){var t=(+new Date).toString(36),h,s,o,v;s=r.contentDocument||r.contentWindow.document;o=s.body;h=s.createElement("div");h.innerHTML='<form id="edui_form_'+t+'" target="edui_iframe_'+t+'" method="POST" enctype="multipart/form-data" action="'+n.getOpt("serverUrl")+'" style="'+f+'"><input id="edui_input_'+t+'" type="file" accept="image/*" name="'+n.options.imageFieldName+'" style="'+f+'"><\/form><iframe id="edui_iframe_'+t+'" name="edui_iframe_'+t+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"><\/iframe>';h.className="edui-"+n.options.theme;h.id=n.ui.id+"_iframeupload";o.style.cssText=f;o.style.width=u+"px";o.style.height=e+"px";o.appendChild(h);o.parentNode&&(o.parentNode.style.width=u+"px",o.parentNode.style.height=u+"px");var a=s.getElementById("edui_form_"+t),c=s.getElementById("edui_input_"+t),l=s.getElementById("edui_iframe_"+t);domUtils.on(c,"change",function(){function s(){try{var f,r,u,e=(l.contentDocument||l.contentWindow.document).body,o=e.innerText||e.textContent||"";r=new Function("return "+o)();f=n.options.imageUrlPrefix+r.url;r.state=="SUCCESS"&&r.url?(u=n.document.getElementById(t),u.setAttribute("src",f),u.setAttribute("_src",f),u.setAttribute("title",r.title||""),u.setAttribute("alt",r.original||""),u.removeAttribute("id"),domUtils.removeClasses(u,"loadingclass")):i&&i(r.state)}catch(h){i&&i(n.getLang("simpleupload.loadError"))}a.reset();domUtils.un(l,"load",s)}function i(i){if(t){var r=n.document.getElementById(t);r&&domUtils.remove(r);n.fireEvent("showmessage",{id:t,content:i,type:"error",timeout:4e3})}}var r,u,f;if(c.value){var t="loading_"+(+new Date).toString(36),f=utils.serializeParam(n.queryCommandValue("serverparam"))||"",e=n.getActionUrl(n.getOpt("imageActionName")),o=n.getOpt("imageAllowFiles");if(n.focus(),n.execCommand("inserthtml",'<img class="loadingclass" id="'+t+'" src="'+n.options.themePath+n.options.theme+'/images/spacer.gif" title="'+(n.getLang("simpleupload.loading")||"")+'" >'),!n.getOpt("imageActionName")){errorHandler(n.getLang("autoupload.errorLoadConfig"));return}if(r=c.value,u=r?r.substr(r.lastIndexOf(".")):"",!u||o&&(o.join("")+".").indexOf(u.toLowerCase()+".")==-1){i(n.getLang("simpleupload.exceedTypeError"));return}domUtils.on(l,"load",s);f=utils.serializeParam(n.queryCommandValue("serverparam"))||"";a.action=utils.formatUrl(e+(e.indexOf("?")==-1?"?":"&")+f);a.submit()}});n.addListener("selectionchange",function(){clearTimeout(v);v=setTimeout(function(){var t=n.queryCommandState("simpleupload");c.disabled=t==-1?"disabled":!1},400)});i=!0});r.style.cssText=f;t.appendChild(r)}var n=this,i=!1,t;return{bindEvents:{ready:function(){utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document)},simpleuploadbtnready:function(i,u){t=u;n.afterConfigReady(r)}},outputRule:function(n){utils.each(n.getNodesByTagName("img"),function(n){/\b(loaderrorclass)|(bloaderrorclass)\b/.test(n.getAttr("class"))&&n.parentNode.removeChild(n)})},commands:{simpleupload:{queryCommandState:function(){return i?0:-1}}}}});UE.plugin.register("serverparam",function(){var t=this,n={};return{commands:{serverparam:{execCommand:function(t,i,r){i===undefined||i===null?n={}:utils.isString(i)?r===undefined||r===null?delete n[i]:n[i]=r:utils.isObject(i)?utils.extend(n,i,!0):utils.isFunction(i)&&utils.extend(n,i(),!0)},queryCommandValue:function(){return n||{}}}}}});UE.plugin.register("insertfile",function(){function t(n){var i=n.substr(n.lastIndexOf(".")+1).toLowerCase(),t={rar:"icon_rar.gif",zip:"icon_rar.gif",tar:"icon_rar.gif",gz:"icon_rar.gif",bz2:"icon_rar.gif",doc:"icon_doc.gif",docx:"icon_doc.gif",pdf:"icon_pdf.gif",mp3:"icon_mp3.gif",xls:"icon_xls.gif",chm:"icon_chm.gif",ppt:"icon_ppt.gif",pptx:"icon_ppt.gif",avi:"icon_mv.gif",rmvb:"icon_mv.gif",wmv:"icon_mv.gif",flv:"icon_mv.gif",swf:"icon_mv.gif",rm:"icon_mv.gif",exe:"icon_exe.gif",psd:"icon_psd.gif",txt:"icon_txt.gif",jpg:"icon_jpg.gif",png:"icon_jpg.gif",jpeg:"icon_jpg.gif",gif:"icon_jpg.gif",ico:"icon_jpg.gif",bmp:"icon_jpg.gif"};return t[i]?t[i]:t.txt}var n=this;return{commands:{insertfile:{execCommand:function(i,r){r=utils.isArray(r)?r:[r];for(var u,e,o,h="",s=n.getOpt("UEDITOR_HOME_URL"),c=s+(s.substr(s.length-1)=="/"?"":"/")+"dialogs/attachment/fileTypeImages/",f=0;f<r.length;f++)u=r[f],e=c+t(u.url),o=u.title||u.url.substr(u.url.lastIndexOf("/")+1),h+='<p class="keylab-self-p" style="line-height: 16px;"><img style="vertical-align: middle; margin-right: 2px;" src="'+e+'" _src="'+e+'" /><a style="font-size:12px; color:#0066cc;" href="'+u.url+'" title="'+o+'">'+o+"<\/a><\/p>";n.execCommand("insertHtml",h)}}}}});t=t||{};t.editor=t.editor||{};UE.ui=t.editor.ui={},function(){function f(){var n=document.getElementById("edui_fixedlayer");i.setViewportOffset(n,{left:0,top:0})}function h(){r.on(window,"scroll",f);r.on(window,"resize",t.editor.utils.defer(f,0,!0))}var n=t.editor.browser,r=t.editor.dom.domUtils,u="$EDITORUI",e=window[u]={},o="ID"+u,s=0,i=t.editor.ui.uiUtils={uid:function(n){return n?n[o]||(n[o]=++s):++s},hook:function(n,t){var i;return n&&n._callbacks?i=n:(i=function(){var t,r,u,f;for(n&&(t=n.apply(this,arguments)),r=i._callbacks,u=r.length;u--;)f=r[u].apply(this,arguments),t===undefined&&(t=f);return t},i._callbacks=[]),i._callbacks.push(t),i},createElementByHtml:function(n){var t=document.createElement("div");return t.innerHTML=n,t=t.firstChild,t.parentNode.removeChild(t),t},getViewportElement:function(){return n.ie&&n.quirks?document.body:document.documentElement},getClientRect:function(n){var t,i,u;try{t=n.getBoundingClientRect()}catch(f){t={left:0,top:0,height:0,width:0}}for(i={left:Math.round(t.left),top:Math.round(t.top),height:Math.round(t.bottom-t.top),width:Math.round(t.right-t.left)};(u=n.ownerDocument)!==document&&(n=r.getWindow(u).frameElement);)t=n.getBoundingClientRect(),i.left+=t.left,i.top+=t.top;return i.bottom=i.top+i.height,i.right=i.left+i.width,i},getViewportRect:function(){var n=i.getViewportElement(),t=(window.innerWidth||n.clientWidth)|0,r=(window.innerHeight||n.clientHeight)|0;return{left:0,top:0,height:r,width:t,bottom:r,right:t}},setViewportOffset:function(n,t){var u=i.getFixedLayer();n.parentNode===u?(n.style.left=t.left+"px",n.style.top=t.top+"px"):r.setViewportOffset(n,t)},getEventOffset:function(n){var u=n.target||n.srcElement,t=i.getClientRect(u),r=i.getViewportOffsetByEvent(n);return{left:r.left-t.left,top:r.top-t.top}},getViewportOffsetByEvent:function(n){var f=n.target||n.srcElement,e=r.getWindow(f).frameElement,t={left:n.clientX,top:n.clientY},u;return e&&f.ownerDocument!==document&&(u=i.getClientRect(e),t.left+=u.left,t.top+=u.top),t},setGlobal:function(n,t){return e[n]=t,u+'["'+n+'"]'},unsetGlobal:function(n){delete e[n]},copyAttributes:function(t,i){for(var f=i.attributes,e=f.length,u;e--;)u=f[e],u.nodeName!="style"&&u.nodeName!="class"&&(!n.ie||u.specified)&&t.setAttribute(u.nodeName,u.nodeValue);i.className&&r.addClass(t,i.className);i.style.cssText&&(t.style.cssText+=";"+i.style.cssText)},removeStyle:function(n,t){if(n.style.removeProperty)n.style.removeProperty(t);else if(n.style.removeAttribute)n.style.removeAttribute(t);else throw"";},contains:function(n,t){return n&&t&&(n===t?!1:n.contains?n.contains(t):n.compareDocumentPosition(t)&16)},startDrag:function(n,t,i){function u(n){var i=n.clientX-o,r=n.clientY-s;t.ondragmove(i,r,n);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}var i=i||document,o=n.clientX,s=n.clientY,r;if(i.addEventListener){function f(){i.removeEventListener("mousemove",u,!0);i.removeEventListener("mouseup",f,!0);window.removeEventListener("mouseup",f,!0);t.ondragstop()}i.addEventListener("mousemove",u,!0);i.addEventListener("mouseup",f,!0);window.addEventListener("mouseup",f,!0);n.preventDefault()}else{r=n.srcElement;r.setCapture();function e(){r.releaseCapture();r.detachEvent("onmousemove",u);r.detachEvent("onmouseup",e);r.detachEvent("onlosecaptrue",e);t.ondragstop()}r.attachEvent("onmousemove",u);r.attachEvent("onmouseup",e);r.attachEvent("onlosecaptrue",e);n.returnValue=!1}t.ondragstart()},getFixedLayer:function(){var t=document.getElementById("edui_fixedlayer");return t==null&&(t=document.createElement("div"),t.id="edui_fixedlayer",document.body.appendChild(t),n.ie&&n.version<=8?(t.style.position="absolute",h(),setTimeout(f)):t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="0",t.style.height="0"),t},makeUnselectable:function(t){if(n.opera||n.ie&&n.version<9){if(t.unselectable="on",t.hasChildNodes())for(var r=0;r<t.childNodes.length;r++)t.childNodes[r].nodeType==1&&i.makeUnselectable(t.childNodes[r])}else t.style.MozUserSelect!==undefined?t.style.MozUserSelect="none":t.style.WebkitUserSelect!==undefined?t.style.WebkitUserSelect="none":t.style.KhtmlUserSelect!==undefined&&(t.style.KhtmlUserSelect="none")}}}(),function(){var i=t.editor.utils,n=t.editor.ui.uiUtils,u=t.editor.EventBase,r=t.editor.ui.UIBase=function(){};r.prototype={className:"",uiName:"",initOptions:function(t){var r=this;for(var i in t)r[i]=t[i];this.id=this.id||"edui"+n.uid()},initUIBase:function(){this._globalKey=i.unhtml(n.setGlobal(this.id,this))},render:function(t){for(var r,o=this.renderHtml(),i=n.createElementByHtml(o),s=domUtils.getElementsByTagName(i,"*"),u="edui-"+(this.theme||this.editor.options.theme),f=document.getElementById("edui_fixedlayer"),h=0,e;e=s[h++];)domUtils.addClass(e,u);domUtils.addClass(i,u);f&&(f.className="",domUtils.addClass(f,u));r=this.getDom();r!=null?(r.parentNode.replaceChild(i,r),n.copyAttributes(i,r)):(typeof t=="string"&&(t=document.getElementById(t)),t=t||n.getFixedLayer(),domUtils.addClass(t,u),t.appendChild(i));this.postRender()},getDom:function(n){return n?document.getElementById(this.id+"_"+n):document.getElementById(this.id)},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(n){var t="edui-"+this.uiName;return n.replace(/##/g,this.id).replace(/%%-/g,this.uiName?t+"-":"").replace(/%%/g,(this.uiName?t:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var i=this.getDom();i&&t.editor.dom.domUtils.remove(i);n.unsetGlobal(this.id)}};i.inherits(r,u)}(),function(){var i=t.editor.utils,r=t.editor.ui.UIBase,n=t.editor.ui.Separator=function(n){this.initOptions(n);this.initSeparator()};n.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><\/div>'}};i.inherits(n,r)}(),function(){var i=t.editor.utils,r=t.editor.dom.domUtils,u=t.editor.ui.UIBase,f=t.editor.ui.uiUtils,n=t.editor.ui.Mask=function(n){this.initOptions(n);this.initUIBase()};n.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onclick="return $$._onClick(event, this);" onmousedown="return $$._onMouseDown(event, this);"><\/div>'},postRender:function(){var n=this;r.on(window,"resize",function(){setTimeout(function(){n.isHidden()||n._fill()})})},show:function(n){this._fill();this.getDom().style.display="";this.getDom().style.zIndex=n},hide:function(){this.getDom().style.display="none";this.getDom().style.zIndex=""},isHidden:function(){return this.getDom().style.display=="none"},_onMouseDown:function(){return!1},_onClick:function(n,t){this.fireEvent("click",n,t)},_fill:function(){var n=this.getDom(),t=f.getViewportRect();n.style.width=t.width+"px";n.style.height=t.height+"px"}};i.inherits(n,u)}(),function(){function e(n,t){for(var i,u=0;u<r.length;u++)if(i=r[u],!i.isHidden()&&i.queryAutoHide(t)!==!1){if(n&&/scroll/ig.test(n.type)&&i.className=="edui-wordpastepop")return;i.hide()}r.length&&i.editor.fireEvent("afterhidepop")}var s=t.editor.utils,n=t.editor.ui.uiUtils,i=t.editor.dom.domUtils,u=t.editor.ui.UIBase,f=t.editor.ui.Popup=function(n){this.initOptions(n);this.initPopup()},r=[],o;f.postHide=e;o=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];f.prototype={SHADOW_RADIUS:5,content:null,_hidden:!1,autoRender:!0,canSideLeft:!0,canSideUp:!0,initPopup:function(){this.initUIBase();r.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%" onmousedown="return false;"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"><\/iframe> <div class="edui-shadow"><\/div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  <\/div> <\/div><\/div>"},getContentHtmlTpl:function(){return this.content?typeof this.content=="string"?this.content:this.content.renderHtml():""},_UIBase_postRender:u.prototype.postRender,postRender:function(){if(this.content instanceof u&&this.content.postRender(),this.captureWheel&&!this.captured){this.captured=!0;var e=(document.documentElement.clientHeight||document.body.clientHeight)-80,r=this.getDom().offsetHeight,o=n.getClientRect(this.combox.getDom()).top,f=this.getDom("content"),t=this.getDom("body").getElementsByTagName("iframe"),s=this;for(t.length&&(t=t[0]);o+r>e;)r-=30;if(f.style.height=r+"px",t&&(t.style.height=r+"px"),window.XMLHttpRequest)i.on(f,"onmousewheel"in document.body?"mousewheel":"DOMMouseScroll",function(n){n.preventDefault?n.preventDefault():n.returnValue=!1;f.scrollTop-=n.wheelDelta?n.wheelDelta/2:n.detail*-20});else i.on(this.getDom(),"mousewheel",function(n){n.returnValue=!1;s.getDom("content").scrollTop-=n.wheelDelta/2})}this.fireEvent("postRenderAfter");this.hide(!0);this._UIBase_postRender()},_doAutoRender:function(){!this.getDom()&&this.autoRender&&this.render()},mesureSize:function(){var t=this.getDom("content");return n.getClientRect(t)},fitSize:function(){var t,n,i;return this.captureWheel&&this.sized?this.__size:(this.sized=!0,t=this.getDom("body"),t.style.width="",t.style.height="",n=this.mesureSize(),this.captureWheel?(t.style.width=-(-20-n.width)+"px",i=parseInt(this.getDom("content").style.height,10),window.isNaN(i)||(n.height=i)):t.style.width=n.width+"px",t.style.height=n.height+"px",this.__size=n,this.captureWheel&&(this.getDom("content").style.overflow="auto"),n)},showAnchor:function(t,i){this.showAnchorRect(n.getClientRect(t),i)},showAnchorRect:function(r,u){var s,f,h,c,l,a,e;this._doAutoRender();s=n.getViewportRect();this.getDom().style.visibility="hidden";this._show();f=this.fitSize();u?(h=this.canSideLeft&&r.right+f.width>s.right&&r.left>f.width,c=this.canSideUp&&r.top+f.height>s.bottom&&r.bottom>f.height,l=h?r.left-f.width:r.right,a=c?r.bottom-f.height:r.top):(h=this.canSideLeft&&r.right+f.width>s.right&&r.left>f.width,c=this.canSideUp&&r.top+f.height>s.bottom&&r.bottom>f.height,l=h?r.right-f.width:r.left,a=c?r.top-f.height:r.bottom);e=this.getDom();n.setViewportOffset(e,{left:l,top:a});i.removeClasses(e,o);e.className+=" "+o[(c?1:0)*2+(h?1:0)];this.editor&&(e.style.zIndex=this.editor.container.style.zIndex*1+10,t.editor.ui.uiUtils.getFixedLayer().style.zIndex=e.style.zIndex-1);this.getDom().style.visibility="visible"},showAt:function(n){var t=n.left,i=n.top,r={left:t,top:i,right:t,bottom:i,height:0,width:0};this.showAnchorRect(r,!1,!0)},_show:function(){if(this._hidden){var n=this.getDom();n.style.display="";this._hidden=!1;this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender();this._show()},hide:function(n){!this._hidden&&this.getDom()&&(this.getDom().style.display="none",this._hidden=!0,n||this.fireEvent("hide"))},queryAutoHide:function(t){return!t||!n.contains(this.getDom(),t)}};s.inherits(f,u);i.on(document,"mousedown",function(n){var t=n.target||n.srcElement;e(n,t)});i.on(window,"scroll",function(n,t){e(n,t)})}(),function(){function f(t,i){for(var u='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview"><\/div><div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+t+'<\/div><\/div><table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0"><tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+i.getLang("themeColor")+'<\/td> <\/tr><tr class="edui-colorpicker-tablefirstrow" >',r=0;r<n.length;r++)r&&r%10==0&&(u+="<\/tr>"+(r==60?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+i.getLang("standardColor")+"<\/td><\/tr>":"")+"<tr"+(r==60?' class="edui-colorpicker-tablefirstrow"':"")+">"),u+=r<70?'<td style="padding: 0 2px;"><a hidefocus title="'+n[r]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell" data-color="#'+n[r]+'" style="background-color:#'+n[r]+";border:solid #ccc;"+(r<10||r>=60?"border-width:1px;":r>=10&&r<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"><\/a><\/td>':"";return u+"<\/tr><\/table><\/div>"}var r=t.editor.utils,u=t.editor.ui.UIBase,i=t.editor.ui.ColorPicker=function(n){this.initOptions(n);this.noColorText=this.noColorText||this.editor.getLang("clearColor");this.initUIBase()},n;i.prototype={getHtmlTpl:function(){return f(this.noColorText,this.editor)},_onTableClick:function(n){var i=n.target||n.srcElement,t=i.getAttribute("data-color");t&&this.fireEvent("pickcolor",t)},_onTableOver:function(n){var i=n.target||n.srcElement,t=i.getAttribute("data-color");t&&(this.getDom("preview").style.backgroundColor=t)},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}};r.inherits(i,u);n="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(",")}(),function(){var u=t.editor.utils,n=t.editor.ui.uiUtils,i=t.editor.ui.UIBase,r=t.editor.ui.TablePicker=function(n){this.initOptions(n);this.initTablePicker()};r.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){var n=this;return'<div id="##" class="edui-tablepicker %%"><div class="edui-tablepicker-body"><div class="edui-infoarea"><span id="##_label" class="edui-label"><\/span><\/div><div class="edui-pickarea" onmousemove="$$._onMouseMove(event, this);" onmouseover="$$._onMouseOver(event, this);" onmouseout="$$._onMouseOut(event, this);" onclick="$$._onClick(event, this);"><div id="##_overlay" class="edui-overlay"><\/div><\/div><\/div><\/div>'},_UIBase_render:i.prototype.render,render:function(n){this._UIBase_render(n);this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(n,t){var i=this.getDom("overlay").style,r=this.lengthOfCellSide,u;i.width=n*r+"px";i.height=t*r+"px";u=this.getDom("label");u.innerHTML=n+this.editor.getLang("t_col")+" x "+t+this.editor.getLang("t_row");this.numCols=n;this.numRows=t},_onMouseOver:function(t,i){var r=t.relatedTarget||t.fromElement;n.contains(i,r)||i===r||(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="")},_onMouseOut:function(t,i){var r=t.relatedTarget||t.toElement;n.contains(i,r)||i===r||(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="hidden")},_onMouseMove:function(t){var e=this.getDom("overlay").style,i=n.getEventOffset(t),r=this.lengthOfCellSide,u=Math.ceil(i.left/r),f=Math.ceil(i.top/r);this._track(u,f)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}};u.inherits(r,i)}(),function(){var r=t.editor.browser,n=t.editor.dom.domUtils,i=t.editor.ui.uiUtils,u='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(r.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"');t.editor.ui.Stateful={alwalysHoverable:!1,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl;this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var n=this._Stateful_dGetHtmlTpl();return n.replace(/stateful/g,function(){return u})},Stateful_onMouseEnter:function(n,t){this.target=t;(!this.isDisabled()||this.alwalysHoverable)&&(this.addState("hover"),this.fireEvent("over"))},Stateful_onMouseLeave:function(){(!this.isDisabled()||this.alwalysHoverable)&&(this.removeState("hover"),this.removeState("active"),this.fireEvent("out"))},Stateful_onMouseOver:function(n,t){var r=n.relatedTarget;i.contains(t,r)||t===r||this.Stateful_onMouseEnter(n,t)},Stateful_onMouseOut:function(n,t){var r=n.relatedTarget;i.contains(t,r)||t===r||this.Stateful_onMouseLeave(n,t)},Stateful_onMouseDown:function(){this.isDisabled()||this.addState("active")},Stateful_onMouseUp:function(){this.isDisabled()||this.removeState("active")},Stateful_postRender:function(){this.disabled&&!this.hasState("disabled")&&this.addState("disabled")},hasState:function(t){return n.hasClass(this.getStateDom(),"edui-state-"+t)},addState:function(n){this.hasState(n)||(this.getStateDom().className+=" edui-state-"+n)},removeState:function(t){this.hasState(t)&&n.removeClasses(this.getStateDom(),["edui-state-"+t])},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(n){!this.isDisabled()&&n?this.addState("checked"):this.removeState("checked")},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(n){n?(this.removeState("hover"),this.removeState("checked"),this.removeState("active"),this.addState("disabled")):this.removeState("disabled")}}}(),function(){var n=t.editor.utils,r=t.editor.ui.UIBase,u=t.editor.ui.Stateful,i=t.editor.ui.Button=function(n){if(n.name){var t=n.name,i=n.cssRules;n.className||(n.className="edui-for-"+t);n.cssRules=".edui-default  .edui-for-"+t+" .edui-icon {"+i+"}"}this.initOptions(n);this.initButton()};i.prototype={uiName:"button",label:"",title:"",showIcon:!0,showText:!0,cssRules:"",initButton:function(){this.initUIBase();this.Stateful_init();this.cssRules&&n.cssRule("edui-customize-"+this.name+"-style",this.cssRules)},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return $$._onMouseDown(event, this);" onclick="return $$._onClick(event, this);">'+(this.showIcon?'<div class="edui-box edui-icon"><\/div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"<\/div>":"")+"<\/div><\/div><\/div><\/div>"},postRender:function(){this.Stateful_postRender();this.setDisabled(this.disabled)},_onMouseDown:function(n){var t=n.target||n.srcElement,i=t&&t.tagName&&t.tagName.toLowerCase();if(i=="input"||i=="object"||i=="object")return!1},_onClick:function(){this.isDisabled()||this.fireEvent("click")},setTitle:function(n){var t=this.getDom("label");t.innerHTML=n}};n.inherits(i,r);n.extend(i.prototype,u)}(),function(){var n=t.editor.utils,i=t.editor.ui.uiUtils,e=t.editor.dom.domUtils,u=t.editor.ui.UIBase,f=t.editor.ui.Stateful,r=t.editor.ui.SplitButton=function(n){this.initOptions(n);this.initSplitButton()};r.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){var t,n;this.initUIBase();this.Stateful_init();t=this;this.popup!=null&&(n=this.popup,this.popup=null,this.setPopup(n))},_UIBase_postRender:u.prototype.postRender,postRender:function(){this.Stateful_postRender();this._UIBase_postRender()},setPopup:function(t){this.popup!==t&&(this.popup!=null&&this.popup.dispose(),t.addListener("show",n.bind(this._onPopupShow,this)),t.addListener("hide",n.bind(this._onPopupHide,this)),t.addListener("postrender",n.bind(function(){t.getDom("body").appendChild(i.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(i.getClientRect(this.getDom()).width+20)+'px"><\/div>'));t.getDom().className+=" "+this.className},this)),this.popup=t)},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon"><\/div><\/div><div class="edui-box edui-splitborder"><\/div><div class="edui-box edui-arrow" onclick="$$._onArrowClick();"><\/div><\/div><\/div><\/div>'},showPopup:function(){var n=i.getClientRect(this.getDom());n.top-=this.popup.SHADOW_RADIUS;n.height+=this.popup.SHADOW_RADIUS;this.popup.showAnchorRect(n)},_onArrowClick:function(){this.isDisabled()||this.showPopup()},_onButtonClick:function(){this.isDisabled()||this.fireEvent("buttonclick")}};n.inherits(r,u);n.extend(r.prototype,f,!0)}(),function(){var r=t.editor.utils,u=t.editor.ui.uiUtils,f=t.editor.ui.ColorPicker,e=t.editor.ui.Popup,n=t.editor.ui.SplitButton,i=t.editor.ui.ColorButton=function(n){this.initOptions(n);this.initColorButton()};i.prototype={initColorButton:function(){var n=this;this.popup=new e({content:new f({noColorText:n.editor.getLang("clearColor"),editor:n.editor,onpickcolor:function(t,i){n._onPickColor(i)},onpicknocolor:function(t,i){n._onPickNoColor(i)}}),editor:n.editor});this.initSplitButton()},_SplitButton_postRender:n.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.getDom("button_body").appendChild(u.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"><\/div>'));this.getDom().className+=" edui-colorbutton"},setColor:function(n){this.getDom("colorlump").style.backgroundColor=n;this.color=n},_onPickColor:function(n){this.fireEvent("pickcolor",n)!==!1&&(this.setColor(n),this.popup.hide())},_onPickNoColor:function(){this.fireEvent("picknocolor")!==!1&&this.popup.hide()}};r.inherits(i,n)}(),function(){var i=t.editor.utils,r=t.editor.ui.Popup,u=t.editor.ui.TablePicker,f=t.editor.ui.SplitButton,n=t.editor.ui.TableButton=function(n){this.initOptions(n);this.initTableButton()};n.prototype={initTableButton:function(){var n=this;this.popup=new r({content:new u({editor:n.editor,onpicktable:function(t,i,r){n._onPickTable(i,r)}}),editor:n.editor});this.initSplitButton()},_onPickTable:function(n,t){this.fireEvent("picktable",n,t)!==!1&&this.popup.hide()}};i.inherits(n,f)}(),function(){var r=t.editor.utils,n=t.editor.ui.UIBase,i=t.editor.ui.AutoTypeSetPicker=function(n){this.initOptions(n);this.initAutoTypeSetPicker()};i.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var i=this.editor,n=i.options.autotypeset,t=i.getLang("autoTypeSet"),u="textAlignValue"+i.uid,r="imageBlockLineValue"+i.uid,f="symbolConverValue"+i.uid;return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td nowrap><input type="checkbox" name="mergeEmptyline" '+(n.mergeEmptyline?"checked":"")+">"+t.mergeLine+'<\/td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(n.removeEmptyline?"checked":"")+">"+t.delLine+'<\/td><\/tr><tr><td nowrap><input type="checkbox" name="removeClass" '+(n.removeClass?"checked":"")+">"+t.removeFormat+'<\/td><td colspan="2"><input type="checkbox" name="indent" '+(n.indent?"checked":"")+">"+t.indent+'<\/td><\/tr><tr><td nowrap><input type="checkbox" name="textAlign" '+(n.textAlign?"checked":"")+">"+t.alignment+'<\/td><td colspan="2" id="'+u+'"><input type="radio" name="'+u+'" value="left" '+(n.textAlign&&n.textAlign=="left"?"checked":"")+">"+i.getLang("justifyleft")+'<input type="radio" name="'+u+'" value="center" '+(n.textAlign&&n.textAlign=="center"?"checked":"")+">"+i.getLang("justifycenter")+'<input type="radio" name="'+u+'" value="right" '+(n.textAlign&&n.textAlign=="right"?"checked":"")+">"+i.getLang("justifyright")+'<\/td><\/tr><tr><td nowrap><input type="checkbox" name="imageBlockLine" '+(n.imageBlockLine?"checked":"")+">"+t.imageFloat+'<\/td><td nowrap id="'+r+'"><input type="radio" name="'+r+'" value="none" '+(n.imageBlockLine&&n.imageBlockLine=="none"?"checked":"")+">"+i.getLang("default")+'<input type="radio" name="'+r+'" value="left" '+(n.imageBlockLine&&n.imageBlockLine=="left"?"checked":"")+">"+i.getLang("justifyleft")+'<input type="radio" name="'+r+'" value="center" '+(n.imageBlockLine&&n.imageBlockLine=="center"?"checked":"")+">"+i.getLang("justifycenter")+'<input type="radio" name="'+r+'" value="right" '+(n.imageBlockLine&&n.imageBlockLine=="right"?"checked":"")+">"+i.getLang("justifyright")+'<\/td><\/tr><tr><td nowrap><input type="checkbox" name="clearFontSize" '+(n.clearFontSize?"checked":"")+">"+t.removeFontsize+'<\/td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(n.clearFontFamily?"checked":"")+">"+t.removeFontFamily+'<\/td><\/tr><tr><td nowrap colspan="3"><input type="checkbox" name="removeEmptyNode" '+(n.removeEmptyNode?"checked":"")+">"+t.removeHtml+'<\/td><\/tr><tr><td nowrap colspan="3"><input type="checkbox" name="pasteFilter" '+(n.pasteFilter?"checked":"")+">"+t.pasteFilter+'<\/td><\/tr><tr><td nowrap><input type="checkbox" name="symbolConver" '+(n.bdc2sb||n.tobdc?"checked":"")+">"+t.symbol+'<\/td><td id="'+f+'"><input type="radio" name="bdc" value="bdc2sb" '+(n.bdc2sb?"checked":"")+">"+t.bdc2sb+'<input type="radio" name="bdc" value="tobdc" '+(n.tobdc?"checked":"")+">"+t.tobdc+'<\/td><td nowrap align="right"><button >'+t.run+"<\/button><\/td><\/tr><\/table><\/div><\/div>"},_UIBase_render:n.prototype.render};r.inherits(i,n)}(),function(){function n(n){for(var f,o,y,s,p,h,c,t={},l=n.getDom(),w=n.editor.uid,a=null,r=null,v=domUtils.getElementsByTagName(l,"input"),e=v.length-1,u;u=v[e--];)if(a=u.getAttribute("type"),a=="checkbox")if(r=u.getAttribute("name"),t[r]&&delete t[r],u.checked)if(f=document.getElementById(r+"Value"+w),f){if(/input/ig.test(f.tagName))t[r]=f.value;else for(o=f.getElementsByTagName("input"),y=o.length-1;s=o[y--];)if(s.checked){t[r]=s.value;break}}else t[r]=!0;else t[r]=!1;else t[u.getAttribute("value")]=u.checked;for(p=domUtils.getElementsByTagName(l,"select"),e=0;h=p[e++];)c=h.getAttribute("name"),t[c]=t[c]?h.value:"";i.extend(n.editor.options.autotypeset,t);n.editor.setPreferences("autotypeset",t)}var i=t.editor.utils,u=t.editor.ui.Popup,f=t.editor.ui.AutoTypeSetPicker,e=t.editor.ui.SplitButton,r=t.editor.ui.AutoTypeSetButton=function(n){this.initOptions(n);this.initAutoTypeSetButton()};r.prototype={initAutoTypeSetButton:function(){var t=this,i;this.popup=new u({content:new f({editor:t.editor}),editor:t.editor,hide:function(){!this._hidden&&this.getDom()&&(n(this),this.getDom().style.display="none",this._hidden=!0,this.fireEvent("hide"))}});i=0;this.popup.addListener("postRenderAfter",function(){var r=this,u,f;if(!i){u=this.getDom();f=u.getElementsByTagName("button")[0];f.onclick=function(){n(r);t.editor.execCommand("autotypeset");r.hide()};domUtils.on(u,"click",function(i){var u=i.target||i.srcElement,o=t.editor.uid,f,s;if(u&&u.tagName=="INPUT"){if(u.name=="imageBlockLine"||u.name=="textAlign"||u.name=="symbolConver"){var h=u.checked,c=document.getElementById(u.name+"Value"+o),e=c.getElementsByTagName("input"),l={imageBlockLine:"none",textAlign:"left",symbolConver:"tobdc"};for(f=0;f<e.length;f++)h?e[f].value==l[u.name]&&(e[f].checked="checked"):e[f].checked=!1}(u.name=="imageBlockLineValue"+o||u.name=="textAlignValue"+o||u.name=="bdc")&&(s=u.parentNode.previousSibling.getElementsByTagName("input"),s&&(s[0].checked=!0));n(r)}});i=1}});this.initSplitButton()}};i.inherits(r,e)}(),function(){var i=t.editor.utils,u=t.editor.ui.Popup,f=t.editor.ui.Stateful,r=t.editor.ui.UIBase,n=t.editor.ui.CellAlignPicker=function(n){this.initOptions(n);this.initSelected();this.initCellAlignPicker()};n.prototype={initSelected:function(){var n={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3};this.selected&&(this.selectedIndex=n.valign[this.selected.valign]*n.count+n.align[this.selected.align])},initCellAlignPicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){for(var u=["left","center","right"],r=null,t=-1,i=[],n=0;n<9;n++)r=this.selectedIndex===n?' class="edui-cellalign-selected" ':"",t=n%3,t===0&&i.push("<tr>"),i.push('<td index="'+n+'" '+r+' stateful><div class="edui-icon edui-'+u[t]+'"><\/div><\/td>'),t===2&&i.push("<\/tr>");return'<div id="##" class="edui-cellalignpicker %%"><div class="edui-cellalignpicker-body"><table onclick="$$._onClick(event);">'+i.join("")+"<\/table><\/div><\/div>"},getStateDom:function(){return this.target},_onClick:function(n){var t=n.target||n.srcElement;/icon/.test(t.className)&&(this.items[t.parentNode.getAttribute("index")].onclick(),u.postHide(n))},_UIBase_render:r.prototype.render};i.inherits(n,r);i.extend(n.prototype,f,!0)}(),function(){var i=t.editor.utils,f=t.editor.ui.Stateful,r=t.editor.ui.uiUtils,u=t.editor.ui.UIBase,n=t.editor.ui.PastePicker=function(n){this.initOptions(n);this.initPastePicker()};n.prototype={initPastePicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"><\/div><div class="edui-pastecontainer"><div class="edui-title">'+this.editor.getLang("pasteOpt")+'<\/div><div class="edui-button"><div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful><div class="edui-richtxticon"><\/div><\/div><div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful><div class="edui-tagicon"><\/div><\/div><div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful><div class="edui-plaintxticon"><\/div><\/div><\/div><\/div><\/div>'},getStateDom:function(){return this.target},format:function(n){this.editor.ui._isTransfer=!0;this.editor.fireEvent("pasteTransfer",n)},_onClick:function(n){var t=domUtils.getNextDomNode(n),u=r.getViewportRect().height,i=r.getClientRect(t);t.style.top=i.top+i.height>u?-i.height-n.offsetHeight+"px":"";/hidden/ig.test(domUtils.getComputedStyle(t,"visibility"))?(t.style.visibility="visible",domUtils.addClass(n,"edui-state-opened")):(t.style.visibility="hidden",domUtils.removeClasses(n,"edui-state-opened"))},_UIBase_render:u.prototype.render};i.inherits(n,u);i.extend(n.prototype,f,!0)}(),function(){var i=t.editor.utils,r=t.editor.ui.uiUtils,u=t.editor.ui.UIBase,n=t.editor.ui.Toolbar=function(n){this.initOptions(n);this.initToolbar()};n.prototype={items:null,initToolbar:function(){this.items=this.items||[];this.initUIBase()},add:function(n,t){t===undefined?this.items.push(n):this.items.splice(t,0,n)},getHtmlTpl:function(){for(var t=[],n=0;n<this.items.length;n++)t[n]=this.items[n].renderHtml();return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+t.join("")+"<\/div>"},postRender:function(){for(var t=this.getDom(),n=0;n<this.items.length;n++)this.items[n].postRender();r.makeUnselectable(t)},_onMouseDown:function(n){var t=n.target||n.srcElement,i=t&&t.tagName&&t.tagName.toLowerCase();if(i=="input"||i=="object"||i=="object")return!1}};i.inherits(n,u)}(),function(){var e=t.editor.utils,u=t.editor.dom.domUtils,i=t.editor.ui.uiUtils,o=t.editor.ui.UIBase,r=t.editor.ui.Popup,s=t.editor.ui.Stateful,h=t.editor.ui.CellAlignPicker,f=t.editor.ui.Menu=function(n){this.initOptions(n);this.initMenu()},c={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"><\/div><\/div>'},postRender:function(){},queryAutoHide:function(){return!0}},n;f.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[];this.initPopup();this.initItems()},initItems:function(){for(var i,t=0;t<this.items.length;t++)i=this.items[t],i=="-"?this.items[t]=this.getSeparator():i instanceof n||(i.editor=this.editor,i.theme=this.editor.options.theme,this.items[t]=this.createItem(i))},getSeparator:function(){return c},createItem:function(t){return t.menu=this,new n(t)},_Popup_getContentHtmlTpl:r.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){var t,n,i;if(this.items.length==0)return this._Popup_getContentHtmlTpl();for(t=[],n=0;n<this.items.length;n++)i=this.items[n],t[n]=i.renderHtml();return'<div class="%%-body">'+t.join("")+"<\/div>"},_Popup_postRender:r.prototype.postRender,postRender:function(){for(var t,r=this,n=0;n<this.items.length;n++)t=this.items[n],t.ownerMenu=this,t.postRender();u.on(this.getDom(),"mouseover",function(n){n=n||event;var t=n.relatedTarget||n.fromElement,u=r.getDom();i.contains(u,t)||u===t||r.fireEvent("over")});this._Popup_postRender()},queryAutoHide:function(n){var t,r;if(n){if(i.contains(this.getDom(),n))return!1;for(t=0;t<this.items.length;t++)if(r=this.items[t],r.queryAutoHide(n)===!1)return!1}},clearItems:function(){for(var n,t=0;t<this.items.length;t++)n=this.items[t],clearTimeout(n._showingTimer),clearTimeout(n._closingTimer),n.subMenu&&n.subMenu.destroy();this.items=[]},destroy:function(){this.getDom()&&u.remove(this.getDom());this.clearItems()},dispose:function(){this.destroy()}};e.inherits(f,r);n=t.editor.ui.MenuItem=function(n){if(this.initOptions(n),this.initUIBase(),this.Stateful_init(),this.subMenu&&!(this.subMenu instanceof f))if(n.className&&n.className.indexOf("aligntd")!=-1){var t=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment");this.subMenu=new r({content:new h(this.subMenu),parentMenu:t,editor:t.editor,destroy:function(){this.getDom()&&u.remove(this.getDom())}});this.subMenu.addListener("postRenderAfter",function(){u.on(this.getDom(),"mouseover",function(){t.addState("opened")})})}else this.subMenu=new f(this.subMenu)};n.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:!0,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"<\/div><\/div>"},postRender:function(){var n=this;this.addListener("over",function(){n.ownerMenu.fireEvent("submenuover",n);n.subMenu&&n.delayShowSubMenu()});this.subMenu&&(this.getDom().className+=" edui-hassubmenu",this.subMenu.render(),this.addListener("out",function(){n.delayHideSubMenu()}),this.subMenu.addListener("over",function(){clearTimeout(n._closingTimer);n._closingTimer=null;n.addState("opened")}),this.ownerMenu.addListener("hide",function(){n.hideSubMenu()}),this.ownerMenu.addListener("submenuover",function(t,i){i!==n&&n.delayHideSubMenu()}),this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide,this.subMenu.queryAutoHide=function(t){return t&&i.contains(n.getDom(),t)?!1:this._bakQueryAutoHide(t)});this.getDom().style.tabIndex="-1";i.makeUnselectable(this.getDom());this.Stateful_postRender()},delayShowSubMenu:function(){var n=this;n.isDisabled()||(n.addState("opened"),clearTimeout(n._showingTimer),clearTimeout(n._closingTimer),n._closingTimer=null,n._showingTimer=setTimeout(function(){n.showSubMenu()},250))},delayHideSubMenu:function(){var n=this;n.isDisabled()||(n.removeState("opened"),clearTimeout(n._showingTimer),n._closingTimer||(n._closingTimer=setTimeout(function(){n.hasState("opened")||n.hideSubMenu();n._closingTimer=null},400)))},renderLabelHtml:function(){return'<div class="edui-arrow"><\/div><div class="edui-box edui-icon"><\/div><div class="edui-box edui-label %%-label">'+(this.label||"")+"<\/div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(n){if(this.subMenu&&this.hasState("opened"))return this.subMenu.queryAutoHide(n)},_onClick:function(n,t){this.hasState("disabled")||this.fireEvent("click",n,t)!==!1&&(this.subMenu?this.showSubMenu():r.postHide(n))},showSubMenu:function(){var n=i.getClientRect(this.getDom());n.right-=5;n.left+=2;n.width-=7;n.top-=4;n.bottom+=4;n.height+=8;this.subMenu.showAnchorRect(n,!0,!0)},hideSubMenu:function(){this.subMenu.hide()}};e.inherits(n,o);e.extend(n.prototype,s,!0)}(),function(){var r=t.editor.utils,u=t.editor.ui.uiUtils,f=t.editor.ui.Menu,n=t.editor.ui.SplitButton,i=t.editor.ui.Combox=function(n){this.initOptions(n);this.initCombox()};i.prototype={uiName:"combox",onbuttonclick:function(){this.showPopup()},initCombox:function(){var i=this,n,t;for(this.items=this.items||[],n=0;n<this.items.length;n++)t=this.items[n],t.uiName="listitem",t.index=n,t.onclick=function(){i.selectByIndex(this.index)};this.popup=new f({items:this.items,uiName:"list",editor:this.editor,captureWheel:!0,combox:this});this.initSplitButton()},_SplitButton_postRender:n.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.setLabel(this.label||"");this.setValue(this.initValue||"")},showPopup:function(){var n=u.getClientRect(this.getDom());n.top+=1;n.bottom-=1;n.height-=2;this.popup.showAnchorRect(n)},getValue:function(){return this.value},setValue:function(n){var t=this.indexByValue(n);t!=-1?(this.selectedIndex=t,this.setLabel(this.items[t].label),this.value=this.items[t].value):(this.selectedIndex=-1,this.setLabel(this.getLabelForUnknowValue(n)),this.value=n)},setLabel:function(n){this.getDom("button_body").innerHTML=n;this.label=n},getLabelForUnknowValue:function(n){return n},indexByValue:function(n){for(var t=0;t<this.items.length;t++)if(n==this.items[t].value)return t;return-1},getItem:function(n){return this.items[n]},selectByIndex:function(n){n<this.items.length&&this.fireEvent("select",n)!==!1&&(this.selectedIndex=n,this.value=this.items[n].value,this.setLabel(this.items[n].label))}};r.inherits(i,n)}(),function(){var r=t.editor.utils,i=t.editor.dom.domUtils,n=t.editor.ui.uiUtils,e=t.editor.ui.Mask,c=t.editor.ui.UIBase,u=t.editor.ui.Button,o=t.editor.ui.Dialog=function(n){if(n.name){var t=n.name,i=n.cssRules;n.className||(n.className="edui-for-"+t);i&&(n.cssRules=".edui-default .edui-for-"+t+" .edui-dialog-content  {"+i+"}")}this.initOptions(r.extend({autoReset:!0,draggable:!0,onok:function(){},oncancel:function(){},onclose:function(n,t){return t?this.onok():this.oncancel()},holdScroll:!1},n));this.initDialog()},s,h,f;o.prototype={draggable:!1,uiName:"dialog",initDialog:function(){var i=this,t=this.editor.options.theme,n;if(this.cssRules&&r.cssRule("edui-customize-"+this.name+"-style",this.cssRules),this.initUIBase(),this.modalMask=s||(s=new e({className:"edui-dialog-modalmask",theme:t,onclick:function(){f&&f.close(!1)}})),this.dragMask=h||(h=new e({className:"edui-dialog-dragmask",theme:t})),this.closeButton=new u({className:"edui-dialog-closebutton",title:i.closeDialog,theme:t,onclick:function(){i.close(!1)}}),this.fullscreen&&this.initResizeEvent(),this.buttons)for(n=0;n<this.buttons.length;n++)this.buttons[n]instanceof u||(this.buttons[n]=new u(r.extend(this.buttons[n],{editor:this.editor},!0)))},initResizeEvent:function(){var t=this;i.on(window,"resize",function(){t._hidden||t._hidden===undefined||(t.__resizeTimer&&window.clearTimeout(t.__resizeTimer),t.__resizeTimer=window.setTimeout(function(){t.__resizeTimer=null;var r=t.getDom(),u=t.getDom("content"),f=UE.ui.uiUtils.getClientRect(r),e=UE.ui.uiUtils.getClientRect(u),i=n.getViewportRect();u.style.width=i.width-f.width+e.width+"px";u.style.height=i.height-f.height+e.height+"px";r.style.width=i.width+"px";r.style.height=i.height+"px";t.fireEvent("resize")},100))})},fitSize:function(){var t=this.getDom("body"),n=this.mesureSize();return t.style.width=n.width+"px",t.style.height=n.height+"px",n},safeSetOffset:function(t){var o=this,f=o.getDom(),i=n.getViewportRect(),r=n.getClientRect(f),e=t.left,u;e+r.width>i.right&&(e=i.right-r.width);u=t.top;u+r.height>i.bottom&&(u=i.bottom-r.height);f.style.left=Math.max(e,0)+"px";f.style.top=Math.max(u,0)+"px"},showAtCenter:function(){var r=n.getViewportRect(),t,u,f,e;if(this.fullscreen)t=this.getDom(),u=this.getDom("content"),t.style.display="block",f=UE.ui.uiUtils.getClientRect(t),e=UE.ui.uiUtils.getClientRect(u),t.style.left="-100000px",u.style.width=r.width-f.width+e.width+"px",u.style.height=r.height-f.height+e.height+"px",t.style.width=r.width+"px",t.style.height=r.height+"px",t.style.left=0,this._originalContext={html:{overflowX:document.documentElement.style.overflowX,overflowY:document.documentElement.style.overflowY},body:{overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY}},document.documentElement.style.overflowX="hidden",document.documentElement.style.overflowY="hidden",document.body.style.overflowX="hidden",document.body.style.overflowY="hidden";else{this.getDom().style.display="";var o=this.fitSize(),s=this.getDom("titlebar").offsetHeight|0,c=r.width/2-o.width/2,l=r.height/2-(o.height-s)/2-s,h=this.getDom();this.safeSetOffset({left:Math.max(c|0,0),top:Math.max(l|0,0)});i.hasClass(h,"edui-state-centered")||(h.className+=" edui-state-centered")}this._show()},getContentHtml:function(){var n="";return typeof this.content=="string"?n=this.content:this.iframeUrl&&(n='<span id="'+this.id+'_contmask" class="dialogcontmask"><\/span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"><\/iframe>'),n},getHtmlTpl:function(){var i="",t,n;if(this.buttons){for(t=[],n=0;n<this.buttons.length;n++)t[n]=this.buttons[n].renderHtml();i='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+t.join("")+"<\/div><\/div>"}return'<div id="##" class="%%"><div '+(this.fullscreen?'class="%%-wrap edui-dialog-fullscreen-flag"':'class="%%"')+'><div id="##_body" class="%%-body"><div class="%%-shadow"><\/div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"<\/span><\/div>"+this.closeButton.renderHtml()+'<\/div><div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"<\/div>"+i+"<\/div><\/div><\/div>"},postRender:function(){var t,r;if(this.modalMask.getDom()||(this.modalMask.render(),this.modalMask.hide()),this.dragMask.getDom()||(this.dragMask.render(),this.dragMask.hide()),t=this,this.addListener("show",function(){t.modalMask.show(this.getDom().style.zIndex-2)}),this.addListener("hide",function(){t.modalMask.hide()}),this.buttons)for(r=0;r<this.buttons.length;r++)this.buttons[r].postRender();i.on(window,"resize",function(){setTimeout(function(){t.isHidden()||t.safeSetOffset(n.getClientRect(t.getDom()))})});this._hide()},mesureSize:function(){var t=this.getDom("body"),i=n.getClientRect(this.getDom("content")).width,r=t.style;return r.width=i,n.getClientRect(t)},_onTitlebarMouseDown:function(t){if(this.draggable){var u,f=n.getViewportRect(),r=this;n.startDrag(t,{ondragstart:function(){u=n.getClientRect(r.getDom());r.getDom("contmask").style.visibility="visible";r.dragMask.show(r.getDom().style.zIndex-1)},ondragmove:function(n,t){var i=u.left+n,f=u.top+t;r.safeSetOffset({left:i,top:f})},ondragstop:function(){r.getDom("contmask").style.visibility="hidden";i.removeClasses(r.getDom(),["edui-state-centered"]);r.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml();this.fireEvent("dialogafterreset")},_show:function(){this._hidden&&(this.getDom().style.display="",this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10),this._hidden=!1,this.fireEvent("show"),t.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4)},isHidden:function(){return this._hidden},_hide:function(){if(!this._hidden){var n=this.getDom();n.style.display="none";n.style.zIndex="";n.style.width="";n.style.height="";this._hidden=!0;this.fireEvent("hide")}},open:function(){if(this.autoReset)try{this.reset()}catch(n){this.render();this.open()}if(this.showAtCenter(),this.iframeUrl)try{this.getDom("iframe").focus()}catch(t){}f=this},_onCloseButtonClick:function(){this.close(!1)},close:function(n){var r,t,u;this.fireEvent("close",n)!==!1&&(this.fullscreen&&(document.documentElement.style.overflowX=this._originalContext.html.overflowX,document.documentElement.style.overflowY=this._originalContext.html.overflowY,document.body.style.overflowX=this._originalContext.body.overflowX,document.body.style.overflowY=this._originalContext.body.overflowY,delete this._originalContext),this._hide(),r=this.getDom("content"),t=this.getDom("iframe"),r&&t&&(u=t.contentDocument||t.contentWindow.document,u&&(u.body.innerHTML=""),i.remove(r)))}};r.inherits(o,c)}(),function(){var i=t.editor.utils,r=t.editor.ui.Menu,u=t.editor.ui.SplitButton,n=t.editor.ui.MenuButton=function(n){this.initOptions(n);this.initMenuButton()};n.prototype={initMenuButton:function(){var n=this;this.uiName="menubutton";this.popup=new r({items:n.items,className:n.className,editor:n.editor});this.popup.addListener("show",function(){for(var i=this,t=0;t<i.items.length;t++)i.items[t].removeState("checked"),i.items[t].value==n._value&&(i.items[t].addState("checked"),this.value=n._value)});this.initSplitButton()},setValue:function(n){this._value=n}};i.inherits(n,u)}(),function(){var i=t.editor.utils,r=t.editor.ui.Popup,u=t.editor.ui.SplitButton,n=t.editor.ui.MultiMenuPop=function(n){this.initOptions(n);this.initMultiMenu()};n.prototype={initMultiMenu:function(){var n=this;this.popup=new r({content:"",editor:n.editor,iframe_rendered:!1,onshow:function(){this.iframe_rendered||(this.iframe_rendered=!0,this.getDom("content").innerHTML='<iframe id="'+n.id+'_iframe" src="'+n.iframeUrl+'" frameborder="0"><\/iframe>',n.editor.container.style.zIndex&&(this.getDom().style.zIndex=n.editor.container.style.zIndex*1+1))}});this.onbuttonclick=function(){this.showPopup()};this.initSplitButton()}};i.inherits(n,u)}(),function(){function s(n){var u=n.target||n.srcElement,f=i.findParent(u,function(n){return i.hasClass(n,"edui-shortcutmenu")||i.hasClass(n,"edui-popup")},!0),t,r;if(!f)for(t=0;r=h[t++];)r.hide()}var r=t.editor.ui,l=r.UIBase,e=r.uiUtils,u=t.editor.utils,i=t.editor.dom.domUtils,h=[],c,f=!1,o=r.ShortCutMenu=function(n){this.initOptions(n);this.initShortCutMenu()};o.postHide=s;o.prototype={isHidden:!0,SPACE:5,initShortCutMenu:function(){this.items=this.items||[];this.initUIBase();this.initItems();this.initEvent();h.push(this)},initEvent:function(){var t=this,r=t.editor.document;i.on(r,"mousemove",function(n){if(t.isHidden===!1){if(t.getSubMenuMark()||t.eventType=="contextmenu")return;var o=!0,i=t.getDom(),s=i.offsetWidth,h=i.offsetHeight,f=s/2+t.SPACE,e=h/2,r=Math.abs(n.screenX-t.left),u=Math.abs(n.screenY-t.top);clearTimeout(c);c=setTimeout(function(){u>0&&u<e?t.setOpacity(i,"1"):u>e&&u<e+70?(t.setOpacity(i,"0.5"),o=!1):u>e+70&&u<e+140&&t.hide();o&&r>0&&r<f?t.setOpacity(i,"1"):r>f&&r<f+70?t.setOpacity(i,"0.5"):r>f+70&&r<f+140&&t.hide()})}});if(n.chrome)i.on(r,"mouseout",function(n){var i=n.relatedTarget||n.toElement;(i==null||i.tagName=="HTML")&&t.hide()});t.editor.addListener("afterhidepop",function(){t.isHidden||(f=!0)})},initItems:function(){var n,i,t;if(u.isArray(this.items))for(n=0,i=this.items.length;n<i;n++)t=this.items[n].toLowerCase(),r[t]&&(this.items[n]=new r[t](this.editor),this.items[n].className+=" edui-shortcutsubmenu ")},setOpacity:function(t,i){n.ie&&n.version<9?t.style.filter="alpha(opacity = "+parseFloat(i)*100+");":t.style.opacity=i},getSubMenuMark:function(){var n,t,r,u;for(f=!1,n=e.getFixedLayer(),t=i.getElementsByTagName(n,"div",function(n){return i.hasClass(n,"edui-shortcutsubmenu edui-popup")}),r=0;u=t[r++];)u.style.display!="none"&&(f=!0);return f},show:function(n,t){function h(n){n.left<0&&(n.left=0);n.top<0&&(n.top=0);u.style.cssText="position:absolute;left:"+n.left+"px;top:"+n.top+"px;"}function c(n){n.tagName||(n=n.getDom());f.left=parseInt(n.style.left);f.top=parseInt(n.style.top);f.top-=u.offsetHeight+15;h(f)}var r=this,f={},u=this.getDom(),s=e.getFixedLayer(),o;r.eventType=n.type;u.style.cssText="display:block;left:-9999px";n.type=="contextmenu"&&t?(o=i.getElementsByTagName(s,"div","edui-contextmenu")[0],o?c(o):r.editor.addListener("aftershowcontextmenu",function(n,t){c(t)})):(f=e.getViewportOffsetByEvent(n),f.top-=u.offsetHeight+r.SPACE,f.left+=r.SPACE+20,h(f),r.setOpacity(u,.2));r.isHidden=!1;r.left=n.screenX+u.offsetWidth/2-r.SPACE;r.top=n.screenY-u.offsetHeight/2-r.SPACE;r.editor&&(u.style.zIndex=r.editor.container.style.zIndex*1+10,s.style.zIndex=u.style.zIndex-1)},hide:function(){this.getDom()&&(this.getDom().style.display="none");this.isHidden=!0},postRender:function(){if(u.isArray(this.items))for(var t=0,n;n=this.items[t++];)n.postRender()},getHtmlTpl:function(){var n,t;if(u.isArray(this.items)){for(n=[],t=0;t<this.items.length;t++)n[t]=this.items[t].renderHtml();n=n.join("")}else n=this.items;return'<div id="##" class="%% edui-toolbar" data-src="shortcutmenu" onmousedown="return false;" onselectstart="return false;" >'+n+"<\/div>"}};u.inherits(o,l);i.on(document,"mousedown",function(n){s(n)});i.on(window,"scroll",function(n){s(n)})}(),function(){var i=t.editor.utils,r=t.editor.ui.UIBase,n=t.editor.ui.Breakline=function(n){this.initOptions(n);this.initSeparator()};n.prototype={uiName:"Breakline",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return"<br/>"}};i.inherits(n,r)}(),function(){var i=t.editor.utils,r=t.editor.dom.domUtils,u=t.editor.ui.UIBase,n=t.editor.ui.Message=function(n){this.initOptions(n);this.initMessage()};n.prototype={initMessage:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-message %%"> <div id="##_closer" class="edui-message-closer">×<\/div> <div id="##_body" class="edui-message-body edui-message-type-info"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"><\/iframe> <div class="edui-shadow"><\/div> <div id="##_content" class="edui-message-content">  <\/div> <\/div><\/div>'},reset:function(n){var t=this;n.keepshow||(clearTimeout(this.timer),t.timer=setTimeout(function(){t.hide()},n.timeout||4e3));n.content!==undefined&&t.setContent(n.content);n.type!==undefined&&t.setType(n.type);t.show()},postRender:function(){var t=this,n=this.getDom("closer");n&&r.on(n,"click",function(){t.hide()})},setContent:function(n){this.getDom("content").innerHTML=n},setType:function(n){n=n||"info";var t=this.getDom("body");t.className=t.className.replace(/edui-message-type-[\w-]+/,"edui-message-type-"+n)},getContent:function(){return this.getDom("content").innerHTML},getType:function(){var n=this.getDom("body").match(/edui-message-type-([\w-]+)/);return n?n[1]:""},show:function(){this.getDom().style.display="block"},hide:function(){var n=this.getDom();n&&(n.style.display="none",n.parentNode&&n.parentNode.removeChild(n))}};i.inherits(n,u)}(),function(){var f=t.editor.utils,i=t.editor.ui,b=i.Dialog,e,c,s,o,r,h,u,l,a,v,y,p,w;for(i.buttons={},i.Dialog=function(t){var i=new b(t);return i.addListener("hide",function(){var t,r,u;if(i.editor){t=i.editor;try{n.gecko?(r=t.window.scrollY,u=t.window.scrollX,t.body.focus(),t.window.scrollTo(u,r)):t.focus()}catch(f){}}}),i},e={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",preview:"~/dialogs/preview/preview.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html",charts:"~/dialogs/charts/charts.html"},c=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable","drafts"],o=0;r=c[o++];)r=r.toLowerCase(),i[r]=function(n){return function(t){var r=new i.Button({className:"edui-for-"+n,title:t.options.labelMap[n]||t.getLang("labelMap."+n)||"",onclick:function(){t.execCommand(n)},theme:t.options.theme,showText:!1});return i.buttons[n]=r,t.addListener("selectionchange",function(i,u,f){var e=t.queryCommandState(n);e==-1?(r.setDisabled(!0),r.setChecked(!1)):f||(r.setDisabled(!1),r.setChecked(e))}),r}}(r);i.cleardoc=function(n){var t=new i.Button({className:"edui-for-cleardoc",title:n.options.labelMap.cleardoc||n.getLang("labelMap.cleardoc")||"",theme:n.options.theme,onclick:function(){confirm(n.getLang("confirmClear"))&&n.execCommand("cleardoc")}});return i.buttons.cleardoc=t,n.addListener("selectionchange",function(){t.setDisabled(n.queryCommandState("cleardoc")==-1)}),t};s={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(u in s)(function(n,t){for(var u=0,r;r=t[u++];)(function(t){i[n.replace("float","")+t]=function(r){var u=new i.Button({className:"edui-for-"+n.replace("float","")+t,title:r.options.labelMap[n.replace("float","")+t]||r.getLang("labelMap."+n.replace("float","")+t)||"",theme:r.options.theme,onclick:function(){r.execCommand(n,t)}});return i.buttons[n]=u,r.addListener("selectionchange",function(i,f,e){u.setDisabled(r.queryCommandState(n)==-1);u.setChecked(r.queryCommandValue(n)==t&&!e)}),u}})(r)})(u,s[u]);for(o=0;r=["backcolor","forecolor"][o++];)i[r]=function(n){return function(t){var r=new i.ColorButton({className:"edui-for-"+n,color:"default",title:t.options.labelMap[n]||t.getLang("labelMap."+n)||"",editor:t,onpickcolor:function(i,r){t.execCommand(n,r)},onpicknocolor:function(){t.execCommand(n,"default");this.setColor("transparent");this.color="default"},onbuttonclick:function(){t.execCommand(n,this.color)}});return i.buttons[n]=r,t.addListener("selectionchange",function(){r.setDisabled(t.queryCommandState(n)==-1)}),r}}(r);h={noOk:["searchreplace","help","spechars","webapp","preview"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","insertframe","edittip","edittable","edittd","scrawl","template","music","background","charts"]};for(u in h)(function(t,r){for(var o=0,u;u=r[o++];)n.opera&&u==="searchreplace"||function(n){i[n]=function(r,u,o){var s,h;return u=u||(r.options.iframeUrlMap||{})[n]||e[n],o=r.options.labelMap[n]||r.getLang("labelMap."+n)||"",u&&(s=new i.Dialog(f.extend({iframeUrl:r.ui.mapUrl(u),editor:r,className:"edui-for-"+n,title:o,holdScroll:n==="insertimage",fullscreen:/charts|preview/.test(n),closeDialog:r.getLang("closeDialog")},t=="ok"?{buttons:[{className:"edui-okbutton",label:r.getLang("ok"),editor:r,onclick:function(){s.close(!0)}},{className:"edui-cancelbutton",label:r.getLang("cancel"),editor:r,onclick:function(){s.close(!1)}}]}:{})),r.ui._dialogs[n+"Dialog"]=s),h=new i.Button({className:"edui-for-"+n,title:o,onclick:function(){if(s)switch(n){case"wordimage":var t=r.execCommand("wordimage");t&&t.length&&(s.render(),s.open());break;case"scrawl":r.queryCommandState("scrawl")!=-1&&(s.render(),s.open());break;default:s.render();s.open()}},theme:r.options.theme,disabled:n=="scrawl"&&r.queryCommandState("scrawl")==-1||n=="charts"}),i.buttons[n]=h,r.addListener("selectionchange",function(){var t;n in{edittable:1}||(t=r.queryCommandState(n),h.getDom()&&(h.setDisabled(t==-1),h.setChecked(t)))}),h}}(u.toLowerCase())})(u,h[u]);for(i.snapscreen=function(n,t,r){var f,u;return r=n.options.labelMap.snapscreen||n.getLang("labelMap.snapscreen")||"",f=new i.Button({className:"edui-for-snapscreen",title:r,onclick:function(){n.execCommand("snapscreen")},theme:n.options.theme}),i.buttons.snapscreen=f,t=t||(n.options.iframeUrlMap||{}).snapscreen||e.snapscreen,t&&(u=new i.Dialog({iframeUrl:n.ui.mapUrl(t),editor:n,className:"edui-for-snapscreen",title:r,buttons:[{className:"edui-okbutton",label:n.getLang("ok"),editor:n,onclick:function(){u.close(!0)}},{className:"edui-cancelbutton",label:n.getLang("cancel"),editor:n,onclick:function(){u.close(!1)}}]}),u.render(),n.ui._dialogs.snapscreenDialog=u),n.addListener("selectionchange",function(){f.setDisabled(n.queryCommandState("snapscreen")==-1)}),f},i.insertcode=function(n,t,r){var e,u;return t=n.options.insertcode||[],r=n.options.labelMap.insertcode||n.getLang("labelMap.insertcode")||"",e=[],f.each(t,function(t,i){e.push({label:t,value:i,theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"<\/div>"}})}),u=new i.Combox({editor:n,items:e,onselect:function(t,i){n.execCommand("insertcode",this.items[i].value)},onbuttonclick:function(){this.showPopup()},title:r,initValue:r,className:"edui-for-insertcode",indexByValue:function(n){if(n)for(var t=0,i;i=this.items[t];t++)if(i.value.indexOf(n)!=-1)return t;return-1}}),i.buttons.insertcode=u,n.addListener("selectionchange",function(t,i,f){var o,e;if(!f)if(o=n.queryCommandState("insertcode"),o==-1)u.setDisabled(!0);else{if(u.setDisabled(!1),e=n.queryCommandValue("insertcode"),!e){u.setValue(r);return}e&&(e=e.replace(/['"]/g,"").split(",")[0]);u.setValue(e)}}),u},i.fontfamily=function(n,t,r){var o,e,s,h,u;if(t=n.options.fontfamily||[],r=n.options.labelMap.fontfamily||n.getLang("labelMap.fontfamily")||"",t.length){for(o=0,s=[];e=t[o];o++)h=n.getLang("fontfamily")[e.name]||"",function(t,i){s.push({label:t,value:i,theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+f.unhtml(this.value)+'">'+(this.label||"")+"<\/div>"}})}(e.label||h,e.val);return u=new i.Combox({editor:n,items:s,onselect:function(t,i){n.execCommand("FontFamily",this.items[i].value)},onbuttonclick:function(){this.showPopup()},title:r,initValue:r,className:"edui-for-fontfamily",indexByValue:function(n){if(n)for(var t=0,i;i=this.items[t];t++)if(i.value.indexOf(n)!=-1)return t;return-1}}),i.buttons.fontfamily=u,n.addListener("selectionchange",function(t,i,r){var e,f;r||(e=n.queryCommandState("FontFamily"),e==-1?u.setDisabled(!0):(u.setDisabled(!1),f=n.queryCommandValue("FontFamily"),f&&(f=f.replace(/['"]/g,"").split(",")[0]),u.setValue(f)))}),u}},i.fontsize=function(n,t,r){var e,f,o,u;if(r=n.options.labelMap.fontsize||n.getLang("labelMap.fontsize")||"",t=t||n.options.fontsize||[],t.length){for(e=[],f=0;f<t.length;f++)o=t[f]+"px",e.push({label:o,value:o,theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"<\/div>"}});return u=new i.Combox({editor:n,items:e,title:r,initValue:r,onselect:function(t,i){n.execCommand("FontSize",this.items[i].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"}),i.buttons.fontsize=u,n.addListener("selectionchange",function(t,i,r){if(!r){var f=n.queryCommandState("FontSize");f==-1?u.setDisabled(!0):(u.setDisabled(!1),u.setValue(n.queryCommandValue("FontSize")))}}),u}},i.paragraph=function(n,t,r){var o,e,u;if(r=n.options.labelMap.paragraph||n.getLang("labelMap.paragraph")||"",t=n.options.paragraph||[],!f.isEmptyObject(t)){o=[];for(e in t)o.push({value:e,label:t[e]||n.getLang("paragraph")[e],theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"<\/span><\/div>"}});return u=new i.Combox({editor:n,items:o,title:r,initValue:r,className:"edui-for-paragraph",onselect:function(t,i){n.execCommand("Paragraph",this.items[i].value)},onbuttonclick:function(){this.showPopup()}}),i.buttons.paragraph=u,n.addListener("selectionchange",function(t,i,r){var e,f,o;r||(e=n.queryCommandState("Paragraph"),e==-1?u.setDisabled(!0):(u.setDisabled(!1),f=n.queryCommandValue("Paragraph"),o=u.indexByValue(f),o!=-1?u.setValue(f):u.setValue(u.initValue)))}),u}},i.customstyle=function(n){var u=n.options.customstyle||[],f=n.options.labelMap.customstyle||n.getLang("labelMap.customstyle")||"",e,o,r,s,t;if(u.length){for(e=n.getLang("customstyle"),o=0,r=[];s=u[o++];)(function(t){var i={};i.label=t.label?t.label:e[t.name];i.style=t.style;i.className=t.className;i.tag=t.tag;r.push({label:i.label,value:i,theme:n.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><'+i.tag+" "+(i.className?' class="'+i.className+'"':"")+(i.style?' style="'+i.style+'"':"")+">"+i.label+"<\/"+i.tag+"><\/div>"}})})(s);return t=new i.Combox({editor:n,items:r,title:f,initValue:f,className:"edui-for-customstyle",onselect:function(t,i){n.execCommand("customstyle",this.items[i].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(n){for(var t=0,i;i=this.items[t++];)if(i.label==n)return t-1;return-1}}),i.buttons.customstyle=t,n.addListener("selectionchange",function(i,r,u){var e,f,o;u||(e=n.queryCommandState("customstyle"),e==-1?t.setDisabled(!0):(t.setDisabled(!1),f=n.queryCommandValue("customstyle"),o=t.indexByValue(f),o!=-1?t.setValue(f):t.setValue(t.initValue)))}),t}},i.inserttable=function(n,t,r){r=n.options.labelMap.inserttable||n.getLang("labelMap.inserttable")||"";var u=new i.TableButton({editor:n,title:r,className:"edui-for-inserttable",onpicktable:function(t,i,r){n.execCommand("InsertTable",{numRows:r,numCols:i,border:1})},onbuttonclick:function(){this.showPopup()}});return i.buttons.inserttable=u,n.addListener("selectionchange",function(){u.setDisabled(n.queryCommandState("inserttable")==-1)}),u},i.lineheight=function(n){var f=n.options.lineheight||[],e,r,u,t;if(f.length){for(e=0,u=[];r=f[e++];)u.push({label:r,value:r,theme:n.options.theme,onclick:function(){n.execCommand("lineheight",this.value)}});return t=new i.MenuButton({editor:n,className:"edui-for-lineheight",title:n.options.labelMap.lineheight||n.getLang("labelMap.lineheight")||"",items:u,onbuttonclick:function(){var t=n.queryCommandValue("LineHeight")||this.value;n.execCommand("LineHeight",t)}}),i.buttons.lineheight=t,n.addListener("selectionchange",function(){var r=n.queryCommandState("LineHeight"),i;r==-1?t.setDisabled(!0):(t.setDisabled(!1),i=n.queryCommandValue("LineHeight"),i&&t.setValue((i+"").replace(/cm/,"")),t.setChecked(r))}),t}},l=["top","bottom"],a=0;v=l[a++];)(function(n){i["rowspacing"+n]=function(t){var e=t.options["rowspacing"+n]||[],o,u,f,r;if(!e.length)return null;for(o=0,f=[];u=e[o++];)f.push({label:u,value:u,theme:t.options.theme,onclick:function(){t.execCommand("rowspacing",this.value,n)}});return r=new i.MenuButton({editor:t,className:"edui-for-rowspacing"+n,title:t.options.labelMap["rowspacing"+n]||t.getLang("labelMap.rowspacing"+n)||"",items:f,onbuttonclick:function(){var i=t.queryCommandValue("rowspacing",n)||this.value;t.execCommand("rowspacing",i,n)}}),i.buttons[n]=r,t.addListener("selectionchange",function(){var u=t.queryCommandState("rowspacing",n),i;u==-1?r.setDisabled(!0):(r.setDisabled(!1),i=t.queryCommandValue("rowspacing",n),i&&r.setValue((i+"").replace(/%/,"")),r.setChecked(u))}),r}})(v);for(y=["insertorderedlist","insertunorderedlist"],p=0;w=y[p++];)(function(n){i[n]=function(t){var f=t.options[n],o=function(){t.execCommand(n,this.value)},e=[],u,r;for(u in f)e.push({label:f[u]||t.getLang()[n][u]||"",value:u,theme:t.options.theme,onclick:o});return r=new i.MenuButton({editor:t,className:"edui-for-"+n,title:t.getLang("labelMap."+n)||"",items:e,onbuttonclick:function(){var i=t.queryCommandValue(n)||this.value;t.execCommand(n,i)}}),i.buttons[n]=r,t.addListener("selectionchange",function(){var i=t.queryCommandState(n),u;i==-1?r.setDisabled(!0):(r.setDisabled(!1),u=t.queryCommandValue(n),r.setValue(u),r.setChecked(i))}),r}})(w);i.fullscreen=function(n,t){t=n.options.labelMap.fullscreen||n.getLang("labelMap.fullscreen")||"";var r=new i.Button({className:"edui-for-fullscreen",title:t,theme:n.options.theme,onclick:function(){n.ui&&n.ui.setFullScreen(!n.ui.isFullScreen());this.setChecked(n.ui.isFullScreen())}});return i.buttons.fullscreen=r,n.addListener("selectionchange",function(){var t=n.queryCommandState("fullscreen");r.setDisabled(t==-1);r.setChecked(n.ui.isFullScreen())}),r};i.emotion=function(n,t){var r="emotion",u=new i.MultiMenuPop({title:n.options.labelMap[r]||n.getLang("labelMap."+r+"")||"",editor:n,className:"edui-for-"+r,iframeUrl:n.ui.mapUrl(t||(n.options.iframeUrlMap||{})[r]||e[r])});return i.buttons[r]=u,n.addListener("selectionchange",function(){u.setDisabled(n.queryCommandState(r)==-1)}),u};i.autotypeset=function(n){var t=new i.AutoTypeSetButton({editor:n,title:n.options.labelMap.autotypeset||n.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){n.execCommand("autotypeset")}});return i.buttons.autotypeset=t,n.addListener("selectionchange",function(){t.setDisabled(n.queryCommandState("autotypeset")==-1)}),t};i.simpleupload=function(n){var r="simpleupload",t=new i.Button({className:"edui-for-"+r,title:n.options.labelMap[r]||n.getLang("labelMap."+r)||"",onclick:function(){},theme:n.options.theme,showText:!1});return i.buttons[r]=t,n.addListener("ready",function(){var i=t.getDom("body"),r=i.children[0];n.fireEvent("simpleuploadbtnready",r)}),n.addListener("selectionchange",function(i,u,f){var e=n.queryCommandState(r);e==-1?(t.setDisabled(!0),t.setChecked(!1)):f||(t.setDisabled(!1),t.setChecked(e))}),t}}(),function(){function f(n){this.initOptions(n);this.initEditorUI()}var u=t.editor.utils,e=t.editor.ui.uiUtils,s=t.editor.ui.UIBase,i=t.editor.dom.domUtils,o=[],r;f.prototype={uiName:"editor",initEditorUI:function(){function s(n,t){var r;n.setOpt({wordCount:!0,maximumWords:1e4,wordCountMsg:n.options.wordCountMsg||n.getLang("wordCountMsg"),wordOverFlowMsg:n.options.wordOverFlowMsg||n.getLang("wordOverFlowMsg")});var i=n.options,u=i.maximumWords,e=i.wordCountMsg,o=i.wordOverFlowMsg,f=t.getDom("wordcount");i.wordCount&&(r=n.getContentLength(!0),r>u?(f.innerHTML=o,n.fireEvent("wordcountoverflow")):f.innerHTML=e.replace("{#leave}",u-r).replace("{#count}",r))}var n,f,u,e,o,r;this.editor.ui=this;this._dialogs={};this.initUIBase();this._initToolbars();n=this.editor;f=this;n.addListener("ready",function(){n.getDialog=function(t){return n.ui._dialogs[t+"Dialog"]};i.on(n.window,"scroll",function(n){t.editor.ui.Popup.postHide(n)});if(n.ui._actualFrameWidth=n.options.initialFrameWidth,UE.browser.ie&&UE.browser.version===6&&n.container.ownerDocument.execCommand("BackgroundImageCache",!1,!0),n.options.elementPathEnabled&&(n.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+n.getLang("elementPathTip")+":<\/div>"),n.options.wordCount){function r(){s(n,f);i.un(n.document,"click",arguments.callee)}i.on(n.document,"click",r);n.ui.getDom("wordcount").innerHTML=n.getLang("wordCountTip")}(n.ui._scale(),n.options.scaleEnabled?(n.autoHeightEnabled&&n.disableAutoHeight(),f.enableScale()):f.disableScale(),n.options.elementPathEnabled||n.options.wordCount||n.options.scaleEnabled||(n.ui.getDom("elementpath").style.display="none",n.ui.getDom("wordcount").style.display="none",n.ui.getDom("scale").style.display="none"),n.selection.isFocus())&&n.fireEvent("selectionchange",!1,!0)});n.addListener("mousedown",function(n,i){var r=i.target||i.srcElement;t.editor.ui.Popup.postHide(i,r);t.editor.ui.ShortCutMenu.postHide(i)});n.addListener("delcells",function(){UE.ui.edittip&&new UE.ui.edittip(n);n.getDialog("edittip").open()});e=!1;n.addListener("afterpaste",function(){n.queryCommandState("pasteplain")||(t.editor.ui.PastePicker&&(u=new t.editor.ui.Popup({content:new t.editor.ui.PastePicker({editor:n}),editor:n,className:"edui-wordpastepop"}),u.render()),e=!0)});n.addListener("afterinserthtml",function(){clearTimeout(o);o=setTimeout(function(){var r,f,t;u&&(e||n.ui._isTransfer)&&(u.isHidden()?(r=i.createElement(n.document,"span",{style:"line-height:0px;",innerHTML:"﻿"}),f=n.selection.getRange(),f.insertNode(r),t=h(r,"firstChild","previousSibling"),t&&u.showAnchor(t.nodeType==3?t.parentNode:t),i.remove(r)):u.show(),delete n.ui._isTransfer,e=!1)},200)});n.addListener("contextmenu",function(n,i){t.editor.ui.Popup.postHide(i)});n.addListener("keydown",function(n,t){u&&u.dispose(t);var i=t.keyCode||t.which;t.altKey&&i==90&&UE.ui.buttons.fullscreen.onclick()});n.addListener("wordcount",function(){s(this,f)});n.addListener("selectionchange",function(){n.options.elementPathEnabled&&f[(n.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"]();n.options.scaleEnabled&&f[(n.queryCommandState("scale")==-1?"dis":"en")+"ableScale"]()});r=new t.editor.ui.Popup({editor:n,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide();n.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(t){this.hide();n.ui._dialogs[t]&&n.ui._dialogs[t].open()},_onImgSetFloat:function(t){this.hide();n.execCommand("imagefloat",t)},_setIframeAlign:function(n){var u=r.anchorEl,t=u.cloneNode(!0);switch(n){case-2:t.setAttribute("align","");break;case-1:t.setAttribute("align","left");break;case 1:t.setAttribute("align","right")}u.parentNode.insertBefore(t,u);i.remove(u);r.anchorEl=t;r.showAnchor(r.anchorEl)},_updateIframe:function(){var t=n._iframe=r.anchorEl;i.hasClass(t,"ueditor_baidumap")?(n.selection.getRange().selectNode(t).select(),n.ui._dialogs.mapDialog.open(),r.hide()):(n.ui._dialogs.insertframeDialog.open(),r.hide())},_onRemoveButtonClick:function(t){n.execCommand(t);this.hide()},queryAutoHide:function(u){return u&&u.ownerDocument==n.document&&(u.tagName.toLowerCase()=="img"||i.findParentByTagName(u,"a",!0))?u!==r.anchorEl:t.editor.ui.Popup.prototype.queryAutoHide.call(this,u)}});r.render();n.options.imagePopup&&(n.addListener("mouseover",function(t,i){var u,f;i=i||window.event;u=i.target||i.srcElement;n.ui._dialogs.insertframeDialog&&/iframe/ig.test(u.tagName)&&(f=r.formatHtml("<nobr>"+n.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+n.getLang("default")+'<\/span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+n.getLang("justifyleft")+'<\/span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+n.getLang("justifyright")+'<\/span>&nbsp;&nbsp; <span onclick="$$._updateIframe( this);" class="edui-clickable">'+n.getLang("modify")+"<\/span><\/nobr>"),f?(r.getDom("content").innerHTML=f,r.anchorEl=u,r.showAnchor(r.anchorEl)):r.hide())}),n.addListener("selectionchange",function(t,u){var e,s,h,c;if(u){var o="",l="",f=n.selection.getRange().getClosedNode(),a=n.ui._dialogs;if(f&&f.tagName=="IMG"){if(e="insertimageDialog",(f.className.indexOf("edui-faked-video")!=-1||f.className.indexOf("edui-upload-video")!=-1)&&(e="insertvideoDialog"),f.className.indexOf("edui-faked-webapp")!=-1&&(e="webappDialog"),f.src.indexOf("http://api.map.baidu.com")!=-1&&(e="mapDialog"),f.className.indexOf("edui-faked-music")!=-1&&(e="musicDialog"),f.src.indexOf("http://maps.google.com/maps/api/staticmap")!=-1&&(e="gmapDialog"),f.getAttribute("anchorname")&&(e="anchorDialog",o=r.formatHtml("<nobr>"+n.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+n.getLang("modify")+"<\/span>&nbsp;&nbsp;<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+n.getLang("delete")+"<\/span><\/nobr>")),f.getAttribute("word_img")&&(n.word_img=[f.getAttribute("word_img")],e="wordimageDialog"),(i.hasClass(f,"loadingclass")||i.hasClass(f,"loaderrorclass"))&&(e=""),!a[e])return;l="<nobr>"+n.getLang("property")+': <span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+n.getLang("default")+'<\/span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+n.getLang("justifyleft")+'<\/span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+n.getLang("justifyright")+'<\/span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+n.getLang("justifycenter")+"<\/span>&nbsp;&nbsp;<span onclick=\"$$._onImgEditButtonClick('"+e+'\');" class="edui-clickable">'+n.getLang("modify")+"<\/span><\/nobr>";o||(o=r.formatHtml(l))}n.ui._dialogs.linkDialog&&(s=n.queryCommandValue("link"),s&&(h=s.getAttribute("_href")||s.getAttribute("href",2))&&(c=h,h.length>30&&(c=h.substring(0,20)+"..."),o&&(o+='<div style="height:5px;"><\/div>'),o+=r.formatHtml("<nobr>"+n.getLang("anthorMsg")+': <a target="_blank" href="'+h+'" title="'+h+'" >'+c+'<\/a> <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+n.getLang("modify")+'<\/span> <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+n.getLang("clear")+"<\/span><\/nobr>"),r.showAnchor(s)));o?(r.getDom("content").innerHTML=o,r.anchorEl=f||s,r.showAnchor(r.anchorEl)):r.hide()}}))},_initToolbars:function(){for(var h,r,s,n,i,f=this.editor,c=this.toolbars||[],e=[],o=0;o<c.length;o++){for(h=c[o],r=new t.editor.ui.Toolbar({theme:f.options.theme}),s=0;s<h.length;s++){if(n=h[s],i=null,typeof n=="string"){if(n=n.toLowerCase(),n=="|"&&(n="Separator"),n=="||"&&(n="Breakline"),t.editor.ui[n]&&(i=new t.editor.ui[n](f)),n=="fullscreen"){e&&e[0]?e[0].items.splice(0,0,i):i&&r.items.splice(0,0,i);continue}}else i=n;i&&i.id&&r.add(i)}e[o]=r}u.each(UE._customizeUI,function(n,t){var u,i;if(n.id&&n.id!=f.key)return!1;u=n.execFn.call(f,f,t);u&&(i=n.index,i===undefined&&(i=r.items.length),r.add(u,i))});this.toolbars=e},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"<\/div><\/div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;"><div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+'<\/div><div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x<\/div><div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"><\/div><div style="height:0;overflow:hidden;clear:both;"><\/div><\/div><div id="##_message_holder" class="%%-messageholder"><\/div><\/div><div id="##_iframeholder" class="%%-iframeholder"><\/div><div id="##_bottombar" class="%%-bottomContainer"><table><tr><td id="##_elementpath" class="%%-bottombar"><\/td><td id="##_wordcount" class="%%-wordcount"><\/td><td id="##_scale" class="%%-scale"><div class="%%-icon"><\/div><\/td><\/tr><\/table><\/div><div id="##_scalelayer"><\/div><\/div>'},showWordImageDialog:function(){this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){for(var t=[],n=0;n<this.toolbars.length;n++)t.push(this.toolbars[n].renderHtml());return t.join("")},setFullScreen:function(i){var r=this.editor,u=r.container.parentNode.parentNode,e,s,f;if(this._fullscreen!=i){if(this._fullscreen=i,this.editor.fireEvent("beforefullscreenchange",i),t.editor.browser.gecko&&(e=r.selection.getRange().createBookmark()),i){while(u.tagName!="BODY")s=t.editor.dom.domUtils.getComputedStyle(u,"position"),o.push(s),u.style.position="static",u=u.parentNode;this._bakHtmlOverflow=document.documentElement.style.overflow;this._bakBodyOverflow=document.body.style.overflow;this._bakAutoHeight=this.editor.autoHeightEnabled;this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop);this._bakEditorContaninerWidth=r.iframe.parentNode.offsetWidth;this._bakAutoHeight&&(r.autoHeightEnabled=!1,this.editor.disableAutoHeight());document.documentElement.style.overflow="hidden";window.scrollTo(0,window.scrollY);this._bakCssText=this.getDom().style.cssText;this._bakCssText1=this.getDom("iframeholder").style.cssText;r.iframe.parentNode.style.width="";this._updateFullScreen()}else{while(u.tagName!="BODY")u.style.position=o.shift(),u=u.parentNode;this.getDom().style.cssText=this._bakCssText;this.getDom("iframeholder").style.cssText=this._bakCssText1;this._bakAutoHeight&&(r.autoHeightEnabled=!0,this.editor.enableAutoHeight());document.documentElement.style.overflow=this._bakHtmlOverflow;document.body.style.overflow=this._bakBodyOverflow;r.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px";window.scrollTo(0,this._bakScrollTop)}n.gecko&&r.body.contentEditable==="true"&&(f=document.createElement("input"),document.body.appendChild(f),r.body.contentEditable=!1,setTimeout(function(){f.focus();setTimeout(function(){r.body.contentEditable=!0;r.fireEvent("fullscreenchanged",i);r.selection.getRange().moveToBookmark(e).select(!0);t.editor.dom.domUtils.remove(f);i&&window.scroll(0,0)},0)},0));r.body.contentEditable==="true"&&(this.editor.fireEvent("fullscreenchanged",i),this.triggerLayout())}},_updateFullScreen:function(){if(this._fullscreen){var t=e.getViewportRect();if(this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+t.width+"px;height:"+t.height+"px;z-index:"+(this.getDom().style.zIndex*1+100),e.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0}),this.editor.setHeight(t.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0),!0),n.gecko)try{window.onresize()}catch(i){}}},_updateElementPath:function(){var i=this.getDom("elementpath"),r,t,n,u;if(this.elementPathEnabled&&(r=this.editor.queryCommandValue("elementpath"))){for(t=[],n=0;u=r[n];n++)t[n]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+n+'&quot;);">'+u+"<\/span>");i.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+t.join(" &gt; ")+"<\/div>"}else i.style.display="none"},disableElementPath:function(){var n=this.getDom("elementpath");n.innerHTML="";n.style.display="none";this.elementPathEnabled=!1},enableElementPath:function(){var n=this.getDom("elementpath");n.style.display="";this.elementPathEnabled=!0;this._updateElementPath()},_scale:function(){function d(){c=i.getXY(e);l||(l=t.options.minFrameHeight+p.offsetHeight+w.offsetHeight);u.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+e.offsetWidth+"px;height:"+e.offsetHeight+"px;z-index:"+(t.options.zIndex+1);i.on(r,"mousemove",g);i.on(y,"mouseup",h);i.on(r,"mouseup",h)}function g(n){nt();var t=n||window.event;b=t.pageX||r.documentElement.scrollLeft+t.clientX;k=t.pageY||r.documentElement.scrollTop+t.clientY;a=b-c.x;v=k-c.y;a>=tt&&(s=!0,u.style.width=a+"px");v>=l&&(s=!0,u.style.height=v+"px")}function h(){s&&(s=!1,t.ui._actualFrameWidth=u.offsetWidth-2,e.style.width=t.ui._actualFrameWidth+"px",t.setHeight(u.offsetHeight-w.offsetHeight-p.offsetHeight-2,!0));u&&(u.style.display="none");nt();i.un(r,"mousemove",g);i.un(y,"mouseup",h);i.un(r,"mouseup",h)}function nt(){n.ie?r.selection.clear():window.getSelection().removeAllRanges()}var r=document,t=this.editor,e=t.container,y=t.document,p=this.getDom("toolbarbox"),w=this.getDom("bottombar"),o=this.getDom("scale"),u=this.getDom("scalelayer"),s=!1,c=null,l=0,tt=t.options.minFrameWidth,b=0,k=0,a=0,v=0,f=this;this.editor.addListener("fullscreenchanged",function(n,t){if(t)f.disableScale();else if(f.editor.options.scaleEnabled){f.enableScale();var r=f.editor.document.createElement("span");f.editor.body.appendChild(r);f.editor.body.style.height=Math.max(i.getXY(r).y,f.editor.iframe.offsetHeight-20)+"px";i.remove(r)}});this.enableScale=function(){if(t.queryCommandState("source")!=1){o.style.display="";this.scaleEnabled=!0;i.on(o,"mousedown",d)}};this.disableScale=function(){o.style.display="none";this.scaleEnabled=!1;i.un(o,"mousedown",d)}},isFullScreen:function(){return this._fullscreen},postRender:function(){var n;for(s.prototype.postRender.call(this),n=0;n<this.toolbars.length;n++)this.toolbars[n].postRender();var r=this,i,u=t.editor.dom.domUtils,f=function(){clearTimeout(i);i=setTimeout(function(){r._updateFullScreen()})};u.on(window,"resize",f);r.addListener("destroy",function(){u.un(window,"resize",f);clearTimeout(i)})},showToolbarMsg:function(n,t){if(this.getDom("toolbarmsg_label").innerHTML=n,this.getDom("toolbarmsg").style.display="",!t){var i=this.getDom("upload_dialog");i.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(n){return n?n.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var n=this.getDom();n.style.zoom=n.style.zoom=="1"?"100%":"1"}};u.inherits(f,t.editor.ui.UIBase);r={};UE.ui.Editor=function(n){var t=new UE.Editor(n),e;return t.options.editor=t,u.loadFile(document,{href:t.options.themePath+t.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"}),e=t.render,t.render=function(n){n.constructor===String&&(t.key=n,r[n]=t);u.domReady(function(){function r(){var o,h,r,c,l,a,u,s;for(t.setOpt({labelMap:t.options.labelMap||t.getLang("labelMap")}),new f(t.options),n&&(n.constructor===String&&(n=document.getElementById(n)),n&&n.getAttribute("name")&&(t.options.textarea=n.getAttribute("name")),n&&/script|textarea/ig.test(n.tagName)&&(o=document.createElement("div"),n.parentNode.insertBefore(o,n),h=n.value||n.innerHTML,t.options.initialContent=/^[\t\r\n ]*$/.test(h)?t.options.initialContent:h.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),n.className&&(o.className=n.className),n.style.cssText&&(o.style.cssText=n.style.cssText),/textarea/i.test(n.tagName)?(t.textarea=n,t.textarea.style.display="none"):n.parentNode.removeChild(n),n.id&&(o.id=n.id,i.removeAttributes(n,"id")),n=o,n.innerHTML="")),i.addClass(n,"edui-"+t.options.theme),t.ui.render(n),r=t.options,t.container=t.ui.getDom(),c=i.findParents(n,!0),l=[],u=0;s=c[u];u++)l[u]=s.style.display,s.style.display="block";for(r.initialFrameWidth?r.minFrameWidth=r.initialFrameWidth:(r.minFrameWidth=r.initialFrameWidth=n.offsetWidth,a=n.style.width,/%$/.test(a)&&(r.initialFrameWidth=a)),r.initialFrameHeight?r.minFrameHeight=r.initialFrameHeight:r.initialFrameHeight=r.minFrameHeight=n.offsetHeight,u=0;s=c[u];u++)s.style.display=l[u];n.style.height&&(n.style.height="");t.container.style.width=r.initialFrameWidth+(/%$/.test(r.initialFrameWidth)?"":"px");t.container.style.zIndex=r.zIndex;e.call(t,t.ui.getDom("iframeholder"));t.fireEvent("afteruiready")}t.langIsReady?r():t.addListener("langReady",r)})},t};UE.getEditor=function(n,t){var i=r[n];return i||(i=r[n]=new UE.ui.Editor(t),i.render(n)),i};UE.delEditor=function(n){var t;(t=r[n])&&(t.key&&t.destroy(),delete r[n])};UE.registerUI=function(n,t,i,r){u.each(n.split(/\s+/),function(n){UE._customizeUI[n]={id:r,execFn:t,index:i}})}}();UE.registerUI("message",function(n){function f(){var n=i.ui.getDom("toolbarbox");n&&(r.style.top=n.offsetHeight+3+"px");r.style.zIndex=Math.max(i.options.zIndex,i.iframe.style.zIndex)+1}var e=t.editor.ui,o=e.Message,r,u=[],i=n;i.addListener("ready",function(){r=document.getElementById(i.ui.id+"_message_holder");f();setTimeout(function(){f()},500)});i.addListener("showmessage",function(n,t){t=utils.isString(t)?{content:t}:t;var e=new o({timeout:t.timeout,type:t.type,content:t.content,keepshow:t.keepshow,editor:i}),s=t.id||"msg_"+(+new Date).toString(36);return e.render(r),u[s]=e,e.reset(t),f(),s});i.addListener("updatemessage",function(n,t,i){i=utils.isString(i)?{content:i}:i;var f=u[t];f.render(r);f&&f.reset(i)});i.addListener("hidemessage",function(n,t){var i=u[t];i&&i.hide()})});UE.registerUI("autosave",function(n){var i=null,t=null;n.on("afterautosave",function(){clearTimeout(i);i=setTimeout(function(){t&&n.trigger("hidemessage",t);t=n.trigger("showmessage",{content:n.getLang("autosave.success"),timeout:2e3})},2e3)})})})();
//# sourceMappingURL=ueditor.all.min.js.map
